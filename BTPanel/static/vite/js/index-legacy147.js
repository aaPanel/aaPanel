System.register(["./page_layout-legacy.js?v=1763625242172","./vue-legacy.js?v=1763625242172","./public-legacy.js?v=1763625242172","./file-legacy.js?v=1763625242172","./naive-legacy.js?v=1763625242172","./common-legacy.js?v=1763625242172","./__commonjsHelpers__-legacy.js?v=1763625242172"],(function(e,t){"use strict";var a,n,l,o,s,i,r,d,p,c,u,f,m,g,h,b,x,_,y,v,w,C,U,z,F,k,j,M;return{setters:[e=>{a=e.ap,n=e.n,l=e.m,o=e.bh,s=e._,i=e.fl,r=e.p},e=>{d=e.k,p=e.P,c=e.r,u=e.c,f=e.X,m=e.j,g=e.R,h=e.S,b=e.U,x=e.a3,_=e.a4,y=e.V,v=e.aj,w=e.a2,C=e.au,U=e.an},e=>{z=e.f},e=>{F=e.c},e=>{k=e.bH,j=e.aC,M=e.dg},null,null],execute:function(){var t=document.createElement("style");t.textContent=".n-upload-dragger[data-v-fd46742b]{height:360px;padding:10px}.n-upload-dragger[data-v-fd46742b]:hover{--n-dragger-border-hover: 1px dashed #20a53a}.drag-text[data-v-fd46742b]{margin-top:20px;font-size:16px}.drag-suffix[data-v-fd46742b]{margin-top:12px;color:#777;font-size:14px}.n-data-table[data-v-fd46742b]{--n-th-color-modal: transparent;--n-td-color-modal: transparent;--n-th-color-hover-modal: transparent;--n-td-color-hover-modal: transparent;--n-border-color-modal: transparent}\n",document.head.appendChild(t);const S={class:"p-16px"},$={class:"flex items-center mb-12px"},B={key:1,class:"flex-center flex-col h-300px"},D={class:"drag-text"},E={key:0,class:"drag-suffix"},P=d({__name:"index",props:{path:{default:""},size:{},uploadData:{default:()=>({multiple:!1})},uploadSuccess:{},showSuccessMsg:{type:Boolean,default:!0}},emits:["setConfirm"],setup(e,{expose:t,emit:r}){const d=e,P=r,{path:H,uploadData:L}=d,{t:A}=p(),I=a(),N=c([]),R=c(new Map),T=u((()=>(L.accept||"").split(",").map((e=>`'${e}'`)).join(", "))),V=e=>{const{file:t}=e;return(t.file?.size??0)>1048576*(d.size??1/0)?(l.error(A("Component.UploadFile.index_7",[t.name,d.size])),!1):(L.multiple||(N.value=[]),!0)},X=c([{key:"name",title:A("Component.UploadFile.index_3"),ellipsis:!0},{key:"size",title:A("Component.UploadFile.index_4"),width:100,render:e=>n(e.file?.size)},{key:"status",title:A("Component.UploadFile.index_5"),width:140,render:e=>{if("pending"===e.status)return A("Component.UploadFile.index_8");if("finished"===e.status)return f("span",{class:"text-primary"},[A("Component.UploadFile.index_9")]);if("error"===e.status)return f("span",{class:"text-error"},[m("Upload Failed")]);const t=e.percentage?e.percentage.toFixed(1):0;return f(k,{type:"line",color:I.value.primaryColor,"indicator-placement":"outside",processing:!0,percentage:Number(t)},null)}},z({width:70,options:(e,t)=>[{label:A("Public.Btn.Del"),type:"error",show:"uploading"!==e.status,onClick:()=>N.value.splice(t,1)},{label:A("Public.Btn.Cancel"),type:"warning",show:"uploading"===e.status,onClick:()=>(e=>{const t=e.id||e.name,a=R.value.get(t);a&&(a.abort(),R.value.delete(t),e.status="error",e.percentage=0,l.info(`Upload Canceled: ${e.name}`))})(e)}]})]),q=async(e,t,a,n)=>{const l=10485760,o=Math.ceil(e.size/l);let s=0;for(let i=0;i<o;i++){if(n.signal.aborted)throw new Error("Upload Canceled");const o=s,r=Math.min(e.size,o+l),d=e.slice(o,r),p=r-o,c=new FormData;c.append("f_path",H),c.append("f_name",t),c.append("f_size",e.size.toString()),c.append("f_start",o.toString()),c.append("blob",d);try{const t=await F(c,(t=>{if(n.signal.aborted)return;const l=(s+(t.progress||0)*p)/e.size*100;a(Math.min(l,99))}));let o=r;if(t&&"number"==typeof t.message&&(o=t.message),s=Math.max(s,o),a(Math.min(s/e.size*100,99)),s>=e.size)break;i=Math.floor(s/l)-1}catch{let e=!1;for(let t=0;t<3;t++){if(n.signal.aborted)throw new Error("Upload Canceled");try{await new Promise((e=>setTimeout(e,1e3)));const t=await F(c);if(t&&"number"==typeof t.message){s=t.message,e=!0;break}}catch{e=!1}}if(!e)throw new Error(`Chunk ${i+1} upload failed`)}}return a(100),!0};return t({onConfirm:async()=>{const e=N.value.filter((e=>"pending"===e.status));if(!e.length)return l.error(A("Component.UploadFile.index_10")),!1;P("setConfirm",{disabled:!0}),e.forEach((e=>e.status="uploading"));let t=!0,a=!1;for(const o of e){const e=o.file;if(!e)continue;const n=new AbortController,s=o.id||o.name;R.value.set(s,n);try{if(e.size>52428800){if(!(await q(e,o.name,(e=>o.percentage=e),n))||n.signal.aborted){o.status="error",a=!0;continue}}else{const t=new FormData;t.append("f_path",H),t.append("f_name",o.name),t.append("f_start","0"),t.append("f_size",e.size.toString()),t.append("blob",e),await F(t,(e=>{n.signal.aborted||(o.percentage=100*(e.progress||0))}))}if(n.signal.aborted){o.status="error",a=!0;continue}o.status="finished"}catch{o.status="error",l.error(`${o.name} upload failed}`),t=!1}finally{R.value.delete(s)}}t&&!a&&d.showSuccessMsg&&e.filter((e=>"finished"===e.status)).length&&l.success(A("Component.UploadFile.index_9")),P("setConfirm",{disabled:!1});const n=e.filter((e=>"finished"===e.status));return n.length&&await(d.uploadSuccess?.(n)),t&&!a}}),(e,t)=>{const a=j,n=o,l=M,r=s,d=i;return g(),h("div",S,[b("div",$,[f(n,{ref:"upload",class:"w-auto","file-list":y(N),"onUpdate:fileList":t[0]||(t[0]=e=>v(N)?N.value=e:null),accept:y(L).accept,multiple:y(L).multiple,"default-upload":!1,"show-file-list":!1,onBeforeUpload:V},{default:x((()=>[f(a,{type:"primary"},{default:x((()=>[m(_(e.$t("Component.UploadFile.index_6")),1)])),_:1})])),_:1},8,["file-list","accept","multiple"])]),f(n,{ref:"upload",class:"w-auto","file-list":y(N),"onUpdate:fileList":t[2]||(t[2]=e=>v(N)?N.value=e:null),accept:y(L).accept,multiple:y(L).multiple,"default-upload":!1,"show-file-list":!1,onBeforeUpload:V},{default:x((()=>[f(d,null,{default:x((()=>[y(N).length>0?(g(),w(l,{key:0,"max-height":300,bordered:!1,data:y(N),columns:y(X),onClick:t[1]||(t[1]=C((()=>{}),["stop"]))},null,8,["data","columns"])):(g(),h("div",B,[f(r,{name:"base-upload",size:"48",class:"text-#999"}),b("div",D,_(e.$t("Component.UploadFile.index_1")),1),y(L).accept?(g(),h("div",E,_(e.$t("Component.UploadFile.index_2",[y(T)])),1)):U("",!0)]))])),_:1})])),_:1},8,["file-list","accept","multiple"])])}}});e("default",r(P,[["__scopeId","data-v-fd46742b"]]))}}}));
