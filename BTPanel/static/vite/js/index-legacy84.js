System.register(["./page_layout-legacy.js?v=1767769852656","./index-legacy135.js?v=1767769852656","./index.vue_vue_type_script_setup_true_lang-legacy5.js?v=1767769852656","./index.vue_vue_type_script_setup_true_lang-legacy7.js?v=1767769852656","./index.vue_vue_type_script_setup_true_lang-legacy9.js?v=1767769852656","./naive-legacy.js?v=1767769852656","./vue-legacy.js?v=1767769852656","./index.vue_vue_type_script_setup_true_lang-legacy8.js?v=1767769852656","./index-legacy133.js?v=1767769852656","./public-legacy.js?v=1767769852656","./site-legacy.js?v=1767769852656","./index-legacy244.js?v=1767769852656","./soft-legacy2.js?v=1767769852656","./php-legacy.js?v=1767769852656","./useOperate-legacy.js?v=1767769852656","./common-legacy.js?v=1767769852656","./index.vue_vue_type_script_setup_true_lang-legacy14.js?v=1767769852656","./index-legacy.js?v=1767769852656","./index.vue_vue_type_script_setup_true_lang-legacy.js?v=1767769852656"],function(e,t){"use strict";var a,i,l,n,s,o,r,d,u,c,p,m,f,y,v,g,h,_,x,w,k,S,b,P,C,H,j,B,$,M,U,T,W,N,D,L,V,A,R,O,q,K,F,I,z,E,Q,X,Y,G,J,Z,ee,te,ae,ie,le,ne,se,oe,re,de,ue,ce,pe,me,fe,ye,ve,ge,he,_e,xe,we,ke,Se,be,Pe,Ce,He,je,Be,$e,Me,Ue,Te,We,Ne,De,Le,Ve,Ae,Re,Oe,qe,Ke,Fe,Ie,ze,Ee,Qe,Xe,Ye,Ge,Je,Ze,et,tt,at,it;return{setters:[e=>{a=e.j,i=e.s,l=e.aI,n=e.a,s=e.A,o=e.p,r=e.q,d=e.r,u=e.a7,c=e.d,p=e._,m=e.u,f=e.x,y=e.du,v=e.aa,g=e.m,h=e.o},e=>{_=e._},e=>{x=e._},e=>{w=e._},e=>{k=e._},e=>{S=e.de,b=e.di,P=e.aC,C=e._,H=e.dc,j=e.dd,B=e.d8,$=e.dh,M=e.aX,U=e.da,T=e.bH,W=e.dj,N=e.dm,D=e.au,L=e.dg,V=e.dR,A=e.dV,R=e.dS},e=>{O=e.k,q=e.i,K=e.r,F=e.o,I=e.w,z=e.a2,E=e.V,Q=e.U,X=e.a3,Y=e.W,G=e.S,J=e.F,Z=e.P,ee=e._,te=e.a0,ae=e.R,ie=e.H,le=e.a4,ne=e.l,se=e.v,oe=e.c,re=e.j,de=e.am,ue=e.av,ce=e.ak,pe=e.O,me=e.x,fe=e.s,ye=e.e,ve=e.N,ge=e.ah,he=e.an,_e=e.p},e=>{xe=e._},e=>{we=e._},e=>{ke=e.u,Se=e.T,be=e.t,Pe=e._,Ce=e.h,He=e.F,je=e.e,Be=e.c,$e=e.f,Me=e.a,Ue=e.d,Te=e.U,We=e.m},e=>{Ne=e.s,De=e.d,Le=e.e,Ve=e.f,Ae=e.h,Re=e.i,Oe=e.j,qe=e.k,Ke=e.l},e=>{Fe=e.u},e=>{Ie=e.u},e=>{ze=e.a,Ee=e.b,Qe=e.c},e=>{Xe=e.u},e=>{Ye=e.a3,Ge=e.a4,Je=e.a5,Ze=e.m,et=e.h},e=>{tt=e._},e=>{at=e._},e=>{it=e._}],execute:function(){var lt=document.createElement("style");lt.textContent=".website-name[data-v-5103c19c]{display:flex;align-items:center;gap:8px;width:100%}.website-icon[data-v-5103c19c]{width:24px;flex-shrink:0;cursor:pointer}.website-info[data-v-5103c19c]{flex:1;min-width:0;overflow:hidden}.website-description[data-v-5103c19c]{margin-top:2px}.website-status[data-v-a66f2bce]{display:inline-flex;font-size:20px;cursor:pointer}.n-date-panel[data-v-4583ec55]{margin:0}.n-date-panel[data-v-4583ec55] .n-date-panel-calendar{padding:6px 0 12px}.n-date-panel[data-v-4583ec55] .n-date-panel--month .n-date-panel-footer{display:none}.n-date-panel[data-v-4583ec55] .n-date-panel-footer{padding:12px 0 6px}.n-data-table[data-v-fca1cf0d] .requests .n-data-table-th__title-wrapper{justify-content:center}\n/*$vite$:1*/",document.head.appendChild(lt);const nt=O({__name:"index",props:{disabledKeys:{type:Array,default:()=>[]},hideKeys:{type:Array,default:()=>[]},storeKey:{type:String,default:""},loading:{type:Boolean,default:!1}},setup(e){const t=q("tableRef"),n=K(!1),s=K([]),o=K([]),r=K([]),d=()=>{n.value=!0},u=()=>{n.value=!1},c=()=>{if(!t)return;const e=S(o.value.filter(e=>s.value.includes(String(e.key)))),a=e.length;if(a>0){const t=Math.floor(100/a),i=100-t*a;e.forEach((e,a)=>{if(l(e.width)||!e.width)return;let n=t;a<i&&(n+=1),e.width=`${n}%`})}"selection"===o.value[0].type&&e.unshift(o.value[0]),t.value.setColumns(e)},p=t=>{if(s.value.includes(t)?s.value=s.value.filter(e=>e!==t):s.value.push(t),e.storeKey&&i(e.storeKey,s.value.join(",")),e.loading){const t=I(()=>e.loading,e=>{e||c(),t()})}else c()};return F(()=>{if(t){const i=t.value.getColumns();0===o.value.length&&(o.value=S(i)),(()=>{if(e.storeKey){const t=a(e.storeKey);t&&(s.value=t.split(","))}})(),(()=>{const t=o.value.filter(e=>"selection"!==e.type);0===s.value.length&&(s.value=t.filter(t=>!e.hideKeys.includes(String(t.key))).map(e=>String(e.key))),r.value=t.map(t=>({key:String(t.key),disabled:"operate"===t.key||e.disabledKeys.includes(String(t.key)),label:()=>Y(J,null,[Y(C,{checked:s.value.includes(String(t.key))},null),Y("span",{class:"ml-8px"},[String(t.title).includes("Requests")?"Requests":String(t.title)])])}))})();const l=I(()=>e.loading,e=>{e||c(),l()})}}),(e,t)=>{const a=P,i=b;return E(),z(i,{placement:"bottom-end",show:Q(n),"show-arrow":!0,"arrow-point-to-center":!0,options:Q(r),onSelect:p,onClickoutside:u},{default:X(()=>[Y(a,{onClick:d},{default:X(()=>t[0]||(t[0]=[G("i",{class:"i-famicons:settings-outline text-16px"},null,-1)])),_:1,__:[0]})]),_:1},8,["show","options"])}}}),st=e("u",()=>{const{t:e}=Z();return{openAddSiteModal:()=>{ke({title:e("Site.PHP.index_9"),width:700,height:540,footer:!0,component:ee(()=>n(()=>t.import("./index-legacy238.js?v=1767769852656"),void 0))})},openBackupModal:a=>{ke({title:e("Site.PHP.index_33",[a.name]),width:720,minHeight:200,data:{row:a},component:ee(()=>n(()=>t.import("./index-legacy239.js?v=1767769852656"),void 0))})},openSiteConfig:(a,i={})=>{ke({title:e("Site.PHP.index_13",[a.name,a.addtime]),width:860,height:700,data:{siteInfo:a,config:Object.assign({menu:"",subMenu:""},i)},component:ee(()=>n(()=>t.import("./index-legacy240.js?v=1767769852656").then(e=>e.i),void 0))})},openDeleteSiteConfig:a=>{ke({title:1===a.length?`${e("Site.Cert.index_56")} [${a[0].name}]`:`${e("Site.Cert.index_57")}`,width:480,minHeight:248,footer:!0,data:{rows:a},component:ee(()=>n(()=>t.import("./index-legacy241.js?v=1767769852656"),void 0))})},openSiteAdvancedModal:a=>{ke({title:e("Database.Mysql.index_3"),width:950,height:620,data:{menu:a},component:ee(()=>n(()=>t.import("./index-legacy242.js?v=1767769852656"),void 0))})},openSslLogsModal:a=>{ke({title:e("SSL.Domain.index_5"),width:700,height:450,data:{path:a},component:ee(()=>n(()=>t.import("./ssl-log-legacy.js?v=1767769852656"),void 0))})},openSiteStatisticsModal:(a=!1,i)=>{ke({title:i?`[${i}] ${e("Website statistics")}`:e("Website statistics"),width:900,minHeight:450,data:{name:i,showTops5:a},component:ee(()=>n(()=>t.import("./index-legacy243.js?v=1767769852656"),void 0))})}}}),ot={class:"website-name"},rt={key:1,class:"flex-center w-24px h-24px rounded-50%"},dt=["src"],ut={class:"flex flex-col flex-1 w-0 overflow-hidden"},ct={class:"flex items-center gap-8px"},pt={class:"min-w-0"},mt={class:"website-description"},ft=o(O({__name:"Name",props:{ico:{type:String,default:""},name:{type:String,default:"--"},description:{type:String,default:"--"}},emits:["clickName","clickServer","blur"],setup(e,{emit:t}){const a=s(),{theme:i}=te(a),l=t,n=()=>{l("clickName")},o=()=>{l("clickServer")},r=()=>{window.open(`http://${e.name}`)},d=e=>{l("blur",e)};return(t,a)=>{const l=H,s=P,u=Se;return E(),ae("div",ot,[G("div",{class:"website-icon",onClick:o},[e.ico?(E(),ae("div",rt,[G("img",{src:e.ico,class:"w-full h-full"},null,8,dt)])):(E(),ae("div",{key:0,class:ie(["flex-center w-24px h-24px rounded-50%","dark"!==Q(i)&&"bg-#F1F9F3"])},[G("i",{class:ie(["i-mdi:earth text-18px","dark"!==Q(i)&&"text-primary"])},null,2)],2))]),G("div",ut,[G("div",ct,[G("div",pt,[Y(l,{class:"max-w-full",tooltip:{contentStyle:{maxWidth:"200px"}}},{default:X(()=>[G("span",{class:ie(["cursor-pointer","dark"!==Q(i)&&"text-primary"]),onClick:n},le(e.name),3)]),_:1})]),Y(s,{type:"primary",text:"",onClick:r},{default:X(()=>a[0]||(a[0]=[G("i",{class:"i-fa-solid:external-link-alt"},null,-1)])),_:1,__:[0]})]),G("div",mt,[Y(u,{value:e.description,onBlur:d},null,8,["value"])])])])}}}),[["__scopeId","data-v-5103c19c"]]),yt={class:"i-famicons:play-circle-outline"},vt={class:"i-famicons:pause-circle-outline text-warning"},gt=o(O({__name:"Status",props:{status:{type:String,default:"0"},checkedValue:{type:String,default:"1"},unCheckedValue:{type:String,default:"0"},onUpdateValue:{type:Function}},setup(e){const t=()=>{e.onUpdateValue?.(e.status===e.checkedValue?e.unCheckedValue:e.checkedValue)};return(a,i)=>(E(),ae("div",{class:"website-status",onClick:t},[ne(G("i",yt,null,512),[[se,e.status===e.checkedValue]]),ne(G("i",vt,null,512),[[se,e.status===e.unCheckedValue]])]))}}),[["__scopeId","data-v-a66f2bce"]]),ht=O({__name:"Backup",props:{count:{type:Number,default:0},lastTime:{type:String,default:""}},emits:["showBackup"],setup(e,{emit:t}){const a=t,i=()=>{a("showBackup")},l=t=>Ye(new Date,e.lastTime||new Date)>=t,n=oe(()=>{if(0===e.count)return"Backup now";const t=Ye(new Date,e.lastTime||new Date);return 0===t?"Today":1===t?"Yesterday":`${t} days ago`}),s=oe(()=>l(30)||e.count<=0?"error":l(7)?"warning":"primary");return(t,a)=>{const l=j,o=B;return E(),ae("div",{class:"flex items-center gap-8px cursor-pointer",onClick:i},[Y(l,{type:Q(s),size:"small",bordered:!1},{default:X(()=>[re(le(e.count),1)]),_:1},8,["type"]),Y(o,{disabled:0===e.count},{trigger:X(()=>[G("div",{class:ie({"text-error":"error"===Q(s),"text-warning":"warning"===Q(s)})},le(Q(n)),3)]),default:X(()=>[re(" "+le(e.lastTime),1)]),_:1},8,["disabled"])])}}}),_t={class:"inline-flex items-center w-full"},xt={class:"flex-1 text-right"},wt={class:"flex-1 text-left"},kt=O({__name:"Quick",props:{path:{type:String,default:""},phpVersion:{type:String,default:""}},emits:["showPhp"],setup(e,{emit:t}){const a=t,i=de(),l=()=>{d("Path",e.path),i.push("/files")},n=()=>{a("showPhp")};return(t,a)=>{const i=P,s=B,o=r;return E(),ae("div",_t,[G("div",xt,[Y(s,{trigger:"hover"},{trigger:X(()=>[Y(i,{text:"",onClick:l},{default:X(()=>a[0]||(a[0]=[G("i",{class:"i-fa:folder-open-o text-13px"},null,-1)])),_:1,__:[0]})]),default:X(()=>[re(" "+le(e.path),1)]),_:1})]),Y(o,{vertical:""}),G("div",wt,[Y(i,{text:"",onClick:n},{default:X(()=>[re(le(e.phpVersion),1)]),_:1})])])}}}),St={class:"flex justify-end"},bt=o(O({__name:"ExpiredDate",props:{value:{type:String,default:"0000-00-00"},onUpdateValue:{type:Function}},setup(e){const{t:t}=Z(),a=ue("popoverRef"),i=K(null),l=oe(()=>{const t=new Date(e.value);return"0000-00-00"!==e.value&&Ge(t,Je())}),n=oe(()=>"0000-00-00"===e.value?t("Site.PHP.index_34"):l.value?t("Site.PHP.index_28"):e.value),s=e=>Ge(e,Ze(Je(),1)),o=oe(()=>{const t=new Date(e.value);return"0000-00-00"!==e.value&&Ge(t,Ze(Je(),7))}),r=async()=>{await(e.onUpdateValue?.("0000-00-00")),a.value?.setShow(!1)},d=async()=>{if(null===i.value)return;const t=et(i.value,"yyyy-MM-dd");await(e.onUpdateValue?.(t)),a.value?.setShow(!1)},c=()=>{i.value="0000-00-00"===e.value?null:new Date(e.value).getTime()};return(e,t)=>{const p=P,m=M,f=u,y=$;return E(),z(y,{ref_key:"popoverRef",ref:a,placement:"bottom",trigger:"click"},{trigger:X(()=>[Y(p,{type:Q(l)?"error":Q(o)?"warning":"default",text:!0,onClick:c},{default:X(()=>[re(le(Q(n)),1)]),_:1},8,["type"])]),default:X(()=>[Y(f,{value:Q(i),"onUpdate:value":t[0]||(t[0]=e=>ce(i)?i.value=e:null),type:"date",panel:!0,actions:null,"is-date-disabled":s},{footer:X(()=>[G("div",St,[Y(m,{size:"small"},{default:X(()=>[Y(p,{onClick:r},{default:X(()=>[re(le(e.$t("Site.PHP.index_34")),1)]),_:1}),Y(p,{disabled:null===Q(i),onClick:d},{default:X(()=>[re(le(e.$t("Public.Btn.Confirm")),1)]),_:1},8,["disabled"])]),_:1})])]),_:1},8,["value"])]),_:1},512)}}}),[["__scopeId","data-v-4583ec55"]]),Pt=["onClick"],Ct={class:"whitespace-nowrap mr-10px"},Ht={class:"w-120px"},jt=O({__name:"Ssl",props:{config:{type:[Number,Object],default:-1},sslApplyList:{type:Array,default:()=>[]}},emits:["click"],setup(e,{emit:t}){const a=t,{openSslLogsModal:i}=st(),l=()=>{a("click")};return(t,a)=>{const n=P,s=T,o=p,r=U;return Q(c)(e.config)?(E(),z(n,{key:0,type:e.config.endtime<0?"error":"primary",text:"",onClick:l},{default:X(()=>[re(le(e.config.endtime<0?t.$t("Site.PHP.index_28"):t.$t("Site.PHP.index_29",[e.config.endtime])),1)]),_:1},8,["type"])):e.sslApplyList.length>0?(E(!0),ae(J,{key:1},pe(e.sslApplyList,e=>(E(),ae("div",{class:"flex flex-nowrap! p-10px cursor-pointer justify-between items-center",key:e.task_name,onClick:t=>{return a=t,l=e.task_log,a.stopPropagation(),void i(l);var a,l}},[G("span",Ct,le(e.task_name),1),Y(r,{class:"items-center flex-nowrap!"},{default:X(()=>[G("div",Ht,[Y(s,{class:"w-full",type:"line",status:"success","indicator-placement":"inside",percentage:e.task_status,processing:100!==e.task_status},null,8,["percentage","processing"])]),Y(o,{name:"base-left-logs",size:"18",color:"#666666"})]),_:2},1024)],8,Pt))),128)):(E(),z(n,{key:2,type:"warning",text:"",onClick:l},{default:X(()=>[re(le(t.$t("Site.PHP.index_30")),1)]),_:1}))}}}),Bt={class:"text-left"},$t={class:"cursor-pointer"},Mt=O({__name:"Requests",props:{name:{type:String,default:""},total:{type:[Number,String],default:0},value:{type:Array,default:()=>[]}},setup(e){const{openSiteStatisticsModal:t}=st(),a=oe(()=>e.total.toLocaleString("en-US")),i=oe(()=>({xAxis:{type:"category",data:e.value.map(e=>e.date)},yAxis:{type:"value",show:!1},series:[{name:"页面浏览量",data:e.value.map(e=>e.value),type:"line",lineStyle:{color:"#20a53a",width:2},areaStyle:{color:"rgba(32, 165, 58, 0.1)"},symbol:"none"}],grid:{left:0,right:0,top:0,bottom:0}}));return(l,n)=>(E(),ae("div",{class:"flex flex-col gap-3px cursor-pointer",onClick:n[0]||(n[0]=a=>Q(t)(!1,e.name))},[G("div",Bt,le(Q(a)),1),G("div",$t,[Y(tt,{type:"line",option:Q(i),height:"15px"},null,8,["option"])])]))}}),Ut={class:"flex w-full items-center"},Tt={class:"flex-1 flex items-center justify-end"},Wt={class:"flex-1 flex justify-start"},Nt=O({__name:"Waf",props:{siteName:{type:String,default:""},total:{type:Number,default:0},status:{type:Boolean,default:!1},onUpdateStatus:{type:Function}},setup(e){const{openSiteWaf:t}=Xe();return(a,i)=>{const l=P,n=r,s=W;return E(),ae("div",Ut,[G("div",Tt,[Y(l,{text:"",onClick:i[0]||(i[0]=a=>Q(t)(e.siteName))},{default:X(()=>[re(le(e.total),1)]),_:1})]),Y(n,{vertical:""}),G("div",Wt,[Y(s,{value:e.status,size:"small","onUpdate:value":e.onUpdateStatus},null,8,["value","onUpdate:value"])])])}}}),Dt={class:"inline-flex items-center"},Lt=O({__name:"OperateMenu",emits:["clickConfig","clickLog","clickOperate"],setup(e,{emit:t}){const a=t,i=[{key:"scan",label:"Security Scan",icon:()=>Y("i",{class:"i-ant-design:security-scan-outlined text-18px"},null)},{key:"delete",label:"Delete WebSite",icon:()=>Y("i",{class:"i-weui:delete-outlined text-18px"},null)}],l=e=>{a("clickOperate",e)};return(e,t)=>{const n=P,s=r,o=b;return E(),ae("div",Dt,[Y(n,{type:"primary",text:"",onClick:t[0]||(t[0]=e=>a("clickConfig"))},{default:X(()=>t[2]||(t[2]=[re("Conf",-1)])),_:1,__:[2]}),Y(s,{vertical:""}),Y(n,{class:"mr-8px",type:"primary",text:"",onClick:t[1]||(t[1]=e=>a("clickLog"))},{default:X(()=>t[3]||(t[3]=[re("Log",-1)])),_:1,__:[3]}),Y(o,{trigger:"click",options:i,onSelect:l},{default:X(()=>t[4]||(t[4]=[G("i",{class:"i-famicons:ellipsis-vertical text-18px cursor-pointer"},null,-1)])),_:1,__:[4]})])}}}),Vt=O({__name:"index",emits:["fetchTable","update:sorter","update:monitorMap"],setup(e,{expose:t,emit:i}){const l=i,n=Fe(),s=m(),{isFree:o,siteMonitorStatus:r}=te(s),{webserver:d,waf:u,isWafInstall:p,monitor:g,isMonitorInstall:h}=te(n),{t:_}=Z(),{openBackupModal:x,openSiteConfig:w,openDeleteSiteConfig:k}=st(),{setSiteStatus:S}=Xe(),b=K([{type:"selection",width:40,minWidth:40,maxWidth:40},{key:"name",title:_("Site.PHP.index_17"),minWidth:160,sorter:!0,sortOrder:!1,render:e=>Y(ft,{ico:e.ico,name:e.name,description:e.ps,onClickName:()=>{w(e)},onClickServer:()=>{w(e,{menu:"webserver"})},onBlur:async t=>{await Ne({id:e.id,ps:t}),e.ps=t}},null)},{key:"status",title:_("Public.Table.Status"),align:"center",className:"sort-center",width:90,minWidth:90,maxWidth:90,sorter:!0,sortOrder:!1,render:e=>Y(gt,{status:e.status,onUpdateValue:t=>{S(t,e)}},null)},{key:"backup_count",title:_("Site.PHP.index_19"),width:"10%",minWidth:110,render:e=>Y(ht,{count:e.backup_count,lastTime:e.last_backup_time,onShowBackup:()=>{x(e)}},null)},{key:"path",title:"Quick action",align:"center",width:"8%",minWidth:100,render:e=>Y(kt,{path:e.path,phpVersion:e.php_version,onShowPhp:()=>{w(e,{menu:"php"})}},null)},be({type:"site",minWidth:70,callback:()=>{l("fetchTable")}}),{key:"edate",title:"Expiration",align:"center",width:"8%",minWidth:80,render:e=>Y(bt,{value:e.edate,onUpdateValue:async t=>{await De({id:e.id,edate:t}),e.edate=t}},null)},{key:"site_ssl",title:_("Site.PHP.index_27"),align:"center",width:100,minWidth:100,maxWidth:100,sorter:!0,sortOrder:!1,className:"sort-center",render:e=>{const t=V.value.filter(t=>t.target_id===e.id);return Y(jt,{config:e.ssl,sslApplyList:t,onClick:()=>{w(e,{menu:"ssl"})}},null)}},{key:"requests",sorter:!0,sortOrder:!1,className:"requests",title:()=>Y("span",{class:"inline-flex items-center gap-6px"},[Y("span",null,[re("Requests")]),Y($,{trigger:"hover"},{trigger:()=>Y("i",{class:"i-uiw:question-circle-o text-16px text-desc cursor-pointer"},null),default:()=>Y(Pe,null,{default:()=>["",Y("li",null,[re("The monitoring report data will be updated as the website list is refreshed")]),Y("li",null,[re("The monitoring report plugin will use the plugin's data; if it is not installed, free monitoring report data will be used.")])]})})]),align:"center",width:"12%",minWidth:120,render:e=>{if("nginx"!==d.value&&"apache"!==d.value)return"--";if(!r.value&&o.value)return Y(P,{type:"primary",text:!0,onClick:()=>{He({source:216})}},{default:()=>[re("Active")]});if(!h.value&&!r.value)return Y(P,{type:"primary",text:!0,onClick:()=>{Ie("monitor",async()=>{await n.getConfig(),l("fetchTable"),M()})}},{default:()=>[1===g.value.is_install?_("Public.Btn.Update"):_("Public.Btn.Install")]});const t=H.value[e.name];if(!N(t)){const a=j(t),i=B(t);return Y(Mt,{name:e.name,total:a,value:i},null)}return"--"}},{key:"waf",title:"WAF",align:"center",width:"10%",minWidth:100,render:e=>{if("nginx"!==d.value)return"--";if(o.value)return Y(P,{type:"primary",text:!0,onClick:()=>{He({source:216})}},{default:()=>[re("Active")]});if(!p.value)return Y(P,{type:"primary",text:!0,onClick:()=>{Ie("btwaf",async()=>{await n.getConfig(),l("fetchTable"),W()})}},{default:()=>[1===u.value.is_install?_("Public.Btn.Update"):_("Public.Btn.Install")]});const t=U.value.find(t=>t.siteName===e.name);if(c(t)){const a=T(t);return Y(Nt,{siteName:e.name,total:a,status:t.open,onUpdateStatus:async a=>{await Qe({siteName:e.name,obj:"open"}),t.open=a}},null)}return"--"}},{key:"operate",title:_("Public.Table.Operation"),align:"right",width:110,minWidth:110,maxWidth:110,render:e=>Y(Lt,{onClickConfig:()=>{w(e)},onClickLog:()=>{w(e,{menu:"logs"})},onClickOperate:t=>{switch(t){case"scan":w(e,{menu:"logs",subMenu:"security"});break;case"delete":k([e])}}},null)}]),C=e=>{b.value.forEach(t=>{const a=t;a.key===e.columnKey?a.sortOrder=e.order:a.sortOrder=!1});const t="descend"===e.order?"desc":"ascend"===e.order?"asc":"";if("requests"===e.columnKey)return void l("update:monitorMap",t);const a=t?`${e.columnKey} ${t}`:"";l("update:sorter",a)},H=me({}),j=e=>e.total?e.total.request:0,B=e=>e.list.map(e=>({date:e.date,value:e.request})),M=async()=>{if("nginx"!==d.value&&"apache"!==d.value)return;if(o.value&&!r.value)return;const{message:e}=await ze((()=>{const e=new Date,t=Ze(e,-30);return{start_date:v(t,"yyyy-MM-dd"),end_date:v(e,"yyyy-MM-dd")}})());c(e)&&(H.value=e)},U=K([]),T=e=>e.total.reduce((e,t)=>e+t.value,0),W=async()=>{if(o.value)return;if(!p.value)return;const{message:e}=await Ee({p:1,limit:1e3,search:""});c(e)&&(U.value=f(e.data)?e.data.map(e=>({open:e.open,total:e.total,siteName:e.siteName})):[])};let D=null;const L=K(!1),V=K([]),A=async()=>{D&&clearTimeout(D);const{message:e}=await y();f(e)&&(V.value=e,e.length>0?(L.value=!0,D=window.setTimeout(()=>{A()},3e3)):(L.value&&l("fetchTable"),D&&clearTimeout(D)))};return(()=>{const e=a("site-php-order","");if(e){const[t,a]=e.split(" "),i=b.value.find(e=>e.key===t);i&&(i.sortOrder="asc"===a?"ascend":"descend")}})(),t({getMonitorData:M,getNginxWafConfig:W,getSSLApplyList:A,getColumns:()=>b.value,setColumns:e=>{b.value=e}}),(e,t)=>{const a=Ce;return E(),z(a,fe(e.$attrs,{columns:Q(b),"onUpdate:sorter":C}),null,16,["columns"])}}}),At=o(Vt,[["__scopeId","data-v-fca1cf0d"]]),Rt={class:"p-20px"},Ot={class:"flex-1"},qt={class:"mt-12px"},Kt={class:"px-20px pt-24px pb-8px"},Ft={class:"w-150px"},It=O({__name:"set",props:{data:{}},setup(e){const{t:t}=Z(),a=e,{setOptions:i}=a.data,l=K(""),n=async()=>{const e=l.value.trim();""!==e?(await Ae({name:e}),l.value="",await m(),i?.(c.data)):g.error(t("Site.PHP.index_46"))},s=je(),o=K(null),r=ye({id:-1,name:""}),d={name:{required:!0,message:t("Site.PHP.index_46"),trigger:["blur","change"]}},u=async({hide:e})=>{await(o.value?.validate()),await Re(ve(r)),await m(),i?.(c.data),e()},{table:c,columns:p}=Be([{key:"name",title:"Name"},$e({width:120,options:e=>[{label:t("Public.Btn.Edit"),disabled:0===e.id,onClick:()=>{(e=>{r.id=e.id,r.name=e.name,s.title=`${t("Site.PHP.index_48")} [${e.name}]`,s.show=!0})(e)}},{label:t("Public.Btn.Delete"),disabled:0===e.id,onClick:()=>{Me({title:`${t("Site.PHP.index_49")} [${e.name}]`,content:t("Site.PHP.index_50"),onConfirm:async({hide:t})=>{await Le({id:e.id}),await m(),i?.(c.data,e.id),t()}})}}]})]),m=async()=>{const{message:e}=await Ve();c.data=f(e)?e:[]};return m(),(e,t)=>{const a=D,i=P,m=U,f=L,y=V,v=it,g=at;return E(),ae("div",Rt,[Y(m,null,{default:X(()=>[G("div",Ot,[Y(a,{value:Q(l),"onUpdate:value":t[0]||(t[0]=e=>ce(l)?l.value=e:null),placeholder:e.$t("Site.PHP.index_46")},null,8,["value","placeholder"])]),G("div",null,[Y(i,{type:"primary",onClick:n},{default:X(()=>[re(le(e.$t("Site.Cert.index_62")),1)]),_:1})])]),_:1}),G("div",qt,[Y(f,{"max-height":300,data:Q(c).data,columns:Q(p)},null,8,["data","columns"])]),Y(g,{show:Q(s).show,"onUpdate:show":t[2]||(t[2]=e=>Q(s).show=e),title:Q(s).title,width:350,footer:!0,onConfirm:u},{default:X(()=>[G("div",Kt,[Y(v,{ref_key:"formRef",ref:o,model:Q(r),rules:d},{default:X(()=>[Y(y,{label:e.$t("Site.PHP.index_47"),path:"name"},{default:X(()=>[G("div",Ft,[Y(a,{value:Q(r).name,"onUpdate:value":t[1]||(t[1]=e=>Q(r).name=e),placeholder:""},null,8,["value"])])]),_:1},8,["label"])]),_:1},8,["model"])])]),_:1},8,["show","title"])])}}}),zt={class:"w-160px"},Et=O({__name:"index",props:{value:{default:null}},emits:["change","update:value"],setup(e,{emit:t}){const a=t,i=ge(e,"value"),{t:l}=Z(),{loading:n,setLoading:s}=Ue(),o=K([]),r=async e=>{a("change"),a("update:value",e),sessionStorage.setItem("typeValue",e)},d=je(l("Site.PHP.index_44"),{setOptions:(e,t)=>{t===i.value&&(i.value=-1),o.value=e.map(e=>({label:e.name,value:e.id})),c()}}),u=()=>{d.show=!0},c=()=>{o.value.unshift({label:l("Site.PHP.index_45"),value:-1})};return c(),F(()=>{(async()=>{try{s(!0);const{message:e}=await Ve();f(e)?o.value=e.map(e=>({label:e.name,value:e.id})):o.value=[],c()}finally{s(!1);const e=sessionStorage.getItem("typeValue");i.value=e?Number(e):-1}})()}),(e,t)=>{const a=P,l=A,s=at;return E(),ae("div",zt,[Y(l,{value:Q(i),"onUpdate:value":t[0]||(t[0]=e=>ce(i)?i.value=e:null),loading:Q(n),options:Q(o),onUpdateValue:r},{action:X(()=>[Y(a,{block:"",onClick:u},{default:X(()=>[re(le(e.$t("Site.PHP.index_43")),1)]),_:1})]),_:1},8,["value","loading","options"]),Y(s,{show:Q(d).show,"onUpdate:show":t[1]||(t[1]=e=>Q(d).show=e),width:350,title:Q(d).title,data:Q(d).data,component:It},null,8,["show","title","data"])])}}}),Qt=O({__name:"index",setup(e){const l=Fe(),s=m(),{web:o,webserver:r}=te(l),{t:d}=Z(),{openAddSiteModal:u,openSiteAdvancedModal:c,openDeleteSiteConfig:p,openSiteStatisticsModal:f}=st(),{tableConfig:y,tableData:v,pageConfig:g,tableParams:S,fetchTable:C,resetTable:H,setLoading:j}=Te({params:{p:1,limit:10,table:"sites",search:"",order:a("site-php-order",""),type:-1,re_order:""},immediate:!1,fetchFn:Ke}),B=ue("siteTableRef");_e("tableRef",B);const $=K(!1),U=K([]),T=[{label:d("Site.PHP.index_5"),key:"default-page"},{label:d("Site.PHP.index_6"),key:"default-site"},{label:d("Site.PHP.index_7"),key:"php-version"},{label:d("Site.PHP.index_86"),key:"https"},{label:d("CDN Resolution"),key:"global"}],W=[{key:"enable",type:"confirm",label:d("Site.Batch.index_1"),confirm:{title:d("Site.Batch.index_2"),desc:d("Site.Batch.index_3"),columns:[{key:"name",title:d("Site.PHP.index_17")}],api:e=>Oe(!0,{id:e.id,name:e.name},!1),done:()=>{C(!1)}}},{key:"disable",type:"confirm",label:d("Site.Batch.index_4"),confirm:{title:d("Site.Batch.index_5"),desc:d("Site.Batch.index_6"),columns:[{key:"name",title:d("Site.PHP.index_17")}],api:e=>Oe(!1,{id:e.id,name:e.name},!1),done:()=>{C(!1)}}},{key:"backup",type:"confirm",label:d("Site.Batch.index_7"),confirm:{title:d("Site.Batch.index_8"),desc:d("Site.Batch.index_9"),columns:[{key:"name",title:d("Site.PHP.index_17")}],api:e=>qe({id:e.id},!1),done:()=>{C(!1)}}},{key:"expired",label:d("Site.PHP.index_70"),onBatch:e=>{ke({title:d("Site.PHP.index_71"),width:380,minHeight:72,footer:!0,data:{rows:e},component:ee(()=>n(()=>t.import("./expired-legacy.js?v=1767769852656"),void 0))})}},{key:"php",label:d("Site.PHP.index_66"),onBatch:e=>{ke({title:d("Site.PHP.index_65"),width:500,minHeight:198,footer:!0,data:{rows:e,refresh:O},component:ee(()=>n(()=>t.import("./php-legacy2.js?v=1767769852656"),void 0))})}},{key:"category",label:d("Crontab.Planned.index_19"),onBatch:e=>{ke({title:d("Site.Batch.index_22"),width:350,minHeight:72,footer:!0,data:{rows:e},component:ee(()=>n(()=>t.import("./category-legacy.js?v=1767769852656"),void 0))})}},{key:"webserver",label:"Switch service",onBatch:e=>{ke({title:"Batch switch service",width:450,minHeight:150,footer:!0,data:{rows:e},component:ee(()=>n(()=>t.import("./webserver-legacy.js?v=1767769852656"),void 0))})}},{key:"delete",label:d("Site.Batch.index_10"),onBatch:e=>{p(e)}}],N=()=>{u()},D=e=>{S.value.order=e,i("site-php-order",e),C()},L=e=>{S.value.p=1,S.value.limit=100,S.value.re_order=e,C()},V=e=>{c(e)},A=async()=>{await H(),B.value?.getNginxWafConfig(),B.value?.getMonitorData(),B.value?.getSSLApplyList(),U.value=[]},O=async(e=!1)=>{await C(e,!0),B.value?.getSSLApplyList(),B.value?.getNginxWafConfig(),B.value?.getMonitorData(),U.value=[]},q=async()=>{try{j(!0),await l.getConfig(),$.value=o.value.setup,o.value.setup&&await O()}finally{j(!1)}};return I(()=>l.isRefresh,e=>{e&&(l.setRefresh(!1),O())}),I(()=>s.taskCount,()=>{q()}),j(!0),F(async()=>{q()}),(e,t)=>{const a=h,i=P,l=b,n=M,s=we,d=xe,u=nt,p=k,m=w,H=x,j=_,q=R;return E(),z(q,null,{default:X(()=>[Y(j,{install:Q(o).setup},{desc:X(()=>[G("span",null,le(e.$t("Site.PHP.index_1")),1),Y(a,{class:"ml-4px",onClick:t[0]||(t[0]=e=>Q(We)("nginx"))},{default:X(()=>[re(le(e.$t("Site.PHP.index_2")),1)]),_:1}),t[8]||(t[8]=G("span",{class:"mx-4px"},"|",-1)),Y(a,{onClick:t[1]||(t[1]=e=>Q(We)("apache"))},{default:X(()=>[re(le(e.$t("Site.PHP.index_3")),1)]),_:1})]),default:X(()=>[Y(H,{class:"p-16px",feedback:!0},{toolsLeft:X(()=>[Y(i,{type:"primary",class:"add-site-btn",onClick:N},{default:X(()=>[re(le(e.$t("Site.PHP.index_4")),1)]),_:1}),Y(n,null,{default:X(()=>[Y(i,{onClick:t[2]||(t[2]=e=>Q(c)())},{default:X(()=>[re(le(e.$t("Database.Mysql.index_3")),1)]),_:1}),Y(l,{trigger:"hover",options:T,onSelect:V},{default:X(()=>[Y(i,null,{default:X(()=>t[9]||(t[9]=[G("i",{class:"i-fa:angle-down"},null,-1)])),_:1,__:[9]})]),_:1})]),_:1}),Y(i,{onClick:t[3]||(t[3]=e=>Q(f)(!0))},{default:X(()=>[re(le(e.$t("Statistics")),1)]),_:1}),Q($)?(E(),z(s,{key:0,"soft-name":Q(r),"is-web-site":!0},null,8,["soft-name"])):he("",!0)]),toolsRight:X(()=>[Y(Et,{value:Q(S).type,"onUpdate:value":t[4]||(t[4]=e=>Q(S).type=e),onChange:A},null,8,["value"]),Y(d,{value:Q(S).search,"onUpdate:value":t[5]||(t[5]=e=>Q(S).search=e),placeholder:e.$t("Site.PHP.index_8"),onSearch:A},null,8,["value","placeholder"]),Y(u,{"store-key":"site-php-columns",loading:Q(y).loading,"hide-keys":["quota"],"disabled-keys":["name"]},null,8,["loading"])]),table:X(()=>[Y(At,fe({ref_key:"siteTableRef",ref:B,"checked-row-keys":Q(U),"onUpdate:checkedRowKeys":t[6]||(t[6]=e=>ce(U)?U.value=e:null)},Q(y),{onFetchTable:Q(C),"onUpdate:sorter":D,"onUpdate:monitorMap":L}),null,16,["checked-row-keys","onFetchTable"])]),pageLeft:X(()=>[Y(p,{"checked-row-keys":Q(U),"onUpdate:checkedRowKeys":t[7]||(t[7]=e=>ce(U)?U.value=e:null),data:Q(v),options:W},null,8,["checked-row-keys","data"])]),pageRight:X(()=>[Y(m,fe(Q(g),{"store-key":"site-php-page",onRefresh:O}),null,16)]),_:1})]),_:1},8,["install"])]),_:1})}}}),Xt=Object.freeze(Object.defineProperty({__proto__:null,default:Qt},Symbol.toStringTag,{value:"Module"}));e("i",Xt)}}});
