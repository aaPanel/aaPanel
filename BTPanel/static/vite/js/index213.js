import{d as a,_ as e,af as l,ag as s,u as t,ah as n,ai as i,aj as d,aC as o}from"./public.js?v=1762424784323";import{_ as u}from"./index.vue_vue_type_script_setup_true_lang.js?v=1762424784323";import{a3 as r}from"./site.js?v=1762424784323";import{aV as p,S as m,d as _,w as c}from"./page_layout.js?v=1762424784323";import{a as h}from"./ssl-lets-progress.js?v=1762424784323";import{dR as f,dT as v,dU as y,_ as S,dV as x,au as g,eg as w,da as b,d5 as k}from"./naive.js?v=1762424784323";import{k as L,P as A,r as j,e as $,c as z,w as Z,o as U,R,V as E,W as O,a3 as C,an as F,U as J,j as V,a4 as q,a2 as H,F as M,O as N,S as P}from"./vue.js?v=1762424784323";import"./common.js?v=1762424784323";import"./__commonjsHelpers__.js?v=1762424784323";import"./index.js?v=1762424784323";const W={class:"p-16px"},B={key:0},T={key:1},D=L({__name:"index",props:{onRefresh:{type:Function},onOpenLog:{type:Function}},setup(L,{expose:D}){const{t:G}=A(),I=L,K=j(null),Q=$({auth_type:"dns",dns_manual:0,site:0,type:"wildcard",domains:"",domains_list:[],all:!1}),X=j([{label:G("SSL.index_17"),value:"single"},{label:G("SSL.index_18"),value:"wildcard"},{label:G("SSL.index_19"),value:"wildcard_all"}]),Y=j([]),aa=j([]),ea=()=>{Q.domains=""},la=()=>{Q.domains_list=[],oa()},sa=z(()=>Q.domains_list.length>0&&Q.domains_list.length<aa.value.length);Z(()=>Q.domains_list,a=>{a.length===aa.value.length?Q.all=!0:a.length||(Q.all=!1)}),Z(()=>Q.all,a=>{var e;a?(Q.domains_list=aa.value.map(a=>a.name),null==(e=K.value)||e.validate()):Q.domains_list=[]});const ta={domains:{required:!0,trigger:"input",validator:(a,e)=>{if("single"===Q.type){if(!e)return new Error(G("SSL.index_20"));if(!/^[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+$/.test(e))return new Error(G("SSL.index_21"))}else if("wildcard"===Q.type){if(!e)return new Error(G("SSL.index_22"));if(!/^(?:\*\.)?(?:[a-zA-Z0-9-]+\.)?[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+(\n(?:\*\.)?(?:[a-zA-Z0-9-]+\.)?[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+)*$/.test(e))return new Error(G("SSL.index_23"))}else if("wildcard_all"===Q.type){if(!e)return new Error(G("SSL.index_24"));if(!/^\*\.[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+(\n\*\.[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+)*$/i.test(e))return new Error(G("SSL.index_25"))}return!0}},domains_list:{required:!0,trigger:"change",type:"array",message:G("SSL.SiteSSL.index_16")}},na=()=>({auth_type:Q.dns_manual?"dns_manual":Q.auth_type,domains:JSON.stringify("http"===Q.auth_type?Q.domains_list:"single"===Q.type?[Q.domains]:Q.domains.split("\n")),site_id:Q.dns_manual?-1:void 0}),{loading:ia,setLoading:da}=a(),oa=async()=>{try{da(!0);const{message:a}=await r({id:Q.site});c(a)&&(aa.value=a.map(a=>({name:a.name})))}finally{da(!1)}};return U(async()=>{await(async()=>{const{message:a}=await o();c(a)&&(Y.value=a.map(a=>({label:a.name,value:a.id})),Q.site=Y.value[0].value)})(),oa()}),D({onConfirm:async()=>{var a;if(await(null==(a=K.value)?void 0:a.validate()),Q.dns_manual&&"dns"===Q.auth_type){const a=JSON.stringify("single"===Q.type?[Q.domains]:Q.domains.split("\n")),{message:e}=await l({site_id:-1,domains:a});if(_(e)&&Object.keys(e).length)return s(e.auths,-1,[Q.domains],()=>{I.onRefresh()},!0),!1;const u=t({width:500,height:300,hideClose:!0,component:n});try{const{message:a}=await i(na(),!1);if(_(a)){if(a.deploy)return void I.onRefresh();Array.isArray(a.auths)&&a.auths.length&&s(a.auths,-1,[Q.domains],()=>{I.onRefresh()})}}catch(o){d(k(o,"message",""))}finally{u.hide()}return}const{message:e}=await i(na());_(e)&&t({hideClose:!0,data:{isJump:!1,task_id:e.task_id,onFinish:()=>{I.onRefresh()}},component:h}),I.onRefresh()}}),(a,l)=>{const s=y,t=p,n=v,i=f,d=S,o=x,r=g,_=b,c=w,h=m,k=u,L=e;return E(),R("div",W,[O(k,{ref_key:"formRef",ref:K,model:J(Q),rules:ta,"label-width":"150px"},{default:C(()=>[O(i,{label:a.$t("Waf.Setting.config_67"),path:"verify_method"},{default:C(()=>[O(n,{value:J(Q).auth_type,"onUpdate:value":l[0]||(l[0]=a=>J(Q).auth_type=a)},{default:C(()=>[O(t,null,{default:C(()=>[O(s,{value:"dns"},{default:C(()=>[V(q(a.$t("SSL.index_12")),1)]),_:1}),O(s,{value:"http"},{default:C(()=>[V(q(a.$t("SSL.SiteSSL.index_17")),1)]),_:1})]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),"dns"===J(Q).auth_type?(E(),R("div",B,[O(i,{label:" "},{default:C(()=>[O(d,{checked:J(Q).dns_manual,"onUpdate:checked":l[1]||(l[1]=a=>J(Q).dns_manual=a),"checked-value":1,"unchecked-value":0},{default:C(()=>[V(q(a.$t("SSL.index_2")),1)]),_:1},8,["checked"])]),_:1}),O(i,{label:a.$t("SSL.index_13"),path:"type"},{default:C(()=>[O(o,{class:"w-300px",value:J(Q).type,"onUpdate:value":[l[2]||(l[2]=a=>J(Q).type=a),ea],options:J(X)},null,8,["value","options"])]),_:1},8,["label"]),"single"===J(Q).type?(E(),H(i,{key:0,label:" ",path:"domains"},{default:C(()=>[O(r,{"input-props":{spellcheck:!1},class:"w-300px!",value:J(Q).domains,"onUpdate:value":l[3]||(l[3]=a=>J(Q).domains=a),placeholder:"aapanel.com"},null,8,["value"])]),_:1})):F("",!0),"wildcard"===J(Q).type?(E(),H(i,{key:1,label:" ",path:"domains"},{default:C(()=>[O(r,{"input-props":{spellcheck:!1},type:"textarea",class:"w-300px!",value:J(Q).domains,"onUpdate:value":l[4]||(l[4]=a=>J(Q).domains=a),placeholder:a.$t("SSL.index_14")},null,8,["value","placeholder"])]),_:1})):F("",!0),"wildcard_all"===J(Q).type?(E(),H(i,{key:2,label:" ",path:"domains"},{default:C(()=>[O(r,{"input-props":{spellcheck:!1},type:"textarea",class:"w-300px!",value:J(Q).domains,"onUpdate:value":l[5]||(l[5]=a=>J(Q).domains=a),placeholder:"*.aapanel.com"},null,8,["value"])]),_:1})):F("",!0)])):F("",!0),"http"===J(Q).auth_type?(E(),R("div",T,[O(i,{label:a.$t("Home.index_68")},{default:C(()=>[O(o,{class:"w-300px",value:J(Q).site,"onUpdate:value":[l[6]||(l[6]=a=>J(Q).site=a),la],options:J(Y)},null,8,["value","options"])]),_:1},8,["label"]),O(i,{label:a.$t("Mail.Bcc.index_6"),path:"domains_list"},{default:C(()=>[O(h,{show:J(ia),class:"p-12px w-300px max-h-300px min-h-100px overflow-auto border border-solid border-#ccc"},{default:C(()=>[O(d,{class:"mb-12px",checked:J(Q).all,"onUpdate:checked":l[7]||(l[7]=a=>J(Q).all=a),label:a.$t("Public.SelectAll"),indeterminate:J(sa)},null,8,["checked","label","indeterminate"]),O(c,{value:J(Q).domains_list,"onUpdate:value":l[8]||(l[8]=a=>J(Q).domains_list=a)},{default:C(()=>[O(_,{class:"flex-col!",size:12},{default:C(()=>[(E(!0),R(M,null,N(J(aa),a=>(E(),H(d,{key:a.name,value:a.name,label:a.name},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1},8,["show"])]),_:1},8,["label"])])):F("",!0)]),_:1},8,["model"]),O(L,{class:"mt-16px"},{default:C(()=>[P("li",null,q(a.$t("SSL.index_15")),1),l[9]||(l[9]=P("li",null,"Manually resolved certificates do not support auto-renewal",-1)),P("li",null,q(a.$t("SSL.index_16")),1)]),_:1,__:[9]})])}}});export{D as default};
