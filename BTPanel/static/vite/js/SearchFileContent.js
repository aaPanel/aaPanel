import{_ as e}from"./index.js?v=1764830988434";import{_ as a,q as t,bp as l,bo as s,m as n,aD as o,p as i}from"./page_layout.js?v=1764830988434";import{k as c,P as r,i as u,r as d,R as f,V as h,W as p,a3 as m,S as v,U as _,j as b,a4 as C,a2 as k,an as F,F as j,O as x,au as y,ak as M}from"./vue.js?v=1764830988434";import{o as g}from"./index37.js?v=1764830988434";import{R as $}from"./ResourceManagerWindow.js?v=1764830988434";import{dW as w,dR as U,av as R,au as O,aC as S,_ as P,dT as W,dU as D}from"./naive.js?v=1764830988434";import"./common.js?v=1764830988434";import"./__commonjsHelpers__.js?v=1764830988434";import"./public.js?v=1764830988434";import"./soft2.js?v=1764830988434";import"./soft.js?v=1764830988434";import"./site.js?v=1764830988434";import"./file2.js?v=1764830988434";import"./index.vue_vue_type_script_setup_true_lang7.js?v=1764830988434";const H={class:"search-wrapper"},T={class:"w-100% flex justify-start gap-6 items-center"},q={class:"w-100% flex justify-between"},I={class:"search-res"},L={class:"top-desc"},z={class:"mr-5px"},E={class:"match-list"},V={class:"text-font1 fw-bold"},A=["innerHTML"],B=i(c({__name:"SearchFileContent",props:{currentPath:{type:String,default:"/"}},setup(i,{expose:c}){const B=i,{t:G}=r(),J=u("fileStore"),{currentPath:K,resetSearchFileContentFormData:N}=J;function Q(){N()}c({open:function(){te.value=!0,Z.value.path=K.value},close:Q});const{searchStatistics:X,searchRes:Y,searchFileContentFormData:Z}=J,ee=d(),ae=d(B.currentPath),te=d(!1);function le(){!async function(){const e=n.loading(G("file.searchFileContentModal.searching"));try{const e=await o.post("/files?action=files_search",Z.value,{requestOptions:{isOriginalResult:!0}});Y.value=e.message,Object.keys(Y.value).length&&(X.value.files=Object.keys(Y.value).length,X.value.times=Object.values(Y.value).flat().reduce((e,a)=>e+Object.values(a).length,0))}catch(a){console.warn(a)}finally{e.close()}}()}function se(e,a){const t=new RegExp(a,"g");return e.replace(t,'<span style="color:#ff3300">'.concat(a,"</span>"))}function ne(){ee.value.open()}function oe(e){Z.value.path=e}return(n,o)=>{const i=O,c=S,r=R,u=U,d=P,B=a,G=D,J=W,N=w,ie=t,ce=s,re=l,ue=e;return h(),f(j,null,[p(ue,{show:_(te),"onUpdate:show":o[7]||(o[7]=e=>M(te)?te.value=e:null),title:n.$t("file.searchFileContentModal.title"),width:720,onPublicClose:Q},{default:m(()=>[v("div",H,[p(N,{"label-placement":"left","label-width":60,"label-align":"left"},{default:m(()=>[p(u,{label:n.$t("file.searchFileContentModal.search")},{default:m(()=>[p(r,null,{default:m(()=>[p(i,{value:_(Z).text,"onUpdate:value":o[0]||(o[0]=e=>_(Z).text=e)},null,8,["value"]),p(c,{type:"primary",onClick:le},{default:m(()=>[b(C(n.$t("file.searchFileContentModal.search")),1)]),_:1})]),_:1})]),_:1},8,["label"]),p(u,{label:n.$t("file.searchFileContentModal.suffix")},{default:m(()=>[p(i,{value:_(Z).exts,"onUpdate:value":o[1]||(o[1]=e=>_(Z).exts=e)},null,8,["value"])]),_:1},8,["label"]),p(u,{label:n.$t("file.searchFileContentModal.folder")},{default:m(()=>[v("div",T,[p(i,{value:_(Z).path,"onUpdate:value":o[3]||(o[3]=e=>_(Z).path=e)},{suffix:m(()=>[p(d,{checked:_(Z).is_subdir,"onUpdate:checked":o[2]||(o[2]=e=>_(Z).is_subdir=e),"checked-value":1,"unchecked-value":0},{default:m(()=>[b(C(n.$t("file.searchFileContentModal.subdir")),1)]),_:1},8,["checked"])]),_:1},8,["value"]),p(B,{name:"file-dir",color:"#000",size:"24",style:{cursor:"pointer"},onClick:ne})])]),_:1},8,["label"]),p(u,{label:n.$t("file.searchFileContentModal.mode")},{default:m(()=>[v("div",q,[p(J,{value:_(Z).mode,"onUpdate:value":o[4]||(o[4]=e=>_(Z).mode=e)},{default:m(()=>[p(G,{value:0},{default:m(()=>[b(C(n.$t("file.searchFileContentModal.words")),1)]),_:1}),p(G,{value:1},{default:m(()=>[b(C(n.$t("file.searchFileContentModal.regex")),1)]),_:1})]),_:1},8,["value"]),v("div",null,[0==_(Z).mode?(h(),k(d,{key:0,checked:_(Z).isword,"onUpdate:checked":o[5]||(o[5]=e=>_(Z).isword=e),label:n.$t("file.searchFileContentModal.matchWholeWord"),class:"mr-5","checked-value":1,"unchecked-value":0},null,8,["checked","label"])):F("",!0),p(d,{checked:_(Z).iscase,"onUpdate:checked":o[6]||(o[6]=e=>_(Z).iscase=e),label:n.$t("file.searchFileContentModal.matchCase"),"checked-value":1,"unchecked-value":0},null,8,["checked","label"])])])]),_:1},8,["label"])]),_:1}),v("div",I,[v("div",L,[v("span",z,C(n.$t("file.searchFileContentModal.searchResult")),1),v("span",null,C(_(X).times)+" "+C(n.$t("file.searchFileContentModal.matchesIn"))+" "+C(_(X).files)+" "+C(n.$t("file.searchFileContentModal.files")),1)]),p(ie,{style:{"margin-bottom":"20px"}}),(h(!0),f(j,null,x(_(Y),(e,a)=>(h(),k(re,{key:a,class:"mb-10px"},{default:m(()=>[p(ce,{title:"".concat(a," (").concat(n.$t("file.searchFileContentModal.match")," ").concat(Object.values(e).length," ").concat(n.$t("file.searchFileContentModal.times"),")"),name:"1"},{"header-extra":m(()=>[p(c,{text:"",type:"primary",onClick:y(e=>async function(e){g(0,e,K.value)}(a),["stop"])},{default:m(()=>[b(C(n.$t("file.searchFileContentModal.edit")),1)]),_:2},1032,["onClick"])]),default:m(()=>[v("div",E,[(h(!0),f(j,null,x(e,(e,a)=>(h(),f("div",{class:"match-list-item",key:a},[v("div",V,C(n.$t("file.searchFileContentModal.line"))+" "+C(a)+": ",1),v("div",{innerHTML:se(e,_(Z).text)},null,8,A)]))),128))])]),_:2},1032,["title"])]),_:2},1024))),128))])])]),_:1},8,["show","title"]),p($,{"current-path":_(ae),ref_key:"resourceRef",ref:ee,onChooseDir:oe},null,8,["current-path"])],64)}}}),[["__scopeId","data-v-17c24141"]]);export{B as default};
