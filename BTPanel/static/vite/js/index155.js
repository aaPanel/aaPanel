import{_ as a}from"./index245.js?v=1763625242172";import{p as e,i as n,k as s,P as t,r as i,R as o,S as r,U as l,a4 as p,X as c,V as d,F as m,a3 as u,j as v,a2 as _,e as g,aj as b}from"./vue.js?v=1763625242172";import{a as x,b as h,_ as f,d as y}from"./public.js?v=1763625242172";import{_ as w}from"./index168.js?v=1763625242172";import{i as D,bf as M,M as P,u as j,x as k,m as C,fM as A,c as $,q as S,p as q,b as U}from"./page_layout.js?v=1763625242172";import{aC as z,d5 as B,dV as O,d9 as F,df as I,dP as H}from"./naive.js?v=1763625242172";import{a as L}from"./soft.js?v=1763625242172";import{g as N}from"./site.js?v=1763625242172";import{_ as R}from"./index.vue_vue_type_script_setup_true_lang.js?v=1763625242172";import"./__commonjsHelpers__.js?v=1763625242172";import"./common.js?v=1763625242172";const T=Symbol("php-admin");const{t:V}=D.global,E=()=>M.post("/adminer_manager?action=get_status"),X=a=>M.post("/adminer_manager?action=install",a,{requestOptions:{loading:V("Database.adminerManager.installing"),successMessage:!0}});async function G(a,e,n,s=""){const t=document.createElement("form");t.action="".concat(P(),"/adminer/index.php?driver=").concat(a,"&username=").concat(e),t.method="post",t.target="_blank",t.style.display="none";let i="";"mongo"===a&&(i="localhost:27017".concat("root"===e?"/admin?authSource=admin":"/".concat(e,"?authSource=").concat(e)),s="root"===e?"admin":s);const o='\n\t\t<input type="text" name="auth[driver]" id="driver" value="'.concat(a,'" size="24" />\n\t\t<input type="text" name="auth[username]" id="username" value="').concat(e,'" size="24" />\n\t\t<input type="password" name="auth[password]" id="password" value="').concat(n,'" size="24" />\n\t\t<input type="text" name="auth[db]" id="db" value="').concat(s,'" size="24" />\n\t\t<input type="text" name="auth[server]" id="server" value="').concat(i,'" size="24" />\n\t');t.innerHTML=o,document.body.appendChild(t),t.submit(),document.body.removeChild(t)}const J={class:"p-4px"},K={class:"flex items-center h-40px mb-10px text-14px whitespace-pre-wrap"},Q={class:"flex gap-10px"},W={class:"mt-20px"},Y={class:"flex gap-24px mt-20px"},Z=q(s({__name:"index",setup(a,{expose:e}){const{t:s}=t(),{type:g,db:b,username:y,password:D}=n(T),q=j(),U=i(!1),B=i(""),O=async()=>{x({title:s("Database.adminerManager.service.fixed"),content:s("Database.adminerManager.service.confirmFixed"),onConfirm:async()=>{await X({version:B.value}),R()}})},F=()=>{x({title:s("Database.adminerManager.service.uninstall"),content:s("Database.adminerManager.service.confirmUninstall"),onConfirm:async()=>{await M.post("/adminer_manager?action=uninstall",{},{requestOptions:{loading:V("Database.adminerManager.uninstalling"),successMessage:!0}}),R()}})},I=()=>{x({title:s("Database.adminerManager.service.install"),content:s("Database.adminerManager.service.confirmInstall"),onConfirm:async()=>{const{message:a}=await M.post("/adminer_manager?action=support_versions");k(a)&&await X({version:a[0]}),R()}})},H=new Map([["pgsql","postgres"],["mongo","root"]]),L=async()=>{if(q.isFree)return void h({source:160});if(y&&D&&b)return void G(g,y,D,b);const a=C.loading(s("Database.adminerManager.service.jumpingToAdminer"));try{if("mongo"===g)return void(await N());const{message:a}=await A(g);$(a)&&G(g,H.get(g)||"",a.result)}finally{a.close()}},N=async()=>{const{message:a}=await A("mongodb");$(a)&&G(g,H.get(g)||"",a.root)},R=async()=>{const{message:a}=await E();$(a)&&(U.value=1===a.install,B.value=a.version)};return R(),e({init:R}),(a,e)=>{const n=w,s=z,t=S,i=f;return o(),r("div",J,[l("div",K,[l("span",null,p(a.$t("Database.adminerManager.service.currentStatus")),1),c(n,{value:d(U)},null,8,["value"])]),l("div",Q,[d(U)?(o(),r(m,{key:0},[c(s,{onClick:O},{default:u((()=>[v(p(a.$t("Database.adminerManager.service.fixed")),1)])),_:1}),c(s,{onClick:F},{default:u((()=>[v(p(a.$t("Public.Btn.Uninstall")),1)])),_:1})],64)):(o(),_(s,{key:1,onClick:I},{default:u((()=>[v(p(a.$t("Public.Btn.Install")),1)])),_:1}))]),l("div",W,[c(t,{dashed:""})]),l("div",Y,[c(s,{class:"access-btn",onClick:L},{default:u((()=>[l("span",null,p(a.$t("Database.PhpAdmin.index_11")),1),e[1]||(e[1]=l("span",{class:"bg-recommend"},null,-1))])),_:1,__:[1]}),c(s,{class:"access-btn",onClick:e[0]||(e[0]=a=>(async()=>{window.open("".concat(P(),"/adminer/index.php?driver=").concat(g))})())},{default:u((()=>[v(p(a.$t("Database.PhpAdmin.index_6")),1)])),_:1})]),c(i,{class:"mt-16px"},{default:u((()=>[l("li",null,p(a.$t("Database.PhpAdmin.index_7")),1),l("li",null,p(a.$t("Database.PhpAdmin.index_33")),1)])),_:1})])}}}),[["__scopeId","data-v-989f4d59"]]),aa={class:"p-8px"},ea={class:"w-160px"},na=s({__name:"index",setup(a,{expose:e}){const{t:n}=t(),s=g({php_version:null}),m=i([]),{loading:_,setLoading:b}=y(),x=async()=>{try{b(!0);const[a,e]=await Promise.all([N(),E()]),{message:n}=a;k(n)&&(m.value=n.filter((a=>"00"!==a.version)).map((a=>({label:a.name,value:a.version}))));const{message:t}=e;s.php_version=B(t,"php_version",null)}finally{b(!1)}},h=async()=>{const a=s.php_version;var e;null!==a?(await(e={php_version:a},M.post("/adminer_manager?action=switch_php",e,{requestOptions:{loading:V("Database.adminerManager.switchingPhp"),successMessage:!0}})),x()):C.error(n("Database.PhpAdmin.index_32"))},f=async()=>{const{message:a}=await U({sName:"php-".concat(Number(s.php_version)/10)});$(a)&&L(a)};return x(),e({init:x}),(a,e)=>{const n=O,t=z,i=F;return o(),r("div",aa,[c(i,{class:"items-center"},{default:u((()=>[l("span",null,p(a.$t("Database.PhpAdmin.index_31")),1),l("div",ea,[c(n,{value:d(s).php_version,"onUpdate:value":e[0]||(e[0]=a=>d(s).php_version=a),loading:d(_),options:d(m)},null,8,["value","loading","options"])]),c(t,{disabled:null===d(s).php_version,type:"primary",onClick:h},{default:u((()=>[v(p(a.$t("Public.Btn.Save")),1)])),_:1},8,["disabled"]),c(t,{disabled:null===d(s).php_version,onClick:f},{default:u((()=>e[1]||(e[1]=[v(" Settings ")]))),_:1,__:[1]},8,["disabled"])])),_:1})])}}}),sa={class:"p-4px"},ta={class:"w-142px mr-8px"},ia=s({__name:"index",setup(a,{expose:e}){const{t:n}=t(),s=i(null),m=async()=>{const a=s.value;var e;null!==a?(await(e={port:a},M.post("/adminer_manager?action=switch_port",e,{requestOptions:{loading:V("Database.adminerManager.switchingPort"),successMessage:!0}})),g()):C.error(n("Database.PhpAdmin.index_25"))},_=i(!1),g=async()=>{const{message:a}=await E();s.value=B(a,"port",null)},x=()=>{g()};return x(),e({init:x}),(a,e)=>{const n=I,t=z,i=H,g=R;return o(),r("div",sa,[c(g,{"label-width":"160"},{default:u((()=>[c(i,{label:a.$t("Database.PhpAdmin.index_16"),"label-width":"auto"},{default:u((()=>[l("div",ta,[c(n,{value:d(s),"onUpdate:value":e[0]||(e[0]=a=>b(s)?s.value=a:null),min:0,max:66325,"show-button":!1,loading:d(_),placeholder:""},null,8,["value","loading"])]),c(t,{type:"primary",onClick:m},{default:u((()=>[v(p(a.$t("Public.Btn.Save")),1)])),_:1})])),_:1},8,["label"])])),_:1})])}}}),oa={class:"h-580px"},ra=s({__name:"index",props:{type:{},username:{},password:{},db:{}},setup(n){const s=n,{t:l}=t(),p=i("service"),m=[{key:"service",label:l("Database.PhpAdmin.index_1"),component:Z},{key:"php",label:l("Database.PhpAdmin.index_2"),component:na},{key:"safe",label:l("Database.PhpAdmin.index_3"),component:ia}];var u;return u={type:s.type,username:s.username,password:s.password,db:s.db},e(T,u),(e,n)=>{const s=a;return o(),r("div",oa,[c(s,{value:d(p),"onUpdate:value":n[0]||(n[0]=a=>b(p)?p.value=a:null),ref:"tabsRef",data:m},null,8,["value"])])}}});export{ra as default};
