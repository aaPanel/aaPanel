System.register(["./page_layout-legacy.js?v=1763625242172","./public-legacy.js?v=1763625242172","./naive-legacy.js?v=1763625242172","./vue-legacy.js?v=1763625242172","./common-legacy.js?v=1763625242172","./__commonjsHelpers__-legacy.js?v=1763625242172"],(function(e,t){"use strict";var l,a,n,o,i,s,r,c,u,d,p,f,v,h,m,g,_,x,w,y,b,C,F,k,U,$,W,j,E,O,P,I,M,B,R,z,N,S,A,L,V,q,H,X;return{setters:[e=>{l=e.dN,a=e.p,n=e.h,o=e.x,i=e._,s=e.m,r=e.hb,c=e.dP},e=>{u=e.i},e=>{d=e.aC,p=e.aZ,f=e.dV,v=e.dP,h=e.dd,m=e.au,g=e.de,_=e.dW},e=>{x=e.k,w=e.ae,y=e.r,b=e.R,C=e.a2,F=e.a3,k=e.X,U=e.j,$=e.a4,W=e.s,j=e.V,E=e.P,O=e.c,P=e.S,I=e.U,M=e.l,B=e.v,R=e.F,z=e.ad,N=e.an,S=e.ay,A=e.O,L=e.aL,V=e.t,q=e.e,H=e.aj,X=e.n},null,null],execute:function(){var t=document.createElement("style");t.textContent=".seg[data-v-7ea28fa1]{width:1px;height:8px;margin:0 auto;border-left:1px solid #ccc}.tips[data-v-c8f1f83a]{position:absolute;top:32px;left:0;width:100%;padding-top:2px;padding-left:2px;color:#999}.rows[data-v-31e9f077]{display:flex}.rows .field[data-v-31e9f077]{width:140px;margin-right:8px}.rows .condition[data-v-31e9f077]{width:160px;margin-right:8px}.rows .content[data-v-31e9f077]{display:flex;flex:1;width:0;flex-shrink:0}.rows .rows-btn[data-v-31e9f077]{display:flex;align-items:center;margin-left:8px}.rows .rows-btn .close[data-v-31e9f077]{display:flex;align-items:center;justify-content:center;width:24px;height:32px;margin-left:8px;color:#666;cursor:pointer;transition:opacity .3s}.rows .rows-btn .close[data-v-31e9f077]:hover{opacity:.8}.rows.rows-tit>div[data-v-31e9f077]{padding-bottom:8px}.form-title[data-v-2a17c742]{margin-bottom:20px;font-size:16px}\n",document.head.appendChild(t);const Z=x({__name:"site-select",props:{value:{},valueModifiers:{}},emits:["update:value"],setup(e){const t=w(e,"value"),a=l(),n=y([]),o=()=>{t.value=n.value.map((e=>e.value))},i=()=>{t.value=[]};return(async()=>{n.value=Object.entries(a.config.sitemap).map((([e,t])=>({label:e,value:t})))})(),(e,l)=>{const a=d,s=p,r=f;return b(),C(r,W(e.$attrs,{value:t.value,"onUpdate:value":l[0]||(l[0]=e=>t.value=e),multiple:"",filterable:"",options:j(n),"max-tag-count":"responsive","consistent-menu-width":!1,placeholder:e.$t("Waf.Custom.index_25")}),{header:F((()=>[k(s,{class:"w-full"},{default:F((()=>[k(a,{class:"flex-1",onClick:o},{default:F((()=>[U($(e.$t("Public.All")),1)])),_:1}),k(a,{class:"flex-1",onClick:i},{default:F((()=>[U($(e.$t("Public.Btn.Cancel")),1)])),_:1})])),_:1})])),_:1},16,["value","options","placeholder"])}}}),D={class:"w-320px"},G={class:"w-320px"},J=x({__name:"action",props:{action:{default:""},actionModifiers:{},response:{},responseModifiers:{}},emits:["update:action","update:response"],setup(e){const{t:t}=E(),a=l(),n=w(e,"action"),o=w(e,"response"),i=y([]),s=O((()=>{let e="";switch(n.value){case"deny":e=t("Waf.Custom.index_21");break;case"validate":e="验证方式"}return e})),r=O((()=>c(n.value).map((e=>({label:e.text,value:e.type,data:e}))))),c=e=>{const t=a.config.action.filter((t=>t.type===e));return t.length>0?t[0].response:[]},u=e=>{const t=c(e);t.length>0?o.value=t[0].type:o.value=null};return i.value=a.config.action.map((e=>({label:e.text,value:e.type,data:e}))),null===o.value&&u(n.value),(e,t)=>{const l=f,a=v;return b(),P(R,null,[k(a,{label:e.$t("Waf.Custom.index_20")},{default:F((()=>[I("div",D,[k(l,{value:n.value,"onUpdate:value":[t[0]||(t[0]=e=>n.value=e),u],options:j(i)},null,8,["value","options"])])])),_:1},8,["label"]),M(k(a,{label:j(s),"show-feedback":!1},{default:F((()=>[I("div",G,[k(l,{value:o.value,"onUpdate:value":t[1]||(t[1]=e=>o.value=e),options:j(r)},null,8,["value","options"])])])),_:1},8,["label"]),[[B,j(r).length>0]])],64)}}}),K={class:"my-18px"},Q=a({},[["render",function(e,t){const l=h;return b(),P("div",K,[k(l,{class:"w-38px justify-center"},{default:F((()=>[U($(e.$t("Waf.Custom.index_31")),1)])),_:1})])}]]),T={class:"flex flex-center flex-col w-38px"},Y=a({},[["render",function(e,t){const l=h;return b(),P("div",T,[t[0]||(t[0]=I("div",{class:"seg"},null,-1)),k(l,{class:"w-38px justify-center"},{default:F((()=>[U($(e.$t("Waf.Custom.index_30")),1)])),_:1}),t[1]||(t[1]=I("div",{class:"seg"},null,-1))])}],["__scopeId","data-v-7ea28fa1"]]),ee={class:"relative flex items-center w-full h-full"},te={class:"tips"},le=a(x({__name:"content",props:z({condition:{default:null},factor:{},type:{default:"right"}},{input:{},inputModifiers:{},select:{default:()=>null},selectModifiers:{}}),emits:["update:input","update:select"],setup(e){const t=e,l=w(e,"input"),a=w(e,"select"),i=O((()=>null===t.condition)),s=["in","not_in"],r=O((()=>{const{factor:e}=t;return"text"===e.widget.type})),c=["select","area_select","mult"],u=O((()=>{const{factor:e}=t;return c.includes(e.widget.type)})),v=O((()=>"left"!==t.type&&("mult"===t.factor.widget.type||s.includes(t.condition||"")))),h=O((()=>{const{factor:e}=t,{widget:l}=e;return l.value.map((e=>({label:n(e)?e:e.label,value:n(e)?e:e.key})))})),g=()=>{a.value=h.value.map((e=>e.value))},_=()=>{a.value=[]},x=y(""),W=e=>{x.value=e},E=()=>{""!==x.value&&(o(a.value)?o(a.value)&&!a.value.includes(x.value)&&a.value.push(x.value):a.value=[x.value],x.value="")};return(e,t)=>{const n=m,o=f,s=d,c=p;return b(),P("div",ee,[j(r)?(b(),P(R,{key:0},[j(v)?(b(),C(o,{key:1,value:a.value,"onUpdate:value":t[1]||(t[1]=e=>a.value=e),tag:"",multiple:"",filterable:"","show-arrow":!1,show:!1,"max-tag-count":"responsive","consistent-menu-width":!1,placeholder:e.factor.widget.placeholder,onSearch:W,onBlur:E},null,8,["value","placeholder"])):(b(),C(n,{key:0,value:l.value,"onUpdate:value":t[0]||(t[0]=e=>l.value=e),spellcheck:"false",disabled:j(i),placeholder:e.factor.widget.placeholder},null,8,["value","disabled","placeholder"])),I("div",te,$(e.factor.widget.hint?`${e.factor.widget.hint}${j(v)?e.$t("Waf.Custom.index_29"):""}`:""),1)],64)):N("",!0),j(u)?(b(),C(o,{key:1,value:a.value,"onUpdate:value":t[2]||(t[2]=e=>a.value=e),options:j(h),disabled:j(i),filterable:!0,"consistent-menu-width":!1,multiple:j(v),"max-tag-count":"responsive",placeholder:e.factor.widget.placeholder},S({_:2},[j(v)?{name:"header",fn:F((()=>[k(c,{class:"w-full"},{default:F((()=>[k(s,{class:"flex-1",onClick:g},{default:F((()=>[U($(e.$t("Public.All")),1)])),_:1}),k(s,{class:"flex-1",onClick:_},{default:F((()=>[U($(e.$t("Public.Btn.Cancel")),1)])),_:1})])),_:1})])),key:"0"}:void 0]),1032,["value","options","disabled","multiple","placeholder"])):N("",!0)])}}}),[["__scopeId","data-v-c8f1f83a"]]),ae={class:"rows rows-tit"},ne={class:"field"},oe={class:"condition"},ie={class:"content"},se={class:"rows"},re={class:"field"},ce={class:"condition"},ue={class:"content"},de={key:0,class:"w-140px mr-8px"},pe={class:"flex-1 w-0"},fe={class:"rows-btn"},ve=["onClick"],he=x({__name:"index",props:z({isInit:{type:Boolean,default:!0}},{value:{default:()=>[]},valueModifiers:{}}),emits:["update:value"],setup(e,{expose:t}){const a=e,n=w(e,"value"),s=l(),r={type:"or",children:[]},c={input:"",select:null,show:!1,widget:{hint:"",placeholder:"",type:"text",value:[]}},u={type:"and",field:null,condition:null,conOptions:[],leftFactor:g(c),rightFactor:g(c)},p=["select","area_select"],v=["in","not_in"],h=O((()=>s.config.options.map((e=>({label:e.text,value:e.type,data:e}))))),m=(e,t)=>(l,a)=>{const o=n.value[e].children[t],i=a.data;o.conOptions=i.operators.map((e=>({label:s.getOperatorName(e),value:e}))),o.condition=i.operators[0]||null,o.leftFactor=g(c),o.rightFactor=g(c),i.left_factor_enabled&&(o.leftFactor.show=i.left_factor_enabled,o.leftFactor.widget=i.left_widget),i.right_factor_enabled&&(o.rightFactor.widget=i.right_widget,o.rightFactor.show=i.right_factor_enabled)},_=(e,t)=>l=>{const a=n.value[e].children[t],{rightFactor:i}=a,{widget:s}=i;if(p.includes(s.type)){if(null===i.select)return;v.includes(l||"")?i.select=o(i.select)?i.select:[i.select]:i.select=o(i.select)?i.select[0]:i.select}"text"===s.type&&(v.includes(l||"")&&""!==i.input&&(i.select=[i.input],i.input=""),null!==i.select&&(i.input=o(i.select)?i.select[0]:i.select))},x=O((()=>n.value.map((e=>e.children.length)).reduce(((e,t)=>e+t))>1)),y=(e,t)=>t===n.value.length-1&&e===n.value[t].children.length-1,E=(e,t=0)=>{n.value[t].children.splice(e+1,0,g(u))},M=()=>{n.value.push(g(r)),E(0,n.value.length-1)},B=(e,t,l)=>"text"!==l.widget.type||v.includes(t)?"":e,z=(e,t,l)=>e&&e.includes(",")?e?e.split(","):[]:p.includes(l.widget.type)&&e||null;return a.isInit&&0===n.value.length&&M(),t({setRules:e=>{const t=[];e.children.forEach((e=>{const l=g(r);e.children.forEach((e=>{const{option:t}=e;if(!t)return;const a=g(u);a.field=t.type,a.condition=t.operator,((e,t)=>{const{options:l}=s.config;for(let a=0;a<l.length;a++)if(l[a].type===e){t(l[a]);break}})(t.type,(e=>{if(e.left_factor_enabled){const l=t?.left_factor||"";a.leftFactor.show=e.left_factor_enabled,a.leftFactor.widget=e.left_widget,a.leftFactor.input=B(l,t.operator,a.leftFactor),a.leftFactor.select=z(l,t.operator,a.leftFactor)}if(e.right_factor_enabled){const l=t?.right_factor||"";a.rightFactor.show=e.right_factor_enabled,a.rightFactor.widget=e.right_widget,a.rightFactor.input=B(l,t.operator,a.rightFactor),a.rightFactor.select=z(l,t.operator,a.rightFactor)}a.conOptions=e.operators.map((e=>({label:s.getOperatorName(e),value:e})))})),l.children.push(a)})),t.push(l)})),t.length>0?n.value=t:M()}}),(e,t)=>{const l=f,a=d,o=i;return b(),P("div",null,[I("div",ae,[I("div",ne,$(e.$t("Waf.Custom.index_26")),1),I("div",oe,$(e.$t("Waf.Custom.index_27")),1),I("div",ie,$(e.$t("Waf.Custom.index_28")),1),t[0]||(t[0]=I("div",{class:"btn"},null,-1))]),(b(!0),P(R,null,A(n.value,((t,i)=>(b(),P("div",{key:`${i+1}`},[0!==i?(b(),C(Q,{key:0})):N("",!0),(b(!0),P(R,null,A(t.children,((t,s)=>(b(),P("div",{key:`${s+1}`},[0!==s?(b(),C(Y,{key:0})):N("",!0),I("div",se,[I("div",re,[k(l,W({value:t.field,"onUpdate:value":e=>t.field=e,options:j(h),"consistent-menu-width":!1},L({"update:value":m(i,s)})),null,16,["value","onUpdate:value","options"])]),I("div",ce,[t.leftFactor.show?(b(),C(le,{key:0,input:t.leftFactor.input,"onUpdate:input":e=>t.leftFactor.input=e,select:t.leftFactor.select,"onUpdate:select":e=>t.leftFactor.select=e,type:"left",condition:t.condition,factor:t.leftFactor},null,8,["input","onUpdate:input","select","onUpdate:select","condition","factor"])):(b(),C(l,W({key:1,value:t.condition,"onUpdate:value":e=>t.condition=e,disabled:null===t.field,options:t.conOptions,"consistent-menu-width":!1},L({"update:value":_(i,s)})),null,16,["value","onUpdate:value","disabled","options"]))]),I("div",ue,[t.leftFactor.show?(b(),P("div",de,[k(l,W({value:t.condition,"onUpdate:value":e=>t.condition=e,disabled:null===t.field,options:t.conOptions,"consistent-menu-width":!1},L({"update:value":_(i,s)})),null,16,["value","onUpdate:value","disabled","options"])])):N("",!0),I("div",pe,[k(le,{input:t.rightFactor.input,"onUpdate:input":e=>t.rightFactor.input=e,select:t.rightFactor.select,"onUpdate:select":e=>t.rightFactor.select=e,type:"right",condition:t.condition,factor:t.rightFactor},null,8,["input","onUpdate:input","select","onUpdate:select","condition","factor"])])]),I("div",fe,[k(a,{onClick:e=>E(s,i)},{default:F((()=>[U($(e.$t("Waf.Custom.index_30")),1)])),_:2},1032,["onClick"]),y(s,i)?(b(),C(a,{key:0,class:"ml-8px",onClick:M},{default:F((()=>[U($(e.$t("Waf.Custom.index_31")),1)])),_:1})):N("",!0),j(x)?(b(),P("div",{key:1,class:"close",onClick:e=>((e,t)=>{const l=n.value[t];l.children.length>1?l.children.splice(e,1):n.value.splice(t,1)})(s,i)},[k(o,{name:"base-close",size:"16"})],8,ve)):N("",!0)])])])))),128))])))),128)),t[1]||(t[1]=I("div",null,null,-1))])}}}),me=a(he,[["__scopeId","data-v-31e9f077"]]),ge={class:"p-24px"},_e={class:"form-title"},xe={class:"w-320px"},we={class:"w-320px"},ye={class:"form-title mt-8px"},be={class:"flex-1"},Ce={class:"form-title mt-8px"},Fe=x({__name:"index",props:{isEdit:{type:Boolean},row:{}},emits:["refresh"],setup(e,{expose:t,emit:l}){const a=e,n=l,p=V(a,"isEdit"),{t:f}=E(),h=q({name:"",server:[],action:"deny",response:null}),g={name:{trigger:["blur","input"],validator:()=>""!==h.name||new Error(f("Waf.Custom.index_18"))},rules:{validator:()=>{for(let e=0;e<x.value.length;e++){const t=x.value[e];for(let e=0;e<t.children.length;e++){const l=t.children[e];if(null===l.field||null===l.condition)return new Error(f("Waf.Custom.index_22"));const{leftFactor:a,rightFactor:n}=l;if(a.show&&""===a.input&&null===a.select)return new Error(f("Waf.Custom.index_22"));if(n.show&&""===n.input&&null===n.select)return new Error(f("Waf.Custom.index_22"))}}return!0}}},x=y([]),w=y(null),C=y(),U=()=>{h.server.length>0?u(h.server.join("\n")):s.error(f("Waf.Custom.index_24"))},W=()=>{const e=O();return x.value.forEach((t=>{const l=O("and");t.children.forEach((e=>{null===e.field&&null===e.condition||l.children.push(M(e))})),e.children.push(l)})),e},O=(e="or")=>({logic:e,type:"block",option:null,children:[]}),M=e=>({type:"option",logic:"",children:[],option:{type:e.field||"",operator:e.condition||"",left_factor:R(e.condition,e.leftFactor),right_factor:R(e.condition,e.rightFactor)}}),B=["in","not_in"],R=(e,t)=>{const{widget:l}=t;return"text"!==l.type||B.includes(e||"")?o(t.select)?t.select.join(","):t.select||"":t.input};return(()=>{if(!p.value)return;const{row:e}=a;e&&(h.name=e.name,h.server=e.servers||null,h.action=e.action.type,h.response=e.action.response.type,X((()=>{C.value.setRules(e.root)})))})(),t({onConfirm:async()=>{await(w.value?.validate());const e=(()=>{const{action:e,response:t}=h;return"allow"===e&&null===t&&(h.response="black_page"),{name:h.name,servers:h.server?h.server:[],status:1,is_global:0,priority:0,root:W(),action:{type:h.action,response:{type:h.response||"",response_id:0,status:0,headers:{},body:""}}}})(),{row:t}=a;p.value&&t?await r({infos:e,id:t.id}):await c(e),n("refresh")}}),(e,t)=>{const l=i,a=d,n=v,o=m,s=_;return b(),P("div",ge,[k(s,{ref_key:"formRef",ref:w,model:j(h),rules:g,"label-width":"140px","label-placement":"left","require-mark-placement":"left"},{default:F((()=>[I("div",_e,$(e.$t("Waf.Custom.index_15")),1),k(n,{label:e.$t("Waf.Custom.index_16")},{default:F((()=>[I("div",xe,[k(Z,{value:j(h).server,"onUpdate:value":t[0]||(t[0]=e=>j(h).server=e)},null,8,["value"])]),k(a,{class:"ml-16px",onClick:U},{default:F((()=>[k(l,{name:"common-copy",class:"mr-6px",size:"14"}),I("span",null,$(e.$t("Waf.Custom.index_23")),1)])),_:1})])),_:1},8,["label"]),k(n,{label:e.$t("Waf.Custom.index_17"),path:"name"},{default:F((()=>[I("div",we,[k(o,{value:j(h).name,"onUpdate:value":t[1]||(t[1]=e=>j(h).name=e),spellcheck:"false",placeholder:e.$t("Waf.Custom.index_18")},null,8,["value","placeholder"])])])),_:1},8,["label"]),I("div",ye,$(e.$t("Waf.Custom.index_19")),1),k(n,{label:"",class:"pl-36px",path:"rules"},{default:F((()=>[I("div",be,[k(me,{ref_key:"ruleListRef",ref:C,value:j(x),"onUpdate:value":t[2]||(t[2]=e=>H(x)?x.value=e:null),"is-init":!j(p)},null,8,["value","is-init"])])])),_:1}),I("div",Ce,$(e.$t("Waf.Custom.index_10")),1),k(J,{action:j(h).action,"onUpdate:action":t[3]||(t[3]=e=>j(h).action=e),response:j(h).response,"onUpdate:response":t[4]||(t[4]=e=>j(h).response=e)},null,8,["action","response"])])),_:1},8,["model"])])}}});e("default",a(Fe,[["__scopeId","data-v-2a17c742"]]))}}}));
