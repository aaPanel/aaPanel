import{_ as e}from"./index.vue_vue_type_script_setup_true_lang.js?v=1769066082311";import{_ as a}from"./index.vue_vue_type_script_setup_true_lang20.js?v=1769066082311";import{_ as l}from"./index.vue_vue_type_script_setup_true_lang10.js?v=1769066082311";import{k as t,R as u,V as n,ad as s,ae as r,t as i,c as o,F as d,S as v,an as p,W as m,U as _,I as f,a4 as c,a3 as y,a2 as g,j as h,O as b,a7 as x,P as w,a0 as k,r as U,e as j,x as C,ak as A,n as E}from"./vue.js?v=1769066082311";import{aI as $,k as M,u as P,d as R,x as B,cl as D}from"./page_layout.js?v=1769066082311";import{_ as O,d as S,b as H}from"./public.js?v=1769066082311";import{j as I,h as T,i as F}from"./alarm.js?v=1769066082311";import{dW as V,av as W,dg as G,d_ as L,dU as Y,dV as q,dS as z}from"./naive.js?v=1769066082311";import{_ as J}from"./index220.js?v=1769066082311";import"./__commonjsHelpers__.js?v=1769066082311";import"./common.js?v=1769066082311";const K=t({__name:"form-template-field-none",props:{field:{}},setup:e=>(e,a)=>(n(),u("div"))}),N={key:0,class:"ml-10px whitespace-pre"},Q=t({__name:"form-template-field-select",props:s({field:{}},{value:{default:null},valueModifiers:{}}),emits:["update:value"],setup(e){const a=e,l=r(e,"value"),t=i(a,"field"),s=o(()=>t.value.items.map(e=>({label:"".concat(e.title).concat(t.value.unit||""),value:e.value})));return(e,a)=>{const r=V;return n(),u(d,null,[v("div",{style:f({width:_(t).width?"160px":"260px"})},[m(r,{value:l.value,"onUpdate:value":a[0]||(a[0]=e=>l.value=e),disabled:_(t).disabled,options:_(s)},null,8,["value","disabled","options"])],4),_(t).suffix?(n(),u("div",N,c(_(t).suffix),1)):p("",!0)],64)}}}),X={key:0,class:"ml-10px whitespace-pre"},Z=t({__name:"form-template-field-number",props:s({field:{}},{value:{},valueModifiers:{}}),emits:["update:value"],setup(e){const a=i(e,"field"),l=r(e,"value"),t=()=>{l.value||(l.value=a.value.default)};return(e,s)=>{const r=G,i=L,o=W;return n(),u(d,null,[v("div",null,[m(o,null,{default:y(()=>[m(r,{value:l.value,"onUpdate:value":s[0]||(s[0]=e=>l.value=e),class:"w-100px",min:1,"show-button":!1,placeholder:"",onBlur:t},null,8,["value"]),_(a).unit?(n(),g(i,{key:0,class:"min-w-52px text-center"},{default:y(()=>[h(c(_(a).unit),1)]),_:1})):p("",!0)]),_:1})]),_(a).suffix?(n(),u("span",X,c(_(a).suffix),1)):p("",!0)],64)}}}),ee=t({__name:"form-template-field-radio",props:s({field:{}},{value:{},valueModifiers:{}}),emits:["update:value"],setup(e){const a=e,l=r(e,"value"),t=i(a,"field");return(e,a)=>{const s=q,r=Y;return n(),g(r,{value:l.value,"onUpdate:value":a[0]||(a[0]=e=>l.value=e)},{default:y(()=>[(n(!0),u(d,null,b(_(t).items,e=>(n(),g(s,{key:e.value,value:e.value},{default:y(()=>[h(c(e.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])}}}),ae=t({__name:"form-template-field-help",props:{field:{}},setup:e=>(e,a)=>{const l=O;return n(),g(l,null,{default:y(()=>[(n(!0),u(d,null,b(e.field.list,e=>(n(),u("li",{key:e},c(e),1))),128))]),_:1})}}),le=t({__name:"form-template-field",props:s({field:{}},{value:{},valueModifiers:{}}),emits:s(["change"],["update:value"]),setup(e,{emit:a}){const l=e,t=a,u=r(e,"value"),s=i(l,"field"),o=(()=>{switch(s.value.type){case"select":return Q;case"number":return Z;case"radio":return ee;case"help":return ae;default:return K}})(),d=e=>{t("change",e,s.value.attr)};return(e,a)=>(n(),g(x(_(o)),{value:u.value,"onUpdate:value":[a[0]||(a[0]=e=>u.value=e),d],field:_(s)},null,40,["value","field"]))}}),te=t({__name:"form-template",props:s({type:{default:"none"},template:{default:()=>({field:[],sorted:[]})}},{value:{default:()=>({})},valueModifiers:{}}),emits:["update:value"],setup(e,{expose:a}){const l=e,{t:t}=w(),s=i(l,"type"),v=i(l,"template"),f=r(e,"value"),c=o(()=>{const{field:e,sorted:a}=v.value,l=[];return a.forEach(a=>{const t=[];a.forEach(a=>{const l=e.find(e=>e.attr===a);l&&t.push(l)}),l.push(t)}),l}),h=(e,a)=>{"system_disk"===s.value&&"cycle"===a&&x(),"project_status"===s.value&&"cycle"===a&&k()},x=()=>{const{cycle:e}=f.value;switch(e){case 1:v.value.field[2].unit="GB",v.value.field[2].name=t("Config.Alarm.index_26");break;case 2:v.value.field[2].unit="%",v.value.field[2].name=t("Config.Alarm.index_27")}},k=()=>{const{field:e}=v.value,[,a]=e,{all_items:l}=a;if(l&&$(f.value.cycle)){const e=l[M(f.value.cycle)-1];e.length>0?(a.items=e,f.value.project=e[0].value):(a.items=[],f.value.project=null)}},U=()=>{switch(s.value){case"system_disk":x();break;case"project_status":k()}};return U(),a({render:U}),(e,a)=>{const l=z;return n(!0),u(d,null,b(_(c),(e,a)=>(n(),u(d,null,[1===e.length?(n(!0),u(d,{key:0},b(e,e=>(n(),g(l,{key:"".concat(_(s),"-").concat(e.attr),label:e.name},{default:y(()=>[m(le,{value:f.value[e.attr],"onUpdate:value":a=>f.value[e.attr]=a,field:e,onChange:h},null,8,["value","onUpdate:value","field"])]),_:2},1032,["label"]))),128)):p("",!0),e.length>1?(n(),u("div",{key:"".concat(_(s),"-").concat(a+1),class:"flex"},[(n(!0),u(d,null,b(e,(e,a)=>(n(),g(l,{key:"".concat(_(s),"-").concat(e.attr),label:e.name,"label-width":0!==a?"auto":void 0},{default:y(()=>[m(le,{value:f.value[e.attr],"onUpdate:value":a=>f.value[e.attr]=a,field:e,onChange:h},null,8,["value","onUpdate:value","field"])]),_:2},1032,["label","label-width"]))),128))])):p("",!0)],64))),256)}}}),ue=t({__name:"form-advanced",props:s({config:{default:()=>({})},inverse:{type:Boolean,default:!1},timeRangeShow:{type:Boolean,default:!1}},{value:{default:()=>({day_num:0,total:0,send_interval:0,time_range:[]})},valueModifiers:{}}),emits:["update:value"],setup(e){const a=e,l=i(a,"config"),t=r(e,"value"),s=e=>a.inverse?!l.value[e]:l.value[e];return(e,a)=>{const l=G,r=L,i=W,o=z,v=J;return n(),u(d,null,[s("day_num")?(n(),g(o,{key:0,label:e.$t("Config.Alarm.index_28"),path:"day_num"},{default:y(()=>[m(i,null,{default:y(()=>[m(l,{value:t.value.day_num,"onUpdate:value":a[0]||(a[0]=e=>t.value.day_num=e),class:"w-100px",min:0,"show-button":!1,placeholder:""},null,8,["value"]),m(r,{class:"min-w-52px text-center"},{default:y(()=>[h(c(e.$t("Public.Unit.Times")),1)]),_:1})]),_:1})]),_:1},8,["label"])):p("",!0),s("total")?(n(),g(o,{key:1,label:e.$t("Config.Alarm.index_30"),path:"total"},{default:y(()=>[m(i,null,{default:y(()=>[m(l,{value:t.value.total,"onUpdate:value":a[1]||(a[1]=e=>t.value.total=e),class:"w-100px",min:0,"show-button":!1,placeholder:""},null,8,["value"]),m(r,{class:"min-w-52px text-center"},{default:y(()=>[h(c(e.$t("Public.Unit.Times")),1)]),_:1})]),_:1})]),_:1},8,["label"])):p("",!0),s("send_interval")?(n(),g(o,{key:2,label:e.$t("Config.Alarm.index_31"),path:"send_interval"},{default:y(()=>[m(i,null,{default:y(()=>[m(l,{value:t.value.send_interval,"onUpdate:value":a[2]||(a[2]=e=>t.value.send_interval=e),class:"w-100px",min:0,"show-button":!1,placeholder:""},null,8,["value"]),m(r,{class:"min-w-52px text-center"},{default:y(()=>[h(c(e.$t("Public.Unit.Seconds")),1)]),_:1})]),_:1})]),_:1},8,["label"])):p("",!0),e.timeRangeShow?(n(),g(o,{key:3,label:e.$t("Config.Alarm.index_33"),path:"time_range","show-feedback":!1},{default:y(()=>[m(v,{value:t.value.time_range,"onUpdate:value":a[3]||(a[3]=e=>t.value.time_range=e)},null,8,["value"])]),_:1},8,["label"])):p("",!0)],64)}}}),ne={class:"px-20px py-24px"},se={class:"w-260px"},re={class:"w-260px"},ie=t({__name:"form",props:{isEdit:{type:Boolean},alert_type:{},row:{}},emits:["refresh"],setup(t,{expose:s,emit:r}){const d=t,p=P(),{isPro:f}=k(p),c=r,{t:g}=w(),b=i(d,"isEdit"),x=U(null),M=U(),O=U(!1),W=j({type:null,method:[],day_num:0,total:0,send_interval:0,time_range:[(new Date).setHours(0,0,0,0),(new Date).setHours(23,59,59,0)],template:{}}),G=j({day_num:{trigger:["input","blur"],validator:()=>!(!W.day_num&&0!==W.day_num)||(N.value.day_num||(O.value=!0),new Error(g("Config.Alarm.index_22")))},total:{trigger:["input","blur"],validator:()=>!(!W.total&&0!==W.total)||(N.value.total||(O.value=!0),new Error(g("Config.Alarm.index_23")))},send_interval:{trigger:["input","blur"],validator:()=>!(!W.send_interval&&0!==W.send_interval)||(N.value.send_interval||(O.value=!0),new Error(g("Config.Alarm.index_24")))},method:{trigger:["change"],validator:()=>0!==W.method.length||new Error(g("Config.Alarm.index_25"))}}),L=C([]),Y=o(()=>L.value.map((e,a)=>({label:e.title,value:a,disabled:"80"===e.id&&!f.value,data:e}))),q=o(()=>{let e="none";const a=L.value[W.type||0];return a&&(e=a.source),e}),J=e=>m("div",null,[m("span",null,[e.label,h(" ")]),14===e.value?m("span",{class:"float-right cursor-pointer color-#ffb800",onClick:()=>{H({source:323})}},[h("PRO")]):""]),K=U({field:[],sorted:[]}),N=U({}),Q=()=>L.value[W.type||0],X=()=>{const e=Q();K.value=e.template,K.value.field.forEach(a=>{a.default?W.template[a.attr]=a.default:W.template[a.attr]=e.default[a.attr]}),W.day_num=0,W.total=0,W.send_interval=0;const a={},{advanced_default:l}=e;R(l)&&Object.entries(l).forEach(([e,l])=>{R(l)?Object.entries(l).forEach(([e,l])=>{a[e]=!0,ee(e,l)}):$(l)&&(a[e]=!0,ee(e,l))}),N.value=a},Z=["day_num","total","send_interval"],ee=(e,a)=>{Z.includes(e)&&(W[e]=a)},ae=()=>{X(),E(()=>{M.value.render()})},{loading:le,setLoading:ie}=S(),oe=e=>{const a=new Date,l=a.getFullYear(),t=a.getMonth(),u=a.getDate();return new Date(l,t,u).getTime()+1e3*e};return(async()=>{await(async()=>{try{ie(!0);const{message:e}=await F();B(e)&&(L.value=e,W.type=0,b.value||X())}finally{ie(!1)}})();const{row:e}=d;b.value&&e&&(W.type=L.value.findIndex(a=>a.id===e.template_id),X(),W.method=e.sender,e.number_rule&&(W.day_num=e.number_rule.day_num,W.total=e.number_rule.total),e.time_rule&&(W.send_interval=e.time_rule.send_interval,e.time_rule.time_range&&e.time_rule.time_range.length>0&&(W.time_range=[oe(e.time_rule.time_range[0]),oe(e.time_rule.time_range[1])])),Object.keys(W.template).forEach(a=>{e.task_data&&(W.template[a]=e.task_data[a])}),await E(),M.value.render()),d.alert_type&&(W.type=d.alert_type,ae())})(),s({onConfirm:async()=>{var e;await(null==(e=x.value)?void 0:e.validate());const{row:a}=d,l=(()=>{const e=Q();return{template_id:e.id,task_data:{task_data:{tid:e.id,type:e.source,title:e.title,status:!0,count:0,interval:600,project:"",...W.template},sender:W.method,number_rule:{day_num:W.day_num,total:W.total},time_rule:{send_interval:W.send_interval,time_range:[D(W.time_range[0]),D(W.time_range[1])]}}}})();b.value&&a?await I({...l,task_id:a.id}):await T(l),c("refresh")}}),(t,s)=>{const r=V,i=z,o=l,d=a,p=e;return n(),u("div",ne,[m(p,{ref_key:"formRef",ref:x,model:_(W),rules:_(G),"label-width":"140"},{default:y(()=>[m(i,{label:t.$t("Config.Alarm.index_19")},{default:y(()=>[v("div",se,[m(r,{value:_(W).type,"onUpdate:value":[s[0]||(s[0]=e=>_(W).type=e),ae],options:_(Y),loading:_(le),"render-label":J},null,8,["value","options","loading"])])]),_:1},8,["label"]),m(te,{ref_key:"templateRef",ref:M,value:_(W).template,"onUpdate:value":s[1]||(s[1]=e=>_(W).template=e),type:_(q),template:_(K)},null,8,["value","type","template"]),m(ue,{value:_(W),"onUpdate:value":s[2]||(s[2]=e=>A(W)?W.value=e:null),config:_(N)},null,8,["value","config"]),m(i,{label:t.$t("Config.Alarm.index_20"),path:"method"},{default:y(()=>[v("div",re,[m(o,{value:_(W).method,"onUpdate:value":s[3]||(s[3]=e=>_(W).method=e)},null,8,["value"])])]),_:1},8,["label"]),m(d,{show:_(O),"onUpdate:show":s[5]||(s[5]=e=>A(O)?O.value=e:null),title:t.$t("Config.Alarm.index_21")},{default:y(()=>[m(ue,{value:_(W),"onUpdate:value":s[4]||(s[4]=e=>A(W)?W.value=e:null),config:_(N),inverse:!0,"time-range-show":!0},null,8,["value","config"])]),_:1},8,["show","title"])]),_:1},8,["model","rules"])])}}});export{ie as default};
