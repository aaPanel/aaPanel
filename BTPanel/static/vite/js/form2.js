import{_ as e}from"./index.vue_vue_type_script_setup_true_lang.js?v=1767769852656";import{_ as a}from"./index.vue_vue_type_script_setup_true_lang20.js?v=1767769852656";import{_ as l}from"./index.vue_vue_type_script_setup_true_lang10.js?v=1767769852656";import{k as t,R as u,V as n,ad as s,ae as r,t as i,c as o,F as d,S as v,an as m,W as p,U as _,I as f,a4 as c,a3 as g,a2 as y,j as h,O as b,a7 as x,P as w,a0 as k,r as U,e as j,x as C,ak as A,n as E}from"./vue.js?v=1767769852656";import{aI as $,k as M,u as R,d as P,x as B,ci as D}from"./page_layout.js?v=1767769852656";import{_ as O,d as S,b as T}from"./public.js?v=1767769852656";import{j as H,h as I,i as F}from"./alarm.js?v=1767769852656";import{dV as V,av as G,df as L,dZ as W,dT as Y,dU as Z,dR as q}from"./naive.js?v=1767769852656";import{_ as z}from"./index215.js?v=1767769852656";import"./__commonjsHelpers__.js?v=1767769852656";import"./common.js?v=1767769852656";const J=t({__name:"form-template-field-none",props:{field:{}},setup:e=>(e,a)=>(n(),u("div"))}),K={key:0,class:"ml-10px whitespace-pre"},N=t({__name:"form-template-field-select",props:s({field:{}},{value:{default:null},valueModifiers:{}}),emits:["update:value"],setup(e){const a=e,l=r(e,"value"),t=i(a,"field"),s=o(()=>t.value.items.map(e=>({label:"".concat(e.title).concat(t.value.unit||""),value:e.value})));return(e,a)=>{const r=V;return n(),u(d,null,[v("div",{style:f({width:_(t).width?"160px":"260px"})},[p(r,{value:l.value,"onUpdate:value":a[0]||(a[0]=e=>l.value=e),disabled:_(t).disabled,options:_(s)},null,8,["value","disabled","options"])],4),_(t).suffix?(n(),u("div",K,c(_(t).suffix),1)):m("",!0)],64)}}}),Q={key:0,class:"ml-10px whitespace-pre"},X=t({__name:"form-template-field-number",props:s({field:{}},{value:{},valueModifiers:{}}),emits:["update:value"],setup(e){const a=i(e,"field"),l=r(e,"value"),t=()=>{l.value||(l.value=a.value.default)};return(e,s)=>{const r=L,i=W,o=G;return n(),u(d,null,[v("div",null,[p(o,null,{default:g(()=>[p(r,{value:l.value,"onUpdate:value":s[0]||(s[0]=e=>l.value=e),class:"w-100px",min:1,"show-button":!1,placeholder:"",onBlur:t},null,8,["value"]),_(a).unit?(n(),y(i,{key:0,class:"min-w-52px text-center"},{default:g(()=>[h(c(_(a).unit),1)]),_:1})):m("",!0)]),_:1})]),_(a).suffix?(n(),u("span",Q,c(_(a).suffix),1)):m("",!0)],64)}}}),ee=t({__name:"form-template-field-radio",props:s({field:{}},{value:{},valueModifiers:{}}),emits:["update:value"],setup(e){const a=e,l=r(e,"value"),t=i(a,"field");return(e,a)=>{const s=Z,r=Y;return n(),y(r,{value:l.value,"onUpdate:value":a[0]||(a[0]=e=>l.value=e)},{default:g(()=>[(n(!0),u(d,null,b(_(t).items,e=>(n(),y(s,{key:e.value,value:e.value},{default:g(()=>[h(c(e.title),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])}}}),ae=t({__name:"form-template-field-help",props:{field:{}},setup:e=>(e,a)=>{const l=O;return n(),y(l,null,{default:g(()=>[(n(!0),u(d,null,b(e.field.list,e=>(n(),u("li",{key:e},c(e),1))),128))]),_:1})}}),le=t({__name:"form-template-field",props:s({field:{}},{value:{},valueModifiers:{}}),emits:s(["change"],["update:value"]),setup(e,{emit:a}){const l=e,t=a,u=r(e,"value"),s=i(l,"field"),o=(()=>{switch(s.value.type){case"select":return N;case"number":return X;case"radio":return ee;case"help":return ae;default:return J}})(),d=e=>{t("change",e,s.value.attr)};return(e,a)=>(n(),y(x(_(o)),{value:u.value,"onUpdate:value":[a[0]||(a[0]=e=>u.value=e),d],field:_(s)},null,40,["value","field"]))}}),te=t({__name:"form-template",props:s({type:{default:"none"},template:{default:()=>({field:[],sorted:[]})}},{value:{default:()=>({})},valueModifiers:{}}),emits:["update:value"],setup(e,{expose:a}){const l=e,{t:t}=w(),s=i(l,"type"),v=i(l,"template"),f=r(e,"value"),c=o(()=>{const{field:e,sorted:a}=v.value,l=[];return a.forEach(a=>{const t=[];a.forEach(a=>{const l=e.find(e=>e.attr===a);l&&t.push(l)}),l.push(t)}),l}),h=(e,a)=>{"system_disk"===s.value&&"cycle"===a&&x(),"project_status"===s.value&&"cycle"===a&&k()},x=()=>{const{cycle:e}=f.value;switch(e){case 1:v.value.field[2].unit="GB",v.value.field[2].name=t("Config.Alarm.index_26");break;case 2:v.value.field[2].unit="%",v.value.field[2].name=t("Config.Alarm.index_27")}},k=()=>{const{field:e}=v.value,[,a]=e,{all_items:l}=a;if(l&&$(f.value.cycle)){const e=l[M(f.value.cycle)-1];e.length>0?(a.items=e,f.value.project=e[0].value):(a.items=[],f.value.project=null)}},U=()=>{switch(s.value){case"system_disk":x();break;case"project_status":k()}};return U(),a({render:U}),(e,a)=>{const l=q;return n(!0),u(d,null,b(_(c),(e,a)=>(n(),u(d,null,[1===e.length?(n(!0),u(d,{key:0},b(e,e=>(n(),y(l,{key:"".concat(_(s),"-").concat(e.attr),label:e.name},{default:g(()=>[p(le,{value:f.value[e.attr],"onUpdate:value":a=>f.value[e.attr]=a,field:e,onChange:h},null,8,["value","onUpdate:value","field"])]),_:2},1032,["label"]))),128)):m("",!0),e.length>1?(n(),u("div",{key:"".concat(_(s),"-").concat(a+1),class:"flex"},[(n(!0),u(d,null,b(e,(e,a)=>(n(),y(l,{key:"".concat(_(s),"-").concat(e.attr),label:e.name,"label-width":0!==a?"auto":void 0},{default:g(()=>[p(le,{value:f.value[e.attr],"onUpdate:value":a=>f.value[e.attr]=a,field:e,onChange:h},null,8,["value","onUpdate:value","field"])]),_:2},1032,["label","label-width"]))),128))])):m("",!0)],64))),256)}}}),ue=t({__name:"form-advanced",props:s({config:{default:()=>({})},inverse:{type:Boolean,default:!1},timeRangeShow:{type:Boolean,default:!1}},{value:{default:()=>({day_num:0,total:0,send_interval:0,time_range:[]})},valueModifiers:{}}),emits:["update:value"],setup(e){const a=e,l=i(a,"config"),t=r(e,"value"),s=e=>a.inverse?!l.value[e]:l.value[e];return(e,a)=>{const l=L,r=W,i=G,o=q,v=z;return n(),u(d,null,[s("day_num")?(n(),y(o,{key:0,label:e.$t("Config.Alarm.index_28"),path:"day_num"},{default:g(()=>[p(i,null,{default:g(()=>[p(l,{value:t.value.day_num,"onUpdate:value":a[0]||(a[0]=e=>t.value.day_num=e),class:"w-100px",min:0,"show-button":!1,placeholder:""},null,8,["value"]),p(r,{class:"min-w-52px text-center"},{default:g(()=>[h(c(e.$t("Public.Unit.Times")),1)]),_:1})]),_:1})]),_:1},8,["label"])):m("",!0),s("total")?(n(),y(o,{key:1,label:e.$t("Config.Alarm.index_30"),path:"total"},{default:g(()=>[p(i,null,{default:g(()=>[p(l,{value:t.value.total,"onUpdate:value":a[1]||(a[1]=e=>t.value.total=e),class:"w-100px",min:0,"show-button":!1,placeholder:""},null,8,["value"]),p(r,{class:"min-w-52px text-center"},{default:g(()=>[h(c(e.$t("Public.Unit.Times")),1)]),_:1})]),_:1})]),_:1},8,["label"])):m("",!0),s("send_interval")?(n(),y(o,{key:2,label:e.$t("Config.Alarm.index_31"),path:"send_interval"},{default:g(()=>[p(i,null,{default:g(()=>[p(l,{value:t.value.send_interval,"onUpdate:value":a[2]||(a[2]=e=>t.value.send_interval=e),class:"w-100px",min:0,"show-button":!1,placeholder:""},null,8,["value"]),p(r,{class:"min-w-52px text-center"},{default:g(()=>[h(c(e.$t("Public.Unit.Seconds")),1)]),_:1})]),_:1})]),_:1},8,["label"])):m("",!0),e.timeRangeShow?(n(),y(o,{key:3,label:e.$t("Config.Alarm.index_33"),path:"time_range","show-feedback":!1},{default:g(()=>[p(v,{value:t.value.time_range,"onUpdate:value":a[3]||(a[3]=e=>t.value.time_range=e)},null,8,["value"])]),_:1},8,["label"])):m("",!0)],64)}}}),ne={class:"px-20px py-24px"},se={class:"w-260px"},re={class:"w-260px"},ie=t({__name:"form",props:{isEdit:{type:Boolean},row:{}},emits:["refresh"],setup(t,{expose:s,emit:r}){const d=t,m=R(),{isPro:f}=k(m),c=r,{t:y}=w(),b=i(d,"isEdit"),x=U(null),M=U(),O=U(!1),G=j({type:null,method:[],day_num:0,total:0,send_interval:0,time_range:[(new Date).setHours(0,0,0,0),(new Date).setHours(23,59,59,0)],template:{}}),L=j({day_num:{trigger:["input","blur"],validator:()=>!(!G.day_num&&0!==G.day_num)||(K.value.day_num||(O.value=!0),new Error(y("Config.Alarm.index_22")))},total:{trigger:["input","blur"],validator:()=>!(!G.total&&0!==G.total)||(K.value.total||(O.value=!0),new Error(y("Config.Alarm.index_23")))},send_interval:{trigger:["input","blur"],validator:()=>!(!G.send_interval&&0!==G.send_interval)||(K.value.send_interval||(O.value=!0),new Error(y("Config.Alarm.index_24")))},method:{trigger:["change"],validator:()=>0!==G.method.length||new Error(y("Config.Alarm.index_25"))}}),W=C([]),Y=o(()=>W.value.map((e,a)=>({label:e.title,value:a,disabled:"80"===e.id&&!f.value,data:e}))),Z=o(()=>{let e="none";const a=W.value[G.type||0];return a&&(e=a.source),e}),z=e=>p("div",null,[p("span",null,[e.label,h(" ")]),14===e.value?p("span",{class:"float-right cursor-pointer color-#ffb800",onClick:()=>{T({source:323})}},[h("PRO")]):""]),J=U({field:[],sorted:[]}),K=U({}),N=()=>W.value[G.type||0],Q=()=>{const e=N();J.value=e.template,J.value.field.forEach(a=>{a.default?G.template[a.attr]=a.default:G.template[a.attr]=e.default[a.attr]}),G.day_num=0,G.total=0,G.send_interval=0;const a={},{advanced_default:l}=e;P(l)&&Object.entries(l).forEach(([e,l])=>{P(l)?Object.entries(l).forEach(([e,l])=>{a[e]=!0,ee(e,l)}):$(l)&&(a[e]=!0,ee(e,l))}),K.value=a},X=["day_num","total","send_interval"],ee=(e,a)=>{X.includes(e)&&(G[e]=a)},ae=()=>{Q(),E(()=>{M.value.render()})},{loading:le,setLoading:ie}=S(),oe=e=>{const a=new Date,l=a.getFullYear(),t=a.getMonth(),u=a.getDate();return new Date(l,t,u).getTime()+1e3*e};return(async()=>{await(async()=>{try{ie(!0);const{message:e}=await F();B(e)&&(W.value=e,G.type=0,b.value||Q())}finally{ie(!1)}})();const{row:e}=d;b.value&&e&&(G.type=W.value.findIndex(a=>a.id===e.template_id),Q(),G.method=e.sender,e.number_rule&&(G.day_num=e.number_rule.day_num,G.total=e.number_rule.total),e.time_rule&&(G.send_interval=e.time_rule.send_interval,e.time_rule.time_range&&e.time_rule.time_range.length>0&&(G.time_range=[oe(e.time_rule.time_range[0]),oe(e.time_rule.time_range[1])])),Object.keys(G.template).forEach(a=>{e.task_data&&(G.template[a]=e.task_data[a])}),await E(),M.value.render())})(),s({onConfirm:async()=>{var e;await(null==(e=x.value)?void 0:e.validate());const{row:a}=d,l=(()=>{const e=N();return{template_id:e.id,task_data:{task_data:{tid:e.id,type:e.source,title:e.title,status:!0,count:0,interval:600,project:"",...G.template},sender:G.method,number_rule:{day_num:G.day_num,total:G.total},time_rule:{send_interval:G.send_interval,time_range:[D(G.time_range[0]),D(G.time_range[1])]}}}})();b.value&&a?await H({...l,task_id:a.id}):await I(l),c("refresh")}}),(t,s)=>{const r=V,i=q,o=l,d=a,m=e;return n(),u("div",ne,[p(m,{ref_key:"formRef",ref:x,model:_(G),rules:_(L),"label-width":"140"},{default:g(()=>[p(i,{label:t.$t("Config.Alarm.index_19")},{default:g(()=>[v("div",se,[p(r,{value:_(G).type,"onUpdate:value":[s[0]||(s[0]=e=>_(G).type=e),ae],options:_(Y),loading:_(le),"render-label":z},null,8,["value","options","loading"])])]),_:1},8,["label"]),p(te,{ref_key:"templateRef",ref:M,value:_(G).template,"onUpdate:value":s[1]||(s[1]=e=>_(G).template=e),type:_(Z),template:_(J)},null,8,["value","type","template"]),p(ue,{value:_(G),"onUpdate:value":s[2]||(s[2]=e=>A(G)?G.value=e:null),config:_(K)},null,8,["value","config"]),p(i,{label:t.$t("Config.Alarm.index_20"),path:"method"},{default:g(()=>[v("div",re,[p(o,{value:_(G).method,"onUpdate:value":s[3]||(s[3]=e=>_(G).method=e)},null,8,["value"])])]),_:1},8,["label"]),p(d,{show:_(O),"onUpdate:show":s[5]||(s[5]=e=>A(O)?O.value=e:null),title:t.$t("Config.Alarm.index_21")},{default:g(()=>[p(ue,{value:_(G),"onUpdate:value":s[4]||(s[4]=e=>A(G)?G.value=e:null),config:_(K),inverse:!0,"time-range-show":!0},null,8,["value","config"])]),_:1},8,["show","title"])]),_:1},8,["model","rules"])])}}});export{ie as default};
