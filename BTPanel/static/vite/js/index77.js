import{_ as e}from"./index.js?v=1767769852656";import{d as a,e as l,c as t,f as o,a as n,h as i,_ as s}from"./public.js?v=1767769852656";import{_ as r}from"./index.vue_vue_type_script_setup_true_lang5.js?v=1767769852656";import{aE as u,i as d,dp as c,p as _,m as f,x as p}from"./page_layout.js?v=1767769852656";import{_ as m}from"./index.vue_vue_type_script_setup_true_lang.js?v=1767769852656";import{k as v,P as w,ae as F,r as x,R as W,V as b,S as h,W as g,U as q,c as y,a2 as R,av as k,e as j,a3 as $,an as U,a4 as E,j as N}from"./vue.js?v=1767769852656";import{dV as P,au as T,dd as C,d0 as O,dR as I,dT as M,dU as A,_ as S,df as B,dj as L,aC as V,dS as J}from"./naive.js?v=1767769852656";import"./common.js?v=1767769852656";import"./__commonjsHelpers__.js?v=1767769852656";import"./index.vue_vue_type_script_setup_true_lang6.js?v=1767769852656";const z={class:"flex w-380px"},D={class:"w-140px mr-12px"},H={class:"flex-1"},G=v({__name:"path",props:{url:{},urlModifiers:{},type:{},typeModifiers:{}},emits:["update:url","update:type"],setup(e){const{t:a}=w(),l=F(e,"url"),t=F(e,"type"),o=x([{label:a("Waf.Flow.Form.index_36"),value:"url"},{label:a("Waf.Flow.Form.index_37"),value:"all"}]),n=e=>{if("all"===e)l.value="/"};return(e,a)=>{const i=P,s=T;return b(),W("div",z,[h("div",D,[g(i,{value:t.value,"onUpdate:value":[a[0]||(a[0]=e=>t.value=e),n],options:q(o)},null,8,["value","options"])]),h("div",H,[g(s,{value:l.value,"onUpdate:value":a[1]||(a[1]=e=>l.value=e),disabled:"all"===t.value,placeholder:e.$t("Waf.Flow.Form.index_35")},null,8,["value","disabled","placeholder"])])])}}}),K="allsite",Q=_(v({__name:"site",props:{value:{},valueModifiers:{}},emits:["update:value"],setup(e){const l=F(e,"value"),t=c(),{t:o}=w(),{loading:n,setLoading:i}=a(),s=x([]),r=x([{label:o("Waf.Flow.Form.index_39"),value:K}]),u=y(()=>l.value===K),d=({option:e,handleClose:a})=>{if(e.value!==K)return g(C,{class:"mr-6px",closable:!0,onClose:e=>{e.stopPropagation(),a()}},{default:()=>[e.label]})},_=e=>{u.value||(e.includes(K)?(l.value=K,s.value=r.value.map(e=>e.value)):e.length!==r.value.length-1?(l.value=e.filter(e=>e!==K),s.value=e.filter(e=>e!==K)):e.length===r.value.length-1&&(l.value=K,s.value=r.value.map(e=>e.value))),u.value&&(e.includes(K)?e.length!==r.value.length&&(l.value=e.filter(e=>e!==K),s.value=e.filter(e=>e!==K)):(l.value=[],s.value=[]))};return(async()=>{try{i(!0),await t.getConfig(),r.value=Object.entries(t.config.sitemap).map(([e,a])=>({label:e,value:a})),r.value.unshift({label:o("Waf.Flow.Form.index_39"),value:K}),l.value===K?s.value=r.value.map(e=>e.value):O(l.value)&&(s.value=l.value)}finally{i(!1)}})(),(e,a)=>{const l=P;return b(),R(l,{loading:q(n),value:q(s),multiple:"",filterable:"",options:q(r),"max-tag-count":"responsive","consistent-menu-width":!1,"render-tag":d,placeholder:e.$t("Waf.Flow.Form.index_38"),"onUpdate:value":_},null,8,["loading","value","options","placeholder"])}}}),[["__scopeId","data-v-5842887f"]]),X={class:"p-24px"},Y={class:"form-title"},Z={class:"w-380px"},ee={class:"w-380px"},ae={class:"form-title mt-8px"},le={class:"w-60px mx-8px"},te={class:"text-desc"},oe={class:"w-60px mx-8px"},ne={class:"text-desc"},ie={class:"w-60px mx-8px"},se={class:"text-desc"},re={class:"form-title mt-8px"},ue={class:"w-380px"},de={class:"w-380px"},ce=_(v({__name:"index",props:{isEdit:{type:Boolean},row:{},refresh:{}},setup(e,{expose:a}){const l=e,{t:t}=w(),o=k("formRef"),n=j({name:"",server:[],types:"url",url:"",condition:1,secondReq:!0,secondReqNum:void 0,countReq:!1,countReqTime:void 0,countReqNum:void 0,action:"status_503",return:"html"}),i=x([{label:t("Waf.Flow.Form.index_16"),value:"status_403"},{label:t("Waf.Flow.Form.index_17"),value:"status_404"},{label:t("Waf.Flow.Form.index_18"),value:"status_502"},{label:t("Waf.Flow.Form.index_19"),value:"status_503"},{label:t("Waf.Flow.Form.index_20"),value:"content"},{label:t("Waf.Flow.Form.index_21"),value:"drop"}]),s=x([{label:t("Waf.Flow.Form.index_22"),value:"html"},{label:t("Waf.Flow.Form.index_23"),value:"json"},{label:t("Waf.Flow.Form.index_24"),value:"444"}]),r={name:{required:!0,trigger:["blur","input"],message:t("Waf.Flow.Form.index_3")},server:{trigger:["change"],validator:()=>!(n.server.length<=0)||new Error(t("Waf.Flow.Form.index_25"))},path:{trigger:["blur","input","change"],validator:()=>{if("url"===n.types){if(!n.url)return new Error(t("Waf.Flow.Form.index_26"));if("/"===n.url)return new Error(t("Waf.Flow.Form.index_27"));if(!n.url.startsWith("/"))return new Error(t("Waf.Flow.Form.index_28"))}return!0}},second:{trigger:["blur","input"],validator:()=>!(n.secondReq&&!n.secondReqNum)||new Error(t("Waf.Flow.Form.index_29"))},count:{trigger:["blur","input"],validator:()=>{if(n.countReq){if(!n.countReqTime)return new Error(t("Waf.Flow.Form.index_30"));if(n.countReqTime<30)return new Error(t("Waf.Flow.Form.index_31"));if(!n.countReqNum)return new Error(t("Waf.Flow.Form.index_32"));if(n.countReqNum<20)return new Error(t("Waf.Flow.Form.index_33"))}return!0}}};return(()=>{const{isEdit:e,row:a}=l;e&&a&&(n.name=a.name,n.server=Object.keys(a.site),n.types=a.types,n.url=a.url,n.condition=a.condition,n.secondReq=!!a.region.req,a.region.req&&(n.secondReqNum=a.region.req),n.countReq=!!a.region.count,a.region.count&&(n.countReqTime=a.region.count.time,n.countReqNum=a.region.count.count),n.action=a.action,"content"===a.action&&(n.return=a.return))})(),a({onConfirm:async()=>{var e,a;if(await(null==(e=o.value)?void 0:e.validate()),!1===n.secondReq&&!1===n.countReq)return f.error(t("Waf.Flow.Form.index_34"),{close:!0}),!1;const i={name:n.name,site:p(n.server)?n.server.join(","):n.server,types:n.types,url:n.url,condition:n.condition,action:n.action,region:{...n.secondReq?{req:n.secondReqNum}:{},...n.countReq?{count:{time:n.countReqTime,count:n.countReqNum}}:{}},..."content"===n.action?{return:n.return}:{}},{row:s,isEdit:r}=l;var c;r&&s?await(c={...i,id:s.id},u.post("/btwaf/edit_user_limit.json",{data:JSON.stringify(c)},{requestOptions:{loading:d.global.t("Waf.Flow.API.index_2"),successMessage:!0}})):await(e=>u.post("/btwaf/add_user_limit.json",{data:JSON.stringify(e)},{requestOptions:{loading:d.global.t("Waf.Flow.API.index_1"),successMessage:!0}}))(i),null==(a=l.refresh)||a.call(l)}}),(e,a)=>{const l=T,t=I,u=A,d=M,c=S,_=B,f=P,p=m;return b(),W("div",X,[g(p,{ref_key:"formRef",ref:o,model:q(n),rules:r},{default:$(()=>[h("div",Y,E(e.$t("Waf.Flow.Form.index_1")),1),g(t,{label:e.$t("Waf.Flow.Form.index_2"),path:"name"},{default:$(()=>[h("div",Z,[g(l,{value:q(n).name,"onUpdate:value":a[0]||(a[0]=e=>q(n).name=e),placeholder:e.$t("Waf.Flow.Form.index_3")},null,8,["value","placeholder"])])]),_:1},8,["label"]),g(t,{label:e.$t("Waf.Flow.Form.index_4"),path:"server"},{default:$(()=>[h("div",ee,[g(Q,{value:q(n).server,"onUpdate:value":a[1]||(a[1]=e=>q(n).server=e)},null,8,["value"])])]),_:1},8,["label"]),h("div",ae,E(e.$t("Waf.Flow.Form.index_5")),1),g(t,{label:e.$t("Waf.Flow.Form.index_6"),path:"path"},{default:$(()=>[g(G,{type:q(n).types,"onUpdate:type":a[2]||(a[2]=e=>q(n).types=e),url:q(n).url,"onUpdate:url":a[3]||(a[3]=e=>q(n).url=e)},null,8,["type","url"])]),_:1},8,["label"]),g(t,{label:e.$t("Waf.Flow.Form.index_7")},{default:$(()=>[g(d,{value:q(n).condition,"onUpdate:value":a[4]||(a[4]=e=>q(n).condition=e)},{default:$(()=>[g(u,{value:1},{default:$(()=>[N(E(e.$t("Waf.Flow.Form.index_8")),1)]),_:1}),g(u,{value:2},{default:$(()=>a[12]||(a[12]=[N("IP+UA",-1)])),_:1,__:[12]}),g(u,{value:3},{default:$(()=>[N(E(e.$t("Waf.Flow.Form.index_9")),1)]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),g(t,{label:" ",path:"second"},{default:$(()=>[g(c,{checked:q(n).secondReq,"onUpdate:checked":a[5]||(a[5]=e=>q(n).secondReq=e)},{default:$(()=>[N(E(e.$t("Waf.Flow.Form.index_10")),1)]),_:1},8,["checked"]),h("div",le,[g(_,{value:q(n).secondReqNum,"onUpdate:value":a[6]||(a[6]=e=>q(n).secondReqNum=e),"show-button":!1,placeholder:""},null,8,["value"])]),h("div",te,E(e.$t("Public.Unit.Times")),1)]),_:1}),g(t,{label:" ",path:"count"},{default:$(()=>[g(c,{checked:q(n).countReq,"onUpdate:checked":a[7]||(a[7]=e=>q(n).countReq=e)},{default:$(()=>[N(E(e.$t("Waf.Flow.Form.index_11")),1)]),_:1},8,["checked"]),h("div",oe,[g(_,{value:q(n).countReqTime,"onUpdate:value":a[8]||(a[8]=e=>q(n).countReqTime=e),"show-button":!1,placeholder:""},null,8,["value"])]),h("div",ne,E(e.$t("Waf.Flow.Form.index_12")),1),h("div",ie,[g(_,{value:q(n).countReqNum,"onUpdate:value":a[9]||(a[9]=e=>q(n).countReqNum=e),"show-button":!1,placeholder:""},null,8,["value"])]),h("div",se,E(e.$t("Public.Unit.Times")),1)]),_:1}),h("div",re,E(e.$t("Waf.Flow.Form.index_13")),1),g(t,{label:e.$t("Waf.Flow.Form.index_14")},{default:$(()=>[h("div",ue,[g(f,{value:q(n).action,"onUpdate:value":a[10]||(a[10]=e=>q(n).action=e),options:q(i)},null,8,["value","options"])])]),_:1},8,["label"]),"content"===q(n).action?(b(),R(t,{key:0,label:e.$t("Waf.Flow.Form.index_15")},{default:$(()=>[h("div",de,[g(f,{value:q(n).return,"onUpdate:value":a[11]||(a[11]=e=>q(n).return=e),options:q(s)},null,8,["value","options"])])]),_:1},8,["label"])):U("",!0)]),_:1},8,["model"])])}}}),[["__scopeId","data-v-c86a897c"]]),_e=v({__name:"index",setup(a){const{t:c}=w(),_=l(c("Waf.Flow.index_6"),{isEdit:!1,refresh:()=>x()}),f=()=>{_.data.row=null,_.data.isEdit=!1,_.title=c("Waf.Flow.index_6"),_.show=!0},{table:m,columns:v,setLoading:F}=t([{key:"name",title:c("Waf.Flow.index_8"),width:"12%",minWidth:160},{key:"site",title:c("Waf.Flow.index_9"),width:"16%",minWidth:200,render:e=>Object.keys(e.site).join(", ")},{key:"region",title:c("Waf.Flow.index_10"),minWidth:300,render:e=>{let a="";switch(e.condition){case 1:a=c("Waf.Flow.index_11");break;case 2:a=c("Waf.Flow.index_12");break;case 3:a=c("Waf.Flow.index_13")}const{region:l}=e;return l.req&&(a+=c("Waf.Flow.index_14",[l.req])),l.count&&l.count.count&&(l.req&&(a+=c("Waf.Flow.index_15")),a+=c("Waf.Flow.index_16",[l.count.time,l.count.count])),c("Waf.Flow.index_17",[a])}},{key:"action",title:c("Waf.Flow.index_18"),width:"16%",minWidth:260,render:e=>{let a="";switch(e.action){case"status_403":a=c("Waf.Flow.index_19");break;case"status_404":a=c("Waf.Flow.index_20");break;case"status_502":a=c("Waf.Flow.index_21");break;case"status_503":a=c("Waf.Flow.index_22");break;case"content":a=c("Waf.Flow.index_23");break;case"drop":a=c("Waf.Flow.index_24")}return a}},{key:"open",title:c("Waf.Flow.index_25"),width:"6%",minWidth:80,render:e=>g(L,{size:"small",value:e.open,onUpdateValue:async a=>{var l;await(l={id:e.id},u.post("/btwaf/set_user_limit.json",l,{requestOptions:{loading:d.global.t("Waf.Flow.API.index_3"),successMessage:!0}})),e.open=a}},null)},o({width:100,options:e=>[{label:c("Public.Btn.Edit"),onClick:()=>{(e=>{_.data.row=e,_.data.isEdit=!0,_.title=c("Waf.Flow.index_7"),_.show=!0})(e)}},{label:c("Public.Btn.Del"),onClick:()=>{n({title:c("Waf.Flow.index_26"),content:c("Waf.Flow.index_27",[e.name]),onConfirm:async()=>{var a;await(a={id:e.id},u.post("/btwaf/del_user_limit.json",a,{requestOptions:{loading:d.global.t("Waf.Flow.API.index_4"),successMessage:!0}})),x()}})}}]})]),x=async()=>{try{F(!0);const{message:e}=await u.post("/btwaf/get_user_limit.json");m.data=p(e)?e:[]}finally{F(!1)}};return x(),(a,l)=>{const t=V,o=i,n=r,u=s,d=e,c=J;return b(),R(c,{class:"p-16px"},{default:$(()=>[g(n,null,{toolsLeft:$(()=>[g(t,{type:"primary",onClick:f},{default:$(()=>[N(E(a.$t("Waf.Flow.index_1")),1)]),_:1})]),table:$(()=>[g(o,{loading:q(m).loading,data:q(m).data,columns:q(v)},null,8,["loading","data","columns"])]),_:1}),g(u,{class:"mt-16px"},{default:$(()=>[h("li",null,E(a.$t("Waf.Flow.index_2")),1),h("li",null,E(a.$t("Waf.Flow.index_3")),1),h("li",null,E(a.$t("Waf.Flow.index_4")),1),h("li",null,E(a.$t("Waf.Flow.index_5")),1)]),_:1}),g(d,{show:q(_).show,"onUpdate:show":l[0]||(l[0]=e=>q(_).show=e),title:q(_).title,width:640,footer:!0,data:q(_).data,component:ce},null,8,["show","title","data"])]),_:1})}}});export{_e as default};
