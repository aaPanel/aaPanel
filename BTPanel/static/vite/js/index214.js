import{d as e,U as a,u as l,V as s,W as t,_ as n}from"./public.js?v=1763625242172";import{_ as i}from"./index.vue_vue_type_script_setup_true_lang.js?v=1763625242172";import{a3 as d}from"./site.js?v=1763625242172";import{e6 as o,c as u,e7 as r,x as p,h9 as m,aY as _,T as c}from"./page_layout.js?v=1763625242172";import{a as h}from"./ssl-lets-progress.js?v=1763625242172";import{d5 as f,dU as v,dT as y,dP as S,_ as x,dV as g,au as w,d9 as b,eg as k}from"./naive.js?v=1763625242172";import{k as L,P as A,r as $,e as j,c as z,w as U,o as Z,R,S as E,X as O,a3 as F,V as C,j as J,a4 as P,a2 as V,an as q,F as H,O as M,U as N}from"./vue.js?v=1763625242172";import"./common.js?v=1763625242172";import"./__commonjsHelpers__.js?v=1763625242172";import"./index.js?v=1763625242172";const T={class:"p-16px"},W={key:0},B={key:1},X=L({__name:"index",props:{onRefresh:{type:Function},onOpenLog:{type:Function}},setup(L,{expose:X}){const{t:Y}=A(),D=L,G=$(null),I=j({auth_type:"dns",dns_manual:0,site:0,type:"wildcard",domains:"",domains_list:[],all:!1}),K=$([{label:Y("SSL.index_17"),value:"single"},{label:Y("SSL.index_18"),value:"wildcard"},{label:Y("SSL.index_19"),value:"wildcard_all"}]),Q=$([]),ee=$([]),ae=()=>{I.domains=""},le=()=>{I.domains_list=[],oe()},se=z((()=>I.domains_list.length>0&&I.domains_list.length<ee.value.length));U((()=>I.domains_list),(e=>{e.length===ee.value.length?I.all=!0:e.length||(I.all=!1)})),U((()=>I.all),(e=>{var a;e?(I.domains_list=ee.value.map((e=>e.name)),null==(a=G.value)||a.validate()):I.domains_list=[]}));const te={domains:{required:!0,trigger:"input",validator:(e,a)=>{if("single"===I.type){if(!a)return new Error(Y("SSL.index_20"));if(!/^[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+$/.test(a))return new Error(Y("SSL.index_21"))}else if("wildcard"===I.type){if(!a)return new Error(Y("SSL.index_22"));if(!/^(?:\*\.)?(?:[a-zA-Z0-9-]+\.)?[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+(\n(?:\*\.)?(?:[a-zA-Z0-9-]+\.)?[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+)*$/.test(a))return new Error(Y("SSL.index_23"))}else if("wildcard_all"===I.type){if(!a)return new Error(Y("SSL.index_24"));if(!/^\*\.[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+(\n\*\.[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)+)*$/i.test(a))return new Error(Y("SSL.index_25"))}return!0}},domains_list:{required:!0,trigger:"change",type:"array",message:Y("SSL.SiteSSL.index_16")}},ne=()=>({auth_type:I.dns_manual?"dns_manual":I.auth_type,domains:JSON.stringify("http"===I.auth_type?I.domains_list:"single"===I.type?[I.domains]:I.domains.split("\n")),site_id:I.dns_manual?-1:void 0}),{loading:ie,setLoading:de}=e(),oe=async()=>{try{de(!0);const{message:e}=await d({id:I.site});p(e)&&(ee.value=e.map((e=>({name:e.name}))))}finally{de(!1)}};return Z((async()=>{await(async()=>{const{message:e}=await m();p(e)&&(Q.value=e.map((e=>({label:e.name,value:e.id}))),I.site=Q.value[0].value)})(),oe()})),X({onConfirm:async()=>{var e;if(await(null==(e=G.value)?void 0:e.validate()),I.dns_manual&&"dns"===I.auth_type){const e=JSON.stringify("single"===I.type?[I.domains]:I.domains.split("\n")),{message:n}=await o({site_id:-1,domains:e});if(u(n)&&Object.keys(n).length)return a(n.auths,-1,[I.domains],(()=>{D.onRefresh()}),!0),!1;const d=l({width:500,height:300,hideClose:!0,component:s});try{const{message:e}=await r(ne(),!1);if(u(e)){if(e.deploy)return void D.onRefresh();Array.isArray(e.auths)&&e.auths.length&&a(e.auths,-1,[I.domains],(()=>{D.onRefresh()}))}}catch(i){t(f(i,"message",""))}finally{d.hide()}return}const{message:n}=await r(ne());u(n)&&l({hideClose:!0,data:{isJump:!1,task_id:n.task_id,onFinish:()=>{D.onRefresh()}},component:h}),D.onRefresh()}}),(e,a)=>{const l=v,s=_,t=y,d=S,o=x,u=g,r=w,p=b,m=k,h=c,f=i,L=n;return R(),E("div",T,[O(f,{ref_key:"formRef",ref:G,model:C(I),rules:te,"label-width":"150px"},{default:F((()=>[O(d,{label:e.$t("Waf.Setting.config_67"),path:"verify_method"},{default:F((()=>[O(t,{value:C(I).auth_type,"onUpdate:value":a[0]||(a[0]=e=>C(I).auth_type=e)},{default:F((()=>[O(s,null,{default:F((()=>[O(l,{value:"dns"},{default:F((()=>[J(P(e.$t("SSL.index_12")),1)])),_:1}),O(l,{value:"http"},{default:F((()=>[J(P(e.$t("SSL.SiteSSL.index_17")),1)])),_:1})])),_:1})])),_:1},8,["value"])])),_:1},8,["label"]),"dns"===C(I).auth_type?(R(),E("div",W,[O(d,{label:" "},{default:F((()=>[O(o,{checked:C(I).dns_manual,"onUpdate:checked":a[1]||(a[1]=e=>C(I).dns_manual=e),"checked-value":1,"unchecked-value":0},{default:F((()=>[J(P(e.$t("SSL.index_2")),1)])),_:1},8,["checked"])])),_:1}),O(d,{label:e.$t("SSL.index_13"),path:"type"},{default:F((()=>[O(u,{class:"w-300px",value:C(I).type,"onUpdate:value":[a[2]||(a[2]=e=>C(I).type=e),ae],options:C(K)},null,8,["value","options"])])),_:1},8,["label"]),"single"===C(I).type?(R(),V(d,{key:0,label:" ",path:"domains"},{default:F((()=>[O(r,{"input-props":{spellcheck:!1},class:"w-300px!",value:C(I).domains,"onUpdate:value":a[3]||(a[3]=e=>C(I).domains=e),placeholder:"aapanel.com"},null,8,["value"])])),_:1})):q("",!0),"wildcard"===C(I).type?(R(),V(d,{key:1,label:" ",path:"domains"},{default:F((()=>[O(r,{"input-props":{spellcheck:!1},type:"textarea",class:"w-300px!",value:C(I).domains,"onUpdate:value":a[4]||(a[4]=e=>C(I).domains=e),placeholder:e.$t("SSL.index_14")},null,8,["value","placeholder"])])),_:1})):q("",!0),"wildcard_all"===C(I).type?(R(),V(d,{key:2,label:" ",path:"domains"},{default:F((()=>[O(r,{"input-props":{spellcheck:!1},type:"textarea",class:"w-300px!",value:C(I).domains,"onUpdate:value":a[5]||(a[5]=e=>C(I).domains=e),placeholder:"*.aapanel.com"},null,8,["value"])])),_:1})):q("",!0)])):q("",!0),"http"===C(I).auth_type?(R(),E("div",B,[O(d,{label:e.$t("Home.index_68")},{default:F((()=>[O(u,{class:"w-300px",value:C(I).site,"onUpdate:value":[a[6]||(a[6]=e=>C(I).site=e),le],options:C(Q)},null,8,["value","options"])])),_:1},8,["label"]),O(d,{label:e.$t("Mail.Bcc.index_6"),path:"domains_list"},{default:F((()=>[O(h,{show:C(ie),class:"p-12px w-300px max-h-300px min-h-100px overflow-auto border border-solid border-#ccc"},{default:F((()=>[O(o,{class:"mb-12px",checked:C(I).all,"onUpdate:checked":a[7]||(a[7]=e=>C(I).all=e),label:e.$t("Public.SelectAll"),indeterminate:C(se)},null,8,["checked","label","indeterminate"]),O(m,{value:C(I).domains_list,"onUpdate:value":a[8]||(a[8]=e=>C(I).domains_list=e)},{default:F((()=>[O(p,{class:"flex-col!",size:12},{default:F((()=>[(R(!0),E(H,null,M(C(ee),(e=>(R(),V(o,{key:e.name,value:e.name,label:e.name},null,8,["value","label"])))),128))])),_:1})])),_:1},8,["value"])])),_:1},8,["show"])])),_:1},8,["label"])])):q("",!0)])),_:1},8,["model"]),O(L,{class:"mt-16px"},{default:F((()=>[N("li",null,P(e.$t("SSL.index_15")),1),a[9]||(a[9]=N("li",null,"Manually resolved certificates do not support auto-renewal",-1)),N("li",null,P(e.$t("SSL.index_16")),1)])),_:1,__:[9]})])}}});export{X as default};
