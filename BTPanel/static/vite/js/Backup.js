import{_ as a}from"./index.js?v=1769066082311";import{f as e,a as t,h as l}from"./public.js?v=1769066082311";import{aa as s,aE as i,x as o,_ as u,m as n}from"./page_layout.js?v=1769066082311";import{R as p}from"./ResourceManagerWindow.js?v=1769066082311";import{av as r,au as c,aC as m}from"./naive.js?v=1769066082311";import{k as d,P as f,i as k,r as v,av as _,R as h,V as b,W as x,a3 as g,S as M,U as j,j as w,a4 as y,ak as C,F as B}from"./vue.js?v=1769066082311";import"./common.js?v=1769066082311";import"./__commonjsHelpers__.js?v=1769066082311";import"./CalcSize.vue_vue_type_script_setup_true_lang.js?v=1769066082311";import"./soft2.js?v=1769066082311";import"./soft.js?v=1769066082311";import"./site.js?v=1769066082311";import"./index38.js?v=1769066082311";import"./file2.js?v=1769066082311";import"./index.vue_vue_type_script_setup_true_lang7.js?v=1769066082311";const P={class:"p-20px"},R={class:"flex items-center gap-16px mb-16px"},U={class:"p-20px"},N={class:"mb-16px text-14px"},S={class:"flex items-center gap-20px"},q={class:"text-13px"},z=d({__name:"Backup",setup(d,{expose:z}){const{t:D}=f(),F=k("fileStore"),{currentPath:O,backupForm:T}=F,W=v(!1),E=v(!1),H=v([]);z({open(){T.value.path="",W.value=!0,L()},close(){W.value=!1,H.value=[]}});const V=v(!1),A=_("resourceManagerRef"),G=v([{key:"time",title:D("file.backupModal.backupTime"),width:160,render:a=>s(a.time)},{key:"path",title:D("file.backupModal.backupPath"),ellipsis:{tooltip:!0}},{key:"name",title:D("file.backupModal.backupName"),width:120,ellipsis:{tooltip:!0},render:a=>a.name||"--"},e({width:100,options:a=>[{label:D("Public.Btn.Delete"),onClick:()=>{t({title:D("file.backupModal.deleteBackup"),content:D("file.backupModal.deleteConfirm"),onConfirm:async()=>{await i.post("/files?action=del_path_premissions",{id:a.id},{requestOptions:{loading:D("file.backupModal.deletingBackup"),successMessage:!0}}),L()}})}}]})]);function I(){var a;null==(a=A.value)||a.open()}function J(a){T.value.path=a}function K(){T.value.path?V.value=!0:n.warning(D("file.backupModal.pleaseSelectPath"))}async function L(){try{E.value=!0;const{message:a}=await i.post("/files?action=get_all_back");o(a)?H.value=a.map(a=>({id:Number(a[0]),time:Number(a[2]),name:a[1],path:a[3]})):H.value=[]}finally{E.value=!1}}async function Q(){try{await i.post("/files?action=back_path_permissions",T.value,{requestOptions:{loading:D("file.backupModal.executingBackup"),successMessage:!0}}),L(),T.value.path="",T.value.remark=""}catch(a){console.warn(a)}}return(e,t)=>{const s=c,i=u,o=m,n=r,d=l,f=a;return b(),h(B,null,[x(f,{show:j(W),"onUpdate:show":t[1]||(t[1]=a=>C(W)?W.value=a:null),title:j(D)("file.backupModal.title"),width:"700"},{default:g(()=>[M("div",P,[M("div",R,[x(n,null,{default:g(()=>[x(s,{value:j(T).path,"onUpdate:value":t[0]||(t[0]=a=>j(T).path=a)},null,8,["value"]),x(o,{onClick:I},{icon:g(()=>[x(i,{name:"file-dir",size:"20"})]),_:1})]),_:1}),x(o,{type:"primary",onClick:K},{default:g(()=>[w(y(j(D)("file.backupModal.backupButton")),1)]),_:1})]),x(d,{loading:j(E),"max-height":370,data:j(H),columns:j(G)},null,8,["loading","data","columns"])])]),_:1},8,["show","title"]),x(f,{show:j(V),"onUpdate:show":t[3]||(t[3]=a=>C(V)?V.value=a:null),title:j(D)("file.backupModal.confirmTitle"),width:320,footer:!0,onConfirm:Q},{default:g(()=>[M("div",U,[M("div",N,y(j(D)("file.backupModal.enterBackupName")),1),M("div",S,[M("div",q,y(j(D)("file.backupModal.remarks")),1),x(s,{class:"flex-1",value:j(T).remark,"onUpdate:value":t[2]||(t[2]=a=>j(T).remark=a)},null,8,["value"])])])]),_:1},8,["show","title"]),x(p,{ref_key:"resourceManagerRef",ref:A,"current-path":j(O),onChooseDir:J},null,8,["current-path"])],64)}}});export{z as default};
