System.register(["./page_layout-legacy.js?v=1769066082311","./public-legacy.js?v=1769066082311","./tools-legacy2.js?v=1769066082311","./vue-legacy.js?v=1769066082311","./naive-legacy.js?v=1769066082311","./rules-legacy.js?v=1769066082311","./index.vue_vue_type_script_setup_true_lang-legacy5.js?v=1769066082311","./index.vue_vue_type_script_setup_true_lang-legacy7.js?v=1769066082311","./index.vue_vue_type_script_setup_true_lang-legacy.js?v=1769066082311","./index-legacy104.js?v=1769066082311","./index.vue_vue_type_script_setup_true_lang-legacy14.js?v=1769066082311","./common-legacy.js?v=1769066082311"],function(e,t){"use strict";var a,l,i,n,o,d,r,s,u,p,c,_,v,y,m,f,g,b,x,h,w,W,R,k,$,j,M,C,S,U,z,D,P,I,B,E,L,O,F,H,T,G,A,q,J,Q,V,X,Y,Z,K,N,ee,te,ae,le,ie,ne,oe,de,re,se,ue,pe,ce,_e,ve,ye;return{setters:[e=>{a=e.aE,l=e.i,i=e.ap,n=e.k,o=e.a,d=e.ds,r=e.x,s=e.a7,u=e.d,p=e.y,c=e.aa,_=e.p,v=e.aA,y=e.M,m=e.h},e=>{f=e.c,g=e.f,b=e.u,x=e.h,h=e.a,w=e.d},e=>{W=e.a,R=e.s},e=>{k=e.k,$=e.P,j=e.W,M=e._,C=e.a2,S=e.V,U=e.U,z=e.ab,D=e.r,P=e.e,I=e.R,B=e.a3,E=e.l,L=e.S,O=e.a4,F=e.v,H=e.j,T=e.F,G=e.t,A=e.X,q=e.aG,J=e.y,Q=e.ae,V=e.O,X=e.ak,Y=e.x,Z=e.c},e=>{K=e.bJ,N=e.dS,ee=e.dW,te=e.aC,ae=e.G,le=e.e2,ie=e.dU,ne=e.dZ,oe=e.dT,de=e.dQ,re=e.dR},e=>{se=e.n},e=>{ue=e._},e=>{pe=e._},e=>{ce=e._},e=>{_e=e._},e=>{ve=e._},e=>{ye=e.m}],execute:function(){var me=document.createElement("style");me.textContent=".rank-table[data-v-9bacc249]{--n-merged-border-color: transparent;height:100%}.rank-table[data-v-9bacc249] .n-data-table-thead{display:none}.bt-radio[data-v-9ee89472] .n-radio-button:last-child{border-right:none;border-top-right-radius:0;border-bottom-right-radius:0}.bt-date-picker[data-v-9ee89472]{width:220px}.bt-date-picker[data-v-9ee89472] .n-input{border-top-left-radius:0;border-bottom-left-radius:0}.report-tabs[data-v-0329e270]{--n-tab-gap: 0;--n-tab-padding: 14px 24px;--n-tab-font-size: 14px;--n-pane-padding-top: 16px;--n-pane-padding-left: 16px;--n-pane-padding-right: 16px;--n-pane-padding-bottom: 16px}.report-card[data-v-0329e270]{--n-title-font-size: 14px}.report-card[data-v-0329e270] .n-card-header{min-height:50px}\n/*$vite$:1*/",document.head.appendChild(me);const fe=e("g",e=>a.post("/plugin?action=a&name=btwaf&s=get_id_log",e,{requestOptions:{loading:l.global.t("Waf.Api.report_1")}})),ge=k({__name:"index",props:{data:{default:()=>[]},total:{default:0},loading:{type:Boolean,default:!1}},setup(e){const a=e,{t:l}=$(),d=i(),{columns:r}=f([{key:"ip",title:l("Waf.Report.index_7"),ellipsis:{tooltip:!0}},{key:"address",title:l("Waf.Report.index_8"),ellipsis:{tooltip:!0}},{key:"num",title:l("Waf.Report.index_9"),width:"14%",minWidth:120},{key:"num",title:l("Waf.Report.index_10"),width:"32%",minWidth:160,render:e=>{const{total:t}=a,l=n((100*(t?e.num/t:0)).toFixed(1));return j("div",{class:"w-90%"},[j(K,{type:"line","indicator-placement":"outside",height:16,"border-radius":2,percentage:l,color:d.value.successColor},null)])}},g({width:120,options:e=>[{label:l("Waf.Report.index_11"),onClick:()=>{W(e)}},{label:l("Public.Btn.Details"),onClick:()=>{b({title:l("Waf.Report.index_12",[e.ip]),width:950,minHeight:672,data:{row:e},component:M(()=>o(()=>t.import("./details-legacy2.js?v=1769066082311"),void 0))})}}]})]);return(e,t)=>{const a=x;return S(),C(a,{loading:e.loading,data:e.data,columns:U(r)},null,8,["loading","data","columns"])}}}),be=k({__name:"index",props:{data:{default:()=>[]},total:{default:0},loading:{type:Boolean,default:!1}},setup(e){const a=e,l=i(),{t:d}=$(),{columns:r}=f([{key:"uri",title:"URI",ellipsis:{tooltip:!0}},{key:"num",title:d("Waf.Report.index_9"),width:"20%"},{key:"num",title:d("Waf.Report.index_10"),render:e=>{const{total:t}=a,i=n((100*(t?e.num/t:0)).toFixed(1));return j("div",{class:"w-90%"},[j(K,{type:"line","indicator-placement":"outside",height:16,"border-radius":2,percentage:i,color:l.value.successColor},null)])}},g({width:120,options:e=>[{label:d("Waf.Report.index_11"),onClick:()=>{s(e)}},{label:d("Public.Btn.Details"),onClick:()=>{u(e)}}]})]),s=e=>{h({title:d("Waf.Report.index_19"),content:()=>j(z,{tag:"div",keypath:"Waf.Report.index_33",scope:"global"},{index_1:()=>j("span",{class:"text-error"},[e.uri])}),onConfirm:async()=>{await se({url_rule:e.uri})}})},u=e=>{b({title:d("Waf.Report.index_20",[e.uri]),width:950,minHeight:600,data:{uri:e.uri,list:e.list},component:M(()=>o(()=>t.import("./details-legacy3.js?v=1769066082311"),void 0))})};return(e,t)=>{const a=x;return S(),C(a,{loading:e.loading,data:e.data,columns:U(r)},null,8,["loading","data","columns"])}}}),xe={class:"p-8px"},he={class:"w-160px"},we={class:"min-w-160px mr-20px"},We={class:"text-desc"},Re={class:"w-450px"},ke=k({__name:"index",setup(e){const{t:l}=$(),i=D(null),n=P({p:1,limit:10,site:"all",type:"1",search:"",time:null}),_={search:{trigger:["input","blur"],validator:()=>"4"===n.type||""!==n.search.trim()||new Error(l("Waf.Report.index_28"))},time:{trigger:["change"],validator:()=>"4"!==n.type||null!==n.time||new Error(l("Waf.Report.index_29"))}},v=D([{label:l("Waf.Report.index_30"),value:"all"}]),y=[{label:"IP",value:"1"},{label:"URI",value:"2"},{label:"URL",value:"3"},{label:l("Waf.Report.index_31"),value:"4"}],{table:m,columns:h,setLoading:w}=f([{key:"time_localtime",title:l("Waf.Report.index_13"),width:"18%",minWidth:150},{key:"ip",title:l("Waf.Report.index_7"),width:"14%",minWidth:120},{key:"server_name",title:l("Waf.Report.index_14"),width:"14%",minWidth:120,ellipsis:{tooltip:!0}},{key:"uri",title:"URI",ellipsis:{tooltip:!0},minWidth:160,render:e=>d(e.uri)},{key:"filter_rule",title:l("Waf.Report.index_1"),width:"14%",minWidth:120,ellipsis:{tooltip:!0}},g({width:100,options:e=>[{label:l("Public.Btn.Details"),onClick:async()=>{const{message:t}=await fe({id:e.id});r(t)&&t.length>0&&R(t[0])}},{label:"HTTP",onClick:()=>{W(e)}}]})]),W=e=>{b({title:l("Waf.Report.index_32",[e.time_localtime]),width:800,minHeight:458,data:{id:e.id},component:M(()=>o(()=>t.import("./http-legacy.js?v=1769066082311"),void 0))})},k=async()=>{try{await(i.value?.validate()),w(!0);const{message:t}=await(e=(()=>{const{time:e}=n,t=e?c(e[0],"yyyy-MM-dd"):"",a=e?c(e[1],"yyyy-MM-dd"):"";return{..."all"===n.site?{is_all:1}:{server_name:n.site},..."4"===n.type?{start_time:t,end_time:a}:{serach:n.search},p:n.p,type:n.type}})(),a.post("/plugin?action=a&name=btwaf&s=get_search",e));u(t)&&(m.data=r(t.data)?t.data:[],m.total=p(t.page))}finally{w(!1)}var e};return(async()=>{try{const{message:e}=await a.post("/plugin?action=a&name=btwaf&s=get_server_name");r(e)&&(v.value=e.map(e=>({label:e,value:e})))}finally{v.value.unshift({label:l("Waf.Report.index_30"),value:"all"})}})(),(e,t)=>{const a=ee,l=N,o=_e,d=s,r=te,u=ce,p=x,c=pe,f=ue;return S(),I("div",xe,[j(u,{ref_key:"formRef",ref:i,model:U(n),rules:_},{default:B(()=>[j(l,{label:e.$t("Waf.Report.index_21")},{default:B(()=>[L("div",he,[j(a,{value:U(n).site,"onUpdate:value":t[0]||(t[0]=e=>U(n).site=e),options:U(v)},null,8,["value","options"])])]),_:1},8,["label"]),j(l,{label:e.$t("Waf.Report.index_22")},{default:B(()=>[L("div",we,[j(a,{value:U(n).type,"onUpdate:value":t[1]||(t[1]=e=>U(n).type=e),options:y},null,8,["value"])]),L("div",null,[t[6]||(t[6]=L("span",{class:"mr-8px text-error"},"*",-1)),L("span",We,O(e.$t("Waf.Report.index_23")),1)])]),_:1},8,["label"]),E(j(l,{label:e.$t("Waf.Report.index_25"),path:"search"},{default:B(()=>[L("div",Re,[j(o,{value:U(n).search,"onUpdate:value":t[2]||(t[2]=e=>U(n).search=e),rows:3},null,8,["value"])])]),_:1},8,["label"]),[[F,"4"!==U(n).type]]),E(j(l,{label:e.$t("Waf.Report.index_26"),path:"time"},{default:B(()=>[j(d,{value:U(n).time,"onUpdate:value":t[3]||(t[3]=e=>U(n).time=e),type:"daterange",clearable:""},null,8,["value"])]),_:1},8,["label"]),[[F,"4"===U(n).type]]),j(l,{label:" "},{default:B(()=>[j(r,{type:"primary",onClick:k},{default:B(()=>[H(O(e.$t("Waf.Report.index_27")),1)]),_:1})]),_:1})]),_:1},8,["model"]),j(f,null,{table:B(()=>[j(p,{loading:U(m).loading,data:U(m).data,columns:U(h)},null,8,["loading","data","columns"])]),pageRight:B(()=>[j(c,{page:U(n).p,"onUpdate:page":t[4]||(t[4]=e=>U(n).p=e),"page-size":U(n).limit,"onUpdate:pageSize":t[5]||(t[5]=e=>U(n).limit=e),"display-order":["pages"],"item-count":U(m).total,onRefresh:k},null,8,["page","page-size","item-count"])]),_:1})])}}}),$e={class:"h-full p-10px"},je=k({__name:"index",props:{loading:{type:Boolean,default:!1},data:{default:()=>[]}},setup(e){const{columns:t}=f([{key:"ip",title:"",align:"center",render:e=>j(T,null,[j("a",{class:"bt-link",href:"javascript:;",onClick:()=>{W(e)}},[e.ip]),j("span",{class:"mx-6px"},[e.address]),j("span",null,[H("("),e.num,H(")")])])}]);return(e,a)=>{const l=x;return S(),I("div",$e,[j(l,{class:"rank-table",loading:e.loading,data:e.data,"flex-height":!0,bordered:!1,"single-line":!1,"single-column":!1,columns:U(t)},null,8,["loading","data","columns"])])}}}),Me=_(je,[["__scopeId","data-v-9bacc249"]]),Ce={class:"flex-center h-full p-10px"},Se=k({__name:"index",props:{data:{default:()=>[]}},setup(e){const t=G(e,"data"),{t:a}=$(),l=A("--color-bg-2"),i=A("--chart-tooltip-bg-color"),n=A("--color-text-1"),o=A("--color-text-2"),d=A("--color-text-3"),r=A("--color-border"),s=D(!1),u=q({backgroundColor:l.value,title:c(),tooltip:{trigger:"item",confine:!0,backgroundColor:i.value,borderColor:"transparent",textStyle:{color:"#c7c7c7"},formatter(e){const t=e;return`${t.marker} ${t.name}: ${t.value} (${t.percent}%)`}},series:_()}),p=["#6ec71e","#4885FF","#fc8b40","#818af8","#31c9d7","#f35e7a","#ab7aee","#14d68b","#cde5ff"];function c(e=0){return{text:a("Waf.Report.index_18"),textStyle:{color:n.value,fontSize:17},subtext:`${e}`,subtextStyle:{color:o.value,fontSize:15},itemGap:20,left:"center",top:"42%"}}function _(e=[]){return[{type:"pie",data:e,radius:["50%","60%"],center:["50%","50%"],clockwise:!0,avoidLabelOverlap:!0,label:{show:!0,position:"outside",color:d.value,lineHeight:18,formatter:e=>""!==e.name?0===e.percent?"":a("Waf.Overview.index_33",[e.name,e.value,e.percent]):""},labelLine:{length:30,length2:30,lineStyle:{width:1,color:r.value}},itemStyle:{labelLine:{length:30,length2:30,lineStyle:{width:1,color:r.value}},color:e=>p[e.dataIndex]},emphasis:{scaleSize:15}}]}return J(()=>{t.value&&(s.value=!t.value.length,(()=>{let e=0;const a=[];t.value.forEach(t=>{e+=t[1],a.push({name:t[0],value:t[1]})}),u.title=c(e),u.series=_(a)})())}),(e,t)=>{const a=ae;return S(),I("div",Ce,[U(s)?(S(),C(a,{key:0})):(S(),C(ve,{key:1,type:"pie",height:"100%",option:U(u)},null,8,["option"]))])}}}),Ue={class:"flex"},ze=_(k({__name:"date",props:{value:{default:"today"},valueModifiers:{}},emits:["update:value"],setup(e){const{t:t}=$(),a=D("today"),l=D(null),i=Q(e,"value"),n=[{label:t("Public.Search.Yesterday"),value:"yesterday"},{label:t("Public.Search.Today"),value:"today"}],o=e=>{l.value=null,i.value=e},d=e=>{a.value=e?"":"today",i.value=r(e)?e:"today"};return J(()=>{r(i.value)?(l.value=i.value,a.value=""):(a.value=i.value,l.value=null)}),(e,t)=>{const i=le,r=ie,u=s;return S(),I("div",Ue,[j(r,{value:U(a),"onUpdate:value":[t[0]||(t[0]=e=>X(a)?a.value=e:null),o],size:"small",class:"bt-radio"},{default:B(()=>[(S(),I(T,null,V(n,e=>j(i,{key:e.value,value:e.value},{default:B(()=>[H(O(e.label),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"]),j(u,{value:U(l),"onUpdate:value":[t[1]||(t[1]=e=>X(l)?l.value=e:null),d],type:"daterange",size:"small",class:"bt-date-picker",clearable:!0},null,8,["value"])])}}}),[["__scopeId","data-v-9ee89472"]]),De={class:"h-320px"},Pe={class:"h-320px"},Ie=_(k({__name:"index",setup(e){const{loading:t,setLoading:l}=w(),i=D("ip"),n=Y({type:[],ip:[],ip_list:{},uri:[],uri_list:{}}),o=Z(()=>n.value.ip.map(e=>({ip:e[0],num:e[1],address:e[2],data:n.value.ip_list[e[0]]}))),d=Z(()=>n.value.uri.map(e=>({uri:e[0],num:e[1],list:n.value.uri_list[e[0]].ip_list||[]}))),r=Z(()=>{let e=0;return n.value.type.forEach(t=>{e+=t[1]}),e}),s=e=>{"search"!==e&&b()},p=()=>{b()},_=()=>{const e=y();if("today"===f.date)window.open(`${e}/btwaf/content_report.html`);else{const{start:t,end:a}=g();window.open(`${e}/btwaf/content_report.html?stime=${t}&etime=${a}`)}},f=P({date:"today"}),g=()=>{let e="",t="";if(m(f.date))switch(f.date){case"today":e=c(new Date,"yyyy-MM-dd"),t=c(new Date,"yyyy-MM-dd");break;case"yesterday":e=c(ye(new Date,-1),"yyyy-MM-dd"),t=c(ye(new Date,-1),"yyyy-MM-dd")}else e=c(new Date(f.date[0]),"yyyy-MM-dd"),t=c(new Date(f.date[1]),"yyyy-MM-dd");return{start:e,end:t}},b=async()=>{try{l(!0);const{message:t}=await(e=(()=>{const{start:e,end:t}=g();return{..."today"!==f.date?{start_time:e,end_time:t}:{}}})(),a.post("/plugin?action=a&name=btwaf&s=get_report",e));u(t)&&(n.value=t)}finally{l(!1)}var e};return b(),(e,a)=>{const l=oe,u=ne,c=te,y=re,m=de,g=v;return S(),C(g,{class:"report-grid","x-gap":"16"},{default:B(()=>[j(u,{span:"6"},{default:B(()=>[j(l,{class:"report-card mb-16px",title:e.$t("Waf.Report.index_1")},{default:B(()=>[L("div",De,[j(Se,{data:U(n).type},null,8,["data"])])]),_:1},8,["title"]),j(l,{class:"report-card",title:e.$t("Waf.Report.index_2")},{default:B(()=>[L("div",Pe,[j(Me,{loading:U(t),data:U(o)},null,8,["loading","data"])])]),_:1},8,["title"])]),_:1}),j(u,{span:"18"},{default:B(()=>[j(l,{class:"h-full"},{default:B(()=>[j(m,{value:U(i),"onUpdate:value":[a[1]||(a[1]=e=>X(i)?i.value=e:null),s],type:"line",class:"report-tabs"},{prefix:B(()=>a[2]||(a[2]=[L("div",null,null,-1)])),suffix:B(()=>[j(ze,{value:U(f).date,"onUpdate:value":[a[0]||(a[0]=e=>U(f).date=e),p]},null,8,["value"]),j(c,{class:"ml-16px",type:"primary",size:"small",onClick:_},{default:B(()=>[H(O(e.$t("Waf.Report.index_3")),1)]),_:1}),a[3]||(a[3]=L("div",{class:"w-16px"},null,-1))]),default:B(()=>[j(y,{name:"ip",tab:e.$t("Waf.Report.index_4")},{default:B(()=>[j(ge,{loading:U(t),total:U(r),data:U(o)},null,8,["loading","total","data"])]),_:1},8,["tab"]),j(y,{name:"uri",tab:e.$t("Waf.Report.index_5")},{default:B(()=>[j(be,{loading:U(t),total:U(r),data:U(d)},null,8,["loading","total","data"])]),_:1},8,["tab"]),j(y,{name:"search",tab:e.$t("Waf.Report.index_6")},{default:B(()=>[j(ke)]),_:1},8,["tab"])]),_:1},8,["value"])]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-0329e270"]]),Be=Object.freeze(Object.defineProperty({__proto__:null,default:Ie},Symbol.toStringTag,{value:"Module"}));e("i",Be)}}});
