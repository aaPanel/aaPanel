System.register(["./index-legacy.js?v=1767769852656","./public-legacy.js?v=1767769852656","./index.vue_vue_type_script_setup_true_lang-legacy5.js?v=1767769852656","./page_layout-legacy.js?v=1767769852656","./index.vue_vue_type_script_setup_true_lang-legacy.js?v=1767769852656","./vue-legacy.js?v=1767769852656","./naive-legacy.js?v=1767769852656","./common-legacy.js?v=1767769852656","./__commonjsHelpers__-legacy.js?v=1767769852656","./index.vue_vue_type_script_setup_true_lang-legacy6.js?v=1767769852656"],function(e,l){"use strict";var a,t,n,o,i,u,r,d,s,c,_,f,p,v,m,w,x,F,W,g,b,h,y,q,R,k,$,j,U,E,N,C,P,T,O,I,M,A,S,B,L,V,z,J,D;return{setters:[e=>{a=e._},e=>{t=e.d,n=e.e,o=e.c,i=e.f,u=e.a,r=e.h,d=e._},e=>{s=e._},e=>{c=e.aE,_=e.i,f=e.dp,p=e.p,v=e.m,m=e.x},e=>{w=e._},e=>{x=e.k,F=e.P,W=e.ae,g=e.r,b=e.R,h=e.V,y=e.S,q=e.W,R=e.U,k=e.c,$=e.a2,j=e.av,U=e.e,E=e.a3,N=e.an,C=e.a4,P=e.j},e=>{T=e.dV,O=e.au,I=e.dd,M=e.d0,A=e.dR,S=e.dT,B=e.dU,L=e._,V=e.df,z=e.dj,J=e.aC,D=e.dS},null,null,null],execute:function(){var l=document.createElement("style");l.textContent=".n-select[data-v-5842887f] .n-base-selection-tag-wrapper{padding:0 0 3px}.form-title[data-v-c86a897c]{margin-bottom:20px;font-size:16px}\n/*$vite$:1*/",document.head.appendChild(l);const H={class:"flex w-380px"},G={class:"w-140px mr-12px"},K={class:"flex-1"},Q=x({__name:"path",props:{url:{},urlModifiers:{},type:{},typeModifiers:{}},emits:["update:url","update:type"],setup(e){const{t:l}=F(),a=W(e,"url"),t=W(e,"type"),n=g([{label:l("Waf.Flow.Form.index_36"),value:"url"},{label:l("Waf.Flow.Form.index_37"),value:"all"}]),o=e=>{"all"===e&&(a.value="/")};return(e,l)=>{const i=T,u=O;return h(),b("div",H,[y("div",G,[q(i,{value:t.value,"onUpdate:value":[l[0]||(l[0]=e=>t.value=e),o],options:R(n)},null,8,["value","options"])]),y("div",K,[q(u,{value:a.value,"onUpdate:value":l[1]||(l[1]=e=>a.value=e),disabled:"all"===t.value,placeholder:e.$t("Waf.Flow.Form.index_35")},null,8,["value","disabled","placeholder"])])])}}}),X="allsite",Y=p(x({__name:"site",props:{value:{},valueModifiers:{}},emits:["update:value"],setup(e){const l=W(e,"value"),a=f(),{t:n}=F(),{loading:o,setLoading:i}=t(),u=g([]),r=g([{label:n("Waf.Flow.Form.index_39"),value:X}]),d=k(()=>l.value===X),s=({option:e,handleClose:l})=>{if(e.value!==X)return q(I,{class:"mr-6px",closable:!0,onClose:e=>{e.stopPropagation(),l()}},{default:()=>[e.label]})},c=e=>{d.value||(e.includes(X)?(l.value=X,u.value=r.value.map(e=>e.value)):e.length!==r.value.length-1?(l.value=e.filter(e=>e!==X),u.value=e.filter(e=>e!==X)):e.length===r.value.length-1&&(l.value=X,u.value=r.value.map(e=>e.value))),d.value&&(e.includes(X)?e.length!==r.value.length&&(l.value=e.filter(e=>e!==X),u.value=e.filter(e=>e!==X)):(l.value=[],u.value=[]))};return(async()=>{try{i(!0),await a.getConfig(),r.value=Object.entries(a.config.sitemap).map(([e,l])=>({label:e,value:l})),r.value.unshift({label:n("Waf.Flow.Form.index_39"),value:X}),l.value===X?u.value=r.value.map(e=>e.value):M(l.value)&&(u.value=l.value)}finally{i(!1)}})(),(e,l)=>{const a=T;return h(),$(a,{loading:R(o),value:R(u),multiple:"",filterable:"",options:R(r),"max-tag-count":"responsive","consistent-menu-width":!1,"render-tag":s,placeholder:e.$t("Waf.Flow.Form.index_38"),"onUpdate:value":c},null,8,["loading","value","options","placeholder"])}}}),[["__scopeId","data-v-5842887f"]]),Z={class:"p-24px"},ee={class:"form-title"},le={class:"w-380px"},ae={class:"w-380px"},te={class:"form-title mt-8px"},ne={class:"w-60px mx-8px"},oe={class:"text-desc"},ie={class:"w-60px mx-8px"},ue={class:"text-desc"},re={class:"w-60px mx-8px"},de={class:"text-desc"},se={class:"form-title mt-8px"},ce={class:"w-380px"},_e={class:"w-380px"},fe=x({__name:"index",props:{isEdit:{type:Boolean},row:{},refresh:{}},setup(e,{expose:l}){const a=e,{t:t}=F(),n=j("formRef"),o=U({name:"",server:[],types:"url",url:"",condition:1,secondReq:!0,secondReqNum:void 0,countReq:!1,countReqTime:void 0,countReqNum:void 0,action:"status_503",return:"html"}),i=g([{label:t("Waf.Flow.Form.index_16"),value:"status_403"},{label:t("Waf.Flow.Form.index_17"),value:"status_404"},{label:t("Waf.Flow.Form.index_18"),value:"status_502"},{label:t("Waf.Flow.Form.index_19"),value:"status_503"},{label:t("Waf.Flow.Form.index_20"),value:"content"},{label:t("Waf.Flow.Form.index_21"),value:"drop"}]),u=g([{label:t("Waf.Flow.Form.index_22"),value:"html"},{label:t("Waf.Flow.Form.index_23"),value:"json"},{label:t("Waf.Flow.Form.index_24"),value:"444"}]),r={name:{required:!0,trigger:["blur","input"],message:t("Waf.Flow.Form.index_3")},server:{trigger:["change"],validator:()=>!(o.server.length<=0)||new Error(t("Waf.Flow.Form.index_25"))},path:{trigger:["blur","input","change"],validator:()=>{if("url"===o.types){if(!o.url)return new Error(t("Waf.Flow.Form.index_26"));if("/"===o.url)return new Error(t("Waf.Flow.Form.index_27"));if(!o.url.startsWith("/"))return new Error(t("Waf.Flow.Form.index_28"))}return!0}},second:{trigger:["blur","input"],validator:()=>!(o.secondReq&&!o.secondReqNum)||new Error(t("Waf.Flow.Form.index_29"))},count:{trigger:["blur","input"],validator:()=>{if(o.countReq){if(!o.countReqTime)return new Error(t("Waf.Flow.Form.index_30"));if(o.countReqTime<30)return new Error(t("Waf.Flow.Form.index_31"));if(!o.countReqNum)return new Error(t("Waf.Flow.Form.index_32"));if(o.countReqNum<20)return new Error(t("Waf.Flow.Form.index_33"))}return!0}}};return(()=>{const{isEdit:e,row:l}=a;e&&l&&(o.name=l.name,o.server=Object.keys(l.site),o.types=l.types,o.url=l.url,o.condition=l.condition,o.secondReq=!!l.region.req,l.region.req&&(o.secondReqNum=l.region.req),o.countReq=!!l.region.count,l.region.count&&(o.countReqTime=l.region.count.time,o.countReqNum=l.region.count.count),o.action=l.action,"content"===l.action&&(o.return=l.return))})(),l({onConfirm:async()=>{if(await(n.value?.validate()),!1===o.secondReq&&!1===o.countReq)return v.error(t("Waf.Flow.Form.index_34"),{close:!0}),!1;const e={name:o.name,site:m(o.server)?o.server.join(","):o.server,types:o.types,url:o.url,condition:o.condition,action:o.action,region:{...o.secondReq?{req:o.secondReqNum}:{},...o.countReq?{count:{time:o.countReqTime,count:o.countReqNum}}:{}},..."content"===o.action?{return:o.return}:{}},{row:l,isEdit:i}=a;var u;i&&l?await(u={...e,id:l.id},c.post("/btwaf/edit_user_limit.json",{data:JSON.stringify(u)},{requestOptions:{loading:_.global.t("Waf.Flow.API.index_2"),successMessage:!0}})):await(e=>c.post("/btwaf/add_user_limit.json",{data:JSON.stringify(e)},{requestOptions:{loading:_.global.t("Waf.Flow.API.index_1"),successMessage:!0}}))(e),a.refresh?.()}}),(e,l)=>{const a=O,t=A,d=B,s=S,c=L,_=V,f=T,p=w;return h(),b("div",Z,[q(p,{ref_key:"formRef",ref:n,model:R(o),rules:r},{default:E(()=>[y("div",ee,C(e.$t("Waf.Flow.Form.index_1")),1),q(t,{label:e.$t("Waf.Flow.Form.index_2"),path:"name"},{default:E(()=>[y("div",le,[q(a,{value:R(o).name,"onUpdate:value":l[0]||(l[0]=e=>R(o).name=e),placeholder:e.$t("Waf.Flow.Form.index_3")},null,8,["value","placeholder"])])]),_:1},8,["label"]),q(t,{label:e.$t("Waf.Flow.Form.index_4"),path:"server"},{default:E(()=>[y("div",ae,[q(Y,{value:R(o).server,"onUpdate:value":l[1]||(l[1]=e=>R(o).server=e)},null,8,["value"])])]),_:1},8,["label"]),y("div",te,C(e.$t("Waf.Flow.Form.index_5")),1),q(t,{label:e.$t("Waf.Flow.Form.index_6"),path:"path"},{default:E(()=>[q(Q,{type:R(o).types,"onUpdate:type":l[2]||(l[2]=e=>R(o).types=e),url:R(o).url,"onUpdate:url":l[3]||(l[3]=e=>R(o).url=e)},null,8,["type","url"])]),_:1},8,["label"]),q(t,{label:e.$t("Waf.Flow.Form.index_7")},{default:E(()=>[q(s,{value:R(o).condition,"onUpdate:value":l[4]||(l[4]=e=>R(o).condition=e)},{default:E(()=>[q(d,{value:1},{default:E(()=>[P(C(e.$t("Waf.Flow.Form.index_8")),1)]),_:1}),q(d,{value:2},{default:E(()=>l[12]||(l[12]=[P("IP+UA",-1)])),_:1,__:[12]}),q(d,{value:3},{default:E(()=>[P(C(e.$t("Waf.Flow.Form.index_9")),1)]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),q(t,{label:" ",path:"second"},{default:E(()=>[q(c,{checked:R(o).secondReq,"onUpdate:checked":l[5]||(l[5]=e=>R(o).secondReq=e)},{default:E(()=>[P(C(e.$t("Waf.Flow.Form.index_10")),1)]),_:1},8,["checked"]),y("div",ne,[q(_,{value:R(o).secondReqNum,"onUpdate:value":l[6]||(l[6]=e=>R(o).secondReqNum=e),"show-button":!1,placeholder:""},null,8,["value"])]),y("div",oe,C(e.$t("Public.Unit.Times")),1)]),_:1}),q(t,{label:" ",path:"count"},{default:E(()=>[q(c,{checked:R(o).countReq,"onUpdate:checked":l[7]||(l[7]=e=>R(o).countReq=e)},{default:E(()=>[P(C(e.$t("Waf.Flow.Form.index_11")),1)]),_:1},8,["checked"]),y("div",ie,[q(_,{value:R(o).countReqTime,"onUpdate:value":l[8]||(l[8]=e=>R(o).countReqTime=e),"show-button":!1,placeholder:""},null,8,["value"])]),y("div",ue,C(e.$t("Waf.Flow.Form.index_12")),1),y("div",re,[q(_,{value:R(o).countReqNum,"onUpdate:value":l[9]||(l[9]=e=>R(o).countReqNum=e),"show-button":!1,placeholder:""},null,8,["value"])]),y("div",de,C(e.$t("Public.Unit.Times")),1)]),_:1}),y("div",se,C(e.$t("Waf.Flow.Form.index_13")),1),q(t,{label:e.$t("Waf.Flow.Form.index_14")},{default:E(()=>[y("div",ce,[q(f,{value:R(o).action,"onUpdate:value":l[10]||(l[10]=e=>R(o).action=e),options:R(i)},null,8,["value","options"])])]),_:1},8,["label"]),"content"===R(o).action?(h(),$(t,{key:0,label:e.$t("Waf.Flow.Form.index_15")},{default:E(()=>[y("div",_e,[q(f,{value:R(o).return,"onUpdate:value":l[11]||(l[11]=e=>R(o).return=e),options:R(u)},null,8,["value","options"])])]),_:1},8,["label"])):N("",!0)]),_:1},8,["model"])])}}}),pe=p(fe,[["__scopeId","data-v-c86a897c"]]);e("default",x({__name:"index",setup(e){const{t:l}=F(),t=n(l("Waf.Flow.index_6"),{isEdit:!1,refresh:()=>x()}),f=()=>{t.data.row=null,t.data.isEdit=!1,t.title=l("Waf.Flow.index_6"),t.show=!0},{table:p,columns:v,setLoading:w}=o([{key:"name",title:l("Waf.Flow.index_8"),width:"12%",minWidth:160},{key:"site",title:l("Waf.Flow.index_9"),width:"16%",minWidth:200,render:e=>Object.keys(e.site).join(", ")},{key:"region",title:l("Waf.Flow.index_10"),minWidth:300,render:e=>{let a="";switch(e.condition){case 1:a=l("Waf.Flow.index_11");break;case 2:a=l("Waf.Flow.index_12");break;case 3:a=l("Waf.Flow.index_13")}const{region:t}=e;return t.req&&(a+=l("Waf.Flow.index_14",[t.req])),t.count&&t.count.count&&(t.req&&(a+=l("Waf.Flow.index_15")),a+=l("Waf.Flow.index_16",[t.count.time,t.count.count])),l("Waf.Flow.index_17",[a])}},{key:"action",title:l("Waf.Flow.index_18"),width:"16%",minWidth:260,render:e=>{let a="";switch(e.action){case"status_403":a=l("Waf.Flow.index_19");break;case"status_404":a=l("Waf.Flow.index_20");break;case"status_502":a=l("Waf.Flow.index_21");break;case"status_503":a=l("Waf.Flow.index_22");break;case"content":a=l("Waf.Flow.index_23");break;case"drop":a=l("Waf.Flow.index_24")}return a}},{key:"open",title:l("Waf.Flow.index_25"),width:"6%",minWidth:80,render:e=>q(z,{size:"small",value:e.open,onUpdateValue:async l=>{var a;await(a={id:e.id},c.post("/btwaf/set_user_limit.json",a,{requestOptions:{loading:_.global.t("Waf.Flow.API.index_3"),successMessage:!0}})),e.open=l}},null)},i({width:100,options:e=>[{label:l("Public.Btn.Edit"),onClick:()=>{(e=>{t.data.row=e,t.data.isEdit=!0,t.title=l("Waf.Flow.index_7"),t.show=!0})(e)}},{label:l("Public.Btn.Del"),onClick:()=>{u({title:l("Waf.Flow.index_26"),content:l("Waf.Flow.index_27",[e.name]),onConfirm:async()=>{var l;await(l={id:e.id},c.post("/btwaf/del_user_limit.json",l,{requestOptions:{loading:_.global.t("Waf.Flow.API.index_4"),successMessage:!0}})),x()}})}}]})]),x=async()=>{try{w(!0);const{message:e}=await c.post("/btwaf/get_user_limit.json");p.data=m(e)?e:[]}finally{w(!1)}};return x(),(e,l)=>{const n=J,o=r,i=s,u=d,c=a,_=D;return h(),$(_,{class:"p-16px"},{default:E(()=>[q(i,null,{toolsLeft:E(()=>[q(n,{type:"primary",onClick:f},{default:E(()=>[P(C(e.$t("Waf.Flow.index_1")),1)]),_:1})]),table:E(()=>[q(o,{loading:R(p).loading,data:R(p).data,columns:R(v)},null,8,["loading","data","columns"])]),_:1}),q(u,{class:"mt-16px"},{default:E(()=>[y("li",null,C(e.$t("Waf.Flow.index_2")),1),y("li",null,C(e.$t("Waf.Flow.index_3")),1),y("li",null,C(e.$t("Waf.Flow.index_4")),1),y("li",null,C(e.$t("Waf.Flow.index_5")),1)]),_:1}),q(c,{show:R(t).show,"onUpdate:show":l[0]||(l[0]=e=>R(t).show=e),title:R(t).title,width:640,footer:!0,data:R(t).data,component:pe},null,8,["show","title","data"])]),_:1})}}}))}}});
