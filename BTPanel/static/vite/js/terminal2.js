const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/form9.js?v=1767769852656","js/index.vue_vue_type_script_setup_true_lang.js?v=1767769852656","js/vue.js?v=1767769852656","js/__commonjsHelpers__.js?v=1767769852656","js/naive.js?v=1767769852656","js/common.js?v=1767769852656","js/page_layout.js?v=1767769852656","js/public.js?v=1767769852656","css/public.css?v=1767769852656","css/page_layout.css?v=1767769852656","js/xterm.js?v=1767769852656","js/xterm-addon-canvas.js?v=1767769852656","css/xterm-addon-canvas.css?v=1767769852656"])))=>i.map(i=>d[i]);
import{x as e,a as t,b as a,c as s}from"./xterm.js?v=1767769852656";import{x as o}from"./xterm-addon-canvas.js?v=1767769852656";import{r as n,_ as i,k as r,P as d,af as c,a0 as l,w as u,ap as m,o as p,b as v,R as _,V as f,n as h}from"./vue.js?v=1767769852656";import{aE as x,i as g,a as w,x as A,e as b,dj as S,p as y}from"./page_layout.js?v=1767769852656";import{u as O,d as T,C}from"./public.js?v=1767769852656";const{t:M}=g.global,j=e=>x.post("/xterm?action=create_host",e,{requestOptions:{loading:M("Security.Api.Index_4"),successMessage:!0}}),D=e=>x.post("/xterm?action=get_host_find",e),E=e=>x.post("/xterm?action=remove_host",e,{requestOptions:{loading:M("Security.Api.Index_3"),successMessage:!0}}),I=()=>x.post("/xterm?action=get_command_list"),k=e=>x.post("/xterm?action=create_command",e,{requestOptions:{loading:M("Security.Api.Index_4"),successMessage:!0}}),q=e=>x.post("/xterm?action=modify_command",e,{requestOptions:{loading:M("Crontab.Api.index_5"),successMessage:!0}}),L=e=>x.post("/xterm?action=remove_command",e,{requestOptions:{loading:M("Security.Api.Index_3"),successMessage:!0}}),R=e=>x.post("/xterm?action=test_ssh_connect",e,{requestOptions:{loading:M("Login.index_22"),successMessage:!0}}),{t:P}=g.global,z=e=>{O({title:e.title,width:600,footer:!0,data:e.data,component:i(()=>w(()=>import("./form9.js?v=1767769852656"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12])))})},{loading:F}=T(),B=n([]),N=async()=>{const{message:e}=await x.post("/xterm?action=get_host_list");A(e)&&(B.value=e)},V=n("aaaaaaaaa"),H=n([{id:"aaaaaaaaa",host:"127.0.0.1",port:22,ps:P("Database.form.index_12"),state:!1}]),U=e=>{V.value=e},W=e=>{const t=b(9,"letter");H.value.push({id:t,host:e.host,port:e.port,ps:e.ps,state:!1}),setTimeout(()=>{U(t)},20)},$=(e,t)=>{const a=H.value.find(t=>t.id===e);a&&(a.state=t)},G=()=>{H.value=[{id:"aaaaaaaaa",host:"127.0.0.1",port:22,ps:P("Database.form.index_12"),state:!1}],V.value="aaaaaaaaa"},J=()=>({activeTerminalId:V,terminals:H,setActiveTerminal:U,onServerList:W,onUpdateState:$,resetTerminals:G}),K=y(r({__name:"terminal",props:{data:{},active:{type:Boolean}},emits:["updateState","connectSuccess"],setup(i,{expose:r,emit:x}){const{t:g}=d(),w=i,{data:A}=w,{active:b}=c(w),y=x,O=S(),{isFull:T}=l(O),{ws:M,status:j,send:D,open:E,close:I}=C("/webssh",{get verifyData(){return{host:A.host,port:A.port,id:A.id,ps:A.ps,sort:0}},onMessage:(e,t)=>{const a=t.data;if(a.indexOf("Authentication timeout.")>-1)R.value=!0;else{if(!(-1===a.indexOf("127.0.0.1:")&&-1===a.indexOf("localhost:")||-1===a.indexOf("Password or private key cannot both be empty")&&-1===a.indexOf("Account or Password incorrect: Authentication failed")))return y("updateState",A.id,!1),I(),W(),void k();if("\\r\\nlogout\\r\\n"==a||"logout\\r\\n"==a||"\r\nlogout\r\n"==a||"logout\r\n"==a||a.search(/logout[\r\n]+$/)>-1)return y("updateState",A.id,!1),q.write("\r"+g("Component.Terminal.index_1")+"\r"),W(),void I()}y("connectSuccess",a)}}),k=()=>{z({title:g("Term.index_22"),data:{isEdit:!0,tips:!0,localhost:!0,onRefresh:()=>{A.host.includes("127.0.0.1")&&!A.host.includes("_22")&&(A.host=A.host.replace("127.0.0.1","127.0.0.1_22")),J()}}})};let q,L;const R=n(!1),P=n(null);let F=null;const V=()=>{const e=M.value;e&&(q.loadAddon(L),q.loadAddon(new o.CanvasAddon),q.loadAddon(new a.WebLinksAddon),F=new s.AttachAddon(e),q.loadAddon(F),setTimeout(()=>{L.fit();const e=P.value;e&&($.value="".concat(e.clientHeight,"px"))},100))};u([M,j],([e,t])=>{if("CLOSED"===t&&e)return y("updateState",A.id,!1),q.write("\r\n"+g("Component.Terminal.index_2")+"\r\n"),void setTimeout(()=>{E(),y("updateState",A.id,!0)},500);"OPEN"===t&&e&&(F&&F.dispose(),F=new s.AttachAddon(e),q.loadAddon(F),setTimeout(()=>{L.fit();const{cols:e,rows:t}=q;D({cols:e,rows:t,resize:1})},100))},{immediate:!1});const H=()=>{P.value&&q.open(P.value)};let U=!1;const W=()=>{U=!1},$=n(""),G=()=>{q.focus(),q.onData(e=>{const t=M.value;"\r"===e&&R.value&&(R.value=!1,q.write("\r\n"),J()),void 0!==t||"\r"!==e||U||(U=!0,q.write("\r\n"+g("Component.Terminal.index_2")+"\r\n"),J())})},J=()=>{E(),G();const e=M.value;e&&(q.loadAddon(new s.AttachAddon(e)),y("updateState",A.id,!0))},K=()=>{h(()=>{if(L.fit(),"CLOSED"!==j.value){y("updateState",A.id,!0);const{cols:e,rows:t}=q;D({cols:e,rows:t,resize:1})}})};u(()=>T.value,e=>{const t=P.value;t&&!e&&(t.style.height=$.value)}),u(()=>O.command,e=>{e&&b.value&&(O.isRunCmd?(D("\v"),D(e+"\n")):D(e),O.setCommand(""))}),u(()=>b.value,e=>{e&&h(()=>{L.fit()})});let Q=!0;const X=new ResizeObserver(()=>{b.value&&m(()=>{Q?Q=!1:K()},200)()});r({send:D});return p(async()=>{await(async()=>{await N(),B.value.some(e=>"127.0.0.1_22"===e.host)&&"127.0.0.1"===A.host&&(A.host="127.0.0.1_22")})(),q=new e.Terminal({cursorBlink:!0,fontSize:14,fontFamily:"Monaco, Menlo, Consolas, 'Courier New', monospace",theme:{background:"#333",foreground:"#ececec"}}),L=new t.FitAddon,V(),H(),G(),K(),(()=>{const e=P.value;e&&X.observe(e)})()}),v(()=>{null==X||X.disconnect()}),(e,t)=>(f(),_("div",{ref_key:"terminalRef",ref:P,class:"w-full box"},null,512))}}),[["__scopeId","data-v-bf60b128"]]);export{K as T,k as a,L as b,I as c,E as d,q as e,j as f,N as g,D as h,F as l,z as o,B as s,R as t,J as u};
