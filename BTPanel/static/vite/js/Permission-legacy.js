System.register(["./index-legacy.js?v=1767769852656","./public-legacy.js?v=1767769852656","./page_layout-legacy.js?v=1767769852656","./index-legacy38.js?v=1767769852656","./naive-legacy.js?v=1767769852656","./vue-legacy.js?v=1767769852656","./common-legacy.js?v=1767769852656","./__commonjsHelpers__-legacy.js?v=1767769852656","./soft-legacy2.js?v=1767769852656","./soft-legacy.js?v=1767769852656","./site-legacy.js?v=1767769852656","./file-legacy2.js?v=1767769852656","./index.vue_vue_type_script_setup_true_lang-legacy7.js?v=1767769852656"],function(e,i){"use strict";var a,t,l,s,n,o,r,p,c,u,d,f,m,v,g,x,w,b,h,y,k,_,M,$,j,P,C,S,U,B,O,N,q;return{setters:[e=>{a=e._},e=>{t=e.f,l=e.a,s=e.h},e=>{n=e.aa,o=e.aE,r=e.T,p=e._,c=e.x,u=e.p},e=>{d=e.g},e=>{f=e.aC,m=e.eh,v=e._,g=e.au,x=e.dV},e=>{w=e.k,b=e.P,h=e.i,y=e.r,k=e.R,_=e.V,M=e.W,$=e.a3,j=e.U,P=e.S,C=e.an,S=e.H,U=e.a4,B=e.j,O=e.ak,N=e.F,q=e.n},null,null,null,null,null,null,null],execute:function(){var i=document.createElement("style");i.textContent='@charset "UTF-8";.modal-footer-btns[data-v-49186f19]{display:flex;align-items:center;flex-direction:row;justify-content:end;gap:10px;padding:10px}.single-line-ellipsis[data-v-49186f19]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.permission-wrapper[data-v-49186f19]{height:360px}.permission-wrapper .tit[data-v-49186f19]{height:46px;display:flex;align-items:center;flex-direction:row}.permission-wrapper .tit .tit-item[data-v-49186f19]{flex:1;line-height:46px;text-align:center;cursor:pointer;font-size:14px;background:var(--color-bg-3)}.permission-wrapper .tit .tit-item.active[data-v-49186f19]{background-color:var(--color-bg-2)}.permission-wrapper .content[data-v-49186f19]{padding:20px}.permission-wrapper .content .backup-notice[data-v-49186f19]{display:flex;align-items:center;flex-direction:row;gap:10px;padding:10px;margin-bottom:20px;background:var(--color-bg-3);border:1px solid var(--color-border);border-radius:10px}.permission-wrapper .content .options[data-v-49186f19]{display:flex;align-items:center;flex-direction:row;gap:20px;margin-bottom:20px}.permission-wrapper .content .options .option-item[data-v-49186f19]{flex:1;padding:15px 10px;border:1px solid var(--color-border);border-radius:5px;position:relative}.permission-wrapper .content .options .option-item[data-v-49186f19]:before{content:"Owner";display:block;width:auto;height:30px;padding:5px;position:absolute;left:10px;top:-15px;font-size:14px;background-color:var(--color-modal)}.permission-wrapper .content .options .option-item.group[data-v-49186f19]:before{content:"Group"}.permission-wrapper .content .options .option-item.public[data-v-49186f19]:before{content:"Public"}.permission-wrapper .content .other-settings[data-v-49186f19]{display:flex;align-items:center;flex-direction:row;gap:10px}.permission-wrapper .content .other-settings .setting-item[data-v-49186f19]{flex:1;display:flex;align-items:center;flex-direction:row;gap:10px}.permission-wrapper .content .backup-list[data-v-49186f19],.permission-wrapper .content .backup-list-item[data-v-49186f19]{display:flex;align-items:center;flex-direction:row;background:#f6f6f6;border:1px solid var(--color-border);padding:10px}.permission-wrapper .content .backup-list .name[data-v-49186f19],.permission-wrapper .content .backup-list-item .name[data-v-49186f19]{flex:1}.permission-wrapper .content .backup-list .permission[data-v-49186f19],.permission-wrapper .content .backup-list-item .permission[data-v-49186f19],.permission-wrapper .content .backup-list .owner[data-v-49186f19],.permission-wrapper .content .backup-list-item .owner[data-v-49186f19]{flex:1.5}.permission-wrapper .content .backup-list .backup-time[data-v-49186f19],.permission-wrapper .content .backup-list-item .backup-time[data-v-49186f19]{flex:2}.permission-wrapper .content .backup-list .opt[data-v-49186f19],.permission-wrapper .content .backup-list-item .opt[data-v-49186f19]{flex:3;text-align:right}.permission-wrapper .content .backup-list-item[data-v-49186f19]{border-top:none;background-color:#fff}.confirm-backup-wrapper[data-v-49186f19]{padding:20px}\n/*$vite$:1*/',document.head.appendChild(i);const L={class:"permission-wrapper"},T={class:"tit"},V={key:0,class:"content"},F={class:"backup-notice"},z={class:"options"},A={class:"option-item"},R={class:"option-item group"},D={class:"option-item public"},W={class:"other-settings"},E={class:"setting-item"},G={class:"setting-item"},H={class:"setting-item"},I={key:1,class:"content"},J={class:"backup-notice"},K={class:"confirm-backup-wrapper"},Q={class:"mb-10px"},X={class:"flex justify-start items-center gap-10px"};e("default",u(w({__name:"Permission",setup(e,{expose:i}){const{t:u}=b(),w=h("fileStore"),{choosedKeys:Y,fileList:Z,currentPath:ee}=w,ie=y(!1),ae=y(!1),te=y(""),le=y([]),se=y(!1),ne=y("SetPermission"),oe=y("777"),re=y("root"),pe=y(1),ce=y([]),ue=y(["4","2","1"]),de=y(["4","2","1"]),fe=y(["4","2","1"]),me=y([{label:"root",value:"root"},{label:"mysql",value:"mysql"},{label:"www",value:"www"}]),ve=y(!1),ge=y([{key:"name",title:u("file.permissionModal.name"),ellipsis:{tooltip:!0}},{key:"permission",title:u("file.permissionModal.permission")},{key:"owner",title:u("file.permissionModal.owner")},{key:"time",title:u("file.permissionModal.backupTime"),width:90,render:e=>n(e.time,"yyyy-MM-dd")},t({width:120,options:e=>[{label:u("file.permissionModal.restore"),onClick:()=>{!async function(e){l({title:u("file.permissionModal.confirmRestore"),content:u("file.permissionModal.restoreWarning"),onConfirm:async()=>{await o.post("/files?action=restore_path_permissions",{path:ce.value[0].path,restore_sub_dir:pe.value,date:e},{requestOptions:{loading:u("file.permissionModal.loading.restoring"),successMessage:!0}}),ie.value=!1}})}(e.time)}},{label:u("Public.Btn.Delete"),onClick:()=>{!async function(e){l({title:u("file.permissionModal.confirmDelete"),content:u("file.permissionModal.deleteWarning"),onConfirm:async()=>{await o.post("/files?action=del_path_premissions",{id:e},{requestOptions:{loading:u("file.permissionModal.loading.deleting"),successMessage:!0}}),Me()}})}(e.id)}}]})]);function xe(e){ne.value=e,"BackupList"==e&&Me()}function we(){q(()=>{const e=ue.value.map(Number).reduce((e,i)=>Number(e)+i,0),i=de.value.map(Number).reduce((e,i)=>Number(e)+i,0),a=fe.value.map(Number).reduce((e,i)=>Number(e)+i,0);oe.value=String(e)+String(i)+String(a)})}function be(e){let[i,a,t]=e.split("");ue.value=he(i),de.value=he(a),fe.value=he(t)}function he(e){switch(e){case"7":return["4","2","1"];case"6":return["4","2"];case"5":return["4","1"];case"4":return["4"];case"3":return["2","1"];case"2":return["2"];case"1":return["1"];default:return[]}}async function ye(){1==ce.value.length?await o.post("/files?action=SetFileAccess",{user:re.value,access:oe.value,all:pe.value?"True":"False",filename:ce.value[0].path},{requestOptions:{loading:u("file.permissionModal.loading.modifyingPermission"),successMessage:!0}}):ce.value.length>1&&await o.post("/files?action=SetBatchData",{user:re.value,access:oe.value,all:pe.value,path:ee.value,data:JSON.stringify(ce.value.map(e=>e.nm)),type:3}),d(w)}function ke(){te.value="",ae.value=!0}async function _e(){let e=ee.value;1==ce.value.length&&(e=ce.value[0].path),await o.post("/files?action=back_path_permissions",{back_sub_dir:pe.value,path:e,remark:te.value},{requestOptions:{loading:u("file.permissionModal.loading.backing"),successMessage:!0}}),te.value=""}async function Me(){ve.value=!0;try{const{message:e}=await o.post("/files?action=get_path_premissions",{path:ce.value[0].path},{requestOptions:{isOriginalResult:!0}});c(e)&&(le.value=e.map(e=>({id:Number(e[5]),name:e[4],permission:e[2],owner:e[1],time:e[3]})))}finally{ve.value=!1}}async function $e(){l({title:u("file.permissionModal.fixPermissionTitle"),content:u("file.permissionModal.fixPermissionNote"),onConfirm:async()=>{await o.post("/files?action=fix_permissions",{path:ce.value[0].path},{requestOptions:{loading:u("file.permissionModal.loading.fixingPermission"),successMessage:!0}}),ie.value=!1}})}return i({open(){ie.value=!0,ce.value=Z.value.filter(e=>Y.value.includes(e.nm)),async function(){se.value=!0;try{const e=await o.post("/files?action=GetFileAccess",{filename:ce.value[0].path},{requestOptions:{isOriginalResult:!0}});oe.value=String(e.message.chmod),re.value=e.message.chown,be(oe.value)}finally{se.value=!1}}()},close(){ie.value=!1}}),(e,i)=>{const t=p,l=f,n=v,o=m,c=g,u=x,d=s,w=r,b=a;return _(),k(N,null,[M(b,{show:j(ie),"onUpdate:show":i[9]||(i[9]=e=>O(ie)?ie.value=e:null),title:e.$t("file.permissionModal.title")+` [${1===j(ce).length?j(ce)[0].path:"Batch"}]`,width:520,footer:!0,"confirm-text":e.$t("Public.Btn.Apply"),onConfirm:ye},{default:$(()=>[M(w,{show:j(se)},{default:$(()=>[P("div",L,[P("div",T,[P("div",{class:S(["tit-item",{active:"SetPermission"==j(ne)}]),onClick:i[0]||(i[0]=e=>xe("SetPermission"))},U(e.$t("file.permissionModal.setPermission")),3),P("div",{class:S(["tit-item",{active:"BackupList"==j(ne)}]),onClick:i[1]||(i[1]=e=>xe("BackupList"))},U(e.$t("file.permissionModal.backupsList")),3)]),"SetPermission"==j(ne)?(_(),k("div",V,[P("div",F,[M(t,{name:"base-notice-yellow",size:"20"}),P("span",null,U(e.$t("file.permissionModal.noBackup")),1),M(l,{type:"primary",onClick:ke},{default:$(()=>[B(U(e.$t("file.permissionModal.backup")),1)]),_:1}),M(l,{onClick:i[2]||(i[2]=e=>xe("BackupList"))},{default:$(()=>[B(U(e.$t("file.permissionModal.restore")),1)]),_:1})]),P("div",z,[P("div",A,[M(o,{class:"flex flex-col gap-10px",value:j(ue),"onUpdate:value":i[3]||(i[3]=e=>O(ue)?ue.value=e:null),onUpdateValue:we},{default:$(()=>[M(n,{value:"4"},{default:$(()=>[B(U(e.$t("file.permissionModal.read")),1)]),_:1}),M(n,{value:"2"},{default:$(()=>[B(U(e.$t("file.permissionModal.write")),1)]),_:1}),M(n,{value:"1"},{default:$(()=>[B(U(e.$t("file.permissionModal.execute")),1)]),_:1})]),_:1},8,["value"])]),P("div",R,[M(o,{class:"flex flex-col gap-10px",value:j(de),"onUpdate:value":i[4]||(i[4]=e=>O(de)?de.value=e:null),onUpdateValue:we},{default:$(()=>[M(n,{value:"4"},{default:$(()=>[B(U(e.$t("file.permissionModal.read")),1)]),_:1}),M(n,{value:"2"},{default:$(()=>[B(U(e.$t("file.permissionModal.write")),1)]),_:1}),M(n,{value:"1"},{default:$(()=>[B(U(e.$t("file.permissionModal.execute")),1)]),_:1})]),_:1},8,["value"])]),P("div",D,[M(o,{class:"flex flex-col gap-10px",value:j(fe),"onUpdate:value":i[5]||(i[5]=e=>O(fe)?fe.value=e:null),onUpdateValue:we},{default:$(()=>[M(n,{value:"4"},{default:$(()=>[B(U(e.$t("file.permissionModal.read")),1)]),_:1}),M(n,{value:"2"},{default:$(()=>[B(U(e.$t("file.permissionModal.write")),1)]),_:1}),M(n,{value:"1"},{default:$(()=>[B(U(e.$t("file.permissionModal.execute")),1)]),_:1})]),_:1},8,["value"])])]),P("div",W,[P("div",E,[M(c,{class:"flex-1",style:{width:"50px"},value:j(oe),"onUpdate:value":i[6]||(i[6]=e=>O(oe)?oe.value=e:null),onUpdateValue:be},null,8,["value"]),P("span",null,U(e.$t("file.permissionModal.permission"))+",",1)]),P("div",G,[P("span",null,U(e.$t("file.permissionModal.owner")),1),M(u,{class:"flex-1",style:{width:"50px"},options:j(me),value:j(re),"onUpdate:value":i[7]||(i[7]=e=>O(re)?re.value=e:null)},null,8,["options","value"])]),P("div",H,[M(n,{checked:j(pe),"onUpdate:checked":i[8]||(i[8]=e=>O(pe)?pe.value=e:null),"checked-value":1,"unchecked-value":0},{default:$(()=>[B(U(e.$t("file.permissionModal.applyToSubdir")),1)]),_:1},8,["checked"])])])])):"BackupList"==j(ne)?(_(),k("div",I,[P("div",J,[M(t,{name:"base-notice-yellow",size:"20"}),P("span",null,U(e.$t("file.permissionModal.fixAllPermissions")),1),M(l,{type:"primary",onClick:$e},{default:$(()=>[B(U(e.$t("file.permissionModal.fixPermissions")),1)]),_:1})]),M(d,{loading:j(ve),"max-height":160,data:j(le),columns:j(ge)},null,8,["loading","data","columns"])])):C("",!0)])]),_:1},8,["show"])]),_:1},8,["show","title","confirm-text"]),M(b,{show:j(ae),"onUpdate:show":i[11]||(i[11]=e=>O(ae)?ae.value=e:null),title:e.$t("file.permissionModal.confirmBackup"),width:320,footer:!0,onConfirm:_e},{default:$(()=>[P("div",K,[P("div",Q,U(e.$t("file.permissionModal.enterBackupName")),1),P("div",X,[P("span",null,U(e.$t("file.permissionModal.remarks")),1),M(c,{value:j(te),"onUpdate:value":i[10]||(i[10]=e=>O(te)?te.value=e:null),class:"flex-1"},null,8,["value"])])])]),_:1},8,["show","title"])],64)}}}),[["__scopeId","data-v-49186f19"]]))}}});
