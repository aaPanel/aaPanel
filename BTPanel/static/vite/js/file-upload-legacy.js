System.register(["./vue-legacy.js?v=1769066082311","./page_layout-legacy.js?v=1769066082311","./public-legacy.js?v=1769066082311","./index-legacy58.js?v=1769066082311","./naive-legacy.js?v=1769066082311","./__commonjsHelpers__-legacy.js?v=1769066082311","./common-legacy.js?v=1769066082311","./index.vue_vue_type_script_setup_true_lang-legacy7.js?v=1769066082311","./index.vue_vue_type_script_setup_true_lang-legacy8.js?v=1769066082311","./CalcSize.vue_vue_type_script_setup_true_lang-legacy.js?v=1769066082311","./soft-legacy2.js?v=1769066082311","./soft-legacy.js?v=1769066082311","./site-legacy.js?v=1769066082311","./index.vue_vue_type_script_setup_true_lang-legacy.js?v=1769066082311","./file-legacy2.js?v=1769066082311"],function(e,t){"use strict";var a,l,n,i,s,o,r,p,d,c,u,f,m,g,h,_,x,y,v,b,w,C,z,k,U,j,F,M,S,$,P;return{setters:[e=>{a=e.k,l=e.P,n=e.c,i=e.r,s=e.W,o=e.j,r=e.R,p=e.V,d=e.S,c=e.a3,u=e.a4,f=e.U,m=e.ak,g=e.a2,h=e.au,_=e.an},e=>{x=e.ap,y=e.n,v=e.aG,b=e.fk,w=e._,C=e.m,z=e.p},e=>{k=e.f,U=e.u},e=>{j=e.u,F=e.a},e=>{M=e.bJ,S=e.aC,$=e.dh,P=e.dd},null,null,null,null,null,null,null,null,null,null],execute:function(){var t=document.createElement("style");t.textContent=".n-upload-dragger[data-v-1b421c9e]{height:360px;padding:10px}.n-upload-dragger[data-v-1b421c9e]:hover{--n-dragger-border-hover: 1px dashed #20a53a}.drag-text[data-v-1b421c9e]{margin-top:20px;font-size:16px}.drag-suffix[data-v-1b421c9e]{margin-top:12px;color:#777;font-size:14px}.n-data-table[data-v-1b421c9e]{--n-th-color-modal: transparent;--n-td-color-modal: transparent;--n-th-color-hover-modal: transparent;--n-td-color-hover-modal: transparent;--n-border-color-modal: transparent}\n/*$vite$:1*/",document.head.appendChild(t);const D={class:"p-16px"},E={class:"flex items-center mb-12px"},B={key:1,class:"flex-center flex-col h-300px"},A={class:"drag-text"},T={key:0,class:"drag-suffix"},L=a({__name:"file-upload",props:{path:{default:""},node_id:{},size:{},uploadData:{default:()=>({multiple:!0})},uploadSuccess:{},showSuccessMsg:{type:Boolean,default:!0}},emits:["setConfirm"],setup(e,{expose:t,emit:a}){const z=e,L=a,{path:N,node_id:W}=z,{t:G}=l(),H=x(),I=n(()=>({multiple:!0,...z.uploadData})),J=i([]),O=i(new Map),R=n(()=>(I.value.accept||"").split(",").map(e=>`'${e}'`).join(", ")),V=e=>{const{file:t}=e;return(t.file?.size??0)>1048576*(z.size??1/0)?(C.error(G("Component.UploadFile.index_7",[t.name,z.size])),!1):(I.value.multiple||(J.value=[]),!0)},q=i([{key:"name",title:G("Component.UploadFile.index_3"),ellipsis:!0},{key:"size",title:G("Component.UploadFile.index_4"),width:100,render:e=>y(e.file?.size)},{key:"status",title:G("Component.UploadFile.index_5"),width:140,render:e=>{if("pending"===e.status)return G("Component.UploadFile.index_8");if("finished"===e.status)return s("span",{class:"text-primary"},[G("Component.UploadFile.index_9")]);if("error"===e.status)return s("span",{class:"text-error"},[o("Upload Failed")]);const t=e.percentage?e.percentage.toFixed(1):0;return s(M,{type:"line",color:H.value.primaryColor,"indicator-placement":"outside",processing:!0,percentage:Number(t)},null)}},k({width:70,options:(e,t)=>[{label:G("Public.Btn.Del"),type:"error",show:"uploading"!==e.status,onClick:()=>J.value.splice(t,1)},{label:G("Public.Btn.Cancel"),type:"warning",show:"uploading"===e.status,onClick:()=>(e=>{const t=e.id||e.name,a=O.value.get(t);a&&(a.abort(),O.value.delete(t),e.status="error",e.percentage=0,C.info(`Upload Canceled: ${e.name}`))})(e)}]})]),K=async(e,t,a,l)=>{const n=10485760,i=Math.ceil(e.size/n);let s=0;for(let o=0;o<i;o++){if(l.signal.aborted)throw new Error("Upload Canceled");const i=s,r=Math.min(e.size,i+n),p=e.slice(i,r),d=r-i,c=new FormData;c.append("f_path",N),c.append("f_name",t),c.append("f_size",e.size.toString()),c.append("f_start",i.toString()),c.append("blob",p),c.append("node_id",W);try{const t=await F(c,t=>{if(l.signal.aborted)return;const n=(s+(t.progress||0)*d)/e.size*100;a(Math.min(n,99))});let i=r;if(t&&"number"==typeof t.message&&(i=t.message),s=Math.max(s,i),a(Math.min(s/e.size*100,99)),s>=e.size)break;o=Math.floor(s/n)-1}catch{let e=!1;for(let t=0;t<3;t++){if(l.signal.aborted)throw new Error("Upload Canceled");try{await new Promise(e=>setTimeout(e,1e3));const t=await F(c);if(t&&"number"==typeof t.message){s=t.message,e=!0;break}}catch{e=!1}}if(!e)throw new Error(`Chunk ${o+1} upload failed`)}}return a(100),!0};return t({onConfirm:async()=>{const e=J.value.filter(e=>"pending"===e.status);if(!e.length)return C.error(G("Component.UploadFile.index_10")),!1;const t=e=>{const t=e.fullPath||e.name;return(z.path.endsWith("/")?z.path:z.path+"/")+t},a=e.map(e=>t(e)).join("\n"),{message:l}=await j({files:a,node_id:W});let n=e;if(Array.isArray(l)){const a=l.filter(e=>e.exists);if(a.length>0){const l=await new Promise(l=>{U({title:G("file.uploadModal.conflictTitle"),width:600,footer:!0,confirmText:G("file.uploadModal.conflictOverwrite"),cancelText:G("file.uploadModal.conflictSkip"),onConfirm:()=>l("overwrite"),onPublicClose:()=>l("skip"),onClose:()=>l("cancel"),content:()=>{const l=a.map(a=>{const l=e.find(e=>t(e)===a.filename);return{...a,localSize:l?.file?.size||0}});return s("div",{class:"p-20px"},[s("div",{class:"flex items-center gap-10px mb-16px"},[s(w,{name:"base-warning",size:"30",class:"text-warning"},null),s("div",{class:"flex-1 w-0 text-14px"},[G("file.uploadModal.conflictMessage")])]),s($,{"max-height":300,data:l,columns:[{title:G("file.uploadModal.conflictFileName"),key:"filename",render:e=>s(P,null,{default:()=>[s("span",null,[e.filename.split("/").pop()])]})},{title:G("file.uploadModal.conflictFileDifference"),key:"difference",width:220,render:e=>s("div",{class:"flex items-center"},[s("span",{class:"color-primary"},[y(e.localSize)]),s("i",{class:"i-material-symbols:arrow-right-alt-rounded mx-5px text-18px"},null),s("span",{class:"color-gray"},[y(e.size)])])}]},null)])}})});if("cancel"===l)return!1;if("skip"===l){const l=new Set(a.map(e=>e.filename));n=e.filter(e=>!l.has(t(e))),e.forEach(e=>{l.has(t(e))&&(e.status="finished",e.percentage=100)})}}}if(!n.length)return C.info(G("All files are skipped")),!0;L("setConfirm",{disabled:!0}),n.forEach(e=>e.status="uploading");let i=!0,o=!1;for(const s of n){const e=s.file;if(!e)continue;const t=new AbortController,a=s.id||s.name;O.value.set(a,t);try{if(e.size>52428800){if(!(await K(e,s.name,e=>s.percentage=e,t))||t.signal.aborted){s.status="error",o=!0;continue}}else{const a=new FormData;a.append("f_path",N),a.append("f_name",s.name),a.append("f_start","0"),a.append("f_size",e.size.toString()),a.append("blob",e),a.append("node_id",W),await F(a,e=>{t.signal.aborted||(s.percentage=100*(e.progress||0))})}if(t.signal.aborted){s.status="error",o=!0;continue}s.status="finished"}catch{s.status="error",C.error(`${s.name} upload failed}`),i=!1}finally{O.value.delete(a)}}i&&!o&&z.showSuccessMsg&&e.filter(e=>"finished"===e.status).length&&C.success(G("Component.UploadFile.index_9")),L("setConfirm",{disabled:!1});const r=e.filter(e=>"finished"===e.status);return r.length&&await(z.uploadSuccess?.(r)),i&&!o}}),(e,t)=>{const a=S,l=v,n=b;return p(),r("div",D,[d("div",E,[s(l,{ref:"upload",class:"w-auto","file-list":f(J),"onUpdate:fileList":t[0]||(t[0]=e=>m(J)?J.value=e:null),accept:f(I).accept,multiple:f(I).multiple,"default-upload":!1,"show-file-list":!1,onBeforeUpload:V},{default:c(()=>[s(a,{type:"primary"},{default:c(()=>[o(u(e.$t("Component.UploadFile.index_6")),1)]),_:1})]),_:1},8,["file-list","accept","multiple"])]),s(l,{ref:"upload",class:"w-auto","file-list":f(J),"onUpdate:fileList":t[2]||(t[2]=e=>m(J)?J.value=e:null),accept:f(I).accept,multiple:f(I).multiple,"default-upload":!1,"show-file-list":!1,onBeforeUpload:V},{default:c(()=>[s(n,null,{default:c(()=>[f(J).length>0?(p(),g(f($),{key:0,"max-height":300,bordered:!1,data:f(J),columns:f(q),onClick:t[1]||(t[1]=h(()=>{},["stop"]))},null,8,["data","columns"])):(p(),r("div",B,[s(w,{name:"base-upload",size:"48",class:"text-#999"}),d("div",A,u(e.$t("Component.UploadFile.index_1")),1),f(I).accept?(p(),r("div",T,u(e.$t("Component.UploadFile.index_2",[f(R)])),1)):_("",!0)]))]),_:1})]),_:1},8,["file-list","accept","multiple"])])}}});e("default",z(L,[["__scopeId","data-v-1b421c9e"]]))}}});
