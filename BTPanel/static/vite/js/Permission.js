import{_ as e}from"./index.js?v=1762424784323";import{f as a,a as s,h as i}from"./public.js?v=1762424784323";import{a8 as l,t,S as o,_ as n,w as u,p as r}from"./page_layout.js?v=1762424784323";import{g as p}from"./index39.js?v=1762424784323";import{aC as c,eg as d,_ as m,au as f,dV as v}from"./naive.js?v=1762424784323";import{k as g,P as h,i as _,r as M,R as y,V as w,W as k,a3 as x,U as b,S as $,an as j,H as P,a4 as S,j as U,ak as C,F as B,n as N}from"./vue.js?v=1762424784323";import"./common.js?v=1762424784323";import"./__commonjsHelpers__.js?v=1762424784323";import"./soft2.js?v=1762424784323";import"./soft.js?v=1762424784323";import"./site.js?v=1762424784323";import"./file2.js?v=1762424784323";import"./index.vue_vue_type_script_setup_true_lang7.js?v=1762424784323";const O={class:"permission-wrapper"},q={class:"tit"},L={key:0,class:"content"},V={class:"backup-notice"},A={class:"options"},F={class:"option-item"},R={class:"option-item group"},T={class:"option-item public"},D={class:"other-settings"},W={class:"setting-item"},z={class:"setting-item"},H={class:"setting-item"},G={key:1,class:"content"},I={class:"backup-notice"},J={class:"confirm-backup-wrapper"},K={class:"mb-10px"},E={class:"flex justify-start items-center gap-10px"},Q=r(g({__name:"Permission",setup(r,{expose:g}){const{t:Q}=h(),X=_("fileStore"),{choosedKeys:Y,fileList:Z,currentPath:ee}=X,ae=M(!1),se=M(!1),ie=M(""),le=M([]),te=M(!1),oe=M("SetPermission"),ne=M("777"),ue=M("root"),re=M(1),pe=M([]),ce=M(["4","2","1"]),de=M(["4","2","1"]),me=M(["4","2","1"]),fe=M([{label:"root",value:"root"},{label:"mysql",value:"mysql"},{label:"www",value:"www"}]),ve=M(!1),ge=M([{key:"name",title:Q("file.permissionModal.name"),ellipsis:{tooltip:!0}},{key:"permission",title:Q("file.permissionModal.permission")},{key:"owner",title:Q("file.permissionModal.owner")},{key:"time",title:Q("file.permissionModal.backupTime"),width:90,render:e=>l(e.time,"yyyy-MM-dd")},a({width:120,options:e=>[{label:Q("file.permissionModal.restore"),onClick:()=>{!async function(e){s({title:Q("file.permissionModal.confirmRestore"),content:Q("file.permissionModal.restoreWarning"),onConfirm:async()=>{await t.post("/files?action=restore_path_permissions",{path:pe.value[0].path,restore_sub_dir:re.value,date:e},{requestOptions:{loading:Q("file.permissionModal.loading.restoring"),successMessage:!0}}),ae.value=!1}})}(e.time)}},{label:Q("Public.Btn.Delete"),onClick:()=>{!async function(e){s({title:Q("file.permissionModal.confirmDelete"),content:Q("file.permissionModal.deleteWarning"),onConfirm:async()=>{await t.post("/files?action=del_path_premissions",{id:e},{requestOptions:{loading:Q("file.permissionModal.loading.deleting"),successMessage:!0}}),be()}})}(e.id)}}]})]);function he(e){oe.value=e,"BackupList"==e&&be()}function _e(){N(()=>{const e=ce.value.map(Number).reduce((e,a)=>Number(e)+a,0),a=de.value.map(Number).reduce((e,a)=>Number(e)+a,0),s=me.value.map(Number).reduce((e,a)=>Number(e)+a,0);ne.value=String(e)+String(a)+String(s)})}function Me(e){let[a,s,i]=e.split("");ce.value=ye(a),de.value=ye(s),me.value=ye(i)}function ye(e){switch(e){case"7":return["4","2","1"];case"6":return["4","2"];case"5":return["4","1"];case"4":return["4"];case"3":return["2","1"];case"2":return["2"];case"1":return["1"];default:return[]}}async function we(){1==pe.value.length?await t.post("/files?action=SetFileAccess",{user:ue.value,access:ne.value,all:re.value?"True":"False",filename:pe.value[0].path},{requestOptions:{loading:Q("file.permissionModal.loading.modifyingPermission"),successMessage:!0}}):pe.value.length>1&&await t.post("/files?action=SetBatchData",{user:ue.value,access:ne.value,all:re.value,path:ee.value,data:JSON.stringify(pe.value.map(e=>e.nm)),type:3}),p(X)}function ke(){ie.value="",se.value=!0}async function xe(){let e=ee.value;1==pe.value.length&&(e=pe.value[0].path),await t.post("/files?action=back_path_permissions",{back_sub_dir:re.value,path:e,remark:ie.value},{requestOptions:{loading:Q("file.permissionModal.loading.backing"),successMessage:!0}}),ie.value=""}async function be(){ve.value=!0;try{const{message:e}=await t.post("/files?action=get_path_premissions",{path:pe.value[0].path},{requestOptions:{isOriginalResult:!0}});u(e)&&(le.value=e.map(e=>({id:Number(e[5]),name:e[4],permission:e[2],owner:e[1],time:e[3]})))}finally{ve.value=!1}}async function $e(){s({title:Q("file.permissionModal.fixPermissionTitle"),content:Q("file.permissionModal.fixPermissionNote"),onConfirm:async()=>{await t.post("/files?action=fix_permissions",{path:pe.value[0].path},{requestOptions:{loading:Q("file.permissionModal.loading.fixingPermission"),successMessage:!0}}),ae.value=!1}})}return g({open(){ae.value=!0,pe.value=Z.value.filter(e=>Y.value.includes(e.nm)),async function(){te.value=!0;try{const e=await t.post("/files?action=GetFileAccess",{filename:pe.value[0].path},{requestOptions:{isOriginalResult:!0}});ne.value=String(e.message.chmod),ue.value=e.message.chown,Me(ne.value)}finally{te.value=!1}}()},close(){ae.value=!1}}),(a,s)=>{const l=n,t=c,u=m,r=d,p=f,g=v,h=i,_=o,M=e;return w(),y(B,null,[k(M,{show:b(ae),"onUpdate:show":s[9]||(s[9]=e=>C(ae)?ae.value=e:null),title:a.$t("file.permissionModal.title")+" [".concat(1===b(pe).length?b(pe)[0].path:"Batch","]"),width:520,footer:!0,"confirm-text":a.$t("Public.Btn.Apply"),onConfirm:we},{default:x(()=>[k(_,{show:b(te)},{default:x(()=>[$("div",O,[$("div",q,[$("div",{class:P(["tit-item",{active:"SetPermission"==b(oe)}]),onClick:s[0]||(s[0]=e=>he("SetPermission"))},S(a.$t("file.permissionModal.setPermission")),3),$("div",{class:P(["tit-item",{active:"BackupList"==b(oe)}]),onClick:s[1]||(s[1]=e=>he("BackupList"))},S(a.$t("file.permissionModal.backupsList")),3)]),"SetPermission"==b(oe)?(w(),y("div",L,[$("div",V,[k(l,{name:"base-notice-yellow",size:"20"}),$("span",null,S(a.$t("file.permissionModal.noBackup")),1),k(t,{type:"primary",onClick:ke},{default:x(()=>[U(S(a.$t("file.permissionModal.backup")),1)]),_:1}),k(t,{onClick:s[2]||(s[2]=e=>he("BackupList"))},{default:x(()=>[U(S(a.$t("file.permissionModal.restore")),1)]),_:1})]),$("div",A,[$("div",F,[k(r,{class:"flex flex-col gap-10px",value:b(ce),"onUpdate:value":s[3]||(s[3]=e=>C(ce)?ce.value=e:null),onUpdateValue:_e},{default:x(()=>[k(u,{value:"4"},{default:x(()=>[U(S(a.$t("file.permissionModal.read")),1)]),_:1}),k(u,{value:"2"},{default:x(()=>[U(S(a.$t("file.permissionModal.write")),1)]),_:1}),k(u,{value:"1"},{default:x(()=>[U(S(a.$t("file.permissionModal.execute")),1)]),_:1})]),_:1},8,["value"])]),$("div",R,[k(r,{class:"flex flex-col gap-10px",value:b(de),"onUpdate:value":s[4]||(s[4]=e=>C(de)?de.value=e:null),onUpdateValue:_e},{default:x(()=>[k(u,{value:"4"},{default:x(()=>[U(S(a.$t("file.permissionModal.read")),1)]),_:1}),k(u,{value:"2"},{default:x(()=>[U(S(a.$t("file.permissionModal.write")),1)]),_:1}),k(u,{value:"1"},{default:x(()=>[U(S(a.$t("file.permissionModal.execute")),1)]),_:1})]),_:1},8,["value"])]),$("div",T,[k(r,{class:"flex flex-col gap-10px",value:b(me),"onUpdate:value":s[5]||(s[5]=e=>C(me)?me.value=e:null),onUpdateValue:_e},{default:x(()=>[k(u,{value:"4"},{default:x(()=>[U(S(a.$t("file.permissionModal.read")),1)]),_:1}),k(u,{value:"2"},{default:x(()=>[U(S(a.$t("file.permissionModal.write")),1)]),_:1}),k(u,{value:"1"},{default:x(()=>[U(S(a.$t("file.permissionModal.execute")),1)]),_:1})]),_:1},8,["value"])])]),$("div",D,[$("div",W,[k(p,{class:"flex-1",style:{width:"50px"},value:b(ne),"onUpdate:value":s[6]||(s[6]=e=>C(ne)?ne.value=e:null),onUpdateValue:Me},null,8,["value"]),$("span",null,S(a.$t("file.permissionModal.permission"))+",",1)]),$("div",z,[$("span",null,S(a.$t("file.permissionModal.owner")),1),k(g,{class:"flex-1",style:{width:"50px"},options:b(fe),value:b(ue),"onUpdate:value":s[7]||(s[7]=e=>C(ue)?ue.value=e:null)},null,8,["options","value"])]),$("div",H,[k(u,{checked:b(re),"onUpdate:checked":s[8]||(s[8]=e=>C(re)?re.value=e:null),"checked-value":1,"unchecked-value":0},{default:x(()=>[U(S(a.$t("file.permissionModal.applyToSubdir")),1)]),_:1},8,["checked"])])])])):"BackupList"==b(oe)?(w(),y("div",G,[$("div",I,[k(l,{name:"base-notice-yellow",size:"20"}),$("span",null,S(a.$t("file.permissionModal.fixAllPermissions")),1),k(t,{type:"primary",onClick:$e},{default:x(()=>[U(S(a.$t("file.permissionModal.fixPermissions")),1)]),_:1})]),k(h,{loading:b(ve),"max-height":160,data:b(le),columns:b(ge)},null,8,["loading","data","columns"])])):j("",!0)])]),_:1},8,["show"])]),_:1},8,["show","title","confirm-text"]),k(M,{show:b(se),"onUpdate:show":s[11]||(s[11]=e=>C(se)?se.value=e:null),title:a.$t("file.permissionModal.confirmBackup"),width:320,footer:!0,onConfirm:xe},{default:x(()=>[$("div",J,[$("div",K,S(a.$t("file.permissionModal.enterBackupName")),1),$("div",E,[$("span",null,S(a.$t("file.permissionModal.remarks")),1),k(p,{value:b(ie),"onUpdate:value":s[10]||(s[10]=e=>C(ie)?ie.value=e:null),class:"flex-1"},null,8,["value"])])])]),_:1},8,["show","title"])],64)}}}),[["__scopeId","data-v-49186f19"]]);export{Q as default};
