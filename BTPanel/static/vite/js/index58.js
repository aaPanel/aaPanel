const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/form4.js?v=1763625242172","js/public.js?v=1763625242172","js/page_layout.js?v=1763625242172","js/vue.js?v=1763625242172","js/__commonjsHelpers__.js?v=1763625242172","js/naive.js?v=1763625242172","js/common.js?v=1763625242172","css/page_layout.css?v=1763625242172","css/public.css?v=1763625242172","js/index.vue_vue_type_script_setup_true_lang.js?v=1763625242172","js/index99.js?v=1763625242172","css/index14.css?v=1763625242172","js/export.js?v=1763625242172","js/process.js?v=1763625242172","js/log.js?v=1763625242172","js/form5.js?v=1763625242172","js/export2.js?v=1763625242172","js/form6.js?v=1763625242172","js/form7.js?v=1763625242172"])))=>i.map(i=>d[i]);
import{_ as e}from"./index132.js?v=1763625242172";import{_ as t}from"./index107.js?v=1763625242172";import{m as a,cG as i,bh as l,cH as r,cI as n,a as o,cJ as s,c as d,y as c,cK as u,u as w,cL as p,cM as y,cN as _,cO as f,cP as m,cQ as h,cR as S,bk as x,cS as F,cT as g,cU as P,x as k,cV as v,cW as b,cX as A,cY as C,cZ as U,c_ as I,r as L,c$ as R,h as T,q as $,o as E}from"./page_layout.js?v=1763625242172";import{e as j,c as z,f as D,a as q,h as O,_ as B,b as K,p as V}from"./public.js?v=1763625242172";import{_ as M}from"./index.js?v=1763625242172";import{_ as N}from"./index.vue_vue_type_script_setup_true_lang5.js?v=1763625242172";import{_ as W}from"./index.vue_vue_type_script_setup_true_lang7.js?v=1763625242172";import{_ as H}from"./index.vue_vue_type_script_setup_true_lang12.js?v=1763625242172";import{_ as Q}from"./index.vue_vue_type_script_setup_true_lang8.js?v=1763625242172";import{u as X}from"./file.js?v=1763625242172";import{aC as Z,dZ as G,dT as J,dS as Y,dj as ee,d9 as te,dQ as ae}from"./naive.js?v=1763625242172";import{k as ie,P as le,r as re,R as ne,a2 as oe,a3 as se,X as de,q as ce,V as ue,aj as we,e as pe,j as ye,F as _e,N as fe,o as me,S as he,a4 as Se,_ as xe,U as Fe,a0 as ge,am as Pe,aK as ke,l as ve,O as be,a7 as Ae,an as Ce}from"./vue.js?v=1763625242172";import"./common.js?v=1763625242172";import"./__commonjsHelpers__.js?v=1763625242172";import"./index.vue_vue_type_script_setup_true_lang6.js?v=1763625242172";const Ue="/www/server/panel/data/firewall",Ie=ie({__name:"import",emits:["finish"],setup(e,{emit:t}){const r=t,{t:n}=le(),o=re([]),s=async({file:e})=>{const{close:t}=a.loading(n("Security.Firewall.Api.index_1"));try{const t=new FormData;t.append("f_path",Ue),t.append("f_name",e.name),t.append("f_start","0"),e.file&&(t.append("blob",e.file),t.append("f_size",e.file.size.toString())),await X(t);const a="".concat(Ue,"/").concat(e.name);await i({rule:"port",file:a}),r("finish",a)}finally{o.value=[],t()}};return(e,t)=>{const a=Z,i=l;return ne(),oe(i,{ref:"upload",class:"w-auto",action:"","file-list":ue(o),"onUpdate:fileList":t[0]||(t[0]=e=>we(o)?o.value=e:null),accept:".json",multiple:!1,"show-file-list":!1,"custom-request":s},{default:se((()=>[de(a,null,{default:se((()=>[ce(e.$slots,"default")])),_:3})])),_:3},8,["file-list"])}}}),Le=ie({__name:"index",emits:["refresh"],setup(e,{expose:t,emit:a}){const i=xe((()=>o((()=>import("./form4.js?v=1763625242172")),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11])))),l=xe((()=>o((()=>import("./export.js?v=1763625242172")),__vite__mapDeps([12,9,3,4,5,6,2,1,8,7])))),u=xe((()=>o((()=>import("./process.js?v=1763625242172")),__vite__mapDeps([13,2,3,4,5,6,1,8,7])))),w=a,{t:p}=le(),y=()=>{R(),w("refresh")},_=j(p("Security.Firewall.Port.index_1"),{isEdit:!1,onRefresh:()=>{y()}}),f=()=>{_.data.row=void 0,_.data.isEdit=!1,_.title=p("Security.Firewall.Port.index_1"),_.show=!0},m=j(p("Security.Firewall.Port.index_3")),h=()=>{m.data.chain=x.chain,m.show=!0},S=e=>"".concat(e.Port,"-").concat(e.Family,"-").concat(e.Protocol),x=pe({chain:"ALL",query:"",p:1,row:20}),F=new Map([["3306",p("Security.Firewall.Port.index_9")],["888",p("Security.Firewall.Port.index_10")],["22",p("Security.Firewall.Port.index_11")],["20",p("Security.Firewall.Port.index_12")],["21",p("Security.Firewall.Port.index_13")],["39000-40000",p("Security.Firewall.Port.index_14")],["30000-40000",p("Security.Firewall.Port.index_14")],["11211",p("Security.Firewall.Port.index_15")],["873",p("Security.Firewall.Port.index_16")],["80",p("Security.Firewall.Port.index_17")]]),{keys:g,table:P,columns:k,setLoading:v}=z([{type:"selection",width:40},{key:"Protocol",title:p("Security.Firewall.Port.index_18")},{key:"Port",title:p("Security.Firewall.Port.index_19"),render:e=>e.Port+("ipv6"===e.Family?" (ipv6)":"")},{key:"status",title:()=>de(_e,null,[de("span",{class:"mr-4px"},[p("Security.Firewall.Port.index_36")]),de("a",{class:"bt-ico-ask",href:"https://www.aapanel.com/forum/d/1088-description-of-firewall-status",target:"_blank"},[ye("?")])]),render:e=>{var t,a;return de(_e,null,[de("span",null,[0===e.status?p("Security.Firewall.Port.index_22"):1!==e.status||(null==(t=e.Port)?void 0:t.includes("-"))?p("Security.Firewall.Port.index_20"):p("Security.Firewall.Port.index_37")]),2!==e.status||(null==(a=e.Port)?void 0:a.includes("-"))||"udp"===e.Protocol?"":de("a",{class:"bt-link",onClick:()=>{A(e)}},[p("Security.Firewall.Port.index_38")])])}},{key:"Strategy",title:p("Security.Firewall.Port.index_21"),render:e=>de("a",{class:["bt-link","accept"==e.Strategy?"":"error"],onClick:()=>{C(e)}},["accept"==e.Strategy?p("Security.Firewall.Port.index_39"):p("Security.Firewall.Port.index_40")])},{key:"Chain",title:p("Security.Firewall.Port.index_23"),render:e=>"INPUT"===e.Chain?p("Security.Firewall.Port.index_5"):p("Security.Firewall.Port.index_6")},{key:"Address",title:p("Security.Firewall.Port.index_24"),render:e=>e.sid>0?e.domain:"all"===e.Address?p("Security.Firewall.Port.index_25"):e.Address},{key:"brief",title:p("Security.Firewall.Port.index_26"),minWidth:150,width:"8%",ellipsis:{tooltip:!0},render:e=>e.brief||F.get(e.Port)||"--"},{key:"addtime",title:p("Security.Firewall.Port.index_27"),width:"8%",minWidth:140},D({width:140,options:e=>[{label:p("Public.Btn.Edit"),onClick:()=>{(e=>{_.data.row=e,_.data.isEdit=!0,_.title=p("Security.Firewall.Port.index_8"),_.show=!0})(e)}},{label:p("Public.Btn.Del"),onClick:()=>{U(e)}}]})]),b=j(""),A=e=>{b.data.row=e,b.title=p("Security.Firewall.Port.index_28",[e.Port]),b.show=!0},C=e=>{q({title:p("Security.Firewall.Port.index_29",[e.Port]),content:"accept"===e.Strategy?p("Security.Firewall.Port.index_41"):p("Security.Firewall.Port.index_30"),onConfirm:async()=>{await r({new_data:{protocol:e.Protocol,address:e.Address,port:e.Port,strategy:"accept"===e.Strategy?"drop":"accept",chain:e.Chain,brief:e.brief},old_data:fe(e)}),P.data.filter((t=>t.Port===e.Port)).forEach((e=>{e.Strategy="accept"===e.Strategy?"drop":"accept"}))}})},U=e=>{q({title:p("Security.Firewall.Port.index_31",[e.Port]),content:p("Security.Firewall.Port.index_32"),onConfirm:async()=>{await n({protocol:e.Protocol,address:e.Address,port:e.Port,strategy:e.Strategy,chain:e.Chain,brief:e.brief,domain:e.domain}),y()}})},I=[{key:"delete",type:"confirm",label:p("Security.Firewall.Port.index_33"),confirm:{title:p("Security.Firewall.Port.index_34"),desc:p("Security.Firewall.Port.index_35"),api:e=>n({protocol:e.Protocol,address:e.Address,port:e.Port,strategy:e.Strategy,chain:e.Chain,brief:e.brief,domain:e.domain},!1),done:()=>{y()},columns:[{key:"Port",title:p("Security.Firewall.Port.index_19"),render:e=>e.Port+("ipv6"===e.Family?" (ipv6)":"")}]}}],L=()=>{x.p=1,R()},R=async()=>{try{v(!0);const{message:e}=await s(fe(x));d(e)&&(P.data=e.data,P.total=c(e.page))}finally{g.value=[],v(!1)}};return me((()=>{R()})),t({init:R}),(e,t)=>{const a=Z,r=G,n=J,o=Q,s=O,d=H,c=W,w=N,p=M;return ne(),he("div",null,[de(w,null,{toolsLeft:se((()=>[de(a,{type:"primary",onClick:f},{default:se((()=>[ye(Se(e.$t("Security.Firewall.Port.index_1")),1)])),_:1}),de(Ie,{onFinish:y},{default:se((()=>[ye(Se(e.$t("Security.Firewall.Port.index_2")),1)])),_:1}),de(a,{onClick:h},{default:se((()=>[ye(Se(e.$t("Security.Firewall.Port.index_3")),1)])),_:1})])),toolsRight:se((()=>[de(n,{value:ue(x).chain,"onUpdate:value":[t[0]||(t[0]=e=>ue(x).chain=e),L]},{default:se((()=>[de(r,{value:"ALL"},{default:se((()=>[ye(Se(e.$t("Security.Firewall.Port.index_4")),1)])),_:1}),de(r,{value:"INPUT"},{default:se((()=>[ye(Se(e.$t("Security.Firewall.Port.index_5")),1)])),_:1}),de(r,{value:"OUTPUT"},{default:se((()=>[ye(Se(e.$t("Security.Firewall.Port.index_6")),1)])),_:1})])),_:1},8,["value"]),de(o,{value:ue(x).query,"onUpdate:value":t[1]||(t[1]=e=>ue(x).query=e),width:"240",placeholder:e.$t("Security.Firewall.Port.index_7"),onSearch:L},null,8,["value","placeholder"])])),table:se((()=>[de(s,{"checked-row-keys":ue(g),"onUpdate:checkedRowKeys":t[2]||(t[2]=e=>we(g)?g.value=e:null),"row-key":S,loading:ue(P).loading,data:ue(P).data,columns:ue(k)},null,8,["checked-row-keys","loading","data","columns"])])),pageLeft:se((()=>[de(d,{"checked-row-keys":ue(g),"onUpdate:checkedRowKeys":t[3]||(t[3]=e=>we(g)?g.value=e:null),"row-key":S,data:ue(P).data,options:I},null,8,["checked-row-keys","data"])])),pageRight:se((()=>[de(c,{page:ue(x).p,"onUpdate:page":t[4]||(t[4]=e=>ue(x).p=e),"page-size":ue(x).row,"onUpdate:pageSize":t[5]||(t[5]=e=>ue(x).row=e),"item-count":ue(P).total,"store-key":"firewall-port",onRefresh:R},null,8,["page","page-size","item-count"])])),_:1}),de(p,{show:ue(_).show,"onUpdate:show":t[6]||(t[6]=e=>ue(_).show=e),title:ue(_).title,data:ue(_).data,width:460,"min-height":396,footer:!0,component:ue(i)},null,8,["show","title","data","component"]),de(p,{show:ue(m).show,"onUpdate:show":t[7]||(t[7]=e=>ue(m).show=e),title:ue(m).title,data:ue(m).data,width:420,"min-height":72,footer:!0,component:ue(l)},null,8,["show","title","data","component"]),de(p,{show:ue(b).show,"onUpdate:show":t[8]||(t[8]=e=>ue(b).show=e),title:ue(b).title,data:ue(b).data,width:420,"min-height":162,component:ue(u)},null,8,["show","title","data","component"])])}}}),Re={class:"p-16px"},Te={class:"flex justify-center"},$e=ie({__name:"index",setup(e){const t=xe((()=>o((()=>import("./log.js?v=1763625242172")),__vite__mapDeps([14,2,3,4,5,6,1,8,7])))),a=j("Migrating firewall data",{path:""}),i=()=>{q({title:"Migrating firewall data",content:"Firewall data is about to be migrated, firewalld/ufw will be reloaded, and iptables rules may be cleared. Please confirm that iptables rules are persisted before proceeding). Do you want to continue?",onConfirm:async()=>{const{message:e}=await u();d(e)&&e.task_id&&(a.data.path="/www/server/panel/tmp/"+e.task_id+".log",a.show=!0)}})};return(e,l)=>{const r=B,n=Z,o=M;return ne(),he("div",Re,[l[3]||(l[3]=Fe("div",{class:"text-#e6a23c font-bold text-center text-4xl!"},"Detected the need to migrate the old firewall to the new service",-1)),de(r,{class:"mt-4 mb-8"},{default:se((()=>l[1]||(l[1]=[Fe("li",null," Only the firewall function of the panel will be migrated, and the existing rules of the system firewall (firewall/ufw) will not be affected. ",-1),Fe("li",null," If you have used the iptables command line to add non-persistent rules, they will be lost! Please pay attention to persist or save iptables rules ",-1)]))),_:1,__:[1]}),Fe("div",Te,[de(n,{type:"primary",onClick:i},{default:se((()=>l[2]||(l[2]=[ye(" Migrate now ")]))),_:1,__:[2]})]),de(o,{show:ue(a).show,"onUpdate:show":l[0]||(l[0]=e=>ue(a).show=e),title:ue(a).title,data:ue(a).data,width:550,"min-height":300,component:ue(t),hideClose:!0},null,8,["show","title","data","component"])])}}}),Ee="/www/server/panel/data/firewall",je=ie({__name:"import",emits:["finish"],setup(e,{emit:t}){const r=t,{t:n}=le(),o=re([]),s=async({file:e})=>{const{close:t}=a.loading(n("Security.Firewall.Api.index_1"));try{const t=new FormData;t.append("f_path",Ee),t.append("f_name",e.name),t.append("f_start","0"),e.file&&(t.append("blob",e.file),t.append("f_size",e.file.size.toString())),await X(t);const a="".concat(Ee,"/").concat(e.name);await i({rule:"ip",file:a}),r("finish",a)}finally{o.value=[],t()}};return(e,t)=>{const a=Z,i=l;return ne(),oe(i,{ref:"upload",class:"w-auto",action:"","file-list":ue(o),"onUpdate:fileList":t[0]||(t[0]=e=>we(o)?o.value=e:null),accept:".json",multiple:!1,"show-file-list":!1,"custom-request":s},{default:se((()=>[de(a,null,{default:se((()=>[ce(e.$slots,"default")])),_:3})])),_:3},8,["file-list"])}}}),ze=ie({__name:"index",emits:["refresh"],setup(t,{expose:a,emit:i}){const l=xe((()=>o((()=>import("./form5.js?v=1763625242172")),__vite__mapDeps([15,1,2,3,4,5,6,7,8,9,10,11])))),r=xe((()=>o((()=>import("./export2.js?v=1763625242172")),__vite__mapDeps([16,9,3,4,5,6,2,1,8,7])))),n=i,{t:s}=le(),u=w(),m=p(),{firewallStatus:h}=ge(m),S=j(s("Security.Firewall.IP.index_1"),{isEdit:!1,onRefresh:()=>{k()}}),x=()=>{S.data.row=void 0,S.data.isEdit=!1,S.title=s("Security.Firewall.IP.index_1"),S.show=!0},F=j(s("Security.Firewall.IP.index_2")),g=()=>{F.data.chain=v.chain,F.show=!0},P=e=>"".concat(e.Address,"-").concat(e.Chain),k=()=>{$(),n("refresh")},v=pe({chain:"ALL",query:"",p:1,row:20}),{keys:b,table:A,columns:C,setLoading:U}=z([{type:"selection",width:40,disabled:e=>"2"===e.stype},{key:"Address",title:s("Security.Firewall.IP.index_9")},{key:"area",title:s("Security.Firewall.IP.index_10"),render:e=>{if(u.isFree)return de("a",{class:"bt-link",onClick:()=>{K({source:116})}},[s("Security.Firewall.IP.index_24")]);const{area:t}=e;return t.info||"--"}},{key:"Strategy",title:s("Security.Firewall.IP.index_11"),render:e=>de("a",{class:["bt-link","accept"==e.Strategy?"":"error"],onClick:()=>{I(e)}},["accept"==e.Strategy?s("Security.Firewall.IP.index_23"):s("Security.Firewall.IP.index_12")])},{key:"Chain",title:s("Security.Firewall.IP.index_13"),render:e=>"INPUT"===e.Chain?s("Security.Firewall.IP.index_5"):s("Security.Firewall.IP.index_6")},{key:"brief",title:s("Security.Firewall.IP.index_14"),render:e=>e.brief||"--"},{key:"addtime",title:s("Security.Firewall.IP.index_15"),render:e=>e.addtime||"--"},D({width:100,options:e=>[{label:s("Public.Btn.Edit"),disabled:"2"===e.stype,onClick:()=>{(e=>{S.data.row=e,S.data.isEdit=!0,S.title=s("Security.Firewall.IP.index_8"),S.show=!0})(e)}},{label:s("Public.Btn.Del"),disabled:"2"===e.stype,onClick:()=>{L(e)}}]})]);C.value.splice(2,1);const I=e=>{q({title:s("Security.Firewall.IP.index_16",[e.Address]),content:"accept"===e.Strategy?s("Security.Firewall.IP.index_25"):s("Security.Firewall.IP.index_17"),onConfirm:async()=>{await y({new_data:{address:e.Address,strategy:"accept"===e.Strategy?"drop":"accept",chain:e.Chain,brief:e.brief,family:e.Family},old_data:fe(e)}),e.Strategy="accept"===e.Strategy?"drop":"accept"}})},L=e=>{q({title:s("Security.Firewall.IP.index_18",[e.Address]),content:s("Security.Firewall.IP.index_19"),onConfirm:async()=>{await _({address:e.Address,strategy:e.Strategy,chain:e.Chain,brief:e.brief,family:e.Family}),k()}})},R=[{key:"delete",type:"confirm",label:s("Security.Firewall.IP.index_20"),confirm:{title:s("Security.Firewall.IP.index_21"),desc:s("Security.Firewall.IP.index_22"),api:e=>_({address:e.Address,strategy:e.Strategy,chain:e.Chain,brief:e.brief,family:e.Family},!1),done:()=>{k()},columns:[{key:"Address",title:s("Security.Firewall.IP.index_9")}]}}],T=()=>{v.p=1,$()},$=async()=>{try{U(!0);const{message:e}=await f(fe(v));d(e)&&(A.data=e.data,A.total=c(e.page))}finally{b.value=[],U(!1)}};return me((()=>{h.value.initStatus&&$()})),a({init:$}),(t,a)=>{const i=Z,n=G,o=J,s=Q,d=O,c=H,u=W,w=N,p=M,y=e;return ne(),oe(y,{install:ue(h).initStatus},{desc:se((()=>[de($e)])),default:se((()=>[de(w,null,{toolsLeft:se((()=>[de(i,{type:"primary",onClick:x},{default:se((()=>[ye(Se(t.$t("Security.Firewall.IP.index_1")),1)])),_:1}),de(je,{onFinish:k},{default:se((()=>[ye(Se(t.$t("Security.Firewall.IP.index_2")),1)])),_:1}),de(i,{onClick:g},{default:se((()=>[ye(Se(t.$t("Security.Firewall.IP.index_3")),1)])),_:1})])),toolsRight:se((()=>[de(o,{value:ue(v).chain,"onUpdate:value":[a[0]||(a[0]=e=>ue(v).chain=e),T]},{default:se((()=>[de(n,{value:"ALL"},{default:se((()=>[ye(Se(t.$t("Security.Firewall.IP.index_4")),1)])),_:1}),de(n,{value:"INPUT"},{default:se((()=>[ye(Se(t.$t("Security.Firewall.IP.index_5")),1)])),_:1}),de(n,{value:"OUTPUT"},{default:se((()=>[ye(Se(t.$t("Security.Firewall.IP.index_6")),1)])),_:1})])),_:1},8,["value"]),de(s,{value:ue(v).query,"onUpdate:value":a[1]||(a[1]=e=>ue(v).query=e),width:"240",placeholder:t.$t("Security.Firewall.IP.index_7"),onSearch:T},null,8,["value","placeholder"])])),table:se((()=>[de(d,{"checked-row-keys":ue(b),"onUpdate:checkedRowKeys":a[2]||(a[2]=e=>we(b)?b.value=e:null),"row-key":P,loading:ue(A).loading,data:ue(A).data,columns:ue(C)},null,8,["checked-row-keys","loading","data","columns"])])),pageLeft:se((()=>[de(c,{"checked-row-keys":ue(b),"onUpdate:checkedRowKeys":a[3]||(a[3]=e=>we(b)?b.value=e:null),"row-key":P,data:ue(A).data,options:R},null,8,["checked-row-keys","data"])])),pageRight:se((()=>[de(u,{page:ue(v).p,"onUpdate:page":a[4]||(a[4]=e=>ue(v).p=e),"page-size":ue(v).row,"onUpdate:pageSize":a[5]||(a[5]=e=>ue(v).row=e),"item-count":ue(A).total,"store-key":"firewall-ip",onRefresh:$},null,8,["page","page-size","item-count"])])),_:1}),de(p,{show:ue(S).show,"onUpdate:show":a[6]||(a[6]=e=>ue(S).show=e),title:ue(S).title,data:ue(S).data,width:420,"min-height":384,footer:!0,component:ue(l)},null,8,["show","title","data","component"]),de(p,{show:ue(F).show,"onUpdate:show":a[7]||(a[7]=e=>ue(F).show=e),title:ue(F).title,data:ue(F).data,width:420,"min-height":72,footer:!0,component:ue(r)},null,8,["show","title","data","component"])])),_:1},8,["install"])}}}),De="/www/server/panel/data/firewall",qe=ie({__name:"import",emits:["finish"],setup(e,{emit:t}){const r=t,{t:n}=le(),o=re([]),s=async({file:e})=>{const{close:t}=a.loading(n("Security.Firewall.Api.index_1"));try{const t=new FormData;t.append("f_path",De),t.append("f_name",e.name),t.append("f_start","0"),e.file&&(t.append("blob",e.file),t.append("f_size",e.file.size.toString())),await X(t);const a="".concat(De,"/").concat(e.name);await i({rule:"forward",file:a}),r("finish",a)}finally{o.value=[],t()}};return(e,t)=>{const a=Z,i=l;return ne(),oe(i,{ref:"upload",class:"w-auto",action:"","file-list":ue(o),"onUpdate:fileList":t[0]||(t[0]=e=>we(o)?o.value=e:null),accept:".json",multiple:!1,"show-file-list":!1,"custom-request":s},{default:se((()=>[de(a,null,{default:se((()=>[ce(e.$slots,"default")])),_:3})])),_:3},8,["file-list"])}}}),Oe=ie({__name:"index",emits:["refresh"],setup(t,{expose:i,emit:l}){const r=xe((()=>o((()=>import("./form6.js?v=1763625242172")),__vite__mapDeps([17,1,2,3,4,5,6,7,8,9])))),n=p(),{firewallStatus:s}=ge(n),u=l,{t:w}=le(),y=j(w("Security.Firewall.Forward.index_1"),{isEdit:!1,onRefresh:()=>{g()}}),_=()=>{y.data.row=void 0,y.data.isEdit=!1,y.title=w("Security.Firewall.Forward.index_1"),y.show=!0},f=async()=>{if(0===k.data.length)return void a.error(w("Security.Firewall.index_21"));const{message:e}=await S({rule:"forward"});d(e)&&x(e.result)},F=e=>"".concat(e.id),g=()=>{L(),u("refresh")},{keys:P,table:k,columns:v,setLoading:b}=z([{type:"selection",width:40},{key:"Protocol",title:w("Security.Firewall.Forward.index_6"),render:e=>e.Protocol.toUpperCase()},{key:"S_Port",title:w("Security.Firewall.Forward.index_7")},{key:"T_Address",title:w("Security.Firewall.Forward.index_8"),render:e=>e.T_Address?e.T_Address:"127.0.0.1"},{key:"T_Port",title:w("Security.Firewall.Forward.index_9")},{key:"brief",title:w("Security.Firewall.Forward.index_10"),render:e=>e.brief||"--"},{key:"addtime",title:w("Security.Firewall.Forward.index_11"),render:e=>e.addtime||"--"},D({width:100,options:e=>[{label:w("Public.Btn.Edit"),onClick:()=>{(e=>{y.data.row=e,y.data.isEdit=!0,y.title=w("Security.Firewall.Forward.index_5"),y.show=!0})(e)}},{label:w("Public.Btn.Del"),onClick:()=>{A(e)}}]})]),A=e=>{q({width:540,title:w("Security.Firewall.Forward.index_12",[e.S_Port,e.T_Port]),content:w("Security.Firewall.Forward.index_13"),onConfirm:async()=>{await m({protocol:e.Protocol.toLowerCase(),S_Address:e.S_Address,S_Port:e.S_Port,T_Address:e.T_Address,T_Port:e.T_Port}),g()}})},C=[{key:"delete",type:"confirm",label:w("Security.Firewall.Forward.index_14"),confirm:{title:w("Security.Firewall.Forward.index_15"),desc:w("Security.Firewall.Forward.index_16"),api:e=>m({protocol:e.Protocol.toLowerCase(),S_Address:e.S_Address,S_Port:e.S_Port,T_Address:e.T_Address,T_Port:e.T_Port},!1),done:()=>{g()},columns:[{key:"T_Address",title:w("Security.Firewall.Forward.index_8"),render:e=>e.T_Address?e.T_Address:"127.0.0.1"}]}}],U=pe({query:"",p:1,row:20}),I=()=>{U.p=1,L()},L=async()=>{try{b(!0);const{message:e}=await h(fe(U));d(e)&&(k.data=e.data,k.total=c(e.page))}finally{P.value=[],b(!1)}};return me((()=>{s.value.initStatus&&L()})),i({init:L}),(t,a)=>{const i=Z,l=Q,n=O,o=H,d=W,c=N,u=M,w=e;return ne(),oe(w,{install:ue(s).initStatus},{desc:se((()=>[de($e)])),default:se((()=>[de(c,null,{toolsLeft:se((()=>[de(i,{type:"primary",onClick:_},{default:se((()=>[ye(Se(t.$t("Security.Firewall.Forward.index_1")),1)])),_:1}),de(qe,{onFinish:g},{default:se((()=>[ye(Se(t.$t("Security.Firewall.Forward.index_2")),1)])),_:1}),de(i,{onClick:f},{default:se((()=>[ye(Se(t.$t("Security.Firewall.Forward.index_3")),1)])),_:1})])),toolsRight:se((()=>[de(l,{value:ue(U).query,"onUpdate:value":a[0]||(a[0]=e=>ue(U).query=e),width:"240",placeholder:t.$t("Security.Firewall.Forward.index_4"),onSearch:I},null,8,["value","placeholder"])])),table:se((()=>[de(n,{"checked-row-keys":ue(P),"onUpdate:checkedRowKeys":a[1]||(a[1]=e=>we(P)?P.value=e:null),"row-key":F,loading:ue(k).loading,data:ue(k).data,columns:ue(v)},null,8,["checked-row-keys","loading","data","columns"])])),pageLeft:se((()=>[de(o,{"checked-row-keys":ue(P),"onUpdate:checkedRowKeys":a[2]||(a[2]=e=>we(P)?P.value=e:null),"row-key":F,data:ue(k).data,options:C},null,8,["checked-row-keys","data"])])),pageRight:se((()=>[de(d,{page:ue(U).p,"onUpdate:page":a[3]||(a[3]=e=>ue(U).p=e),"page-size":ue(U).row,"onUpdate:pageSize":a[4]||(a[4]=e=>ue(U).row=e),"item-count":ue(k).total,"store-key":"firewall-forward",onRefresh:L},null,8,["page","page-size","item-count"])])),_:1}),de(u,{show:ue(y).show,"onUpdate:show":a[5]||(a[5]=e=>ue(y).show=e),title:ue(y).title,data:ue(y).data,width:420,"min-height":344,footer:!0,component:ue(r)},null,8,["show","title","data","component"])])),_:1},8,["install"])}}}),Be="/www/server/panel/data/firewall",Ke=ie({__name:"import",emits:["finish"],setup(e,{emit:t}){const i=t,{t:r}=le(),n=re([]),o=async({file:e})=>{const{close:t}=a.loading(r("Security.Firewall.Api.index_1"));try{const t=new FormData;t.append("f_path",Be),t.append("f_name",e.name),t.append("f_start","0"),e.file&&(t.append("blob",e.file),t.append("f_size",e.file.size.toString())),await X(t);const a="".concat(Be,"/").concat(e.name);await F({file_name:e.name}),i("finish",a)}finally{n.value=[],t()}};return(e,t)=>{const a=Z,i=l;return ne(),oe(i,{ref:"upload",class:"w-auto",action:"","file-list":ue(n),"onUpdate:fileList":t[0]||(t[0]=e=>we(n)?n.value=e:null),accept:".json",multiple:!1,"show-file-list":!1,"custom-request":o},{default:se((()=>[de(a,null,{default:se((()=>[ce(e.$slots,"default")])),_:3})])),_:3},8,["file-list"])}}}),Ve=ie({__name:"index",emits:["refresh"],setup(t,{expose:i,emit:l}){const r=xe((()=>o((()=>import("./form7.js?v=1763625242172")),__vite__mapDeps([18,9,3,4,5,6,2,1,8,7])))),n=p(),{firewallStatus:s}=ge(n),u=l,{t:w}=le(),y=j(w("Security.Firewall.Area.index_1"),{isEdit:!1,onRefresh:()=>{h()}}),_=()=>{y.data.row=void 0,y.data.isEdit=!1,y.title=w("Security.Firewall.Area.index_1"),y.show=!0},f=async()=>{if(0===F.data.length)return void a.error(w("Security.Firewall.index_21"));const{message:e}=await v();d(e)&&x(e.result)},m=e=>"".concat(e.id),h=()=>{R(),u("refresh")},{keys:S,table:F,columns:b,setLoading:A}=z([{type:"selection",width:40},{key:"country",title:w("Security.Firewall.Area.index_6"),render:e=>"".concat(e.country," (").concat(e.brief,")")},{key:"Strategy",title:w("Security.Firewall.Area.index_7"),render:e=>de("a",{class:["bt-link","accept"==e.types?"":"error"]},[(e.types,w("Security.Firewall.Area.index_8"))])},{key:"ports",title:w("Security.Firewall.Area.index_9"),render:e=>e.ports||w("Security.Firewall.Area.index_10")},{key:"addtime",title:w("Security.Firewall.Area.index_11"),render:e=>e.addtime||"--"},D({width:100,options:e=>[{label:w("Public.Btn.Edit"),onClick:()=>{(e=>{y.data.row=e,y.data.isEdit=!0,y.title=w("Security.Firewall.Area.index_5"),y.show=!0})(e)}},{label:w("Public.Btn.Del"),onClick:()=>{C(e)}}]})]),C=e=>{q({title:w("Security.Firewall.Area.index_12",[e.country]),content:w("Security.Firewall.Area.index_13"),onConfirm:async()=>{await g({id:e.id,types:e.types,country:e.country,brief:e.brief,addtime:e.addtime,ports:e.ports}),h()}})},U=[{key:"delete",type:"confirm",label:w("Security.Firewall.Area.index_14"),confirm:{title:w("Security.Firewall.Area.index_15"),desc:w("Security.Firewall.Area.index_16"),api:e=>g({id:e.id,types:e.types,country:e.country,brief:e.brief,addtime:e.addtime,ports:e.ports},!1),done:()=>{h()},columns:[{key:"country",title:w("Security.Firewall.Area.index_6"),render:e=>"".concat(e.country," (").concat(e.brief,")")}]}}],I=pe({p:1,limit:20,query:""}),L=()=>{I.p=1,R()},R=async()=>{try{A(!0);const{message:e}=await P(fe(I));d(e)?(F.data=k(e.data)?e.data:[],F.total=c(e.page)):(F.data=[],F.total=0)}finally{S.value=[],A(!1)}};return me((()=>{s.value.initStatus&&R()})),i({init:R}),(t,a)=>{const i=Z,l=Q,n=O,o=H,d=W,c=N,u=M,w=e;return ne(),oe(w,{install:ue(s).initStatus},{desc:se((()=>[de($e)])),default:se((()=>[de(c,null,{toolsLeft:se((()=>[de(i,{type:"primary",onClick:_},{default:se((()=>[ye(Se(t.$t("Security.Firewall.Area.index_1")),1)])),_:1}),de(Ke,{onFinish:h},{default:se((()=>[ye(Se(t.$t("Security.Firewall.Area.index_2")),1)])),_:1}),de(i,{onClick:f},{default:se((()=>[ye(Se(t.$t("Security.Firewall.Area.index_3")),1)])),_:1})])),toolsRight:se((()=>[de(l,{value:ue(I).query,"onUpdate:value":a[0]||(a[0]=e=>ue(I).query=e),width:"240",placeholder:t.$t("Security.Firewall.Area.index_4"),onSearch:L},null,8,["value","placeholder"])])),table:se((()=>[de(n,{"checked-row-keys":ue(S),"onUpdate:checkedRowKeys":a[1]||(a[1]=e=>we(S)?S.value=e:null),"row-key":m,loading:ue(F).loading,data:ue(F).data,columns:ue(b)},null,8,["checked-row-keys","loading","data","columns"])])),pageLeft:se((()=>[de(o,{"checked-row-keys":ue(S),"onUpdate:checkedRowKeys":a[2]||(a[2]=e=>we(S)?S.value=e:null),"row-key":m,data:ue(F).data,options:U},null,8,["checked-row-keys","data"])])),pageRight:se((()=>[de(d,{page:ue(I).p,"onUpdate:page":a[3]||(a[3]=e=>ue(I).p=e),"page-size":ue(I).limit,"onUpdate:pageSize":a[4]||(a[4]=e=>ue(I).limit=e),"item-count":ue(F).total,"store-key":"firewall-area",onRefresh:R},null,8,["page","page-size","item-count"])])),_:1}),de(u,{show:ue(y).show,"onUpdate:show":a[5]||(a[5]=e=>ue(y).show=e),title:ue(y).title,data:ue(y).data,width:460,"min-height":188,footer:!0,component:ue(r)},null,8,["show","title","data","component"])])),_:1},8,["install"])}}}),Me={class:"mr-10px"},Ne={class:"mx-20px"},We={class:"mr-10px"},He={class:"mx-20px"},Qe={class:"mx-16px"},Xe={class:"font-bold"},Ze=ie({__name:"index",setup(i){const l=p(),{firewallStatus:r}=ge(l),{t:n}=le(),o=re("port"),s=re([{key:"port",label:n("Security.Firewall.index_7",[0])},{key:"ip",label:n("Security.Firewall.index_8",[0])},{key:"forward",label:n("Security.Firewall.index_9",[0])},{key:"area",label:n("Security.Firewall.index_10",[0])}]),c=new Map([["port",Le],["ip",ze],["forward",Oe],["area",Ve]]),u={},w=pe({loading:!1,ping:!1,size:"0 B",log_path:"/www/wwwlogs"}),y=async()=>{try{w.loading=!0;const{message:e}=await b();d(e)&&(w.ping=!e.ping,s.value[0].label=n("Security.Firewall.index_7",[e.port]),s.value[1].label=n("Security.Firewall.index_8",[e.ip]),s.value[2].label=n("Security.Firewall.index_9",[e.trans]),s.value[3].label=n("Security.Firewall.index_10",[e.country]))}finally{w.loading=!1}},_=e=>{q({title:n(e?"Security.Firewall.index_18":"Security.Firewall.index_11"),content:n(e?"Security.Firewall.index_19":"Security.Firewall.index_12"),onConfirm:async()=>{await C({status:e?1:0}),r.value.status=e}})},f=e=>{q({title:n(e?"Security.Firewall.index_13":"Security.Firewall.index_22"),content:n(e?"Security.Firewall.index_20":"Security.Firewall.index_14"),onConfirm:async()=>{await U({status:e?0:1}),w.ping=e}})},m=()=>{q({title:n("Site.Proxy.index_27"),content:"After clearing the cache, the system will reload. Do you want to continue?",onConfirm:async()=>{await I(),setTimeout((()=>{window.location.reload()}),1e3)}})},h=Pe(),S=()=>{L("Path",w.log_path),h.push("/files")},x=()=>{V({title:n("Security.Firewall.index_15"),content:n("Security.Firewall.index_16"),onConfirm:async()=>{const{message:e}=await R();a.success(n("Security.Firewall.index_17")),w.size=d(e)&&T(e.result)?e.result:"0 B"}})};return l.getStatus(),(async()=>{const{message:e}=await A();d(e)&&(w.size=e.size,w.log_path=e.log_path)})(),y(),(a,i)=>{const l=ee,n=$,d=E,p=Z,h=te,F=Y,g=ae,P=t,k=e,v=ke("load-text");return ne(),he(_e,null,[de(F,{class:"mb-16px"},{default:se((()=>[de(h,{class:"items-center p-16px",size:0},{default:se((()=>[Fe("div",Me,Se(a.$t("Security.Firewall.index_1")),1),de(l,{value:ue(r).status,loading:ue(w).loading,"onUpdate:value":_},null,8,["value","loading"]),Fe("div",Ne,[de(n,{class:"mx-0! text-20px",vertical:""})]),Fe("div",We,Se(a.$t("Security.Firewall.index_2")),1),de(l,{value:ue(w).ping,loading:ue(w).loading,"onUpdate:value":f},null,8,["value","loading"]),Fe("div",He,[de(n,{class:"mx-0! text-20px",vertical:""})]),Fe("div",null,[Fe("span",null,Se(a.$t("Security.Firewall.index_3")),1),de(d,{disabled:ue(w).loading,onClick:S},{default:se((()=>[ve((ne(),he("span",null,[ye(Se(ue(w).log_path),1)])),[[v,ue(w).loading]])])),_:1},8,["disabled"])]),Fe("div",Qe,[ve((ne(),he("span",null,[ye(Se(ue(w).size),1)])),[[v,ue(w).loading]])]),de(p,{size:"small",onClick:x},{default:se((()=>[ye(Se(a.$t("Security.Firewall.index_4")),1)])),_:1}),de(p,{size:"small",class:"ml-10px",onClick:m},{default:se((()=>[ye(Se(a.$t("Site.Proxy.index_27")),1)])),_:1})])),_:1})])),_:1}),de(k,{install:ue(r).status},{desc:se((()=>[Fe("div",Xe,[ye(Se(a.$t("Security.Firewall.index_5")),1),de(d,{class:"font-bold!",onClick:i[0]||(i[0]=e=>_(!0))},{default:se((()=>[ye(Se(a.$t("Security.Firewall.index_6")),1)])),_:1})])])),default:se((()=>[de(F,{class:"p-16px"},{default:se((()=>[de(P,{value:ue(o),"onUpdate:value":i[1]||(i[1]=e=>we(o)?o.value=e:null)},{default:se((()=>[(ne(!0),he(_e,null,be(ue(s),(e=>(ne(),oe(g,{key:e.key,name:e.key,tab:e.label,"tab-props":{onClick:t=>{var a,i,l;a=e.key,u[a]&&(null==(l=(i=u[a]).init)||l.call(i))}}},{default:se((()=>[ue(c).get(ue(o))?(ne(),oe(Ae(ue(c).get(ue(o))),{key:0,ref_for:!0,ref:t=>((e,t)=>{u[t]=e})(t,e.key),onRefresh:y},null,544)):Ce("",!0)])),_:2},1032,["name","tab","tab-props"])))),128))])),_:1},8,["value"])])),_:1})])),_:1},8,["install"])],64)}}});export{Ze as default};
