const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/file-upload.js?v=1769066082311","js/vue.js?v=1769066082311","js/__commonjsHelpers__.js?v=1769066082311","js/page_layout.js?v=1769066082311","js/naive.js?v=1769066082311","js/common.js?v=1769066082311","js/public.js?v=1769066082311","css/public.css?v=1769066082311","css/page_layout.css?v=1769066082311","js/index.vue_vue_type_script_setup_true_lang7.js?v=1769066082311","js/index.vue_vue_type_script_setup_true_lang8.js?v=1769066082311","js/CalcSize.vue_vue_type_script_setup_true_lang.js?v=1769066082311","js/soft2.js?v=1769066082311","js/soft.js?v=1769066082311","js/site.js?v=1769066082311","css/CalcSize.css?v=1769066082311","js/index.vue_vue_type_script_setup_true_lang.js?v=1769066082311","js/file2.js?v=1769066082311","css/file-upload.css?v=1769066082311"])))=>i.map(i=>d[i]);
import{_ as e}from"./index.vue_vue_type_script_setup_true_lang7.js?v=1769066082311";import{C as t,u as a,a as l,c as s,f as n,h as r}from"./public.js?v=1769066082311";import{_ as i}from"./index.vue_vue_type_script_setup_true_lang8.js?v=1769066082311";import{aE as o,i as u,x as d,n as p,m as c,a as f,y as m,_,p as h}from"./page_layout.js?v=1769066082311";import{R as v,F as g,_ as y}from"./CalcSize.vue_vue_type_script_setup_true_lang.js?v=1769066082311";import{Z as x,r as b,k as w,P as k,e as C,R as P,V as z,W as S,a3 as j,S as R,U as N,x as I,n as O,o as F,G as U,a2 as L,an as T,a4 as $,H as M,F as D,O as q,j as A,a5 as E,_ as W,u as J,a0 as V,c as B,w as H,ak as K,av as G,l as Z,v as Q,aj as X}from"./vue.js?v=1769066082311";import{_ as Y}from"./index.vue_vue_type_script_setup_true_lang.js?v=1769066082311";import{dS as ee,au as te,dT as ae,db as le,bJ as se,dd as ne,dU as re,dV as ie,dh as oe,aC as ue,av as de,dj as pe,dW as ce}from"./naive.js?v=1769066082311";import{i as fe}from"./file2.js?v=1769066082311";const{t:me}=u.global;const _e=e=>o.post("/mod/node/file_transfer/upload_check",e,{requestOptions:{loading:me("Component.Pay.index_12"),successMessage:!1}}),he=(e,t)=>o.post("/mod/node/file_transfer/file_upload",e,{headers:{"Content-Type":"multipart/form-data"},requestOptions:{isOriginalResult:!0},onUploadProgress:e=>{null==t||t(e)}}),ve=x("file-transfer",()=>{const e=b("/www/server"),t=b("/www/server"),a=b(null),l=b(null),s=b([]),n=b(!1),r=b(!1);return{leftPath:e,rightPath:t,leftNodeId:a,rightNodeId:l,nodesList:s,leftRefreshTrigger:n,rightRefreshTrigger:r,getNode:async()=>{const{message:e}=await(t={node_type:"api"},o.post("/mod/node/node/get_all_node",t));var t;if(d(e)){s.value=e.map(e=>({label:e.remarks,value:e.id}));s.value.some(e=>e.value===a.value)||(a.value=s.value.length?s.value[0].value:null);s.value.some(e=>e.value===l.value)||(s.value.length>1?l.value=s.value[1].value:l.value=null)}},refreshLeft:()=>{n.value=!n.value},refreshRight:()=>{r.value=!r.value}}},{persist:!0}),{t:ge}=u.global,ye=[{title:ge("File name"),key:"nm"}],xe=e=>({pending:ge("Pending"),running:ge("Transferring"),complete:ge("Completed"),error:ge("Failed")}[e]||e),be=e=>"complete"===e?"text-primary":"error"===e?"text-error":"running"===e?"text-warning":"text-desc",we={class:"p-20px"},ke={class:"w-280px"},Ce=w({__name:"file-create",props:{data:{}},setup(e,{expose:t}){const{t:a}=k(),l=e,{path:s,node_id:n,getList:r}=l.data,i=b(null),u=C({name:""}),d={name:{required:!0,message:a("Security.Conf.Index_28"),trigger:["blur","input"]}};return t({onConfirm:async({hide:e})=>{var t;await(null==(t=i.value)?void 0:t.validate());const a={path:s+"/"+u.name,node_id:n};await(e=>o.post("/mod/node/file_transfer/create_dir",e,{requestOptions:{loading:me("Component.Pay.index_12"),successMessage:!0}}))(a),null==r||r(),e()}}),(e,t)=>{const a=te,l=ee,s=Y;return z(),P("div",we,[S(s,{ref_key:"formRef",ref:i,model:N(u),rules:d},{default:j(()=>[S(l,{label:e.$t("Site.TableRow.index_2"),path:"name"},{default:j(()=>[R("div",ke,[S(a,{type:"text",value:N(u).name,"onUpdate:value":t[0]||(t[0]=e=>N(u).name=e),placeholder:e.$t("Enter folder name")},null,8,["value","placeholder"])])]),_:1},8,["label"])]),_:1},8,["model"])])}}}),Pe={class:"font-bold"},ze={class:"h-200px overflow-y-auto"},Se={key:0,class:"text-desc"},je=w({__name:"transfer-progress",props:{getList:{type:Function}},setup(e){const a=C({progress:0,count_size:0,complete_size:0,file_count:0,file_complete:0,msg:"",status:"pending"}),l=I([]),s=b([]),{send:n,close:r}=t("/ws_modsoc",{immediate:!0,onMessage:(t,n)=>{var r;const i=JSON.parse(n.data);if(i.task){const e=i.task;a.progress=parseFloat((null==(r=e.progress)?void 0:r.toFixed(2))||0),a.count_size=e.count_size||0,a.complete_size=e.complete_size||0,a.file_count=e.file_count||0,a.file_complete=e.file_complete||0,a.status=e.status,i.msg&&(a.msg=i.msg),(i.file_list&&Array.isArray(i.file_list)||i.file_status_list&&Array.isArray(i.file_status_list))&&(s.value=[],l.value=(i.file_list||[]).concat(i.file_status_list||[]),O(()=>{const e=l.value.findIndex(e=>"running"===e.status||e.progress>0&&e.progress<100||"pending"===e.status);if(-1!==e&&s.value[e]){s.value[e].scrollIntoView({behavior:"smooth",block:"nearest"})}}))}"end"===i.type&&(a.msg=i.msg,e.getList())}});return F(()=>{n({mod_name:"node",sub_mod_name:"file_transfer",def_name:"transfer_status",callback:"xxxxxxo",data:{}})}),U(()=>{r()}),(e,t)=>{const n=se,r=le,i=ae,o=ne;return z(),L(r,{class:"p-16px flex-col!"},{default:j(()=>[S(i,{class:"p-16px"},{default:j(()=>[N(a).progress?(z(),L(r,{key:0,class:"flex-col!"},{default:j(()=>[R("span",Pe,$(e.$t("Overall Progress")),1),S(n,{type:"line",status:"success",percentage:N(a).progress,height:12,"border-radius":6,processing:N(a).progress>100,"indicator-placement":"inside"},null,8,["percentage","processing"]),S(r,{justify:"space-between"},{default:j(()=>[R("span",null,$(e.$t("Completed"))+": "+$(N(p)(N(a).complete_size))+" / "+$(N(p)(N(a).count_size)),1),R("span",null,$(e.$t("Files"))+": "+$(N(a).file_complete)+" / "+$(N(a).file_count),1)]),_:1})]),_:1})):T("",!0),N(a).msg?(z(),P("div",{key:1,class:M({"mt-10px":N(a).progress})},$(N(a).msg),3)):T("",!0)]),_:1}),S(i,{class:"p-16px"},{default:j(()=>[R("div",ze,[(z(!0),P(D,null,q(N(l),(e,t)=>(z(),L(r,{key:t,ref_for:!0,ref:e=>((e,t)=>{e&&(s.value[t]=e.$el||e)})(e,t),class:"pb-8px flex-col!"},{default:j(()=>[S(r,{justify:"space-between",class:"mb-1 text-13px"},{default:j(()=>[S(o,{style:{"max-width":"300px"}},{default:j(()=>{return[A($((t=e.src_file||e.source_path,t.split("/").pop()||t)),1)];var t}),_:2},1024),R("span",{class:M(N(be)(e.status))},$(N(xe)(e.status)),3)]),_:2},1024),S(n,{type:"line",percentage:e.progress,height:4,"show-indicator":!1,status:"error"===e.status?"error":"success"},null,8,["percentage","status"]),e.log?(z(),P("div",Se,$(e.log),1)):T("",!0)]),_:2},1024))),128))])]),_:1})]),_:1})}}});function Re(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!J(e)}const{t:Ne}=u.global,Ie=e=>{const t=ve();a({title:Ne("File transfer result"),width:600,data:{getList:()=>{e&&"left"!==e||t.refreshLeft(),e&&"right"!==e||t.refreshRight()}},component:je})},Oe=(e,t,l)=>{a({title:Ne("Create folder"),footer:!0,data:{path:e,node_id:t,getList:l},component:Ce})},Fe=(e,t,a)=>{"/"!==e?Te({path:e,node_id:t,onUploadSuccess:e=>{a()}}):c.error(Ne("Root directory cannot upload files"))},Ue=e=>({title:Ne("file.fileName"),key:"name",width:"60%",minWidth:164,render:t=>S("div",{class:"flex cursor-pointer",onClick:()=>e(t)},[S("div",{class:"flex-1 w-0 flex items-center gap-4px"},[S("div",{class:"flex-1 w-0 flex items-center min-w-0"},[S("div",{class:"flex items-center"},[S(g,{ext:t.ext},null)]),S("div",{class:"flex-1 min-w-0 ml-4px"},[S(ne,{tooltip:!0},{default:()=>[S("span",{class:"hover:text-primary cursor-pointer"},[t.lnk?t.nm+t.lnk:t.nm])]})])]),S("div",{class:"flex items-center gap-4px"},[t.isShare?S(E("bt-icon"),{name:"file-share",size:"16"},null):null,t.isFavorite?S(E("bt-icon"),{name:"file-favorite",size:"16"},null):null])])])}),Le=(e,t)=>{var a,s;const n=ve(),{nodesList:r,leftNodeId:i,rightNodeId:u,leftPath:d,rightPath:p}=n,f="left"===t?i:u,m="left"===t?u:i,_="left"===t?p:d,h=null==(a=r.find(e=>e.value===f))?void 0:a.label,v=null==(s=r.find(e=>e.value===m))?void 0:s.label;if("/"===_)return void c.error(Ne("Target node is root directory, cannot transfer files"));const g=b("ignore");l({title:Ne("File transfer"),content:()=>{let t,a;return S(le,{class:"flex-col!"},{default:()=>[S("span",null,[Ne("Whether to transfer the following files or folders from node [{0}] to node [{1}] in [{2}]?",[h,v,_])]),S("span",null,[Ne("When encountering duplicate files, please select the processing method")]),S(re,{value:g.value,"onUpdate:value":e=>g.value=e},{default:()=>[S(ie,{value:"ignore"},Re(t=Ne("Skip"))?t:{default:()=>[t]}),S(ie,{value:"cover"},Re(a=Ne("Cover"))?a:{default:()=>[a]})]}),S(oe,{maxHeight:200,columns:ye,data:e},null)]})},width:600,onConfirm:async()=>{const a={source_node_id:f,target_node_id:m,source_path_list:JSON.stringify(e.map(e=>({path:e.path,size:e.sz,is_dir:"dir"===e.type}))),target_path:_,default_mode:g.value};await(e=>o.post("/mod/node/file_transfer/create_filetransfer_task",e,{requestOptions:{loading:me("Component.Pay.index_12"),successMessage:!0}}))(a);Ie("left"===t?"right":"left")}})},Te=({path:e,node_id:t,confirmText:l,size:s,uploadData:n,onUploadSuccess:r})=>{a({title:Ne("Upload files to [{0}]",[e]),width:580,minHeight:436,footer:!0,confirmText:l||Ne("Public.Btn.Upload"),data:{path:e,node_id:t,size:s,uploadData:n,uploadSuccess:r},component:W(()=>f(()=>import("./file-upload.js?v=1769066082311"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18])))})},$e={class:"flex-1 my-10px"},Me=w({__name:"file-browser",props:{side:{}},setup(t,{expose:a}){const{t:u}=k(),d=t,f=ve(),{leftPath:_,rightPath:h,leftNodeId:g,rightNodeId:x}=V(f),b=B({get:()=>"left"===d.side?_.value:h.value,set:e=>{"left"===d.side?_.value=e:h.value=e}}),w=B(()=>"left"===d.side?g.value:x.value),P=B(()=>"left"===d.side?u("Send to right"):u("Send to left")),I=C({p:1,limit:100,search:""}),{keys:O,table:F,columns:U}=s([{type:"selection",width:40,disabled:e=>"dir"===e.type},Ue(e=>M(e)),{title:u("file.size"),key:"size",width:100,render:e=>"dir"===e.type?S(y,{path:e.path},null):S("span",null,[p(e.sz)])},n({title:u("Site.TableRow.index_30"),width:150,options:e=>[{label:P.value,show:"dir"!==e.type,onClick:()=>D([e])},{label:u("Public.Btn.Del"),onClick:()=>{l({title:u("Delete file"),content:u("Are you sure to delete {0} [{1}]?",["dir"===e.type?u("Folder"):u("File"),e.nm]),width:400,onConfirm:async()=>{var t;await(t={path:e.path,node_id:w.value,is_dir:"dir"===e.type?1:0},o.post("/mod/node/file_transfer/delete_file",t,{requestOptions:{loading:me("Component.Pay.index_12"),successMessage:!0}})),T()}})}}]})]),T=async()=>{if(w.value)try{F.loading=!0,F.data=await async function(e,t){try{const{message:a}=await o.post("/mod/node/file_transfer/file_list",e);t&&t(a);let l=v({type:"dir",list:a.dir,path:a.path}),s=v({type:"file",list:a.files,path:a.path});return l=l.map((e,t)=>({...e,protected:a.tamper_data.dirs&&a.tamper_data.dirs[t]?Number(a.tamper_data.dirs[t].split(";")[0]):0,protected_rule:a.tamper_data.dirs&&a.tamper_data.dirs[t]?Number(a.tamper_data.dirs[t].split(";")[1]):0})),s=s.map((e,t)=>({...e,protected:a.tamper_data.files&&a.tamper_data.files[t]?Number(a.tamper_data.files[t].split(";")[0]):0,protected_rule:a.tamper_data.files&&a.tamper_data.files[t]?Number(a.tamper_data.files[t].split(";")[1]):0})),[...l,...s]}catch(a){return console.warn(a),[]}}({p:I.p,showRow:I.limit,search:I.search,path:b.value,node_id:w.value},e=>{F.total=m(e.page),b.value=e.path})}finally{O.value=[],F.loading=!1}},M=e=>{"dir"===e.type&&(b.value=e.path)},D=e=>{w.value?Le(e,d.side):c.error(u("Please select target node"))},q=()=>{const e=F.data.filter(e=>O.value.includes(e.nm));D(e)},{leftRefreshTrigger:E,rightRefreshTrigger:W}=V(f),J=B(()=>"left"===d.side?E.value:W.value);return H([b,w,J],()=>{T()},{immediate:!0}),a({refresh:T}),(t,a)=>{const l=ue,s=le,n=i,o=r,u=e;return z(),L(s,{class:"flex-col! h-full"},{default:j(()=>[S(s,{justify:"space-between"},{default:j(()=>[S(s,null,{default:j(()=>[S(l,{type:"primary",onClick:a[0]||(a[0]=e=>N(Fe)(N(b),N(w),T))},{default:j(()=>[A($(t.$t("file.uploadFile")),1)]),_:1}),S(l,{onClick:a[1]||(a[1]=e=>N(Oe)(N(b),N(w),T))},{default:j(()=>[A($(t.$t("file.contextMenu.newFolder")),1)]),_:1})]),_:1}),S(n,{value:N(I).search,"onUpdate:value":a[2]||(a[2]=e=>N(I).search=e),placeholder:t.$t("Enter file name"),onSearch:T},null,8,["value","placeholder"])]),_:1}),R("div",$e,[S(o,{"checked-row-keys":N(O),"onUpdate:checkedRowKeys":a[3]||(a[3]=e=>K(O)?O.value=e:null),"row-key":"nm",loading:N(F).loading,data:N(F).data,columns:N(U),"flex-height":"",class:"h-full"},null,8,["checked-row-keys","loading","data","columns"])]),S(s,{class:"justify-between!"},{default:j(()=>[S(s,{class:"items-center"},{default:j(()=>[S(l,{disabled:!N(O).length,type:"primary",onClick:q},{default:j(()=>[A($(N(P)),1)]),_:1},8,["disabled"]),R("span",null,$(t.$t("Selected {0} files",N(O).length)),1)]),_:1}),S(u,{page:N(I).p,"onUpdate:page":a[4]||(a[4]=e=>N(I).p=e),"page-size":N(I).limit,"onUpdate:pageSize":a[5]||(a[5]=e=>N(I).limit=e),"item-count":N(F).total,"store-key":"node-files",onRefresh:T},null,8,["page","page-size","item-count"])]),_:1})]),_:1})}}}),De={class:"path-dir"},qe={class:"path-arrow reversal"},Ae={class:"path-dir"},Ee={class:"path-arrow"},We=["onClick"],Je={class:"path-dir"},Ve={class:"path-arrow"},Be=h(w({__name:"choose-path",props:{currentPath:{type:String,default:"/"}},emits:["pathChange"],setup(e,{expose:t,emit:a}){const l=e,s=a,{t:n}=k(),r=b(""),i=G("pathListRef"),o=b(0),u=B(()=>l.currentPath.split("/").filter(e=>""!==e).map((e,t)=>({name:e,originalIndex:t}))),d=B(()=>{if(!o.value||0===u.value.length)return u.value;let e=o.value-80;const t=[...u.value].reverse(),a=[];for(const l of t){const t=Math.min(8*l.name.length,150)+20+12;if(!(e>=t))break;a.unshift(l),e-=t}return a}),p=B(()=>d.value.length<u.value.length),c=B(()=>{const e=u.value.length-d.value.length;return u.value.slice(0,e)}),f=B(()=>{const e=c.value.map(e=>({key:e.originalIndex,label:e.name,icon:()=>S(_,{name:"file-dir",size:"16"},null)}));return e.unshift({key:"/",label:n("file.rootDirectory"),icon:()=>S(_,{name:"file-dir",size:"16"},null)}),e}),m=e=>{C(e)},h=b(!0),v=G("inputRef");let g=null;function y(){i.value&&(o.value=i.value.offsetWidth)}function x(e){h.value=e,h.value?(r.value="",O(()=>{y()})):r.value=l.currentPath}F(()=>{i.value&&(y(),g=new ResizeObserver(()=>{y()}),g.observe(i.value))}),U(()=>{g&&g.disconnect()});const w=()=>{x(!1),O(()=>{var e;null==(e=v.value)||e.focus()})};function C(e,t){const a=l.currentPath.split("/").filter(e=>""!==e);let n="";"number"==typeof e&&(a.splice(e+1),n="/"+a.join("/")),"/"==e&&(n="/"),s("pathChange",n),null==t||t.stopPropagation()}async function I(){var e;r.value==l.currentPath||""==r.value?(null==(e=v.value)||e.blur(),x(!0)):fe(r.value)?(s("pathChange",r.value),x(!0)):x(!1)}function T(){const e=l.currentPath.split("/").filter(e=>""!==e);if(0!=e.length){e.pop();let t="/"+e.join("/");s("pathChange",t)}}function M(){s("pathChange",l.currentPath)}return t({handleEnterDown:I}),(e,t)=>{const a=ue,l=pe,s=ne,n=te,o=de;return z(),L(o,null,{default:j(()=>[S(a,{onClick:T},{default:j(()=>[S(_,{name:"file-back",size:"16"})]),_:1}),N(h)?(z(),P("div",{key:0,ref_key:"pathListRef",ref:i,class:"path-list",onClick:w},[S(l,{trigger:"click",placement:"bottom-start",options:N(f),onSelect:m},{default:j(()=>[Z(R("div",{class:"path-item",onClick:t[0]||(t[0]=e=>e.stopPropagation())},[R("div",De,[S(_,{name:"file-dir",size:"16"})]),R("div",qe,[S(_,{name:"base-arrow-right"})])],512),[[Q,N(p)]])]),_:1},8,["options"]),Z(R("div",{class:"path-item",onClick:t[1]||(t[1]=e=>C("/",e))},[R("div",Ae,$(e.$t("file.rootDirectory")),1),R("div",Ee,[S(_,{name:"base-arrow-right"})])],512),[[Q,!N(p)]]),(z(!0),P(D,null,q(N(d),(e,t)=>(z(),P("div",{class:"path-item",key:"".concat(e,"_").concat(t),onClick:t=>C(e.originalIndex,t)},[R("div",Je,[S(s,{class:"max-w-150px!"},{default:j(()=>[A($(e.name),1)]),_:2},1024)]),R("div",Ve,[S(_,{name:"base-arrow-right"})])],8,We))),128))],512)):(z(),L(n,{key:1,ref_key:"inputRef",ref:v,value:N(r),"onUpdate:value":t[2]||(t[2]=e=>K(r)?r.value=e:null),class:"flex-1",placeholder:" ",onFocus:t[3]||(t[3]=e=>x(!1)),onBlur:t[4]||(t[4]=e=>x(!0)),onKeydown:X(I,["enter"])},null,8,["value"])),S(a,{onClick:M},{default:j(()=>[S(_,{name:"base-refresh",size:"16"})]),_:1})]),_:1})}}}),[["__scopeId","data-v-cfc90488"]]),He=w({__name:"node-select",props:{side:{}},setup(e){const t=e,a=ve(),{leftPath:l,rightPath:s,nodesList:n,leftNodeId:r,rightNodeId:i}=V(a),o=B({get:()=>"left"===t.side?r.value:i.value,set:e=>{"left"===t.side?r.value=e:i.value=e}}),u=B({get:()=>"left"===t.side?l.value:s.value,set:e=>{"left"===t.side?l.value=e:s.value=e}}),d=e=>{u.value=e,"left"===t.side?a.refreshLeft():a.refreshRight()},p=B(()=>n.value.map(e=>{const a="left"===t.side?i.value:r.value;return{...e,disabled:e.value===a}}));return(e,t)=>{const a=ce,l=le;return z(),L(l,{class:"mb-16px"},{default:j(()=>[S(a,{class:"w-160px","consistent-menu-width":!1,value:N(o),"onUpdate:value":t[0]||(t[0]=e=>K(o)?o.value=e:null),options:N(p),placeholder:e.$t("Select node")},null,8,["value","options","placeholder"]),S(Be,{class:"flex-1","current-path":N(u),onPathChange:d},null,8,["current-path"])]),_:1})}}}),Ke={class:"flex flex-col h-full p-20px"},Ge={class:"flex flex-col h-full p-20px"},Ze=h(w({__name:"index",setup:e=>(ve().getNode(),F(()=>{const{send:e,close:a}=t("/ws_modsoc",{immediate:!0,onMessage:(e,t)=>{try{"end"!==JSON.parse(t.data).type&&Ie(),a()}catch(l){a()}}});e({mod_name:"node",sub_mod_name:"file_transfer",def_name:"transfer_status",callback:"check_status",data:{}})}),(e,t)=>{const a=ae,l=le;return z(),L(l,{class:"flex-nowrap! box-view"},{default:j(()=>[S(a,null,{default:j(()=>[R("div",Ke,[S(He,{side:"left"}),S(Me,{side:"left"})])]),_:1}),S(a,null,{default:j(()=>[R("div",Ge,[S(He,{side:"right"}),S(Me,{side:"right"})])]),_:1})]),_:1})})}),[["__scopeId","data-v-97efdba0"]]),Qe=Object.freeze(Object.defineProperty({__proto__:null,default:Ze},Symbol.toStringTag,{value:"Module"}));export{he as a,Qe as i,_e as u};
