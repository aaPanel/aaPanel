const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/details2.js?v=1756367574781","js/public.js?v=1756367574781","js/page_layout.js?v=1756367574781","js/vue.js?v=1756367574781","js/__commonjsHelpers__.js?v=1756367574781","js/naive.js?v=1756367574781","js/common.js?v=1756367574781","css/page_layout.css?v=1756367574781","css/public.css?v=1756367574781","js/tools2.js?v=1756367574781","js/rules.js?v=1756367574781","js/index.vue_vue_type_script_setup_true_lang15.js?v=1756367574781","js/index.vue_vue_type_script_setup_true_lang5.js?v=1756367574781","js/index.vue_vue_type_script_setup_true_lang6.js?v=1756367574781","css/index15.css?v=1756367574781","js/index.vue_vue_type_script_setup_true_lang7.js?v=1756367574781","js/index.vue_vue_type_script_setup_true_lang.js?v=1756367574781","js/index99.js?v=1756367574781","css/index14.css?v=1756367574781","js/details3.js?v=1756367574781","js/http.js?v=1756367574781","js/index178.js?v=1756367574781","css/index27.css?v=1756367574781"])))=>i.map(i=>d[i]);
import{t as e,i as a,al as t,k as l,a as i,db as n,w as o,a4 as s,d as r,x as d,a7 as u,p,cr as c,cW as _,h as m}from"./page_layout.js?v=1756367574781";import{c as f,f as v,u as y,h as g,a as x,d as b}from"./public.js?v=1756367574781";import{a as h,s as w}from"./tools2.js?v=1756367574781";import{k as R,P as W,W as k,_ as j,a2 as M,V as C,U as S,ab as U,r as P,e as D,R as $,a3 as I,l as z,S as E,a4 as L,v as O,j as T,F as B,t as H,X as F,aG as V,y as A,ae as G,O as q,ak as Q,x as X,c as Y}from"./vue.js?v=1756367574781";import{bH as Z,dR as J,dV as K,aC as N,G as ee,dZ as ae,dT as te,e2 as le,dS as ie,dP as ne,dQ as oe}from"./naive.js?v=1756367574781";import{n as se}from"./rules.js?v=1756367574781";import{_ as re}from"./index.vue_vue_type_script_setup_true_lang5.js?v=1756367574781";import{_ as de}from"./index.vue_vue_type_script_setup_true_lang7.js?v=1756367574781";import{_ as ue}from"./index.vue_vue_type_script_setup_true_lang.js?v=1756367574781";import{_ as pe}from"./index99.js?v=1756367574781";import{_ as ce}from"./index.vue_vue_type_script_setup_true_lang15.js?v=1756367574781";import{m as _e}from"./common.js?v=1756367574781";const me=t=>e.post("/plugin?action=a&name=btwaf&s=get_id_log",t,{requestOptions:{loading:a.global.t("Waf.Api.report_1")}}),fe=R({__name:"index",props:{data:{default:()=>[]},total:{default:0},loading:{type:Boolean,default:!1}},setup(e){const a=e,{t:n}=W(),o=t(),{columns:s}=f([{key:"ip",title:n("Waf.Report.index_7"),ellipsis:{tooltip:!0}},{key:"address",title:n("Waf.Report.index_8"),ellipsis:{tooltip:!0}},{key:"num",title:n("Waf.Report.index_9"),width:"14%",minWidth:120},{key:"num",title:n("Waf.Report.index_10"),width:"32%",minWidth:160,render:e=>{const{total:t}=a,i=l((100*(t?e.num/t:0)).toFixed(1));return k("div",{class:"w-90%"},[k(Z,{type:"line","indicator-placement":"outside",height:16,"border-radius":2,percentage:i,color:o.value.successColor},null)])}},v({width:120,options:e=>[{label:n("Waf.Report.index_11"),onClick:()=>{h(e)}},{label:n("Public.Btn.Details"),onClick:()=>{y({title:n("Waf.Report.index_12",[e.ip]),width:950,minHeight:672,data:{row:e},component:j(()=>i(()=>import("./details2.js?v=1756367574781"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18])))})}}]})]);return(e,a)=>{const t=g;return C(),M(t,{loading:e.loading,data:e.data,columns:S(s)},null,8,["loading","data","columns"])}}}),ve=R({__name:"index",props:{data:{default:()=>[]},total:{default:0},loading:{type:Boolean,default:!1}},setup(e){const a=e,n=t(),{t:o}=W(),{columns:s}=f([{key:"uri",title:"URI",ellipsis:{tooltip:!0}},{key:"num",title:o("Waf.Report.index_9"),width:"20%"},{key:"num",title:o("Waf.Report.index_10"),render:e=>{const{total:t}=a,i=l((100*(t?e.num/t:0)).toFixed(1));return k("div",{class:"w-90%"},[k(Z,{type:"line","indicator-placement":"outside",height:16,"border-radius":2,percentage:i,color:n.value.successColor},null)])}},v({width:120,options:e=>[{label:o("Waf.Report.index_11"),onClick:()=>{r(e)}},{label:o("Public.Btn.Details"),onClick:()=>{d(e)}}]})]),r=e=>{x({title:o("Waf.Report.index_19"),content:()=>k(U,{tag:"div",keypath:"Waf.Report.index_33",scope:"global"},{index_1:()=>k("span",{class:"text-error"},[e.uri])}),onConfirm:async()=>{await se({url_rule:e.uri})}})},d=e=>{y({title:o("Waf.Report.index_20",[e.uri]),width:950,minHeight:600,data:{uri:e.uri,list:e.list},component:j(()=>i(()=>import("./details3.js?v=1756367574781"),__vite__mapDeps([19,1,2,3,4,5,6,7,8,9,10,12,13,14,15,16,17,18,11])))})};return(e,a)=>{const t=g;return C(),M(t,{loading:e.loading,data:e.data,columns:S(s)},null,8,["loading","data","columns"])}}}),ye={class:"p-8px"},ge={class:"w-160px"},xe={class:"min-w-160px mr-20px"},be={class:"text-desc"},he={class:"w-450px"},we=R({__name:"index",setup(a){const{t:t}=W(),l=P(null),p=D({p:1,limit:10,site:"all",type:"1",search:"",time:null}),c={search:{trigger:["input","blur"],validator:()=>"4"===p.type||""!==p.search.trim()||new Error(t("Waf.Report.index_28"))},time:{trigger:["change"],validator:()=>"4"!==p.type||null!==p.time||new Error(t("Waf.Report.index_29"))}},_=P([{label:t("Waf.Report.index_30"),value:"all"}]),m=[{label:"IP",value:"1"},{label:"URI",value:"2"},{label:"URL",value:"3"},{label:t("Waf.Report.index_31"),value:"4"}],{table:x,columns:b,setLoading:h}=f([{key:"time_localtime",title:t("Waf.Report.index_13"),width:"18%",minWidth:150},{key:"ip",title:t("Waf.Report.index_7"),width:"14%",minWidth:120},{key:"server_name",title:t("Waf.Report.index_14"),width:"14%",minWidth:120,ellipsis:{tooltip:!0}},{key:"uri",title:"URI",ellipsis:{tooltip:!0},minWidth:160,render:e=>n(e.uri)},{key:"filter_rule",title:t("Waf.Report.index_1"),width:"14%",minWidth:120,ellipsis:{tooltip:!0}},v({width:100,options:e=>[{label:t("Public.Btn.Details"),onClick:async()=>{const{message:a}=await me({id:e.id});o(a)&&a.length>0&&w(a[0])}},{label:"HTTP",onClick:()=>{R(e)}}]})]),R=e=>{y({title:t("Waf.Report.index_32",[e.time_localtime]),width:800,minHeight:458,data:{id:e.id},component:j(()=>i(()=>import("./http.js?v=1756367574781"),__vite__mapDeps([20,21,4,2,3,5,6,1,8,7,22,9,10,12,13,14,15,16,17,18,11])))})},M=async()=>{var a,t;try{await(null==(a=l.value)?void 0:a.validate()),h(!0);const{message:i}=await(t=(()=>{const{time:e}=p,a=e?u(e[0],"yyyy-MM-dd"):"",t=e?u(e[1],"yyyy-MM-dd"):"";return{..."all"===p.site?{is_all:1}:{server_name:p.site},..."4"===p.type?{start_time:a,end_time:t}:{serach:p.search},p:p.p,type:p.type}})(),e.post("/plugin?action=a&name=btwaf&s=get_search",t));r(i)&&(x.data=o(i.data)?i.data:[],x.total=d(i.page))}finally{h(!1)}};return(async()=>{try{const{message:a}=await e.post("/plugin?action=a&name=btwaf&s=get_server_name");o(a)&&(_.value=a.map(e=>({label:e,value:e})))}finally{_.value.unshift({label:t("Waf.Report.index_30"),value:"all"})}})(),(e,a)=>{const t=K,i=J,n=pe,o=s,r=N,d=ue,u=g,f=de,v=re;return C(),$("div",ye,[k(d,{ref_key:"formRef",ref:l,model:S(p),rules:c},{default:I(()=>[k(i,{label:e.$t("Waf.Report.index_21")},{default:I(()=>[E("div",ge,[k(t,{value:S(p).site,"onUpdate:value":a[0]||(a[0]=e=>S(p).site=e),options:S(_)},null,8,["value","options"])])]),_:1},8,["label"]),k(i,{label:e.$t("Waf.Report.index_22")},{default:I(()=>[E("div",xe,[k(t,{value:S(p).type,"onUpdate:value":a[1]||(a[1]=e=>S(p).type=e),options:m},null,8,["value"])]),E("div",null,[a[6]||(a[6]=E("span",{class:"mr-8px text-error"},"*",-1)),E("span",be,L(e.$t("Waf.Report.index_23")),1)])]),_:1},8,["label"]),z(k(i,{label:e.$t("Waf.Report.index_25"),path:"search"},{default:I(()=>[E("div",he,[k(n,{value:S(p).search,"onUpdate:value":a[2]||(a[2]=e=>S(p).search=e),rows:3},null,8,["value"])])]),_:1},8,["label"]),[[O,"4"!==S(p).type]]),z(k(i,{label:e.$t("Waf.Report.index_26"),path:"time"},{default:I(()=>[k(o,{value:S(p).time,"onUpdate:value":a[3]||(a[3]=e=>S(p).time=e),type:"daterange",clearable:""},null,8,["value"])]),_:1},8,["label"]),[[O,"4"===S(p).type]]),k(i,{label:" "},{default:I(()=>[k(r,{type:"primary",onClick:M},{default:I(()=>[T(L(e.$t("Waf.Report.index_27")),1)]),_:1})]),_:1})]),_:1},8,["model"]),k(v,null,{table:I(()=>[k(u,{loading:S(x).loading,data:S(x).data,columns:S(b)},null,8,["loading","data","columns"])]),pageRight:I(()=>[k(f,{page:S(p).p,"onUpdate:page":a[4]||(a[4]=e=>S(p).p=e),"page-size":S(p).limit,"onUpdate:pageSize":a[5]||(a[5]=e=>S(p).limit=e),"display-order":["pages"],"item-count":S(x).total,onRefresh:M},null,8,["page","page-size","item-count"])]),_:1})])}}}),Re={class:"h-full p-10px"},We=p(R({__name:"index",props:{loading:{type:Boolean,default:!1},data:{default:()=>[]}},setup(e){const{columns:a}=f([{key:"ip",title:"",align:"center",render:e=>k(B,null,[k("a",{class:"bt-link",href:"javascript:;",onClick:()=>{h(e)}},[e.ip]),k("span",{class:"mx-6px"},[e.address]),k("span",null,[T("("),e.num,T(")")])])}]);return(e,t)=>{const l=g;return C(),$("div",Re,[k(l,{class:"rank-table",loading:e.loading,data:e.data,"flex-height":!0,bordered:!1,"single-line":!1,"single-column":!1,columns:S(a)},null,8,["loading","data","columns"])])}}}),[["__scopeId","data-v-9bacc249"]]),ke={class:"flex-center h-full p-10px"},je=R({__name:"index",props:{data:{default:()=>[]}},setup(e){const a=H(e,"data"),{t:t}=W(),l=F("--color-bg-2"),i=F("--chart-tooltip-bg-color"),n=F("--color-text-1"),o=F("--color-text-2"),s=F("--color-text-3"),r=F("--color-border"),d=P(!1),u=V({backgroundColor:l.value,title:c(),tooltip:{trigger:"item",confine:!0,backgroundColor:i.value,borderColor:"transparent",textStyle:{color:"#c7c7c7"},formatter(e){const a=e;return"".concat(a.marker," ").concat(a.name,": ").concat(a.value," (").concat(a.percent,"%)")}},series:_()}),p=["#6ec71e","#4885FF","#fc8b40","#818af8","#31c9d7","#f35e7a","#ab7aee","#14d68b","#cde5ff"];function c(e=0){return{text:t("Waf.Report.index_18"),textStyle:{color:n.value,fontSize:17},subtext:"".concat(e),subtextStyle:{color:o.value,fontSize:15},itemGap:20,left:"center",top:"42%"}}function _(e=[]){return[{type:"pie",data:e,radius:["50%","60%"],center:["50%","50%"],clockwise:!0,avoidLabelOverlap:!0,label:{show:!0,position:"outside",color:s.value,lineHeight:18,formatter:e=>""!==e.name?0===e.percent?"":t("Waf.Overview.index_33",[e.name,e.value,e.percent]):""},labelLine:{length:30,length2:30,lineStyle:{width:1,color:r.value}},itemStyle:{labelLine:{length:30,length2:30,lineStyle:{width:1,color:r.value}},color:e=>p[e.dataIndex]},emphasis:{scaleSize:15}}]}return A(()=>{a.value&&(d.value=!a.value.length,(()=>{let e=0;const t=[];a.value.forEach(a=>{e+=a[1],t.push({name:a[0],value:a[1]})}),u.title=c(e),u.series=_(t)})())}),(e,a)=>{const t=ee;return C(),$("div",ke,[S(d)?(C(),M(t,{key:0})):(C(),M(ce,{key:1,type:"pie",height:"100%",option:S(u)},null,8,["option"]))])}}}),Me={class:"flex"},Ce=p(R({__name:"date",props:{value:{default:"today"},valueModifiers:{}},emits:["update:value"],setup(e){const{t:a}=W(),t=P("today"),l=P(null),i=G(e,"value"),n=[{label:a("Public.Search.Yesterday"),value:"yesterday"},{label:a("Public.Search.Today"),value:"today"}],r=e=>{l.value=null,i.value=e},d=e=>{t.value=e?"":"today",i.value=o(e)?e:"today"};return A(()=>{o(i.value)?(l.value=i.value,t.value=""):(t.value=i.value,l.value=null)}),(e,a)=>{const i=ae,o=te,u=s;return C(),$("div",Me,[k(o,{value:S(t),"onUpdate:value":[a[0]||(a[0]=e=>Q(t)?t.value=e:null),r],size:"small",class:"bt-radio"},{default:I(()=>[(C(),$(B,null,q(n,e=>k(i,{key:e.value,value:e.value},{default:I(()=>[T(L(e.label),1)]),_:2},1032,["value"])),64))]),_:1},8,["value"]),k(u,{value:S(l),"onUpdate:value":[a[1]||(a[1]=e=>Q(l)?l.value=e:null),d],type:"daterange",size:"small",class:"bt-date-picker",clearable:!0},null,8,["value"])])}}}),[["__scopeId","data-v-9ee89472"]]),Se={class:"h-320px"},Ue={class:"h-320px"},Pe=p(R({__name:"index",setup(a){const{loading:t,setLoading:l}=b(),i=P("ip"),n=X({type:[],ip:[],ip_list:{},uri:[],uri_list:{}}),o=Y(()=>n.value.ip.map(e=>({ip:e[0],num:e[1],address:e[2],data:n.value.ip_list[e[0]]}))),s=Y(()=>n.value.uri.map(e=>({uri:e[0],num:e[1],list:n.value.uri_list[e[0]].ip_list||[]}))),d=Y(()=>{let e=0;return n.value.type.forEach(a=>{e+=a[1]}),e}),p=e=>{"search"!==e&&x()},f=()=>{x()},v=()=>{const e=_();if("today"===y.date)window.open("".concat(e,"/btwaf/content_report.html"));else{const{start:a,end:t}=g();window.open("".concat(e,"/btwaf/content_report.html?stime=").concat(a,"&etime=").concat(t))}},y=D({date:"today"}),g=()=>{let e="",a="";if(m(y.date))switch(y.date){case"today":e=u(new Date,"yyyy-MM-dd"),a=u(new Date,"yyyy-MM-dd");break;case"yesterday":e=u(_e(new Date,-1),"yyyy-MM-dd"),a=u(_e(new Date,-1),"yyyy-MM-dd")}else e=u(new Date(y.date[0]),"yyyy-MM-dd"),a=u(new Date(y.date[1]),"yyyy-MM-dd");return{start:e,end:a}},x=async()=>{try{l(!0);const{message:t}=await(a=(()=>{const{start:e,end:a}=g();return{..."today"!==y.date?{start_time:e,end_time:a}:{}}})(),e.post("/plugin?action=a&name=btwaf&s=get_report",a));r(t)&&(n.value=t)}finally{l(!1)}var a};return x(),(e,a)=>{const l=ie,r=le,u=N,_=oe,m=ne,g=c;return C(),M(g,{class:"report-grid","x-gap":"16"},{default:I(()=>[k(r,{span:"6"},{default:I(()=>[k(l,{class:"report-card mb-16px",title:e.$t("Waf.Report.index_1")},{default:I(()=>[E("div",Se,[k(je,{data:S(n).type},null,8,["data"])])]),_:1},8,["title"]),k(l,{class:"report-card",title:e.$t("Waf.Report.index_2")},{default:I(()=>[E("div",Ue,[k(We,{loading:S(t),data:S(o)},null,8,["loading","data"])])]),_:1},8,["title"])]),_:1}),k(r,{span:"18"},{default:I(()=>[k(l,{class:"h-full"},{default:I(()=>[k(m,{value:S(i),"onUpdate:value":[a[1]||(a[1]=e=>Q(i)?i.value=e:null),p],type:"line",class:"report-tabs"},{prefix:I(()=>a[2]||(a[2]=[E("div",null,null,-1)])),suffix:I(()=>[k(Ce,{value:S(y).date,"onUpdate:value":[a[0]||(a[0]=e=>S(y).date=e),f]},null,8,["value"]),k(u,{class:"ml-16px",type:"primary",size:"small",onClick:v},{default:I(()=>[T(L(e.$t("Waf.Report.index_3")),1)]),_:1}),a[3]||(a[3]=E("div",{class:"w-16px"},null,-1))]),default:I(()=>[k(_,{name:"ip",tab:e.$t("Waf.Report.index_4")},{default:I(()=>[k(fe,{loading:S(t),total:S(d),data:S(o)},null,8,["loading","total","data"])]),_:1},8,["tab"]),k(_,{name:"uri",tab:e.$t("Waf.Report.index_5")},{default:I(()=>[k(ve,{loading:S(t),total:S(d),data:S(s)},null,8,["loading","total","data"])]),_:1},8,["tab"]),k(_,{name:"search",tab:e.$t("Waf.Report.index_6")},{default:I(()=>[k(we)]),_:1},8,["tab"])]),_:1},8,["value"])]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-0329e270"]]),De=Object.freeze(Object.defineProperty({__proto__:null,default:Pe},Symbol.toStringTag,{value:"Module"}));export{me as g,De as i};
