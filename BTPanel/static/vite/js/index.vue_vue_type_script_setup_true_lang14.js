import{al as s,_ as a,J as e}from"./index.js?v=1721298337096";import{_ as t}from"./Progress.js?v=1721298337096";import{l,r as n,k as r,S as c,Z as i,_ as o,a3 as u,W as p,P as d,q as m,F as x}from"./vue.js?v=1721298337096";import{N as g}from"./DataTable.js?v=1721298337096";const h={class:"w-400px p-20px"},b={class:"mb-12px text-14px"},v=l({__name:"progress",props:{data:{}},emits:["close"],setup(a,{emit:e}){const l=a,{title:m,data:x,api:g,callback:v}=l.data,f=e,S=n(0),w=n(0),y=r((()=>x.length));return(async()=>{for(let e=0;e<x.length;e++)try{if(g){const a=await g(x[e]);x[e].batchStatus="success",x[e].reqMsg=s(a,"message.result","Success"),w.value+=1,w.value===y.value?S.value=100:S.value=Math.round(w.value/y.value*100)}}catch(a){x[e].batchStatus="error",x[e].reqMsg=s(a,"message.result","")}null==v||v(x),f("close")})(),(s,a)=>{const e=t;return c(),i("div",h,[o("div",b,[o("span",null,"Batching "+u(p(m))+", current progress: ",1),o("span",null,u(p(w))+"/"+u(p(y)),1)]),d(e,{type:"line",status:"success",percentage:p(S),height:24,"border-radius":4,"fill-border-radius":0,processing:!0,"show-indicator":!1,"indicator-placement":"inside"},null,8,["percentage"])])}}}),f={class:"p-24px"},S={class:"flex items-center mb-24px"},w={class:"flex-1 ml-12px text-14px leading-22px"},y={class:"flex-1 ml-12px text-14px leading-22px"},_=l({__name:"index",props:{data:{}},emits:["setConfirm"],setup(s,{expose:t,emit:l}){const r=s,{title:h,desc:b,data:_,columns:k,api:q,done:C}=r.data,M=l,j=n([]),z=n([...k,{key:"batchStatus",title:"Result",align:"right",width:200,render:s=>"success"===s.batchStatus?d("span",{class:"text-primary"},[s.reqMsg]):"error"===s.batchStatus?d("span",{class:"text-error"},[s.reqMsg]):d("span",{class:"text-warning"},[m("Wait")])}]),D=n(!1),P=n(""),W=s=>{const a=s.filter((s=>"success"===s.batchStatus)).length,e=s.length-a;P.value="".concat(h," has been completed, total ").concat(s.length," tasks, ").concat(a," successes, ").concat(e," failures"),D.value=!0,M("setConfirm",{text:"Done",disabled:!1}),null==C||C(s)};return(()=>{j.value=_.map((s=>({batchStatus:"wait",...s})));const{status:s}=r.data;"done"===s&&W(_)})(),t({onConfirm:({hide:s})=>(D.value?s():(M("setConfirm",{disabled:!0}),e({title:h,hideClose:!0,data:{title:h,api:q,data:j.value,callback:W},component:v})),!1)}),(s,e)=>{const t=a,l=g;return c(),i("div",f,[o("div",S,[p(D)?(c(),i(x,{key:1},[d(t,{name:"base-success",size:"40",class:"text-primary"}),o("div",y,u(p(P)),1)],64)):(c(),i(x,{key:0},[d(t,{name:"base-warning",size:"40",class:"text-warning"}),o("div",w,u(p(b)),1)],64))]),d(l,{"max-height":182,data:p(j),columns:p(z)},null,8,["data","columns"])])}}});export{_,v as a};
