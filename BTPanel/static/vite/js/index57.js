import{_ as e}from"./index103.js?v=1749179669910";import{_ as t}from"./index.vue_vue_type_script_setup_true_lang.js?v=1749179669910";import{d as a,O as i,r as s,j as n,R as l,S as o,U as r,c as u,a2 as c,F as p,N as d,V as _,ao as y,P as m,a1 as f,a0 as h,k as x,v as g,aj as v,M as b}from"./vue.js?v=1749179669910";import{i as S,t as k,c as I,q as w,N as $,b4 as C,_ as U,p as H}from"./page_layout.js?v=1749179669910";import{c3 as j,c0 as L,bY as R,cj as P,_ as q,a2 as z,T as M,bU as O,cp as T,cm as A}from"./naive.js?v=1749179669910";import{d as W,_ as F,f as N,a as B,c as E,h as J}from"./public.js?v=1749179669910";import{_ as V}from"./index.vue_vue_type_script_setup_true_lang5.js?v=1749179669910";import{_ as Y}from"./index.vue_vue_type_script_setup_true_lang8.js?v=1749179669910";import{_ as D}from"./index.vue_vue_type_script_setup_true_lang9.js?v=1749179669910";import{T as G}from"./common.js?v=1749179669910";import"./__commonjsHelpers__.js?v=1749179669910";import"./index.vue_vue_type_script_setup_true_lang6.js?v=1749179669910";const{t:K}=S.global,Q=()=>k.post("/breaking_through?action=get_config"),X=e=>k.post("/breaking_through?action=set_config",e,{requestOptions:{loading:K("Security.Api.Index_6"),successMessage:!0}}),Z=e=>k.post("/breaking_through?action=panel_ip_white",e,{requestOptions:{loading:K("Security.Api.Index_4"),successMessage:!0}}),ee=e=>k.post("/breaking_through?action=get_black_white",e),te=e=>k.post("/breaking_through?action=add_black_white",e,{requestOptions:{loading:K("Security.Api.Index_6"),successMessage:!0}}),ae={class:"pl-5px"},ie={key:0},se={class:"mb-15px"},ne={class:"mr-10px"},le={key:0},oe={class:"mr-10px"},re=a({__name:"index",setup(e,{expose:a}){const{t:v}=i(),b=s(null),S=s(null),$=s(null),C=n({protectionUsername:!0,minutes:5,failures:5,radio:0,check:!1}),U=n({protectionIP:!0,minutes:15,failures:5,ip:"1s",check:!1}),H=n({failures:360}),O=n({user:["aapanel"],ip:["ssh"]}),T=async e=>{await X({username_status:e})},A=async e=>{await X({ip_status:e})},W=async()=>{var e;H.failures&&await(e={history_limit:H.failures},k.post("/breaking_through?action=set_history_record_limit",e,{requestOptions:{loading:K("Security.Api.Index_6"),successMessage:!0}}))},F={minutes:{trigger:["blur","change"],validator:(e,t)=>null!==t&&0!==t||new Error(v("Security.Conf.Index_27"))},failures:{required:!0,type:"number",trigger:["blur","change"],message:v("Security.Conf.Index_28")}},N={minutes:{trigger:["blur","change"],validator:(e,t)=>null!==t&&0!==t||new Error(v("Security.Conf.Index_27"))},failures:{required:!0,type:"number",trigger:["blur","change"],message:v("Security.Conf.Index_28")}},B={failures:{required:!0,type:"number",trigger:["blur","change"],message:v("Security.Conf.Index_28")}},E=async()=>{var e,t,a;await(null==(e=b.value)?void 0:e.validate()),await(null==(t=S.value)?void 0:t.validate()),await(null==(a=$.value)?void 0:a.validate()),await X({username_limit:C.minutes,username_count:C.failures,username_type:C.radio,username_limit_root:C.check,ip_limit:U.minutes,ip_count:U.failures,ip_command:U.ip,ip_ipset_filter:U.check,history_limit:H.failures}),J()},J=async()=>{const{message:e}=await Q();I(e)&&(C.protectionUsername=e.username_status,C.minutes=e.based_on_username.limit,C.failures=e.based_on_username.count,C.radio=e.based_on_username.type,C.check=e.based_on_username.limit_root,U.protectionIP=e.ip_status,U.minutes=e.based_on_ip.limit,U.failures=e.based_on_ip.count,U.ip=e.based_on_ip.command,U.check=e.based_on_ip.ipset_filter,H.failures=e.history_limit);const{message:t}=await k.post("/breaking_through?action=get_protected_services");I(t)&&(O.user=t.based_on_username,O.ip=t.based_on_ip)};return J(),a({init:J}),(e,a)=>{const i=j,s=L,n=R,v=P,k=t,I=w,J=q,V=z,Y=M;return l(),o("div",ae,[r("h3",null,[u(c(e.$t("Security.Conf.Index_5"))+" ("+c(e.$t("Security.Conf.Index_37"))+" ",1),(l(!0),o(p,null,d(_(O).user,((e,t)=>(l(),o("span",{key:t},[u(c(e),1),t<_(O).user.length-1?(l(),o("span",ie,"、")):y("",!0)])))),128)),a[9]||(a[9]=u(") "))]),m(i,{"show-icon":!1,class:"my-15px"},{default:f((()=>[u(c(e.$t("Security.Conf.Index_6")),1)])),_:1}),r("div",se,[r("span",ne,c(e.$t("Site.TableRow.index_14")),1),m(s,{size:"small",value:_(C).protectionUsername,"onUpdate:value":[a[0]||(a[0]=e=>_(C).protectionUsername=e),T]},null,8,["value"])]),_(C).protectionUsername?(l(),h(k,{key:0,ref_key:"userFormRef",ref:b,"label-placement":"top",model:_(C),rules:F},{default:f((()=>[m(v,{label:e.$t("Security.Conf.Index_7"),path:"minutes"},{default:f((()=>[m(n,{"show-button":!1,value:_(C).minutes,"onUpdate:value":a[1]||(a[1]=e=>_(C).minutes=e)},null,8,["value"])])),_:1},8,["label"]),m(v,{label:e.$t("Security.Conf.Index_8"),path:"failures"},{default:f((()=>[m(n,{"show-button":!1,value:_(C).failures,"onUpdate:value":a[2]||(a[2]=e=>_(C).failures=e)},null,8,["value"])])),_:1},8,["label"])])),_:1},8,["model"])):y("",!0),m(I,{class:"mb-20px!"}),r("h3",null,[u(c(e.$t("Security.Conf.Index_12"))+" ("+c(e.$t("Security.Conf.Index_37"))+" ",1),(l(!0),o(p,null,d(_(O).ip,((e,t)=>(l(),o("span",{key:t},[u(c(e),1),t<_(O).ip.length-1?(l(),o("span",le,"、")):y("",!0)])))),128)),a[10]||(a[10]=u(") "))]),m(i,{"show-icon":!1,class:"my-15px"},{default:f((()=>[u(c(e.$t("Security.Conf.Index_13")),1)])),_:1}),r("span",oe,c(e.$t("Site.TableRow.index_14")),1),m(s,{size:"small",value:_(U).protectionIP,"onUpdate:value":[a[3]||(a[3]=e=>_(U).protectionIP=e),A]},null,8,["value"]),_(U).protectionIP?(l(),h(k,{key:1,ref_key:"ipFormRef",ref:S,"label-placement":"top",model:_(U),rules:N,class:"pt-15px"},{default:f((()=>[m(v,{label:e.$t("Security.Conf.Index_14"),path:"minutes"},{default:f((()=>[m(n,{"show-button":!1,value:_(U).minutes,"onUpdate:value":a[4]||(a[4]=e=>_(U).minutes=e)},null,8,["value"])])),_:1},8,["label"]),m(v,{label:e.$t("Security.Conf.Index_15"),path:"failures"},{default:f((()=>[m(n,{"show-button":!1,value:_(U).failures,"onUpdate:value":a[5]||(a[5]=e=>_(U).failures=e)},null,8,["value"])])),_:1},8,["label"]),m(v,{label:e.$t("Security.Conf.Index_16")},{default:f((()=>[m(J,{class:"w-150px!",value:_(U).ip,"onUpdate:value":a[6]||(a[6]=e=>_(U).ip=e),placeholder:e.$t("Security.Conf.Index_38")},null,8,["value","placeholder"])])),_:1},8,["label"]),m(V,{checked:_(U).check,"onUpdate:checked":a[7]||(a[7]=e=>_(U).check=e)},{default:f((()=>[u(c(e.$t("Security.Conf.Index_17")),1)])),_:1},8,["checked"]),x(r("div",{class:"mt-10px ml-24px text-desc"},c(e.$t("Security.Conf.Index_39",[_(U).minutes])),513),[[g,_(U).check]])])),_:1},8,["model"])):y("",!0),m(I,{class:"my-20px!"}),r("h3",null,c(e.$t("Security.Conf.Index_22")),1),m(k,{"label-placement":"top",model:_(H),rules:B,ref_key:"historyFormRef",ref:$,class:"pt-15px"},{default:f((()=>[m(v,{label:e.$t("Security.Conf.Index_23"),path:"failures"},{default:f((()=>[m(n,{"show-button":!1,placeholder:e.$t("Site.Placeholder.Index_10"),value:_(H).failures,"onUpdate:value":a[8]||(a[8]=e=>_(H).failures=e),onBlur:W},null,8,["placeholder","value"])])),_:1},8,["label"])])),_:1},8,["model"]),m(I,{class:"mb-20px!"}),m(Y,{type:"primary",onClick:E},{default:f((()=>[u(c(e.$t("Site.Cert.index_60")),1)])),_:1})])}}}),ue={class:"pl-5px"},ce=a({__name:"index",setup(e,{expose:t}){const a=s(""),{loading:i,setLoading:n}=W(!0),p=async()=>{const e=JSON.stringify(a.value);await te({ips:e.replace(/^"|"$/g,""),types:"white",hand:!0}),d()},d=async()=>{try{n(!0);const{message:e}=await ee({types:"white"});$(e)&&(a.value=e.map((e=>"".concat(e.ip," # ").concat(e.ps))).join("\n"))}finally{n(!1)}};return d(),t({init:d}),(e,t)=>{const s=j,n=q,d=F,y=O,h=M;return l(),o("div",ue,[m(s,{"show-icon":!1},{default:f((()=>[u(c(e.$t("Security.WhiteList.Index_1")),1)])),_:1}),m(y,{class:"items-center my-15px"},{default:f((()=>[m(n,{class:"w-500px!",type:"textarea",loading:_(i),value:_(a),"onUpdate:value":t[0]||(t[0]=e=>v(a)?a.value=e:null),autosize:{minRows:10},placeholder:e.$t("Ftp.Placeholder.Index_3")},null,8,["loading","value","placeholder"]),m(d,null,{default:f((()=>[r("li",null,c(e.$t("Security.WhiteList.Index_2")),1),r("li",null,c(e.$t("Security.WhiteList.Index_3")),1),r("li",null,c(e.$t("Security.WhiteList.Index_4")),1)])),_:1})])),_:1}),m(h,{type:"primary",onClick:p},{default:f((()=>[u(c(e.$t("Site.Cert.index_60")),1)])),_:1})])}}}),pe={class:"pl-5px"},de=a({__name:"index",setup(e,{expose:t}){const a=s(""),{loading:i,setLoading:n}=W(!0),p=async()=>{const e=JSON.stringify(a.value);await te({ips:e.replace(/^"|"$/g,""),types:"black",hand:!0}),d()},d=async()=>{try{n(!0);const{message:e}=await ee({types:"black"});$(e)&&(a.value=e.map((e=>"".concat(e.ip," # ").concat(e.ps))).join("\n"))}finally{n(!1)}};return d(),t({init:d}),(e,t)=>{const s=j,n=q,d=F,y=O,h=M;return l(),o("div",pe,[m(s,{"show-icon":!1},{default:f((()=>[u(c(e.$t("Security.BlackList.Index_1")),1)])),_:1}),m(y,{class:"items-center my-15px"},{default:f((()=>[m(n,{class:"w-500px!",type:"textarea",loading:_(i),value:_(a),"onUpdate:value":t[0]||(t[0]=e=>v(a)?a.value=e:null),autosize:{minRows:10},placeholder:e.$t("Ftp.Placeholder.Index_3")},null,8,["loading","value","placeholder"]),m(d,null,{default:f((()=>[r("li",null,c(e.$t("Security.WhiteList.Index_2")),1),r("li",null,c(e.$t("Security.WhiteList.Index_3")),1),r("li",null,c(e.$t("Security.WhiteList.Index_4")),1)])),_:1})])),_:1}),m(h,{type:"primary",onClick:p},{default:f((()=>[u(c(e.$t("Site.Cert.index_60")),1)])),_:1})])}}}),_e=a({__name:"index",setup(e,{expose:t}){const{t:a}=i(),s=n({p:1,limit:10,keyword:"",types:"login"}),d=[{key:"user",title:a("Security.History.Index_7"),width:"15%"},{key:"ip",title:a("Security.History.Index_8"),width:"15%"},{key:"service",title:a("Security.History.Index_10"),width:"15%"},{key:"logintime",title:a("Security.History.Index_11"),align:"center",width:"10%"}],x=[{key:"ip",title:a("Security.History.Index_8"),width:"15%"},{key:"lock_status",title:a("Home.index_66"),width:"20%"},{key:"block_reason",title:a("Security.Anti.Index_21"),width:"20%"},{key:"exptime",title:a("Security.History.index_20"),width:"20%"},{key:"timeleft",title:a("Security.History.index_21"),width:"20%",align:"center"},N({title:a("Public.Table.Action"),align:"right",options:e=>[{label:a("Security.History.Index_16"),onClick:async()=>{B({title:"".concat(a("Security.History.Index_16")," [").concat(e.ip,"]"),content:a("Security.History.Index_17"),onConfirm:async()=>{await Z({ip:e.ip,hand:!0,ps:"Manually add",clear_black:1}),R()}})}}]})],{keys:g,table:v,columns:S}=E(d),w=[{label:a("Security.History.Index_3"),value:"login"},{label:a("Security.History.Index_5"),value:"ip"}],$=async()=>{s.keyword="",s.p=1,v.data=[],S.value="ip"===s.types?x:d,R()},H=async()=>{B({title:a("Security.History.Index_1"),content:a("Security.History.Index_18"),onConfirm:async()=>{await k.post("/breaking_through?action=clear_history_record_limit",{},{requestOptions:{loading:K("Security.Api.Index_7"),successMessage:!0}}),R()}})},{loading:j,setLoading:L}=W(!0),R=async()=>{try{L(!0);const{message:t}=await(e=b(s),k.post("/breaking_through?action=get_history_record",e));I(t)?(v.data=t.data,v.total=C(t.page)):(v.data=[],v.total=0)}finally{g.value=[],L(!1)}var e};return R(),t({init:R}),(e,t)=>{const a=U,i=M,n=T,d=D,x=O,g=J,b=Y,k=V,I=F;return l(),o(p,null,[m(k,{class:"pl-5px"},{toolsLeft:f((()=>[m(i,{type:"primary",onClick:R},{icon:f((()=>[m(a,{name:"refresh",size:"14"})])),default:f((()=>[u(" "+c(e.$t("Public.Btn.Refresh")),1)])),_:1}),m(i,{onClick:H},{default:f((()=>[u(c(e.$t("Security.History.Index_1")),1)])),_:1})])),toolsRight:f((()=>[u(c(e.$t("Security.History.Index_2"))+" ",1),m(x,{class:"flex-nowrap!"},{default:f((()=>[m(n,{value:_(s).types,"onUpdate:value":[t[0]||(t[0]=e=>_(s).types=e),$],options:w,class:"w-200px"},null,8,["value"]),m(d,{value:_(s).keyword,"onUpdate:value":t[1]||(t[1]=e=>_(s).keyword=e),placeholder:e.$t("Security.History.Index_14"),onSearch:R},null,8,["value","placeholder"])])),_:1})])),table:f((()=>[m(g,{loading:_(j),data:_(v).data,columns:_(S)},null,8,["loading","data","columns"])])),pageRight:f((()=>[m(b,{page:_(s).p,"onUpdate:page":t[2]||(t[2]=e=>_(s).p=e),"page-size":_(s).limit,"onUpdate:pageSize":t[3]||(t[3]=e=>_(s).limit=e),"item-count":_(v).total,onRefresh:R},null,8,["page","page-size","item-count"])])),_:1}),"ip"===_(s).types?(l(),h(I,{key:0},{default:f((()=>[r("li",null,c(e.$t("Security.History.Index_19")),1)])),_:1})):y("",!0)],64)}}}),ye=a({__name:"index",setup(t){const{t:a}=i(),n=s("config"),o=[{key:"config",label:a("Security.Tabs.Index_1"),component:re},{key:"white",label:a("Security.Tabs.Index_2"),component:ce},{key:"black",label:a("Security.Tabs.Index_3"),component:de},{key:"history",label:a("Security.Tabs.Index_4"),component:_e}];return(t,a)=>{const i=e;return l(),h(i,{value:_(n),"onUpdate:value":a[0]||(a[0]=e=>v(n)?n.value=e:null),options:o},null,8,["value"])}}}),me={class:"mr-15px"},fe=H(a({__name:"index",setup(e){const{t:t}=i(),a=n({address:"",show:!1}),d=s(!1),x=async e=>{d.value=!e;const a=t("Security.Conf.Index_1"),i=t("Security.Conf.Index_4");B({title:a,content:i,onConfirm:async({hide:t})=>{await X({global_status:e}),d.value=e,t()}})},g=async()=>{await Z({ip:a.address,hand:!0}),w()},{loading:b,setLoading:S}=W(!0),w=async()=>{S(!0);const{message:e}=await Q();if(I(e)&&(d.value=e.global_status,S(!1),!e.global_status))return;const{data:t}=await G.get("https://api.ipify.org?format=json");a.address=t.ip;try{await(e=>k.post("/breaking_through?action=check_local_ip_white",e,{requestOptions:{loading:"",successMessage:!1,errorMessage:!1}}))({ip:t.ip}),a.show=!1}catch(i){a.show=!0,console.error(i)}};return w(),(e,t)=>{const i=M,s=j,n=L,S=O,k=A;return l(),o(p,null,[_(a).show&&_(d)?(l(),h(s,{key:0,class:"py-10px",type:"warning",bordered:!1},{default:f((()=>[r("span",me,c(e.$t("Security.Conf.Index_2",[_(a).address])),1),m(i,{text:"",type:"primary",onClick:g},{default:f((()=>[u(" ["+c(e.$t("Security.Conf.Index_3"))+"] ",1)])),_:1})])),_:1})):y("",!0),m(k,{class:"my-15px"},{default:f((()=>[m(S,{class:"p-15px items-center"},{default:f((()=>[r("span",null,c(e.$t("Security.Conf.Index_1")),1),m(n,{value:_(d),"onUpdate:value":[t[0]||(t[0]=e=>v(d)?d.value=e:null),x],"rubber-band":!1,loading:_(b),size:"small"},null,8,["value","loading"])])),_:1})])),_:1}),_(d)?(l(),h(k,{key:1,class:"p-15px"},{default:f((()=>[m(ye)])),_:1})):y("",!0)],64)}}}),[["__scopeId","data-v-88b60c14"]]);export{fe as default};
