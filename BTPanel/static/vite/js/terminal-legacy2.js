System.register(["./xterm-legacy.js?v=1764830988434","./xterm-addon-canvas-legacy.js?v=1764830988434","./vue-legacy.js?v=1764830988434","./page_layout-legacy.js?v=1764830988434","./public-legacy.js?v=1764830988434"],function(e,t){"use strict";var a,o,s,n,i,d,r,c,l,u,p,m,v,g,h,x,f,_,w,y,A,S,b,O,C,T,M,D;return{setters:[e=>{a=e.x,o=e.a,s=e.b,n=e.c},e=>{i=e.x},e=>{d=e.r,r=e._,c=e.k,l=e.P,u=e.af,p=e.a0,m=e.w,v=e.ap,g=e.o,h=e.b,x=e.R,f=e.V,_=e.n},e=>{w=e.aD,y=e.i,A=e.a,S=e.x,b=e.e,O=e.da,C=e.p},e=>{T=e.u,M=e.d,D=e.C}],execute:function(){var j=document.createElement("style");j.textContent="[data-v-378f7833] .xterm{padding:12px!important}.box[data-v-378f7833]{height:calc(100vh - 160px)}\n/*$vite$:1*/",document.head.appendChild(j);const{t:k}=y.global,{t:q}=(e("f",e=>w.post("/xterm?action=create_host",e,{requestOptions:{loading:k("Security.Api.Index_4"),successMessage:!0}})),e("h",e=>w.post("/xterm?action=get_host_find",e)),e("d",e=>w.post("/xterm?action=remove_host",e,{requestOptions:{loading:k("Security.Api.Index_3"),successMessage:!0}})),e("c",()=>w.post("/xterm?action=get_command_list")),e("a",e=>w.post("/xterm?action=create_command",e,{requestOptions:{loading:k("Security.Api.Index_4"),successMessage:!0}})),e("e",e=>w.post("/xterm?action=modify_command",e,{requestOptions:{loading:k("Crontab.Api.index_5"),successMessage:!0}})),e("b",e=>w.post("/xterm?action=remove_command",e,{requestOptions:{loading:k("Security.Api.Index_3"),successMessage:!0}})),e("t",e=>w.post("/xterm?action=test_ssh_connect",e,{requestOptions:{loading:k("Login.index_22"),successMessage:!0}})),y.global),I=e("o",e=>{T({title:e.title,width:600,footer:!0,data:e.data,component:r(()=>A(()=>t.import("./form-legacy9.js?v=1764830988434"),void 0))})}),{loading:E}=M();e("l",E);const L=e("s",d([])),z=e("g",async()=>{const{message:e}=await w.post("/xterm?action=get_host_list");S(e)&&(L.value=e)}),P=d("aaaaaaaaa"),R=d([{id:"aaaaaaaaa",host:"127.0.0.1",port:22,ps:q("Database.form.index_12"),state:!1}]),$=e=>{P.value=e},F=e=>{const t=b(9,"letter");R.value.push({id:t,host:e.host,port:e.port,ps:e.ps,state:!1}),setTimeout(()=>{$(t)},20)},B=(e,t)=>{const a=R.value.find(t=>t.id===e);a&&(a.state=t)},N=()=>{R.value=[{id:"aaaaaaaaa",host:"127.0.0.1",port:22,ps:q("Database.form.index_12"),state:!1}],P.value="aaaaaaaaa"},H=(e("u",()=>({activeTerminalId:P,terminals:R,setActiveTerminal:$,onServerList:F,onUpdateState:B,resetTerminals:N})),c({__name:"terminal",props:{data:{},active:{type:Boolean}},emits:["updateState","connectSuccess"],setup(e,{expose:t,emit:r}){const{t:c}=l(),w=e,{data:y}=w,{active:A}=u(w),S=r,b=O(),{isFull:C}=p(b),{ws:T,status:M,send:j,open:k,close:q}=D("/webssh",{get verifyData(){return{host:y.host,port:y.port,id:y.id,ps:y.ps,sort:0}},onMessage:(e,t)=>{const a=t.data;if(a.indexOf("Authentication timeout.")>-1)$.value=!0;else{if(!(-1===a.indexOf("127.0.0.1:")&&-1===a.indexOf("localhost:")||-1===a.indexOf("Password or private key cannot both be empty")&&-1===a.indexOf("Account or Password incorrect: Authentication failed")))return S("updateState",y.id,!1),q(),V(),void E();if("\\r\\nlogout\\r\\n"==a||"logout\\r\\n"==a||"\r\nlogout\r\n"==a||"logout\r\n"==a||a.search(/logout[\r\n]+$/)>-1)return S("updateState",y.id,!1),P.write("\r"+c("Component.Terminal.index_1")+"\r"),V(),void q()}S("connectSuccess",a)}}),E=()=>{I({title:c("Term.index_22"),data:{isEdit:!0,tips:!0,localhost:!0,onRefresh:()=>{y.host.includes("127.0.0.1")&&!y.host.includes("_22")&&(y.host=y.host.replace("127.0.0.1","127.0.0.1_22")),J()}}})};let P,R;const $=d(!1),F=d(null);let B=null;const N=()=>{const e=T.value;e&&(P.loadAddon(R),P.loadAddon(new i.CanvasAddon),P.loadAddon(new s.WebLinksAddon),B=new n.AttachAddon(e),P.loadAddon(B),setTimeout(()=>{R.fit();const e=F.value;e&&(W.value=`${e.clientHeight}px`)},100))};m([T,M],([e,t])=>{if("CLOSED"===t&&e)return S("updateState",y.id,!1),P.write("\r\n"+c("Component.Terminal.index_2")+"\r\n"),void setTimeout(()=>{k(),S("updateState",y.id,!0)},500);"OPEN"===t&&e&&(B&&B.dispose(),B=new n.AttachAddon(e),P.loadAddon(B),setTimeout(()=>{R.fit();const{cols:e,rows:t}=P;j({cols:e,rows:t,resize:1})},100))},{immediate:!1});const H=()=>{F.value&&P.open(F.value)};let U=!1;const V=()=>{U=!1},W=d(""),G=()=>{P.focus(),P.onData(e=>{const t=T.value;"\r"===e&&$.value&&($.value=!1,P.write("\r\n"),J()),void 0!==t||"\r"!==e||U||(U=!0,P.write("\r\n"+c("Component.Terminal.index_2")+"\r\n"),J())})},J=()=>{k(),G();const e=T.value;e&&(P.loadAddon(new n.AttachAddon(e)),S("updateState",y.id,!0))},K=()=>{_(()=>{if(R.fit(),"CLOSED"!==M.value){S("updateState",y.id,!0);const{cols:e,rows:t}=P;j({cols:e,rows:t,resize:1})}})};m(()=>C.value,e=>{const t=F.value;t&&!e&&(t.style.height=W.value)}),m(()=>b.command,e=>{e&&A.value&&(console.log(e),j(e+"\n"),b.setCommand(""))}),m(()=>A.value,e=>{e&&_(()=>{R.fit()})});let Q=!0;const X=new ResizeObserver(()=>{A.value&&v(()=>{Q?Q=!1:K()},200)()});return t({send:j}),g(async()=>{await(async()=>{await z(),L.value.some(e=>"127.0.0.1_22"===e.host)&&"127.0.0.1"===y.host&&(y.host="127.0.0.1_22")})(),P=new a.Terminal({cursorBlink:!0,fontSize:14,fontFamily:"Monaco, Menlo, Consolas, 'Courier New', monospace",theme:{background:"#333",foreground:"#ececec"}}),R=new o.FitAddon,N(),H(),G(),K(),(()=>{const e=F.value;e&&X.observe(e)})()}),h(()=>{X?.disconnect()}),(e,t)=>(f(),x("div",{ref_key:"terminalRef",ref:F,class:"w-full box"},null,512))}}));e("T",C(H,[["__scopeId","data-v-378f7833"]]))}}});
