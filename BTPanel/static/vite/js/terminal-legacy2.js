System.register(["./xterm-legacy.js?v=1769066082311","./xterm-addon-canvas-legacy.js?v=1769066082311","./vue-legacy.js?v=1769066082311","./page_layout-legacy.js?v=1769066082311","./public-legacy.js?v=1769066082311"],function(e,t){"use strict";var a,o,s,n,i,d,r,c,l,u,p,m,v,g,h,x,f,_,w,b,y,A,S,O,C,T,M,j;return{setters:[e=>{a=e.a,o=e.b,s=e.c,n=e.x},e=>{i=e.x},e=>{d=e.r,r=e._,c=e.k,l=e.P,u=e.af,p=e.a0,m=e.w,v=e.ap,g=e.o,h=e.b,x=e.R,f=e.V,_=e.n},e=>{w=e.aE,b=e.i,y=e.a,A=e.x,S=e.e,O=e.dp,C=e.p},e=>{T=e.u,M=e.d,j=e.C}],execute:function(){var k=document.createElement("style");k.textContent="[data-v-bf60b128] .xterm{padding:12px!important}.box[data-v-bf60b128]{height:calc(100vh - 160px)}\n/*$vite$:1*/",document.head.appendChild(k);const{t:q}=b.global,{t:D}=(e("f",e=>w.post("/xterm?action=create_host",e,{requestOptions:{loading:q("Security.Api.Index_4"),successMessage:!0}})),e("h",e=>w.post("/xterm?action=get_host_find",e)),e("d",e=>w.post("/xterm?action=remove_host",e,{requestOptions:{loading:q("Security.Api.Index_3"),successMessage:!0}})),e("c",()=>w.post("/xterm?action=get_command_list")),e("a",e=>w.post("/xterm?action=create_command",e,{requestOptions:{loading:q("Security.Api.Index_4"),successMessage:!0}})),e("e",e=>w.post("/xterm?action=modify_command",e,{requestOptions:{loading:q("Crontab.Api.index_5"),successMessage:!0}})),e("b",e=>w.post("/xterm?action=remove_command",e,{requestOptions:{loading:q("Security.Api.Index_3"),successMessage:!0}})),e("t",e=>w.post("/xterm?action=test_ssh_connect",e,{requestOptions:{loading:q("Login.index_22"),successMessage:!0}})),b.global),E=e("o",e=>{T({title:e.title,width:600,footer:!0,data:e.data,component:r(()=>y(()=>t.import("./form-legacy9.js?v=1769066082311"),void 0))})}),{loading:I}=M();e("l",I);const L=e("s",d([])),R=e("g",async()=>{const{message:e}=await w.post("/xterm?action=get_host_list");A(e)&&(L.value=e)}),z=d("aaaaaaaaa"),P=d([{id:"aaaaaaaaa",host:"127.0.0.1",port:22,ps:D("Database.form.index_12"),state:!1}]),$=e=>{z.value=e},F=e=>{const t=S(9,"letter");P.value.push({id:t,host:e.host,port:e.port,ps:e.ps,state:!1}),setTimeout(()=>{$(t)},20)},B=(e,t)=>{const a=P.value.find(t=>t.id===e);a&&(a.state=t)},N=()=>{P.value=[{id:"aaaaaaaaa",host:"127.0.0.1",port:22,ps:D("Database.form.index_12"),state:!1}],z.value="aaaaaaaaa"},H=(e("u",()=>({activeTerminalId:z,terminals:P,setActiveTerminal:$,onServerList:F,onUpdateState:B,resetTerminals:N})),c({__name:"terminal",props:{data:{},active:{type:Boolean}},emits:["updateState","connectSuccess"],setup(e,{expose:t,emit:r}){const{t:c}=l(),w=e,{data:b}=w,{active:y}=u(w),A=r,S=O(),{isFull:C}=p(S),{ws:T,status:M,send:k,open:q,close:D}=j("/webssh",{get verifyData(){return{host:b.host,port:b.port,id:b.id,ps:b.ps,sort:0}},onMessage:(e,t)=>{const a=t.data;if(a.indexOf("Authentication timeout.")>-1)$.value=!0;else{if(!(-1===a.indexOf("127.0.0.1:")&&-1===a.indexOf("localhost:")||-1===a.indexOf("Password or private key cannot both be empty")&&-1===a.indexOf("Account or Password incorrect: Authentication failed")))return A("updateState",b.id,!1),D(),V(),void I();if("\\r\\nlogout\\r\\n"==a||"logout\\r\\n"==a||"\r\nlogout\r\n"==a||"logout\r\n"==a||a.search(/logout[\r\n]+$/)>-1)return A("updateState",b.id,!1),z.write("\r"+c("Component.Terminal.index_1")+"\r"),V(),void D()}A("connectSuccess",a)}}),I=()=>{E({title:c("Term.index_22"),data:{isEdit:!0,tips:!0,localhost:!0,onRefresh:()=>{b.host.includes("127.0.0.1")&&!b.host.includes("_22")&&(b.host=b.host.replace("127.0.0.1","127.0.0.1_22")),J()}}})};let z,P;const $=d(!1),F=d(null);let B=null;const N=()=>{const e=T.value;e&&(z.loadAddon(P),z.loadAddon(new i.CanvasAddon),z.loadAddon(new s.WebLinksAddon),B=new n.AttachAddon(e),z.loadAddon(B),setTimeout(()=>{P.fit();const e=F.value;e&&(W.value=`${e.clientHeight}px`)},100))};m([T,M],([e,t])=>{if("CLOSED"===t&&e)return A("updateState",b.id,!1),z.write("\r\n"+c("Component.Terminal.index_2")+"\r\n"),void setTimeout(()=>{q(),A("updateState",b.id,!0)},500);"OPEN"===t&&e&&(B&&B.dispose(),B=new n.AttachAddon(e),z.loadAddon(B),setTimeout(()=>{P.fit();const{cols:e,rows:t}=z;k({cols:e,rows:t,resize:1})},100))},{immediate:!1});const H=()=>{F.value&&z.open(F.value)};let U=!1;const V=()=>{U=!1},W=d(""),G=()=>{z.focus(),z.onData(e=>{const t=T.value;"\r"===e&&$.value&&($.value=!1,z.write("\r\n"),J()),void 0!==t||"\r"!==e||U||(U=!0,z.write("\r\n"+c("Component.Terminal.index_2")+"\r\n"),J())})},J=()=>{q(),G();const e=T.value;e&&(z.loadAddon(new n.AttachAddon(e)),A("updateState",b.id,!0))},K=()=>{_(()=>{if(P.fit(),"CLOSED"!==M.value){A("updateState",b.id,!0);const{cols:e,rows:t}=z;k({cols:e,rows:t,resize:1})}})};m(()=>C.value,e=>{const t=F.value;t&&!e&&(t.style.height=W.value)}),m(()=>S.command,e=>{e&&y.value&&(S.isRunCmd?(k("\v"),k(e+"\n")):k(e),S.setCommand(""))}),m(()=>y.value,e=>{e&&_(()=>{P.fit()})});let Q=!0;const X=new ResizeObserver(()=>{y.value&&v(()=>{Q?Q=!1:K()},200)()});return t({send:k}),g(async()=>{await(async()=>{await R(),L.value.some(e=>"127.0.0.1_22"===e.host)&&"127.0.0.1"===b.host&&(b.host="127.0.0.1_22")})(),z=new a.Terminal({cursorBlink:!0,fontSize:14,fontFamily:"Monaco, Menlo, Consolas, 'Courier New', monospace",theme:{background:"#333",foreground:"#ececec"}}),P=new o.FitAddon,N(),H(),G(),K(),(()=>{const e=F.value;e&&X.observe(e)})()}),h(()=>{X?.disconnect()}),(e,t)=>(f(),x("div",{ref_key:"terminalRef",ref:F,class:"w-full box"},null,512))}}));e("T",C(H,[["__scopeId","data-v-bf60b128"]]))}}});
