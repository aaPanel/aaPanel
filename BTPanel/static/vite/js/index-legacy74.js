System.register(["./index-legacy122.js?v=1747989938512","./index-legacy.js?v=1747989938512","./public-legacy.js?v=1747989938512","./index.vue_vue_type_script_setup_true_lang-legacy5.js?v=1747989938512","./vue-legacy.js?v=1747989938512","./page_layout-legacy.js?v=1747989938512","./index.vue_vue_type_script_setup_true_lang-legacy.js?v=1747989938512","./naive-legacy.js?v=1747989938512","./common-legacy.js?v=1747989938512","./__commonjsHelpers__-legacy.js?v=1747989938512","./index.vue_vue_type_script_setup_true_lang-legacy6.js?v=1747989938512"],(function(e,a){"use strict";var l,t,n,o,i,u,r,s,d,c,p,_,f,v,m,w,x,F,g,W,b,h,y,q,R,k,j,$,U,E,N,T,C,P,O,M,I,A,S,z,B,L,J,V,D,H,Y,G,K,Q;return{setters:[e=>{l=e._},e=>{t=e._},e=>{n=e.d,o=e.e,i=e.c,u=e.f,r=e.a,s=e.m,d=e.h,c=e._},e=>{p=e._},e=>{_=e.d,f=e.O,v=e.ae,m=e.r,w=e.R,x=e.S,F=e.U,g=e.P,W=e.V,b=e.e,h=e.a0,y=e.au,q=e.j,R=e.a1,k=e.a2,j=e.c,$=e.ao,U=e._},e=>{E=e.t,N=e.i,T=e.cT,C=e.p,P=e.m,O=e.cN,M=e.cU,I=e.N},e=>{A=e._},e=>{S=e.cp,z=e._,B=e.cv,L=e.bM,J=e.cj,V=e.co,D=e.cn,H=e.a2,Y=e.bY,G=e.c0,K=e.T,Q=e.cm},null,null,null],execute:function(){var a=document.createElement("style");a.textContent=".n-select[data-v-aba322fe] .n-base-selection-tag-wrapper{padding:0 0 3px}.form-title[data-v-8a3017c5]{margin-bottom:20px;font-size:16px}\n",document.head.appendChild(a);const X={class:"flex w-380px"},Z={class:"w-140px mr-12px"},ee={class:"flex-1"},ae=_({__name:"path",props:{url:{},urlModifiers:{},type:{},typeModifiers:{}},emits:["update:url","update:type"],setup(e){const{t:a}=f(),l=v(e,"url"),t=v(e,"type"),n=m([{label:a("Waf.Flow.Form.index_36"),value:"url"},{label:a("Waf.Flow.Form.index_37"),value:"all"}]),o=e=>{"all"===e&&(l.value="/")};return(e,a)=>{const i=S,u=z;return w(),x("div",X,[F("div",Z,[g(i,{value:t.value,"onUpdate:value":[a[0]||(a[0]=e=>t.value=e),o],options:W(n)},null,8,["value","options"])]),F("div",ee,[g(u,{value:l.value,"onUpdate:value":a[1]||(a[1]=e=>l.value=e),disabled:"all"===t.value,placeholder:e.$t("Waf.Flow.Form.index_35")},null,8,["value","disabled","placeholder"])])])}}}),le="allsite",te=C(_({__name:"site",props:{value:{},valueModifiers:{}},emits:["update:value"],setup(e){const a=v(e,"value"),l=T(),{t:t}=f(),{loading:o,setLoading:i}=n(),u=m([]),r=m([{label:t("Waf.Flow.Form.index_39"),value:le}]),s=b((()=>a.value===le)),d=({option:e,handleClose:a})=>{if(e.value!==le)return g(B,{class:"mr-6px",closable:!0,onClose:e=>{e.stopPropagation(),a()}},{default:()=>[e.label]})},c=e=>{s.value||(e.includes(le)?(a.value=le,u.value=r.value.map((e=>e.value))):e.length!==r.value.length-1?(a.value=e.filter((e=>e!==le)),u.value=e.filter((e=>e!==le))):e.length===r.value.length-1&&(a.value=le,u.value=r.value.map((e=>e.value)))),s.value&&(e.includes(le)?e.length!==r.value.length&&(a.value=e.filter((e=>e!==le)),u.value=e.filter((e=>e!==le))):(a.value=[],u.value=[]))};return(async()=>{try{i(!0),await l.getConfig(),r.value=Object.entries(l.config.sitemap).map((([e,a])=>({label:e,value:a}))),r.value.unshift({label:t("Waf.Flow.Form.index_39"),value:le}),a.value===le?u.value=r.value.map((e=>e.value)):L(a.value)&&(u.value=a.value)}finally{i(!1)}})(),(e,a)=>{const l=S;return w(),h(l,{loading:W(o),value:W(u),multiple:"",filterable:"",options:W(r),"max-tag-count":"responsive","consistent-menu-width":!1,"render-tag":d,placeholder:e.$t("Waf.Flow.Form.index_38"),"onUpdate:value":c},null,8,["loading","value","options","placeholder"])}}}),[["__scopeId","data-v-aba322fe"]]),ne={class:"p-24px"},oe={class:"form-title"},ie={class:"w-380px"},ue={class:"w-380px"},re={class:"form-title mt-8px"},se={class:"w-60px mx-8px"},de={class:"text-desc"},ce={class:"w-60px mx-8px"},pe={class:"text-desc"},_e={class:"w-60px mx-8px"},fe={class:"text-desc"},ve={class:"form-title mt-8px"},me={class:"w-380px"},we={class:"w-380px"},xe=_({__name:"index",props:{isEdit:{type:Boolean},row:{},refresh:{}},setup(e,{expose:a}){const l=e,{t:t}=f(),n=y("formRef"),o=q({name:"",server:[],types:"url",url:"",condition:1,secondReq:!0,secondReqNum:void 0,countReq:!1,countReqTime:void 0,countReqNum:void 0,action:"status_503",return:"html"}),i=m([{label:t("Waf.Flow.Form.index_16"),value:"status_403"},{label:t("Waf.Flow.Form.index_17"),value:"status_404"},{label:t("Waf.Flow.Form.index_18"),value:"status_502"},{label:t("Waf.Flow.Form.index_19"),value:"status_503"},{label:t("Waf.Flow.Form.index_20"),value:"content"},{label:t("Waf.Flow.Form.index_21"),value:"drop"}]),u=m([{label:t("Waf.Flow.Form.index_22"),value:"html"},{label:t("Waf.Flow.Form.index_23"),value:"json"},{label:t("Waf.Flow.Form.index_24"),value:"444"}]),r={name:{required:!0,trigger:["blur","input"],message:t("Waf.Flow.Form.index_3")},server:{trigger:["change"],validator:()=>!(o.server.length<=0)||new Error(t("Waf.Flow.Form.index_25"))},path:{trigger:["blur","input","change"],validator:()=>{if("url"===o.types){if(!o.url)return new Error(t("Waf.Flow.Form.index_26"));if("/"===o.url)return new Error(t("Waf.Flow.Form.index_27"));if(!o.url.startsWith("/"))return new Error(t("Waf.Flow.Form.index_28"))}return!0}},second:{trigger:["blur","input"],validator:()=>!(o.secondReq&&!o.secondReqNum)||new Error(t("Waf.Flow.Form.index_29"))},count:{trigger:["blur","input"],validator:()=>{if(o.countReq){if(!o.countReqTime)return new Error(t("Waf.Flow.Form.index_30"));if(o.countReqTime<30)return new Error(t("Waf.Flow.Form.index_31"));if(!o.countReqNum)return new Error(t("Waf.Flow.Form.index_32"));if(o.countReqNum<20)return new Error(t("Waf.Flow.Form.index_33"))}return!0}}};return(()=>{const{isEdit:e,row:a}=l;e&&a&&(o.name=a.name,o.server=Object.keys(a.site),o.types=a.types,o.url=a.url,o.condition=a.condition,o.secondReq=!!a.region.req,a.region.req&&(o.secondReqNum=a.region.req),o.countReq=!!a.region.count,a.region.count&&(o.countReqTime=a.region.count.time,o.countReqNum=a.region.count.count),o.action=a.action,"content"===a.action&&(o.return=a.return))})(),a({onConfirm:async()=>{if(await(n.value?.validate()),!1===o.secondReq&&!1===o.countReq)return P.error(t("Waf.Flow.Form.index_34"),{close:!0}),!1;const e={name:o.name,site:o.server.join(","),types:o.types,url:o.url,condition:o.condition,action:o.action,region:{...o.secondReq?{req:o.secondReqNum}:{},...o.countReq?{count:{time:o.countReqTime,count:o.countReqNum}}:{}},..."content"===o.action?{return:o.return}:{}},{row:a,isEdit:i}=l;var u;i&&a?await(u={...e,id:a.id},E.post("/btwaf/edit_user_limit.json",{data:JSON.stringify(u)},{requestOptions:{loading:N.global.t("Waf.Flow.API.index_2"),successMessage:!0}})):await(e=>E.post("/btwaf/add_user_limit.json",{data:JSON.stringify(e)},{requestOptions:{loading:N.global.t("Waf.Flow.API.index_1"),successMessage:!0}}))(e),l.refresh?.()}}),(e,a)=>{const l=z,t=J,s=V,d=D,c=H,p=Y,_=S,f=A;return w(),x("div",ne,[g(f,{ref_key:"formRef",ref:n,model:W(o),rules:r},{default:R((()=>[F("div",oe,k(e.$t("Waf.Flow.Form.index_1")),1),g(t,{label:e.$t("Waf.Flow.Form.index_2"),path:"name"},{default:R((()=>[F("div",ie,[g(l,{value:W(o).name,"onUpdate:value":a[0]||(a[0]=e=>W(o).name=e),placeholder:e.$t("Waf.Flow.Form.index_3")},null,8,["value","placeholder"])])])),_:1},8,["label"]),g(t,{label:e.$t("Waf.Flow.Form.index_4"),path:"server"},{default:R((()=>[F("div",ue,[g(te,{value:W(o).server,"onUpdate:value":a[1]||(a[1]=e=>W(o).server=e)},null,8,["value"])])])),_:1},8,["label"]),F("div",re,k(e.$t("Waf.Flow.Form.index_5")),1),g(t,{label:e.$t("Waf.Flow.Form.index_6"),path:"path"},{default:R((()=>[g(ae,{type:W(o).types,"onUpdate:type":a[2]||(a[2]=e=>W(o).types=e),url:W(o).url,"onUpdate:url":a[3]||(a[3]=e=>W(o).url=e)},null,8,["type","url"])])),_:1},8,["label"]),g(t,{label:e.$t("Waf.Flow.Form.index_7")},{default:R((()=>[g(d,{value:W(o).condition,"onUpdate:value":a[4]||(a[4]=e=>W(o).condition=e)},{default:R((()=>[g(s,{value:1},{default:R((()=>[j(k(e.$t("Waf.Flow.Form.index_8")),1)])),_:1}),g(s,{value:2},{default:R((()=>a[12]||(a[12]=[j("IP+UA")]))),_:1}),g(s,{value:3},{default:R((()=>[j(k(e.$t("Waf.Flow.Form.index_9")),1)])),_:1})])),_:1},8,["value"])])),_:1},8,["label"]),g(t,{label:" ",path:"second"},{default:R((()=>[g(c,{checked:W(o).secondReq,"onUpdate:checked":a[5]||(a[5]=e=>W(o).secondReq=e)},{default:R((()=>[j(k(e.$t("Waf.Flow.Form.index_10")),1)])),_:1},8,["checked"]),F("div",se,[g(p,{value:W(o).secondReqNum,"onUpdate:value":a[6]||(a[6]=e=>W(o).secondReqNum=e),"show-button":!1,placeholder:""},null,8,["value"])]),F("div",de,k(e.$t("Public.Unit.Times")),1)])),_:1}),g(t,{label:" ",path:"count"},{default:R((()=>[g(c,{checked:W(o).countReq,"onUpdate:checked":a[7]||(a[7]=e=>W(o).countReq=e)},{default:R((()=>[j(k(e.$t("Waf.Flow.Form.index_11")),1)])),_:1},8,["checked"]),F("div",ce,[g(p,{value:W(o).countReqTime,"onUpdate:value":a[8]||(a[8]=e=>W(o).countReqTime=e),"show-button":!1,placeholder:""},null,8,["value"])]),F("div",pe,k(e.$t("Waf.Flow.Form.index_12")),1),F("div",_e,[g(p,{value:W(o).countReqNum,"onUpdate:value":a[9]||(a[9]=e=>W(o).countReqNum=e),"show-button":!1,placeholder:""},null,8,["value"])]),F("div",fe,k(e.$t("Public.Unit.Times")),1)])),_:1}),F("div",ve,k(e.$t("Waf.Flow.Form.index_13")),1),g(t,{label:e.$t("Waf.Flow.Form.index_14")},{default:R((()=>[F("div",me,[g(_,{value:W(o).action,"onUpdate:value":a[10]||(a[10]=e=>W(o).action=e),options:W(i)},null,8,["value","options"])])])),_:1},8,["label"]),"content"===W(o).action?(w(),h(t,{key:0,label:e.$t("Waf.Flow.Form.index_15")},{default:R((()=>[F("div",we,[g(_,{value:W(o).return,"onUpdate:value":a[11]||(a[11]=e=>W(o).return=e),options:W(u)},null,8,["value","options"])])])),_:1},8,["label"])):$("",!0)])),_:1},8,["model"])])}}}),Fe=C(xe,[["__scopeId","data-v-8a3017c5"]]),ge={class:"mr-8px"};e("default",_({__name:"index",setup(e){const{t:a}=f(),n=O(),{version:_}=U(n),v=m("9.6.0"),x=b((()=>M(_.value,v.value))),y=()=>{s("btwaf")},q=o(a("Waf.Flow.index_6"),{isEdit:!1,refresh:()=>A()}),$=()=>{q.data.row=null,q.data.isEdit=!1,q.title=a("Waf.Flow.index_6"),q.show=!0},{table:T,columns:C,setLoading:P}=i([{key:"name",title:a("Waf.Flow.index_8"),width:"12%",minWidth:160},{key:"site",title:a("Waf.Flow.index_9"),width:"16%",minWidth:200,render:e=>Object.keys(e.site).join(", ")},{key:"region",title:a("Waf.Flow.index_10"),minWidth:300,render:e=>{let l="";switch(e.condition){case 1:l=a("Waf.Flow.index_11");break;case 2:l=a("Waf.Flow.index_12");break;case 3:l=a("Waf.Flow.index_13")}const{region:t}=e;return t.req&&(l+=a("Waf.Flow.index_14",[t.req])),t.count&&t.count.count&&(t.req&&(l+=a("Waf.Flow.index_15")),l+=a("Waf.Flow.index_16",[t.count.time,t.count.count])),a("Waf.Flow.index_17",[l])}},{key:"action",title:a("Waf.Flow.index_18"),width:"16%",minWidth:260,render:e=>{let l="";switch(e.action){case"status_403":l=a("Waf.Flow.index_19");break;case"status_404":l=a("Waf.Flow.index_20");break;case"status_502":l=a("Waf.Flow.index_21");break;case"status_503":l=a("Waf.Flow.index_22");break;case"content":l=a("Waf.Flow.index_23");break;case"drop":l=a("Waf.Flow.index_24")}return l}},{key:"open",title:a("Waf.Flow.index_25"),width:"6%",minWidth:80,render:e=>g(G,{size:"small",value:e.open,onUpdateValue:async a=>{var l;await(l={id:e.id},E.post("/btwaf/set_user_limit.json",l,{requestOptions:{loading:N.global.t("Waf.Flow.API.index_3"),successMessage:!0}})),e.open=a}},null)},u({width:100,options:e=>[{label:a("Public.Btn.Edit"),onClick:()=>{(e=>{q.data.row=e,q.data.isEdit=!0,q.title=a("Waf.Flow.index_7"),q.show=!0})(e)}},{label:a("Public.Btn.Del"),onClick:()=>{r({title:a("Waf.Flow.index_26"),content:a("Waf.Flow.index_27",[e.name]),onConfirm:async()=>{var a;await(a={id:e.id},E.post("/btwaf/del_user_limit.json",a,{requestOptions:{loading:N.global.t("Waf.Flow.API.index_4"),successMessage:!0}})),A()}})}}]})]),A=async()=>{try{P(!0);const{message:e}=await E.post("/btwaf/get_user_limit.json");T.data=I(e)?e:[]}finally{P(!1)}};return x.value&&A(),(e,a)=>{const n=K,o=d,i=p,u=c,r=t,s=Q,f=l;return w(),h(f,{install:W(x)},{desc:R((()=>[F("span",ge," The WAF is v"+k(W(_))+", please upgrade to the version above v"+k(W(v))+" to use ",1),g(n,{class:"px-8px h-24px",type:"primary",size:"small",onClick:y},{default:R((()=>a[1]||(a[1]=[j(" Upgrade ")]))),_:1})])),default:R((()=>[g(s,{class:"p-16px"},{default:R((()=>[g(i,null,{toolsLeft:R((()=>[g(n,{type:"primary",onClick:$},{default:R((()=>[j(k(e.$t("Waf.Flow.index_1")),1)])),_:1})])),table:R((()=>[g(o,{loading:W(T).loading,data:W(T).data,columns:W(C)},null,8,["loading","data","columns"])])),_:1}),g(u,{class:"mt-16px"},{default:R((()=>[F("li",null,k(e.$t("Waf.Flow.index_2")),1),F("li",null,k(e.$t("Waf.Flow.index_3")),1),F("li",null,k(e.$t("Waf.Flow.index_4")),1),F("li",null,k(e.$t("Waf.Flow.index_5")),1)])),_:1}),g(r,{show:W(q).show,"onUpdate:show":a[0]||(a[0]=e=>W(q).show=e),title:W(q).title,width:640,footer:!0,data:W(q).data,component:Fe},null,8,["show","title","data"])])),_:1})])),_:1},8,["install"])}}}))}}}));
