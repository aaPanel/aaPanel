import{d as e,_ as a}from"./public.js?v=1769066082311";import{_ as t}from"./index.vue_vue_type_script_setup_true_lang.js?v=1769066082311";import{u as s,v as r}from"./index57.js?v=1769066082311";import{k as l,a0 as o,c as p,P as n,r as d,e as i,R as u,V as _,W as y,a3 as c,an as f,U as h,j as v,a4 as w,F as m,a2 as g,S as k}from"./vue.js?v=1769066082311";import{t as b,h as x,j as A}from"./index222.js?v=1769066082311";import{dS as S,au as $,dU as j,e2 as F,db as P,dg as E,aC as I,dW as U}from"./naive.js?v=1769066082311";import"./page_layout.js?v=1769066082311";import"./common.js?v=1769066082311";import"./__commonjsHelpers__.js?v=1769066082311";import"./index.js?v=1769066082311";import"./index.vue_vue_type_script_setup_true_lang5.js?v=1769066082311";import"./index.vue_vue_type_script_setup_true_lang6.js?v=1769066082311";import"./index.vue_vue_type_script_setup_true_lang7.js?v=1769066082311";import"./index.vue_vue_type_script_setup_true_lang9.js?v=1769066082311";import"./index.vue_vue_type_script_setup_true_lang8.js?v=1769066082311";import"./index223.js?v=1769066082311";import"./xterm.js?v=1769066082311";import"./xterm-addon-canvas.js?v=1769066082311";const C={class:"p-20px"},H=["textContent"],q=l({__name:"index",props:{row:{type:Object,default:()=>({})},onRefresh:{type:Function,default:()=>{}}},setup(l,{expose:q}){const K=s(),{categoryList:R}=o(K),N=p(()=>R.value.filter(e=>""!==e.value)),{t:O}=n(),L=l,T=d(null),W=i({name:"",type:"api",group_id:0,url:"",key:"",host:"",port:22,ssh_type:"password",password:"",private_key:"",private_key_password:""}),J={name:{required:!0,message:O("Enter node name"),trigger:"blur"},url:[{required:!0,message:O("Panel address cannot be empty"),trigger:["blur","input"]},{validator:(e,a)=>{if(!a)return!0;W.url=W.url.trim();if(/^(https?):\/\/(?:(?:[\w-]+\.)+[a-zA-Z]{2,}|(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)|(?:\[(?:[0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|(?:[0-9a-fA-F]{1,4}:){1,7}:|(?:[0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|(?:[0-9a-fA-F]{1,4}:){1,5}(?::[0-9a-fA-F]{1,4}){1,2}|(?:[0-9a-fA-F]{1,4}:){1,4}(?::[0-9a-fA-F]{1,4}){1,3}|(?:[0-9a-fA-F]{1,4}:){1,3}(?::[0-9a-fA-F]{1,4}){1,4}|(?:[0-9a-fA-F]{1,4}:){1,2}(?::[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:(?::[0-9a-fA-F]{1,4}){1,6}|:(?::[0-9a-fA-F]{1,4}){1,7}|:(?::[0-9a-fA-F]{1,4}){1,6}:|(?:[0-9a-fA-F]{1,4}:){1,6}:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?))\])(?::\d{1,5})?(?:\/.*)?$/.test(W.url)){const e=new URL(W.url);return W.url=e.origin,!0}return new Error(O("Invalid panel address format"))},trigger:"blur"}],key:{required:!0,message:O("Enter API key"),trigger:"blur"},host:{required:!0,trigger:"blur",validator:(e,a)=>!a||(!!r(a)||new Error(O("Invalid IP address format")))},port:{required:!0,message:O("Enter SSH port"),trigger:"blur",type:"number"},password:{required:!0,message:O("Enter SSH password"),trigger:"blur"},private_key:{required:!0,message:O("Enter SSH key"),trigger:"blur"}},{loading:V,setLoading:z}=e(),B=async()=>{var e;try{z(!0),await(null==(e=T.value)?void 0:e.validate()),await b({host:W.host,port:W.port,test_case:1,pkey:"key"===W.ssh_type?W.private_key:"",pkey_passwd:"key"===W.ssh_type?W.private_key_password:"",password:"password"===W.ssh_type?W.password:""})}finally{z(!1)}},Z=()=>"api"===W.type?{remarks:W.name,address:W.url,api_key:W.key,category_id:W.group_id||0}:{remarks:W.name,ssh_conf:"password"===W.ssh_type?JSON.stringify({host:W.host,port:W.port,password:W.password}):JSON.stringify({host:W.host,port:W.port,pkey:W.private_key,pkey_passwd:W.private_key_password}),category_id:W.group_id||0};q({onConfirm:async()=>{var e;await(null==(e=T.value)?void 0:e.validate()),L.row&&L.row.id?await x({id:L.row.id,...Z()}):await A(Z()),L.onRefresh()}});return L.row&&L.row.id&&(W.name=L.row.remarks,W.type=Object.keys(L.row.ssh_conf).length>0?"ssh":"api",W.group_id=L.row.category_id,W.url=L.row.address,W.key=L.row.api_key,W.host=L.row.ssh_conf.host,W.port=L.row.ssh_conf.port,W.ssh_type=L.row.ssh_conf.password?"password":"key",W.password=L.row.ssh_conf.password,W.private_key=L.row.ssh_conf.pkey,W.private_key_password=L.row.ssh_conf.pkey_passwd),(e,s)=>{const r=$,l=S,o=F,p=j,n=E,d=P,i=I,b=U,x=t,A=a;return _(),u("div",C,[y(x,{ref_key:"formRef",ref:T,model:h(W),rules:J},{default:c(()=>[y(l,{label:e.$t("Node Name"),path:"name"},{default:c(()=>[y(r,{class:"w-350px!",value:h(W).name,"onUpdate:value":s[0]||(s[0]=e=>h(W).name=e),placeholder:e.$t("Enter node name")},null,8,["value","placeholder"])]),_:1},8,["label"]),y(l,{label:e.$t("Verification Type"),path:"type"},{default:c(()=>[y(p,{value:h(W).type,"onUpdate:value":s[1]||(s[1]=e=>h(W).type=e),type:"button"},{default:c(()=>[y(o,{value:"api"},{default:c(()=>[v(w(e.$t("API Key")),1)]),_:1}),y(o,{value:"ssh"},{default:c(()=>s[11]||(s[11]=[v("SSH",-1)])),_:1,__:[11]})]),_:1},8,["value"])]),_:1},8,["label"]),"api"===h(W).type?(_(),u(m,{key:0},[y(l,{label:e.$t("Panel Address"),path:"url"},{default:c(()=>[y(r,{class:"w-350px!",value:h(W).url,"onUpdate:value":s[2]||(s[2]=e=>h(W).url=e),placeholder:"Example: http://192.168.1.1:88 or https://domain.com:88"},null,8,["value"])]),_:1},8,["label"]),y(l,{label:e.$t("API Key"),path:"key"},{default:c(()=>[y(r,{class:"w-350px!",value:h(W).key,"onUpdate:value":s[3]||(s[3]=e=>h(W).key=e),placeholder:e.$t("Enter API key")},null,8,["value","placeholder"])]),_:1},8,["label"])],64)):f("",!0),"ssh"===h(W).type?(_(),u(m,{key:1},[y(d,{class:"flex-nowrap!"},{default:c(()=>[y(l,{label:e.$t("Node IP"),path:"host"},{default:c(()=>[y(r,{class:"w-240px!",value:h(W).host,"onUpdate:value":s[4]||(s[4]=e=>h(W).host=e),placeholder:e.$t("Example:192.168.1.1")},null,8,["value","placeholder"])]),_:1},8,["label"]),y(l,{label:e.$t("SSH port"),path:"port"},{default:c(()=>[y(n,{class:"w-98px!",value:h(W).port,"onUpdate:value":s[5]||(s[5]=e=>h(W).port=e),"show-button":!1,placeholder:e.$t("SSH port")},null,8,["value","placeholder"])]),_:1},8,["label"])]),_:1}),y(l,{label:e.$t("Authentication"),path:"ssh_type"},{default:c(()=>[y(p,{value:h(W).ssh_type,"onUpdate:value":s[6]||(s[6]=e=>h(W).ssh_type=e),type:"button"},{default:c(()=>[y(o,{value:"password"},{default:c(()=>[v(w(e.$t("Password")),1)]),_:1}),y(o,{value:"key"},{default:c(()=>[v(w(e.$t("Key")),1)]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),"password"===h(W).ssh_type?(_(),g(l,{key:0,label:e.$t("SSH Password"),path:"password"},{default:c(()=>[y(d,{class:"flex-nowrap! items-center"},{default:c(()=>[y(r,{class:"w-220px!",value:h(W).password,"onUpdate:value":s[7]||(s[7]=e=>h(W).password=e),type:"password","show-password-on":"click",placeholder:e.$t("Example:123456")},null,8,["value","placeholder"]),y(i,{onClick:B,loading:h(V)},{default:c(()=>[v(w(e.$t("Test connection")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["label"])):f("",!0),"key"===h(W).ssh_type?(_(),u(m,{key:1},[y(l,{label:e.$t("SSH Key"),path:"private_key"},{default:c(()=>[y(d,{class:"flex-nowrap! items-center"},{default:c(()=>[y(r,{class:"w-220px!",value:h(W).private_key,"onUpdate:value":s[8]||(s[8]=e=>h(W).private_key=e),type:"textarea",placeholder:e.$t("Enter private key content")},null,8,["value","placeholder"]),y(i,{onClick:B,loading:h(V)},{default:c(()=>[v(w(e.$t("Test connection")),1)]),_:1},8,["loading"])]),_:1})]),_:1},8,["label"]),y(l,{label:e.$t("SSH Key Password")},{default:c(()=>[y(d,{class:"flex-nowrap! items-center"},{default:c(()=>[y(r,{class:"w-350px!",value:h(W).private_key_password,"onUpdate:value":s[9]||(s[9]=e=>h(W).private_key_password=e),type:"password","show-password-on":"click",placeholder:e.$t("Please leave blank if no password is provided")},null,8,["value","placeholder"])]),_:1})]),_:1},8,["label"])],64)):f("",!0)],64)):f("",!0),y(l,{label:e.$t("Category"),path:"group_id"},{default:c(()=>[y(b,{class:"w-350px!",value:h(W).group_id,"onUpdate:value":s[10]||(s[10]=e=>h(W).group_id=e),options:h(N),placeholder:e.$t("Select Category")},null,8,["value","options","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"]),y(A,null,{default:c(()=>["api"===h(W).type?(_(),u(m,{key:0},[s[12]||(s[12]=k("li",null,"Step 1: Fill in the panel URL address, example: https://192.168.1.2:8888",-1)),s[13]||(s[13]=k("li",null,"Step 2: Open the panel, go to the [Panel Settings] page, click [Advanced Features]",-1)),s[14]||(s[14]=k("li",{class:"color-error"},"Step 3: Configure the [IP Whitelist]. Enter your computer's public fixed IP. If you don't have a fixed IP, please fill in an asterisk (*) ",-1)),k("li",null,w(e.$t("Step 4: Copy [API secret key] in the [API Configuration] window")),1),k("li",null,w(e.$t("Step 5: Back to the node management window, paste it into the [API Key] input box")),1)],64)):f("",!0),"ssh"===h(W).type?(_(),u(m,{key:1},[k("li",null,w(e.$t("Enter root account information")),1),k("li",{class:"color-warning",textContent:w(e.$t("The current authentication method does not support file transfer functionality"))},null,8,H)],64)):f("",!0)]),_:1})])}}});export{q as default};
