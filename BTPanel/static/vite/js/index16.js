import{S as e}from"./index113.js?v=1769066082311";import{_ as a}from"./index.js?v=1769066082311";import{_ as t}from"./index.vue_vue_type_script_setup_true_lang5.js?v=1769066082311";import{_ as l}from"./index.vue_vue_type_script_setup_true_lang7.js?v=1769066082311";import{d as s,e as n,c as i,f as u,r as o,a as r,h as d,u as p}from"./public.js?v=1769066082311";import{_}from"./index.vue_vue_type_script_setup_true_lang8.js?v=1769066082311";import{aE as m,T as c,aK as f,x as v,t as g,d as h,aL as y,p as x}from"./page_layout.js?v=1769066082311";import{h as b,e as w,s as S}from"./alarm.js?v=1769066082311";import{_ as j}from"./index.vue_vue_type_script_setup_true_lang.js?v=1769066082311";import{_ as k}from"./index.vue_vue_type_script_setup_true_lang10.js?v=1769066082311";import{k as P,P as C,r as U,e as R,a2 as $,V as q,a3 as T,W as A,U as M,j as z,a4 as L,S as V,R as B,o as N}from"./vue.js?v=1769066082311";import{dS as F,dk as D,dU as E,dV as H,av as I,dg as K,d_ as O,aC as W,db as G,di as J,dT as Q}from"./naive.js?v=1769066082311";import{_ as X}from"./index109.js?v=1769066082311";import{a as Y}from"./soft.js?v=1769066082311";import"./common.js?v=1769066082311";import"./__commonjsHelpers__.js?v=1769066082311";import"./index.vue_vue_type_script_setup_true_lang6.js?v=1769066082311";import"./site.js?v=1769066082311";const Z={class:"w-250px"},ee=P({__name:"service-daemon",props:{name:{default:"nginx"},onRefresh:{type:Function,default:()=>{}}},setup(e,{expose:a}){const t=e,{name:l,onRefresh:s}=t,{t:n}=C(),i=U(null),u=R({status:!0,day_num:3,interval:600,method:[],count:1,id:null,title:null}),o={day_num:{trigger:"input",type:"number",required:!0,message:n("Config.Alarm.index_22")},interval:{trigger:"input",type:"number",required:!0,message:n("Config.Alarm.index_23")},method:{trigger:"change",type:"array",required:!0,message:n("Config.Safe.index_7")}},r=e=>({template_id:"5",status:e?u.status?1:0:null,task_id:e?u.id:null,title:e?u.title:null,task_data:{task_data:{tid:"5",type:"services",title:"Service Stop Alert",status:u.status,count:u.count,interval:u.interval,project:l,help:600},sender:u.method,number_rule:{day_num:u.day_num,total:0},time_rule:{send_interval:0,time_range:[]}}}),d=U(!1);return(async()=>{try{d.value=!0;const{message:e}=await w({keyword:l});v(e)&&e.length&&(u.id=e[0].id,u.title=e[0].title,u.status=e[0].status,u.method=e[0].sender,u.count=e[0].task_data.count,u.day_num=e[0].number_rule.day_num,u.interval=e[0].task_data.interval)}finally{d.value=!1}})(),a({onConfirm:async()=>{var e;await(null==(e=i.value)?void 0:e.validate()),u.id?await f(r(!0)):await b(r(!1)),s()}}),(e,a)=>{const t=D,l=F,s=H,n=E,r=K,p=O,_=I,m=k,f=j,v=c;return q(),$(v,{show:M(d),class:"p-20px pt-28px pb-8px"},{default:T(()=>[A(f,{ref_key:"formRef",ref:i,model:M(u),rules:o},{default:T(()=>[A(l,{label:e.$t("Mail.Setting.index_51")},{default:T(()=>[A(t,{value:M(u).status,"onUpdate:value":a[0]||(a[0]=e=>M(u).status=e)},null,8,["value"])]),_:1},8,["label"]),A(l,{label:e.$t("Plugin.Mysql.index_4")},{default:T(()=>[A(n,{value:M(u).count,"onUpdate:value":a[1]||(a[1]=e=>M(u).count=e)},{default:T(()=>[A(s,{value:1},{default:T(()=>[z(L(e.$t("Config.Panel.index_83_1")),1)]),_:1}),A(s,{value:2},{default:T(()=>[z(L(e.$t("Config.Panel.index_83_2")),1)]),_:1})]),_:1},8,["value"])]),_:1},8,["label"]),A(l,{label:e.$t("Plugin.Mysql.index_29"),path:"interval"},{default:T(()=>[A(_,null,{default:T(()=>[A(r,{value:M(u).interval,"onUpdate:value":a[2]||(a[2]=e=>M(u).interval=e),class:"w-100px",min:0,"show-button":!1,placeholder:""},null,8,["value"]),A(p,{class:"min-w-52px text-center"},{default:T(()=>[z(L(e.$t("Public.Unit.Seconds")),1)]),_:1})]),_:1})]),_:1},8,["label"]),A(l,{label:e.$t("Config.Alarm.index_28"),path:"day_num"},{default:T(()=>[A(_,null,{default:T(()=>[A(r,{value:M(u).day_num,"onUpdate:value":a[3]||(a[3]=e=>M(u).day_num=e),class:"w-100px",min:0,"show-button":!1,placeholder:""},null,8,["value"]),A(p,{class:"min-w-52px text-center"},{default:T(()=>[z(L(e.$t("Public.Unit.Times")),1)]),_:1})]),_:1})]),_:1},8,["label"]),A(l,{label:e.$t("Config.Safe.index_6"),path:"method"},{default:T(()=>[V("div",Z,[A(m,{value:M(u).method,"onUpdate:value":a[4]||(a[4]=e=>M(u).method=e)},null,8,["value"])])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["show"])}}}),ae={class:"p-16px h-400px"},te=P({__name:"service-log",props:{data:{}},setup(e){const a=e,{loading:t,setLoading:l}=s(),n=U("None"),i=async()=>{if(a.data.path)try{l(!0);const{message:e}=await g({path:a.data.path});h(e)&&(n.value=e.data?e.data:"None")}finally{l(!1)}};return(e,a)=>{const l=W,s=X;return q(),B("div",ae,[A(l,{class:"mb-8px",type:"primary",onClick:i},{default:T(()=>[z(L(e.$t("Public.Btn.Refresh")),1)]),_:1}),A(s,{loading:M(t),log:M(n)},null,8,["loading","log"])])}}}),le=P({__name:"service-table",setup(e){const{t:s}=C(),c=n(s("Ftp.Table.index_15")),f=R({p:1,limit:10,search:""}),{table:v,columns:g}=i([{key:"title",title:s("Mail.Setting.index_31")},{key:"alarm",align:"center",title:()=>A(G,{class:"items-center justify-center!",size:3},{default:()=>[A("span",null,[s("Layout.Sider.monitor_1")]),A(J,{trigger:"hover"},{trigger:()=>A("i",{class:"i-uiw:question-circle-o text-16px text-#9DA1A6 cursor-pointer"},null),default:()=>A("span",null,[s("Once monitoring is enabled, if the service stops, alerts will be sent using the alerting method you selected")])})]}),render:e=>e.alarm?A(D,{value:e.alarm.alarm_status,size:"small","onUpdate:value":async a=>{a?p({title:s("Plugin.Mysql.index_3"),width:480,footer:!0,confirmText:s("Public.Btn.Save"),data:{name:e.name,onRefresh:w},component:ee}):(await S({task_id:e.alarm.alarm_id,status:0}),e.alarm.alarm_status=!1)}},null):"--"},{key:"version",title:s("Site.TableRow.index_3")},{key:"status",title:s("Public.Table.Status"),render:e=>A(o,{value:e.status,checkedValue:!0,onClick:async()=>{x(e.name,e.status?s("Public.Status.Stop"):s("Public.Status.Start"),e.status?"stop":"start")}},null)},u({width:200,options:e=>[{label:s("Public.Status.Restart"),onClick:async()=>{x(e.name,s("Public.Status.Restart"),"restart")}},{label:s("SSL.index_58"),show:"ssh"!==e.name,onClick:()=>{Y({...e,name:e.shop_name})}},{label:"View log",show:!1,onClick:()=>{c.data=e,c.show=!0}}]})]),x=(e,a,t)=>{const l=s("Plugin.Mysql.index_5",[a,e]);r({title:s("Node.index_65"),content:l,onConfirm:async()=>{await y({name:e,type:t}),w()}})},b=()=>{f.p=1,w()},w=async()=>{try{v.loading=!0;const{message:a}=await(e=f,m.post("/config?action=get_alarm_services",e));h(a)&&(v.data=a.data,v.total=a.total)}finally{v.loading=!1}var e};return N(()=>{w()}),(e,s)=>{const n=W,i=_,u=d,o=l,r=t,p=a;return q(),B("div",null,[A(r,null,{toolsLeft:T(()=>[A(n,{type:"primary",onClick:w},{default:T(()=>[z(L(e.$t("Public.Btn.Refresh")),1)]),_:1})]),toolsRight:T(()=>[A(i,{value:M(f).search,"onUpdate:value":s[0]||(s[0]=e=>M(f).search=e),placeholder:e.$t("Please enter the service name"),onSearch:b},null,8,["value","placeholder"])]),table:T(()=>[A(u,{loading:M(v).loading,data:M(v).data,columns:M(g)},null,8,["loading","data","columns"])]),pageRight:T(()=>[A(o,{page:M(f).p,"onUpdate:page":s[1]||(s[1]=e=>M(f).p=e),"page-size":M(f).limit,"onUpdate:pageSize":s[2]||(s[2]=e=>M(f).limit=e),"item-count":M(v).total,"store-key":"config-service",onRefresh:w},null,8,["page","page-size","item-count"])]),_:1}),A(p,{show:M(c).show,"onUpdate:show":s[3]||(s[3]=e=>M(c).show=e),title:M(c).title,data:M(c).data,width:700,height:450,footer:!1,component:te},null,8,["show","title","data"])])}}}),se=x(P({__name:"index",setup:a=>(a,t)=>{const l=Q;return q(),$(l,{class:"p-16px"},{default:T(()=>[A(e,null,{default:T(()=>[z(L(a.$t("Service Status")),1)]),_:1}),A(le)]),_:1})}}),[["__scopeId","data-v-f83d166b"]]);export{se as default};
