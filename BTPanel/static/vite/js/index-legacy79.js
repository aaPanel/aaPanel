System.register(["./page_layout-legacy.js?v=1752142539265","./public-legacy.js?v=1752142539265","./tools-legacy2.js?v=1752142539265","./vue-legacy.js?v=1752142539265","./naive-legacy.js?v=1752142539265","./rules-legacy.js?v=1752142539265","./index.vue_vue_type_script_setup_true_lang-legacy4.js?v=1752142539265","./index.vue_vue_type_script_setup_true_lang-legacy5.js?v=1752142539265","./index.vue_vue_type_script_setup_true_lang-legacy.js?v=1752142539265","./index-legacy100.js?v=1752142539265","./index.vue_vue_type_script_setup_true_lang-legacy15.js?v=1752142539265","./common-legacy.js?v=1752142539265"],(function(e,t){"use strict";var a,l,i,n,d,o,r,s,u,p,c,_,y,v,m,f,g,b,x,h,w,W,R,k,$,C,j,M,D,U,S,z,B,P,I,L,O,E,F,H,T,A,G,Q,X,q,N,V,Y,J,K,Z,ee,te,ae,le,ie,ne,de,oe,re,se,ue,pe,ce,_e,ye;return{setters:[e=>{a=e.v,l=e.i,i=e.ab,n=e.j,d=e.a,o=e.d5,r=e.w,s=e.T,u=e.d,p=e.x,c=e.X,_=e.e,y=e.cd,v=e.cQ,m=e.f},e=>{f=e.b,g=e.h,b=e.u,x=e.f,h=e.d,w=e.c},e=>{W=e.a,R=e.s},e=>{k=e.k,$=e.P,C=e.Q,j=e._,M=e.a1,D=e.X,U=e.W,S=e.aa,z=e.r,B=e.e,P=e.U,I=e.a2,L=e.l,O=e.V,E=e.a3,F=e.v,H=e.j,T=e.F,A=e.t,G=e.aB,Q=e.y,X=e.ac,q=e.O,N=e.ah,V=e.x,Y=e.c},e=>{J=e.by,K=e.cz,Z=e.cD,ee=e.ay,te=e.B,ae=e.cG,le=e.cB,ie=e.cN,ne=e.cA,de=e.cx,oe=e.cy},e=>{re=e.n},e=>{se=e._},e=>{ue=e._},e=>{pe=e._},e=>{ce=e._},e=>{_e=e._},e=>{ye=e.m}],execute:function(){var ve=document.createElement("style");ve.textContent=".rank-table[data-v-9bacc249]{--n-merged-border-color: transparent;height:100%}.rank-table[data-v-9bacc249] .n-data-table-thead{display:none}.bt-radio[data-v-9ee89472] .n-radio-button:last-child{border-right:none;border-top-right-radius:0;border-bottom-right-radius:0}.bt-date-picker[data-v-9ee89472]{width:220px}.bt-date-picker[data-v-9ee89472] .n-input{border-top-left-radius:0;border-bottom-left-radius:0}.report-tabs[data-v-0329e270]{--n-tab-gap: 0;--n-tab-padding: 14px 24px;--n-tab-font-size: 14px;--n-pane-padding-top: 16px;--n-pane-padding-left: 16px;--n-pane-padding-right: 16px;--n-pane-padding-bottom: 16px}.report-card[data-v-0329e270]{--n-title-font-size: 14px}.report-card[data-v-0329e270] .n-card-header{min-height:50px}\n/*$vite$:1*/",document.head.appendChild(ve);const me=e("g",(e=>a.post("/plugin?action=a&name=btwaf&s=get_id_log",e,{requestOptions:{loading:l.global.t("Waf.Api.report_1")}}))),fe=k({__name:"index",props:{data:{default:()=>[]},total:{default:0},loading:{type:Boolean,default:!1}},setup(e){const a=e,{t:l}=$(),o=i(),{columns:r}=f([{key:"ip",title:l("Waf.Report.index_7"),ellipsis:{tooltip:!0}},{key:"address",title:l("Waf.Report.index_8"),ellipsis:{tooltip:!0}},{key:"num",title:l("Waf.Report.index_9"),width:"14%",minWidth:120},{key:"num",title:l("Waf.Report.index_10"),width:"32%",minWidth:160,render:e=>{const{total:t}=a,l=n((100*(t?e.num/t:0)).toFixed(1));return C("div",{class:"w-90%"},[C(J,{type:"line","indicator-placement":"outside",height:16,"border-radius":2,percentage:l,color:o.value.successColor},null)])}},g({width:120,options:e=>[{label:l("Waf.Report.index_11"),onClick:()=>{W(e)}},{label:l("Public.Btn.Details"),onClick:()=>{b({title:l("Waf.Report.index_12",[e.ip]),width:950,minHeight:672,data:{row:e},component:j((()=>d((()=>t.import("./details-legacy2.js?v=1752142539265")),void 0)))})}}]})]);return(e,t)=>{const a=x;return D(),M(a,{loading:e.loading,data:e.data,columns:U(r)},null,8,["loading","data","columns"])}}}),ge=k({__name:"index",props:{data:{default:()=>[]},total:{default:0},loading:{type:Boolean,default:!1}},setup(e){const a=e,l=i(),{t:o}=$(),{columns:r}=f([{key:"uri",title:"URI",ellipsis:{tooltip:!0}},{key:"num",title:o("Waf.Report.index_9"),width:"20%"},{key:"num",title:o("Waf.Report.index_10"),render:e=>{const{total:t}=a,i=n((100*(t?e.num/t:0)).toFixed(1));return C("div",{class:"w-90%"},[C(J,{type:"line","indicator-placement":"outside",height:16,"border-radius":2,percentage:i,color:l.value.successColor},null)])}},g({width:120,options:e=>[{label:o("Waf.Report.index_11"),onClick:()=>{s(e)}},{label:o("Public.Btn.Details"),onClick:()=>{u(e)}}]})]),s=e=>{h({title:o("Waf.Report.index_19"),content:()=>C(S,{tag:"div",keypath:"Waf.Report.index_33",scope:"global"},{index_1:()=>C("span",{class:"text-error"},[e.uri])}),onConfirm:async()=>{await re({url_rule:e.uri})}})},u=e=>{b({title:o("Waf.Report.index_20",[e.uri]),width:950,minHeight:600,data:{uri:e.uri,list:e.list},component:j((()=>d((()=>t.import("./details-legacy3.js?v=1752142539265")),void 0)))})};return(e,t)=>{const a=x;return D(),M(a,{loading:e.loading,data:e.data,columns:U(r)},null,8,["loading","data","columns"])}}}),be={class:"p-8px"},xe={class:"w-160px"},he={class:"min-w-160px mr-20px"},we={class:"text-desc"},We={class:"w-450px"},Re=k({__name:"index",setup(e){const{t:l}=$(),i=z(null),n=B({p:1,limit:10,site:"all",type:"1",search:"",time:null}),_={search:{trigger:["input","blur"],validator:()=>"4"===n.type||""!==n.search.trim()||new Error(l("Waf.Report.index_28"))},time:{trigger:["change"],validator:()=>"4"!==n.type||null!==n.time||new Error(l("Waf.Report.index_29"))}},y=z([{label:l("Waf.Report.index_30"),value:"all"}]),v=[{label:"IP",value:"1"},{label:"URI",value:"2"},{label:"URL",value:"3"},{label:l("Waf.Report.index_31"),value:"4"}],{table:m,columns:h,setLoading:w}=f([{key:"time_localtime",title:l("Waf.Report.index_13"),width:"18%",minWidth:150},{key:"ip",title:l("Waf.Report.index_7"),width:"14%",minWidth:120},{key:"server_name",title:l("Waf.Report.index_14"),width:"14%",minWidth:120,ellipsis:{tooltip:!0}},{key:"uri",title:"URI",ellipsis:{tooltip:!0},minWidth:160,render:e=>o(e.uri)},{key:"filter_rule",title:l("Waf.Report.index_1"),width:"14%",minWidth:120,ellipsis:{tooltip:!0}},g({width:100,options:e=>[{label:l("Public.Btn.Details"),onClick:async()=>{const{message:t}=await me({id:e.id});r(t)&&t.length>0&&R(t[0])}},{label:"HTTP",onClick:()=>{W(e)}}]})]),W=e=>{b({title:l("Waf.Report.index_32",[e.time_localtime]),width:800,minHeight:458,data:{id:e.id},component:j((()=>d((()=>t.import("./http-legacy.js?v=1752142539265")),void 0)))})},k=async()=>{try{await(i.value?.validate()),w(!0);const{message:t}=await(e=(()=>{const{time:e}=n,t=e?c(e[0],"yyyy-MM-dd"):"",a=e?c(e[1],"yyyy-MM-dd"):"";return{..."all"===n.site?{is_all:1}:{server_name:n.site},..."4"===n.type?{start_time:t,end_time:a}:{serach:n.search},p:n.p,type:n.type}})(),a.post("/plugin?action=a&name=btwaf&s=get_search",e));u(t)&&(m.data=r(t.data)?t.data:[],m.total=p(t.page))}finally{w(!1)}var e};return(async()=>{try{const{message:e}=await a.post("/plugin?action=a&name=btwaf&s=get_server_name");r(e)&&(y.value=e.map((e=>({label:e,value:e}))))}finally{y.value.unshift({label:l("Waf.Report.index_30"),value:"all"})}})(),(e,t)=>{const a=Z,l=K,d=ce,o=s,r=ee,u=pe,p=x,c=ue,f=se;return D(),P("div",be,[C(u,{ref_key:"formRef",ref:i,model:U(n),rules:_},{default:I((()=>[C(l,{label:e.$t("Waf.Report.index_21")},{default:I((()=>[O("div",xe,[C(a,{value:U(n).site,"onUpdate:value":t[0]||(t[0]=e=>U(n).site=e),options:U(y)},null,8,["value","options"])])])),_:1},8,["label"]),C(l,{label:e.$t("Waf.Report.index_22")},{default:I((()=>[O("div",he,[C(a,{value:U(n).type,"onUpdate:value":t[1]||(t[1]=e=>U(n).type=e),options:v},null,8,["value"])]),O("div",null,[t[6]||(t[6]=O("span",{class:"mr-8px text-error"},"*",-1)),O("span",we,E(e.$t("Waf.Report.index_23")),1)])])),_:1},8,["label"]),L(C(l,{label:e.$t("Waf.Report.index_25"),path:"search"},{default:I((()=>[O("div",We,[C(d,{value:U(n).search,"onUpdate:value":t[2]||(t[2]=e=>U(n).search=e),rows:3},null,8,["value"])])])),_:1},8,["label"]),[[F,"4"!==U(n).type]]),L(C(l,{label:e.$t("Waf.Report.index_26"),path:"time"},{default:I((()=>[C(o,{value:U(n).time,"onUpdate:value":t[3]||(t[3]=e=>U(n).time=e),type:"daterange",clearable:""},null,8,["value"])])),_:1},8,["label"]),[[F,"4"===U(n).type]]),C(l,{label:" "},{default:I((()=>[C(r,{type:"primary",onClick:k},{default:I((()=>[H(E(e.$t("Waf.Report.index_27")),1)])),_:1})])),_:1})])),_:1},8,["model"]),C(f,null,{table:I((()=>[C(p,{loading:U(m).loading,data:U(m).data,columns:U(h)},null,8,["loading","data","columns"])])),pageRight:I((()=>[C(c,{page:U(n).p,"onUpdate:page":t[4]||(t[4]=e=>U(n).p=e),"page-size":U(n).limit,"onUpdate:pageSize":t[5]||(t[5]=e=>U(n).limit=e),"display-order":["pages"],"item-count":U(m).total,onRefresh:k},null,8,["page","page-size","item-count"])])),_:1})])}}}),ke={class:"h-full p-10px"},$e=k({__name:"index",props:{loading:{type:Boolean,default:!1},data:{default:()=>[]}},setup(e){const{columns:t}=f([{key:"ip",title:"",align:"center",render:e=>C(T,null,[C("a",{class:"bt-link",href:"javascript:;",onClick:()=>{W(e)}},[e.ip]),C("span",{class:"mx-6px"},[e.address]),C("span",null,[H("("),e.num,H(")")])])}]);return(e,a)=>{const l=x;return D(),P("div",ke,[C(l,{class:"rank-table",loading:e.loading,data:e.data,"flex-height":!0,bordered:!1,"single-line":!1,"single-column":!1,columns:U(t)},null,8,["loading","data","columns"])])}}}),Ce=_($e,[["__scopeId","data-v-9bacc249"]]),je={class:"flex-center h-full p-10px"},Me=k({__name:"index",props:{data:{default:()=>[]}},setup(e){const t=A(e,"data"),{t:a}=$(),l=z(!1),i=G({backgroundColor:"#fff",title:d(),tooltip:{trigger:"item",confine:!0,formatter(e){const t=e;return`${t.marker} ${t.name}: ${t.value} (${t.percent}%)`}},series:o()}),n=["#6ec71e","#4885FF","#fc8b40","#818af8","#31c9d7","#f35e7a","#ab7aee","#14d68b","#cde5ff"];function d(e=0){return{text:a("Waf.Report.index_18"),textStyle:{color:"#484848",fontSize:17},subtext:`${e}`,subtextStyle:{color:"#717171",fontSize:15},itemGap:20,left:"center",top:"42%"}}function o(e=[]){return[{type:"pie",data:e,radius:["50%","60%"],center:["50%","50%"],clockwise:!0,avoidLabelOverlap:!0,label:{show:!0,position:"outside",color:"#999",lineHeight:18,formatter:e=>""!==e.name?0===e.percent?"":a("Waf.Overview.index_33",[e.name,e.value,e.percent]):""},labelLine:{length:30,length2:30,lineStyle:{width:1,color:"#CDCDCD"}},itemStyle:{labelLine:{length:30,length2:30,lineStyle:{width:1,color:"#CDCDCD"}},color:e=>n[e.dataIndex]},emphasis:{scaleSize:15}}]}return Q((()=>{t.value&&(l.value=!t.value.length,(()=>{let e=0;const a=[];t.value.forEach((t=>{e+=t[1],a.push({name:t[0],value:t[1]})})),i.title=d(e),i.series=o(a)})())})),(e,t)=>{const a=te;return D(),P("div",je,[U(l)?(D(),M(a,{key:0})):(D(),M(_e,{key:1,type:"pie",height:"100%",option:U(i)},null,8,["option"]))])}}}),De={class:"flex"},Ue=_(k({__name:"date",props:{value:{default:"today"},valueModifiers:{}},emits:["update:value"],setup(e){const{t:t}=$(),a=z("today"),l=z(null),i=X(e,"value"),n=[{label:t("Public.Search.Yesterday"),value:"yesterday"},{label:t("Public.Search.Today"),value:"today"}],d=e=>{l.value=null,i.value=e},o=e=>{a.value=e?"":"today",i.value=r(e)?e:"today"};return Q((()=>{r(i.value)?(l.value=i.value,a.value=""):(a.value=i.value,l.value=null)})),(e,t)=>{const i=ae,r=le,u=s;return D(),P("div",De,[C(r,{value:U(a),"onUpdate:value":[t[0]||(t[0]=e=>N(a)?a.value=e:null),d],size:"small",class:"bt-radio"},{default:I((()=>[(D(),P(T,null,q(n,(e=>C(i,{key:e.value,value:e.value},{default:I((()=>[H(E(e.label),1)])),_:2},1032,["value"]))),64))])),_:1},8,["value"]),C(u,{value:U(l),"onUpdate:value":[t[1]||(t[1]=e=>N(l)?l.value=e:null),o],type:"daterange",size:"small",class:"bt-date-picker",clearable:!0},null,8,["value"])])}}}),[["__scopeId","data-v-9ee89472"]]),Se={class:"h-320px"},ze={class:"h-320px"},Be=_(k({__name:"index",setup(e){const{loading:t,setLoading:l}=w(),i=z("ip"),n=V({type:[],ip:[],ip_list:{},uri:[],uri_list:{}}),d=Y((()=>n.value.ip.map((e=>({ip:e[0],num:e[1],address:e[2],data:n.value.ip_list[e[0]]}))))),o=Y((()=>n.value.uri.map((e=>({uri:e[0],num:e[1],list:n.value.uri_list[e[0]].ip_list||[]}))))),r=Y((()=>{let e=0;return n.value.type.forEach((t=>{e+=t[1]})),e})),s=e=>{"search"!==e&&b()},p=()=>{b()},_=()=>{const e=v();if("today"===f.date)window.open(`${e}/btwaf/content_report.html`);else{const{start:t,end:a}=g();window.open(`${e}/btwaf/content_report.html?stime=${t}&etime=${a}`)}},f=B({date:"today"}),g=()=>{let e="",t="";if(m(f.date))switch(f.date){case"today":e=c(new Date,"yyyy-MM-dd"),t=c(new Date,"yyyy-MM-dd");break;case"yesterday":e=c(ye(new Date,-1),"yyyy-MM-dd"),t=c(ye(new Date,-1),"yyyy-MM-dd")}else e=c(new Date(f.date[0]),"yyyy-MM-dd"),t=c(new Date(f.date[1]),"yyyy-MM-dd");return{start:e,end:t}},b=async()=>{try{l(!0);const{message:t}=await(e=(()=>{const{start:e,end:t}=g();return{..."today"!==f.date?{start_time:e,end_time:t}:{}}})(),a.post("/plugin?action=a&name=btwaf&s=get_report",e));u(t)&&(n.value=t)}finally{l(!1)}var e};return b(),(e,a)=>{const l=ne,u=ie,c=ee,v=oe,m=de,g=y;return D(),M(g,{class:"report-grid","x-gap":"16"},{default:I((()=>[C(u,{span:"6"},{default:I((()=>[C(l,{class:"report-card mb-16px",title:e.$t("Waf.Report.index_1")},{default:I((()=>[O("div",Se,[C(Me,{data:U(n).type},null,8,["data"])])])),_:1},8,["title"]),C(l,{class:"report-card",title:e.$t("Waf.Report.index_2")},{default:I((()=>[O("div",ze,[C(Ce,{loading:U(t),data:U(d)},null,8,["loading","data"])])])),_:1},8,["title"])])),_:1}),C(u,{span:"18"},{default:I((()=>[C(l,{class:"h-full"},{default:I((()=>[C(m,{value:U(i),"onUpdate:value":[a[1]||(a[1]=e=>N(i)?i.value=e:null),s],type:"line",class:"report-tabs"},{prefix:I((()=>a[2]||(a[2]=[O("div",null,null,-1)]))),suffix:I((()=>[C(Ue,{value:U(f).date,"onUpdate:value":[a[0]||(a[0]=e=>U(f).date=e),p]},null,8,["value"]),C(c,{class:"ml-16px",type:"primary",size:"small",onClick:_},{default:I((()=>[H(E(e.$t("Waf.Report.index_3")),1)])),_:1}),a[3]||(a[3]=O("div",{class:"w-16px"},null,-1))])),default:I((()=>[C(v,{name:"ip",tab:e.$t("Waf.Report.index_4")},{default:I((()=>[C(fe,{loading:U(t),total:U(r),data:U(d)},null,8,["loading","total","data"])])),_:1},8,["tab"]),C(v,{name:"uri",tab:e.$t("Waf.Report.index_5")},{default:I((()=>[C(ge,{loading:U(t),total:U(r),data:U(o)},null,8,["loading","total","data"])])),_:1},8,["tab"]),C(v,{name:"search",tab:e.$t("Waf.Report.index_6")},{default:I((()=>[C(Re)])),_:1},8,["tab"])])),_:1},8,["value"])])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-0329e270"]]),Pe=Object.freeze(Object.defineProperty({__proto__:null,default:Be},Symbol.toStringTag,{value:"Module"}));e("i",Pe)}}}));
