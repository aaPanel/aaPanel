System.register(["./page_layout-legacy.js?v=1762424784323","./public-legacy.js?v=1762424784323","./naive-legacy.js?v=1762424784323","./vue-legacy.js?v=1762424784323","./common-legacy.js?v=1762424784323","./__commonjsHelpers__-legacy.js?v=1762424784323"],function(e,t){"use strict";var l,a,n,o,i,s,r,c,u,d,p,f,v,h,m,g,_,x,w,y,b,C,k,F,$,U,W,j,E,O,I,M,R,B,P,z,S,A,L,N,V,q,H,X;return{setters:[e=>{l=e.df,a=e.p,n=e.h,o=e.w,i=e._,s=e.m,r=e.gj,c=e.dh},e=>{u=e.i},e=>{d=e.aX,p=e.aC,f=e.dV,v=e.dR,h=e.dd,m=e.au,g=e.de,_=e.dW},e=>{x=e.k,w=e.ae,y=e.r,b=e.a2,C=e.V,k=e.a3,F=e.W,$=e.j,U=e.a4,W=e.s,j=e.U,E=e.P,O=e.c,I=e.R,M=e.F,R=e.l,B=e.S,P=e.v,z=e.ad,S=e.an,A=e.ay,L=e.O,N=e.aL,V=e.t,q=e.e,H=e.ak,X=e.n},null,null],execute:function(){var t=document.createElement("style");t.textContent=".seg[data-v-7ea28fa1]{width:1px;height:8px;margin:0 auto;border-left:1px solid #ccc}.tips[data-v-c8f1f83a]{position:absolute;top:32px;left:0;width:100%;padding-top:2px;padding-left:2px;color:#999}.rows[data-v-31e9f077]{display:flex}.rows .field[data-v-31e9f077]{width:140px;margin-right:8px}.rows .condition[data-v-31e9f077]{width:160px;margin-right:8px}.rows .content[data-v-31e9f077]{display:flex;flex:1;width:0;flex-shrink:0}.rows .rows-btn[data-v-31e9f077]{display:flex;align-items:center;margin-left:8px}.rows .rows-btn .close[data-v-31e9f077]{display:flex;align-items:center;justify-content:center;width:24px;height:32px;margin-left:8px;color:#666;cursor:pointer;transition:opacity .3s}.rows .rows-btn .close[data-v-31e9f077]:hover{opacity:.8}.rows.rows-tit>div[data-v-31e9f077]{padding-bottom:8px}.form-title[data-v-2a17c742]{margin-bottom:20px;font-size:16px}\n/*$vite$:1*/",document.head.appendChild(t);const D=x({__name:"site-select",props:{value:{},valueModifiers:{}},emits:["update:value"],setup(e){const t=w(e,"value"),a=l(),n=y([]),o=()=>{t.value=n.value.map(e=>e.value)},i=()=>{t.value=[]};return(async()=>{n.value=Object.entries(a.config.sitemap).map(([e,t])=>({label:e,value:t}))})(),(e,l)=>{const a=p,s=d,r=f;return C(),b(r,W(e.$attrs,{value:t.value,"onUpdate:value":l[0]||(l[0]=e=>t.value=e),multiple:"",filterable:"",options:j(n),"max-tag-count":"responsive","consistent-menu-width":!1,placeholder:e.$t("Waf.Custom.index_25")}),{header:k(()=>[F(s,{class:"w-full"},{default:k(()=>[F(a,{class:"flex-1",onClick:o},{default:k(()=>[$(U(e.$t("Public.All")),1)]),_:1}),F(a,{class:"flex-1",onClick:i},{default:k(()=>[$(U(e.$t("Public.Btn.Cancel")),1)]),_:1})]),_:1})]),_:1},16,["value","options","placeholder"])}}}),G={class:"w-320px"},J={class:"w-320px"},K=x({__name:"action",props:{action:{default:""},actionModifiers:{},response:{},responseModifiers:{}},emits:["update:action","update:response"],setup(e){const{t:t}=E(),a=l(),n=w(e,"action"),o=w(e,"response"),i=y([]),s=O(()=>{let e="";switch(n.value){case"deny":e=t("Waf.Custom.index_21");break;case"validate":e="验证方式"}return e}),r=O(()=>c(n.value).map(e=>({label:e.text,value:e.type,data:e}))),c=e=>{const t=a.config.action.filter(t=>t.type===e);return t.length>0?t[0].response:[]},u=e=>{const t=c(e);t.length>0?o.value=t[0].type:o.value=null};return i.value=a.config.action.map(e=>({label:e.text,value:e.type,data:e})),null===o.value&&u(n.value),(e,t)=>{const l=f,a=v;return C(),I(M,null,[F(a,{label:e.$t("Waf.Custom.index_20")},{default:k(()=>[B("div",G,[F(l,{value:n.value,"onUpdate:value":[t[0]||(t[0]=e=>n.value=e),u],options:j(i)},null,8,["value","options"])])]),_:1},8,["label"]),R(F(a,{label:j(s),"show-feedback":!1},{default:k(()=>[B("div",J,[F(l,{value:o.value,"onUpdate:value":t[1]||(t[1]=e=>o.value=e),options:j(r)},null,8,["value","options"])])]),_:1},8,["label"]),[[P,j(r).length>0]])],64)}}}),Q={class:"my-18px"},T=a({},[["render",function(e,t){const l=h;return C(),I("div",Q,[F(l,{class:"w-38px justify-center"},{default:k(()=>[$(U(e.$t("Waf.Custom.index_31")),1)]),_:1})])}]]),Y={class:"flex flex-center flex-col w-38px"},Z=a({},[["render",function(e,t){const l=h;return C(),I("div",Y,[t[0]||(t[0]=B("div",{class:"seg"},null,-1)),F(l,{class:"w-38px justify-center"},{default:k(()=>[$(U(e.$t("Waf.Custom.index_30")),1)]),_:1}),t[1]||(t[1]=B("div",{class:"seg"},null,-1))])}],["__scopeId","data-v-7ea28fa1"]]),ee={class:"relative flex items-center w-full h-full"},te={class:"tips"},le=a(x({__name:"content",props:z({condition:{default:null},factor:{},type:{default:"right"}},{input:{},inputModifiers:{},select:{default:()=>null},selectModifiers:{}}),emits:["update:input","update:select"],setup(e){const t=e,l=w(e,"input"),a=w(e,"select"),i=O(()=>null===t.condition),s=["in","not_in"],r=O(()=>{const{factor:e}=t;return"text"===e.widget.type}),c=["select","area_select","mult"],u=O(()=>{const{factor:e}=t;return c.includes(e.widget.type)}),v=O(()=>"left"!==t.type&&("mult"===t.factor.widget.type||s.includes(t.condition||""))),h=O(()=>{const{factor:e}=t,{widget:l}=e;return l.value.map(e=>({label:n(e)?e:e.label,value:n(e)?e:e.key}))}),g=()=>{a.value=h.value.map(e=>e.value)},_=()=>{a.value=[]},x=y(""),W=e=>{x.value=e},E=()=>{""!==x.value&&(o(a.value)?o(a.value)&&!a.value.includes(x.value)&&a.value.push(x.value):a.value=[x.value],x.value="")};return(e,t)=>{const n=m,o=f,s=p,c=d;return C(),I("div",ee,[j(r)?(C(),I(M,{key:0},[j(v)?(C(),b(o,{key:1,value:a.value,"onUpdate:value":t[1]||(t[1]=e=>a.value=e),tag:"",multiple:"",filterable:"","show-arrow":!1,show:!1,"max-tag-count":"responsive","consistent-menu-width":!1,placeholder:e.factor.widget.placeholder,onSearch:W,onBlur:E},null,8,["value","placeholder"])):(C(),b(n,{key:0,value:l.value,"onUpdate:value":t[0]||(t[0]=e=>l.value=e),spellcheck:"false",disabled:j(i),placeholder:e.factor.widget.placeholder},null,8,["value","disabled","placeholder"])),B("div",te,U(e.factor.widget.hint?`${e.factor.widget.hint}${j(v)?e.$t("Waf.Custom.index_29"):""}`:""),1)],64)):S("",!0),j(u)?(C(),b(o,{key:1,value:a.value,"onUpdate:value":t[2]||(t[2]=e=>a.value=e),options:j(h),disabled:j(i),filterable:!0,"consistent-menu-width":!1,multiple:j(v),"max-tag-count":"responsive",placeholder:e.factor.widget.placeholder},A({_:2},[j(v)?{name:"header",fn:k(()=>[F(c,{class:"w-full"},{default:k(()=>[F(s,{class:"flex-1",onClick:g},{default:k(()=>[$(U(e.$t("Public.All")),1)]),_:1}),F(s,{class:"flex-1",onClick:_},{default:k(()=>[$(U(e.$t("Public.Btn.Cancel")),1)]),_:1})]),_:1})]),key:"0"}:void 0]),1032,["value","options","disabled","multiple","placeholder"])):S("",!0)])}}}),[["__scopeId","data-v-c8f1f83a"]]),ae={class:"rows rows-tit"},ne={class:"field"},oe={class:"condition"},ie={class:"content"},se={class:"rows"},re={class:"field"},ce={class:"condition"},ue={class:"content"},de={key:0,class:"w-140px mr-8px"},pe={class:"flex-1 w-0"},fe={class:"rows-btn"},ve=["onClick"],he=x({__name:"index",props:z({isInit:{type:Boolean,default:!0}},{value:{default:()=>[]},valueModifiers:{}}),emits:["update:value"],setup(e,{expose:t}){const a=e,n=w(e,"value"),s=l(),r={type:"or",children:[]},c={input:"",select:null,show:!1,widget:{hint:"",placeholder:"",type:"text",value:[]}},u={type:"and",field:null,condition:null,conOptions:[],leftFactor:g(c),rightFactor:g(c)},d=["select","area_select"],v=["in","not_in"],h=O(()=>s.config.options.map(e=>({label:e.text,value:e.type,data:e}))),m=(e,t)=>(l,a)=>{const o=n.value[e].children[t],i=a.data;o.conOptions=i.operators.map(e=>({label:s.getOperatorName(e),value:e})),o.condition=i.operators[0]||null,o.leftFactor=g(c),o.rightFactor=g(c),i.left_factor_enabled&&(o.leftFactor.show=i.left_factor_enabled,o.leftFactor.widget=i.left_widget),i.right_factor_enabled&&(o.rightFactor.widget=i.right_widget,o.rightFactor.show=i.right_factor_enabled)},_=(e,t)=>l=>{const a=n.value[e].children[t],{rightFactor:i}=a,{widget:s}=i;if(d.includes(s.type)){if(null===i.select)return;v.includes(l||"")?i.select=o(i.select)?i.select:[i.select]:i.select=o(i.select)?i.select[0]:i.select}"text"===s.type&&(v.includes(l||"")&&""!==i.input&&(i.select=[i.input],i.input=""),null!==i.select&&(i.input=o(i.select)?i.select[0]:i.select))},x=O(()=>n.value.map(e=>e.children.length).reduce((e,t)=>e+t)>1),y=(e,t)=>t===n.value.length-1&&e===n.value[t].children.length-1,E=(e,t=0)=>{n.value[t].children.splice(e+1,0,g(u))},R=()=>{n.value.push(g(r)),E(0,n.value.length-1)},P=(e,t,l)=>"text"!==l.widget.type||v.includes(t)?"":e,z=(e,t,l)=>e&&e.includes(",")?e?e.split(","):[]:d.includes(l.widget.type)&&e||null;return a.isInit&&0===n.value.length&&R(),t({setRules:e=>{const t=[];e.children.forEach(e=>{const l=g(r);e.children.forEach(e=>{const{option:t}=e;if(!t)return;const a=g(u);a.field=t.type,a.condition=t.operator,((e,t)=>{const{options:l}=s.config;for(let a=0;a<l.length;a++)if(l[a].type===e){t(l[a]);break}})(t.type,e=>{if(e.left_factor_enabled){const l=t?.left_factor||"";a.leftFactor.show=e.left_factor_enabled,a.leftFactor.widget=e.left_widget,a.leftFactor.input=P(l,t.operator,a.leftFactor),a.leftFactor.select=z(l,t.operator,a.leftFactor)}if(e.right_factor_enabled){const l=t?.right_factor||"";a.rightFactor.show=e.right_factor_enabled,a.rightFactor.widget=e.right_widget,a.rightFactor.input=P(l,t.operator,a.rightFactor),a.rightFactor.select=z(l,t.operator,a.rightFactor)}a.conOptions=e.operators.map(e=>({label:s.getOperatorName(e),value:e}))}),l.children.push(a)}),t.push(l)}),t.length>0?n.value=t:R()}}),(e,t)=>{const l=f,a=p,o=i;return C(),I("div",null,[B("div",ae,[B("div",ne,U(e.$t("Waf.Custom.index_26")),1),B("div",oe,U(e.$t("Waf.Custom.index_27")),1),B("div",ie,U(e.$t("Waf.Custom.index_28")),1),t[0]||(t[0]=B("div",{class:"btn"},null,-1))]),(C(!0),I(M,null,L(n.value,(t,i)=>(C(),I("div",{key:`${i+1}`},[0!==i?(C(),b(T,{key:0})):S("",!0),(C(!0),I(M,null,L(t.children,(t,s)=>(C(),I("div",{key:`${s+1}`},[0!==s?(C(),b(Z,{key:0})):S("",!0),B("div",se,[B("div",re,[F(l,W({value:t.field,"onUpdate:value":e=>t.field=e,options:j(h),"consistent-menu-width":!1},N({"update:value":m(i,s)})),null,16,["value","onUpdate:value","options"])]),B("div",ce,[t.leftFactor.show?(C(),b(le,{key:0,input:t.leftFactor.input,"onUpdate:input":e=>t.leftFactor.input=e,select:t.leftFactor.select,"onUpdate:select":e=>t.leftFactor.select=e,type:"left",condition:t.condition,factor:t.leftFactor},null,8,["input","onUpdate:input","select","onUpdate:select","condition","factor"])):(C(),b(l,W({key:1,value:t.condition,"onUpdate:value":e=>t.condition=e,disabled:null===t.field,options:t.conOptions,"consistent-menu-width":!1},N({"update:value":_(i,s)})),null,16,["value","onUpdate:value","disabled","options"]))]),B("div",ue,[t.leftFactor.show?(C(),I("div",de,[F(l,W({value:t.condition,"onUpdate:value":e=>t.condition=e,disabled:null===t.field,options:t.conOptions,"consistent-menu-width":!1},N({"update:value":_(i,s)})),null,16,["value","onUpdate:value","disabled","options"])])):S("",!0),B("div",pe,[F(le,{input:t.rightFactor.input,"onUpdate:input":e=>t.rightFactor.input=e,select:t.rightFactor.select,"onUpdate:select":e=>t.rightFactor.select=e,type:"right",condition:t.condition,factor:t.rightFactor},null,8,["input","onUpdate:input","select","onUpdate:select","condition","factor"])])]),B("div",fe,[F(a,{onClick:e=>E(s,i)},{default:k(()=>[$(U(e.$t("Waf.Custom.index_30")),1)]),_:2},1032,["onClick"]),y(s,i)?(C(),b(a,{key:0,class:"ml-8px",onClick:R},{default:k(()=>[$(U(e.$t("Waf.Custom.index_31")),1)]),_:1})):S("",!0),j(x)?(C(),I("div",{key:1,class:"close",onClick:e=>((e,t)=>{const l=n.value[t];l.children.length>1?l.children.splice(e,1):n.value.splice(t,1)})(s,i)},[F(o,{name:"base-close",size:"16"})],8,ve)):S("",!0)])])]))),128))]))),128)),t[1]||(t[1]=B("div",null,null,-1))])}}}),me=a(he,[["__scopeId","data-v-31e9f077"]]),ge={class:"p-24px"},_e={class:"form-title"},xe={class:"w-320px"},we={class:"w-320px"},ye={class:"form-title mt-8px"},be={class:"flex-1"},Ce={class:"form-title mt-8px"},ke=x({__name:"index",props:{isEdit:{type:Boolean},row:{}},emits:["refresh"],setup(e,{expose:t,emit:l}){const a=e,n=l,d=V(a,"isEdit"),{t:f}=E(),h=q({name:"",server:[],action:"deny",response:null}),g={name:{trigger:["blur","input"],validator:()=>""!==h.name||new Error(f("Waf.Custom.index_18"))},rules:{validator:()=>{for(let e=0;e<x.value.length;e++){const t=x.value[e];for(let e=0;e<t.children.length;e++){const l=t.children[e];if(null===l.field||null===l.condition)return new Error(f("Waf.Custom.index_22"));const{leftFactor:a,rightFactor:n}=l;if(a.show&&""===a.input&&null===a.select)return new Error(f("Waf.Custom.index_22"));if(n.show&&""===n.input&&null===n.select)return new Error(f("Waf.Custom.index_22"))}}return!0}}},x=y([]),w=y(null),b=y(),$=()=>{h.server.length>0?u(h.server.join("\n")):s.error(f("Waf.Custom.index_24"))},W=()=>{const e=O();return x.value.forEach(t=>{const l=O("and");t.children.forEach(e=>{null===e.field&&null===e.condition||l.children.push(M(e))}),e.children.push(l)}),e},O=(e="or")=>({logic:e,type:"block",option:null,children:[]}),M=e=>({type:"option",logic:"",children:[],option:{type:e.field||"",operator:e.condition||"",left_factor:P(e.condition,e.leftFactor),right_factor:P(e.condition,e.rightFactor)}}),R=["in","not_in"],P=(e,t)=>{const{widget:l}=t;return"text"!==l.type||R.includes(e||"")?o(t.select)?t.select.join(","):t.select||"":t.input};return(()=>{if(!d.value)return;const{row:e}=a;e&&(h.name=e.name,h.server=e.servers||null,h.action=e.action.type,h.response=e.action.response.type,X(()=>{b.value.setRules(e.root)}))})(),t({onConfirm:async()=>{await(w.value?.validate());const e=(()=>{const{action:e,response:t}=h;return"allow"===e&&null===t&&(h.response="black_page"),{name:h.name,servers:h.server?h.server:[],status:1,is_global:0,priority:0,root:W(),action:{type:h.action,response:{type:h.response||"",response_id:0,status:0,headers:{},body:""}}}})(),{row:t}=a;d.value&&t?await r({infos:e,id:t.id}):await c(e),n("refresh")}}),(e,t)=>{const l=i,a=p,n=v,o=m,s=_;return C(),I("div",ge,[F(s,{ref_key:"formRef",ref:w,model:j(h),rules:g,"label-width":"140px","label-placement":"left","require-mark-placement":"left"},{default:k(()=>[B("div",_e,U(e.$t("Waf.Custom.index_15")),1),F(n,{label:e.$t("Waf.Custom.index_16")},{default:k(()=>[B("div",xe,[F(D,{value:j(h).server,"onUpdate:value":t[0]||(t[0]=e=>j(h).server=e)},null,8,["value"])]),F(a,{class:"ml-16px",onClick:$},{default:k(()=>[F(l,{name:"common-copy",class:"mr-6px",size:"14"}),B("span",null,U(e.$t("Waf.Custom.index_23")),1)]),_:1})]),_:1},8,["label"]),F(n,{label:e.$t("Waf.Custom.index_17"),path:"name"},{default:k(()=>[B("div",we,[F(o,{value:j(h).name,"onUpdate:value":t[1]||(t[1]=e=>j(h).name=e),spellcheck:"false",placeholder:e.$t("Waf.Custom.index_18")},null,8,["value","placeholder"])])]),_:1},8,["label"]),B("div",ye,U(e.$t("Waf.Custom.index_19")),1),F(n,{label:"",class:"pl-36px",path:"rules"},{default:k(()=>[B("div",be,[F(me,{ref_key:"ruleListRef",ref:b,value:j(x),"onUpdate:value":t[2]||(t[2]=e=>H(x)?x.value=e:null),"is-init":!j(d)},null,8,["value","is-init"])])]),_:1}),B("div",Ce,U(e.$t("Waf.Custom.index_10")),1),F(K,{action:j(h).action,"onUpdate:action":t[3]||(t[3]=e=>j(h).action=e),response:j(h).response,"onUpdate:response":t[4]||(t[4]=e=>j(h).response=e)},null,8,["action","response"])]),_:1},8,["model"])])}}});e("default",a(ke,[["__scopeId","data-v-2a17c742"]]))}}});
