import{_ as e}from"./index102.js?v=1752142539265";import{_ as t}from"./index.vue_vue_type_script_setup_true_lang.js?v=1752142539265";import{k as a,P as i,r as s,e as n,U as l,X as o,V as r,Q as u,a1 as c,an as p,j as d,a3 as _,F as y,O as m,W as f,a2 as h,l as x,v as g,ah as v,N as b}from"./vue.js?v=1752142539265";import{v as S,i as k,p as I,d as w,w as $,x as C,_ as U,e as H}from"./page_layout.js?v=1752142539265";import{c3 as j,c1 as L,bZ as P,cz as R,aq as q,_ as z,ay as O,bX as A,cD as M,cA as W}from"./naive.js?v=1752142539265";import{c as T,_ as F,h as B,d as N,b as E,f as J}from"./public.js?v=1752142539265";import{_ as X}from"./index.vue_vue_type_script_setup_true_lang4.js?v=1752142539265";import{_ as D}from"./index.vue_vue_type_script_setup_true_lang5.js?v=1752142539265";import{_ as Q}from"./index.vue_vue_type_script_setup_true_lang6.js?v=1752142539265";import{_ as V}from"./common.js?v=1752142539265";import"./__commonjsHelpers__.js?v=1752142539265";import"./index.vue_vue_type_script_setup_true_lang7.js?v=1752142539265";const{t:Z}=k.global,G=()=>S.post("/breaking_through?action=get_config"),K=e=>S.post("/breaking_through?action=set_config",e,{requestOptions:{loading:Z("Security.Api.Index_6"),successMessage:!0}}),Y=e=>S.post("/breaking_through?action=panel_ip_white",e,{requestOptions:{loading:Z("Security.Api.Index_4"),successMessage:!0}}),ee=e=>S.post("/breaking_through?action=get_black_white",e),te=e=>S.post("/breaking_through?action=add_black_white",e,{requestOptions:{loading:Z("Security.Api.Index_6"),successMessage:!0}}),ae={class:"pl-5px"},ie={key:0},se={class:"mb-15px"},ne={class:"mr-10px"},le={key:0},oe={class:"mr-10px"},re=a({__name:"index",setup(e,{expose:a}){const{t:v}=i(),b=s(null),k=s(null),$=s(null),C=n({protectionUsername:!0,minutes:5,failures:5,radio:0,check:!1}),U=n({protectionIP:!0,minutes:15,failures:5,ip:"1s",check:!1}),H=n({failures:360}),A=n({user:["aapanel"],ip:["ssh"]}),M=async e=>{await K({username_status:e})},W=async e=>{await K({ip_status:e})},T=async()=>{var e;H.failures&&await(e={history_limit:H.failures},S.post("/breaking_through?action=set_history_record_limit",e,{requestOptions:{loading:Z("Security.Api.Index_6"),successMessage:!0}}))},F={minutes:{trigger:["blur","change"],validator:(e,t)=>null!==t&&0!==t||new Error(v("Security.Conf.Index_27"))},failures:{required:!0,type:"number",trigger:["blur","change"],message:v("Security.Conf.Index_28")}},B={minutes:{trigger:["blur","change"],validator:(e,t)=>null!==t&&0!==t||new Error(v("Security.Conf.Index_27"))},failures:{required:!0,type:"number",trigger:["blur","change"],message:v("Security.Conf.Index_28")}},N={failures:{required:!0,type:"number",trigger:["blur","change"],message:v("Security.Conf.Index_28")}},E=async()=>{var e,t,a;await(null==(e=b.value)?void 0:e.validate()),await(null==(t=k.value)?void 0:t.validate()),await(null==(a=$.value)?void 0:a.validate()),await K({username_limit:C.minutes,username_count:C.failures,username_type:C.radio,username_limit_root:C.check,ip_limit:U.minutes,ip_count:U.failures,ip_command:U.ip,ip_ipset_filter:U.check,history_limit:H.failures}),J()},J=async()=>{const{message:e}=await G();w(e)&&(C.protectionUsername=e.username_status,C.minutes=e.based_on_username.limit,C.failures=e.based_on_username.count,C.radio=e.based_on_username.type,C.check=e.based_on_username.limit_root,U.protectionIP=e.ip_status,U.minutes=e.based_on_ip.limit,U.failures=e.based_on_ip.count,U.ip=e.based_on_ip.command,U.check=e.based_on_ip.ipset_filter,H.failures=e.history_limit);const{message:t}=await S.post("/breaking_through?action=get_protected_services");w(t)&&(A.user=t.based_on_username,A.ip=t.based_on_ip)};return J(),a({init:J}),(e,a)=>{const i=j,s=L,n=P,v=R,S=t,w=I,J=q,X=z,D=O;return o(),l("div",ae,[r("h3",null,[d(_(e.$t("Security.Conf.Index_5"))+" ("+_(e.$t("Security.Conf.Index_37"))+" ",1),(o(!0),l(y,null,m(f(A).user,((e,t)=>(o(),l("span",{key:t},[d(_(e),1),t<f(A).user.length-1?(o(),l("span",ie,"、")):p("",!0)])))),128)),a[9]||(a[9]=d(") "))]),u(i,{"show-icon":!1,class:"my-15px"},{default:h((()=>[d(_(e.$t("Security.Conf.Index_6")),1)])),_:1}),r("div",se,[r("span",ne,_(e.$t("Site.TableRow.index_14")),1),u(s,{size:"small",value:f(C).protectionUsername,"onUpdate:value":[a[0]||(a[0]=e=>f(C).protectionUsername=e),M]},null,8,["value"])]),f(C).protectionUsername?(o(),c(S,{key:0,ref_key:"userFormRef",ref:b,"label-placement":"top",model:f(C),rules:F},{default:h((()=>[u(v,{label:e.$t("Security.Conf.Index_7"),path:"minutes"},{default:h((()=>[u(n,{"show-button":!1,value:f(C).minutes,"onUpdate:value":a[1]||(a[1]=e=>f(C).minutes=e)},null,8,["value"])])),_:1},8,["label"]),u(v,{label:e.$t("Security.Conf.Index_8"),path:"failures"},{default:h((()=>[u(n,{"show-button":!1,value:f(C).failures,"onUpdate:value":a[2]||(a[2]=e=>f(C).failures=e)},null,8,["value"])])),_:1},8,["label"])])),_:1},8,["model"])):p("",!0),u(w,{class:"mb-20px!"}),r("h3",null,[d(_(e.$t("Security.Conf.Index_12"))+" ("+_(e.$t("Security.Conf.Index_37"))+" ",1),(o(!0),l(y,null,m(f(A).ip,((e,t)=>(o(),l("span",{key:t},[d(_(e),1),t<f(A).ip.length-1?(o(),l("span",le,"、")):p("",!0)])))),128)),a[10]||(a[10]=d(") "))]),u(i,{"show-icon":!1,class:"my-15px"},{default:h((()=>[d(_(e.$t("Security.Conf.Index_13")),1)])),_:1}),r("span",oe,_(e.$t("Site.TableRow.index_14")),1),u(s,{size:"small",value:f(U).protectionIP,"onUpdate:value":[a[3]||(a[3]=e=>f(U).protectionIP=e),W]},null,8,["value"]),f(U).protectionIP?(o(),c(S,{key:1,ref_key:"ipFormRef",ref:k,"label-placement":"top",model:f(U),rules:B,class:"pt-15px"},{default:h((()=>[u(v,{label:e.$t("Security.Conf.Index_14"),path:"minutes"},{default:h((()=>[u(n,{"show-button":!1,value:f(U).minutes,"onUpdate:value":a[4]||(a[4]=e=>f(U).minutes=e)},null,8,["value"])])),_:1},8,["label"]),u(v,{label:e.$t("Security.Conf.Index_15"),path:"failures"},{default:h((()=>[u(n,{"show-button":!1,value:f(U).failures,"onUpdate:value":a[5]||(a[5]=e=>f(U).failures=e)},null,8,["value"])])),_:1},8,["label"]),u(v,{label:e.$t("Security.Conf.Index_16")},{default:h((()=>[u(J,{class:"w-150px!",value:f(U).ip,"onUpdate:value":a[6]||(a[6]=e=>f(U).ip=e),placeholder:e.$t("Security.Conf.Index_38")},null,8,["value","placeholder"])])),_:1},8,["label"]),u(X,{checked:f(U).check,"onUpdate:checked":a[7]||(a[7]=e=>f(U).check=e)},{default:h((()=>[d(_(e.$t("Security.Conf.Index_17")),1)])),_:1},8,["checked"]),x(r("div",{class:"mt-10px ml-24px text-desc"},_(e.$t("Security.Conf.Index_39",[f(U).minutes])),513),[[g,f(U).check]])])),_:1},8,["model"])):p("",!0),u(w,{class:"my-20px!"}),r("h3",null,_(e.$t("Security.Conf.Index_22")),1),u(S,{"label-placement":"top",model:f(H),rules:N,ref_key:"historyFormRef",ref:$,class:"pt-15px"},{default:h((()=>[u(v,{label:e.$t("Security.Conf.Index_23"),path:"failures"},{default:h((()=>[u(n,{"show-button":!1,placeholder:e.$t("Site.Placeholder.Index_10"),value:f(H).failures,"onUpdate:value":a[8]||(a[8]=e=>f(H).failures=e),onBlur:T},null,8,["placeholder","value"])])),_:1},8,["label"])])),_:1},8,["model"]),u(w,{class:"mb-20px!"}),u(D,{type:"primary",onClick:E},{default:h((()=>[d(_(e.$t("Site.Cert.index_60")),1)])),_:1})])}}}),ue={class:"pl-5px"},ce=a({__name:"index",setup(e,{expose:t}){const a=s(""),{loading:i,setLoading:n}=T(!0),c=async()=>{const e=JSON.stringify(a.value);await te({ips:e.replace(/^"|"$/g,""),types:"white",hand:!0}),p()},p=async()=>{try{n(!0);const{message:e}=await ee({types:"white"});$(e)&&(a.value=e.map((e=>"".concat(e.ip," # ").concat(e.ps))).join("\n"))}finally{n(!1)}};return p(),t({init:p}),(e,t)=>{const s=j,n=q,p=F,y=A,m=O;return o(),l("div",ue,[u(s,{"show-icon":!1},{default:h((()=>[d(_(e.$t("Security.WhiteList.Index_1")),1)])),_:1}),u(y,{class:"items-center my-15px"},{default:h((()=>[u(n,{class:"w-500px!",type:"textarea",loading:f(i),value:f(a),"onUpdate:value":t[0]||(t[0]=e=>v(a)?a.value=e:null),autosize:{minRows:10},placeholder:e.$t("Ftp.Placeholder.Index_3")},null,8,["loading","value","placeholder"]),u(p,null,{default:h((()=>[r("li",null,_(e.$t("Security.WhiteList.Index_2")),1),r("li",null,_(e.$t("Security.WhiteList.Index_3")),1),r("li",null,_(e.$t("Security.WhiteList.Index_4")),1)])),_:1})])),_:1}),u(m,{type:"primary",onClick:c},{default:h((()=>[d(_(e.$t("Site.Cert.index_60")),1)])),_:1})])}}}),pe={class:"pl-5px"},de=a({__name:"index",setup(e,{expose:t}){const a=s(""),{loading:i,setLoading:n}=T(!0),c=async()=>{const e=JSON.stringify(a.value);await te({ips:e.replace(/^"|"$/g,""),types:"black",hand:!0}),p()},p=async()=>{try{n(!0);const{message:e}=await ee({types:"black"});$(e)&&(a.value=e.map((e=>"".concat(e.ip," # ").concat(e.ps))).join("\n"))}finally{n(!1)}};return p(),t({init:p}),(e,t)=>{const s=j,n=q,p=F,y=A,m=O;return o(),l("div",pe,[u(s,{"show-icon":!1},{default:h((()=>[d(_(e.$t("Security.BlackList.Index_1")),1)])),_:1}),u(y,{class:"items-center my-15px"},{default:h((()=>[u(n,{class:"w-500px!",type:"textarea",loading:f(i),value:f(a),"onUpdate:value":t[0]||(t[0]=e=>v(a)?a.value=e:null),autosize:{minRows:10},placeholder:e.$t("Ftp.Placeholder.Index_3")},null,8,["loading","value","placeholder"]),u(p,null,{default:h((()=>[r("li",null,_(e.$t("Security.WhiteList.Index_2")),1),r("li",null,_(e.$t("Security.WhiteList.Index_3")),1),r("li",null,_(e.$t("Security.WhiteList.Index_4")),1)])),_:1})])),_:1}),u(m,{type:"primary",onClick:c},{default:h((()=>[d(_(e.$t("Site.Cert.index_60")),1)])),_:1})])}}}),_e=a({__name:"index",setup(e,{expose:t}){const{t:a}=i(),s=n({p:1,limit:10,keyword:"",types:"login"}),m=[{key:"user",title:a("Security.History.Index_7"),width:"15%"},{key:"ip",title:a("Security.History.Index_8"),width:"15%"},{key:"service",title:a("Security.History.Index_10"),width:"15%"},{key:"logintime",title:a("Security.History.Index_11"),align:"center",width:"10%"}],x=[{key:"ip",title:a("Security.History.Index_8"),width:"15%"},{key:"lock_status",title:a("Home.index_66"),width:"20%"},{key:"block_reason",title:a("Security.Anti.Index_21"),width:"20%"},{key:"exptime",title:a("Security.History.index_20"),width:"20%"},{key:"timeleft",title:a("Security.History.index_21"),width:"20%",align:"center"},B({title:a("Public.Table.Action"),align:"right",options:e=>[{label:a("Security.History.Index_16"),onClick:async()=>{N({title:"".concat(a("Security.History.Index_16")," [").concat(e.ip,"]"),content:a("Security.History.Index_17"),onConfirm:async()=>{await Y({ip:e.ip,hand:!0,ps:"Manually add",clear_black:1}),P()}})}}]})],{keys:g,table:v,columns:k}=E(m),I=[{label:a("Security.History.Index_3"),value:"login"},{label:a("Security.History.Index_5"),value:"ip"}],$=async()=>{s.keyword="",s.p=1,v.data=[],k.value="ip"===s.types?x:m,P()},H=async()=>{N({title:a("Security.History.Index_1"),content:a("Security.History.Index_18"),onConfirm:async()=>{await S.post("/breaking_through?action=clear_history_record_limit",{},{requestOptions:{loading:Z("Security.Api.Index_7"),successMessage:!0}}),P()}})},{loading:j,setLoading:L}=T(!0),P=async()=>{try{L(!0);const{message:t}=await(e=b(s),S.post("/breaking_through?action=get_history_record",e));w(t)?(v.data=t.data,v.total=C(t.page)):(v.data=[],v.total=0)}finally{g.value=[],L(!1)}var e};return P(),t({init:P}),(e,t)=>{const a=U,i=O,n=M,m=Q,x=A,g=J,b=D,S=X,w=F;return o(),l(y,null,[u(S,{class:"pl-5px"},{toolsLeft:h((()=>[u(i,{type:"primary",onClick:P},{icon:h((()=>[u(a,{name:"refresh",size:"14"})])),default:h((()=>[d(" "+_(e.$t("Public.Btn.Refresh")),1)])),_:1}),u(i,{onClick:H},{default:h((()=>[d(_(e.$t("Security.History.Index_1")),1)])),_:1})])),toolsRight:h((()=>[d(_(e.$t("Security.History.Index_2"))+" ",1),u(x,{class:"flex-nowrap!"},{default:h((()=>[u(n,{value:f(s).types,"onUpdate:value":[t[0]||(t[0]=e=>f(s).types=e),$],options:I,class:"w-200px"},null,8,["value"]),u(m,{value:f(s).keyword,"onUpdate:value":t[1]||(t[1]=e=>f(s).keyword=e),placeholder:e.$t("Security.History.Index_14"),onSearch:P},null,8,["value","placeholder"])])),_:1})])),table:h((()=>[u(g,{loading:f(j),data:f(v).data,columns:f(k)},null,8,["loading","data","columns"])])),pageRight:h((()=>[u(b,{page:f(s).p,"onUpdate:page":t[2]||(t[2]=e=>f(s).p=e),"page-size":f(s).limit,"onUpdate:pageSize":t[3]||(t[3]=e=>f(s).limit=e),"item-count":f(v).total,onRefresh:P},null,8,["page","page-size","item-count"])])),_:1}),"ip"===f(s).types?(o(),c(w,{key:0},{default:h((()=>[r("li",null,_(e.$t("Security.History.Index_19")),1)])),_:1})):p("",!0)],64)}}}),ye=a({__name:"index",setup(t){const{t:a}=i(),n=s("config"),l=[{key:"config",label:a("Security.Tabs.Index_1"),component:re},{key:"white",label:a("Security.Tabs.Index_2"),component:ce},{key:"black",label:a("Security.Tabs.Index_3"),component:de},{key:"history",label:a("Security.Tabs.Index_4"),component:_e}];return(t,a)=>{const i=e;return o(),c(i,{value:f(n),"onUpdate:value":a[0]||(a[0]=e=>v(n)?n.value=e:null),options:l},null,8,["value"])}}}),me={class:"mr-15px"},fe=H(a({__name:"index",setup(e){const{t:t}=i(),a=n({address:"",show:!1}),m=s(!1),x=async e=>{m.value=!e;const a=t("Security.Conf.Index_1"),i=t("Security.Conf.Index_4");N({title:a,content:i,onConfirm:async({hide:t})=>{await K({global_status:e}),m.value=e,t()}})},g=async()=>{await Y({ip:a.address,hand:!0}),I()},{loading:b,setLoading:k}=T(!0),I=async()=>{k(!0);const{message:e}=await G();if(w(e)&&(m.value=e.global_status,k(!1),!e.global_status))return;const{data:t}=await V.get("https://api.ipify.org?format=json");a.address=t.ip;try{await(e=>S.post("/breaking_through?action=check_local_ip_white",e,{requestOptions:{loading:"",successMessage:!1,errorMessage:!1}}))({ip:t.ip}),a.show=!1}catch(i){a.show=!0,console.error(i)}};return I(),(e,t)=>{const i=O,s=j,n=L,S=A,k=W;return o(),l(y,null,[f(a).show&&f(m)?(o(),c(s,{key:0,class:"py-10px",type:"warning",bordered:!1},{default:h((()=>[r("span",me,_(e.$t("Security.Conf.Index_2",[f(a).address])),1),u(i,{text:"",type:"primary",onClick:g},{default:h((()=>[d(" ["+_(e.$t("Security.Conf.Index_3"))+"] ",1)])),_:1})])),_:1})):p("",!0),u(k,{class:"my-15px"},{default:h((()=>[u(S,{class:"p-15px items-center"},{default:h((()=>[r("span",null,_(e.$t("Security.Conf.Index_1")),1),u(n,{value:f(m),"onUpdate:value":[t[0]||(t[0]=e=>v(m)?m.value=e:null),x],"rubber-band":!1,loading:f(b),size:"small"},null,8,["value","loading"])])),_:1})])),_:1}),f(m)?(o(),c(k,{key:1,class:"p-15px"},{default:h((()=>[u(ye)])),_:1})):p("",!0)],64)}}}),[["__scopeId","data-v-88b60c14"]]);export{fe as default};
