const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["js/form2.js?v=1769066082311","js/index.vue_vue_type_script_setup_true_lang.js?v=1769066082311","js/vue.js?v=1769066082311","js/__commonjsHelpers__.js?v=1769066082311","js/naive.js?v=1769066082311","js/common.js?v=1769066082311","js/index.vue_vue_type_script_setup_true_lang20.js?v=1769066082311","js/page_layout.js?v=1769066082311","js/public.js?v=1769066082311","css/public.css?v=1769066082311","css/page_layout.css?v=1769066082311","js/index.vue_vue_type_script_setup_true_lang10.js?v=1769066082311","js/alarm.js?v=1769066082311","js/index220.js?v=1769066082311","css/index42.css?v=1769066082311"])))=>i.map(i=>d[i]);
import{_ as e}from"./index114.js?v=1769066082311";import{x as t,i as a,p as n,aa as i,aI as l,h as s,d as o,a as r,o as d,y as m}from"./page_layout.js?v=1769066082311";import{_ as c}from"./index.js?v=1769066082311";import{_ as u}from"./index.vue_vue_type_script_setup_true_lang5.js?v=1769066082311";import{c as p,f as _,a as g,h as f,u as x,e as C,n as h}from"./public.js?v=1769066082311";import{g as w,d as A,a as k,c as y,b,e as v,s as j,o as L,f as P}from"./alarm.js?v=1769066082311";import{r as z,k as R,t as T,P as W,c as E,W as M,R as U,V as $,S as H,a2 as B,a4 as I,U as V,e as D,N as O,a3 as S,j as q,F,b as N,_ as G,H as J,n as K,o as Q,am as X,ak as Y}from"./vue.js?v=1769066082311";import{_ as Z}from"./index.vue_vue_type_script_setup_true_lang7.js?v=1769066082311";import{dh as ee,d9 as te,aC as ae,dT as ne}from"./naive.js?v=1769066082311";import"./common.js?v=1769066082311";import"./__commonjsHelpers__.js?v=1769066082311";import"./index.vue_vue_type_script_setup_true_lang6.js?v=1769066082311";const ie=z([]),le=new Map([["mail",a.global.t("Config.Alarm.index_3")],["feishu",a.global.t("Config.Alarm.index_4")],["dingding",a.global.t("Config.Alarm.index_5")],["weixin",a.global.t("Config.Alarm.index_6")],["tg","Telegram"]]);function se(e){const t=ie.value.find(t=>t.id===e);return t?"".concat(t.data.title," (").concat(le.get(t.sender_type),")"):""}const oe={class:"p-20px"},re={class:"alarm-info"},de={class:"alarm-title"},me={key:1,class:"alarm-box"},ce={class:"alarm-info"},ue={class:"alarm-title"},pe=["innerHTML"],_e=n(R({__name:"record-details",props:{row:{}},setup(e){const t=T(e,"row"),{t:a}=W(),n=E(()=>Object.entries(t.value.result.send_data).map(e=>{const t=se(e[0]);return{result:1===e[1],resultMsg:1===e[1]?a("Config.Alarm.index_108"):e[1],account:t}})),i=z([{key:"account",title:a("Config.Alarm.index_106"),render:e=>e.account||"--"},{key:"resultMsg",title:a("Config.Alarm.index_107"),render:e=>M("span",{class:e.result?"text-primary":"text-error"},[e.resultMsg])}]);return(e,a)=>{const l=ee;return $(),U("div",oe,[H("div",re,[H("div",de,I(e.$t("Config.Alarm.index_104")),1),V(n).length>0?($(),B(l,{key:0,data:V(n),columns:V(i)},null,8,["data","columns"])):($(),U("div",me,I(V(t).result.stop_msg),1))]),H("div",ce,[H("div",ue,I(e.$t("Config.Alarm.index_105")),1),H("div",{class:"alarm-box",innerHTML:e.row.send_data.msg_list.join("<br />")},null,8,pe)])])}}}),[["__scopeId","data-v-fc294895"]]),ge={class:"p-20px"},fe=R({__name:"record",props:{row:{}},setup(e){const a=T(e,"row"),{t:n}=W(),r=()=>{g({title:n("Config.Alarm.index_95",[a.value.title]),content:n("Config.Alarm.index_96",[a.value.title]),onConfirm:async()=>{await y({task_id:a.value.id,record_ids:[]}),b()}})},{table:d,columns:m,setLoading:c}=p([{key:"create_time",title:n("Config.Alarm.index_97"),render:e=>i(e.create_time)},{key:"do_send",title:n("Config.Alarm.index_98"),render:e=>{let t=e.result.stop_msg;if(e.do_send){const a=Object.values(e.result.send_data).reduce((e,t)=>(l(t)&&1===t?e.success++:s(t)&&e.fail++,e),{success:0,fail:0});t=n("Config.Alarm.index_99",[a.success,a.fail])}return M(te,null,{trigger:()=>M("span",{class:e.do_send?"text-primary":"text-error"},[e.do_send?n("Config.Alarm.index_110"):n("Config.Alarm.index_100")]),default:()=>M(F,null,[t])})}},{key:"details",title:n("Config.Alarm.index_101"),render:e=>M("a",{class:"bt-link",href:"javascript:;",onClick:()=>{C(e)}},[n("Config.Alarm.index_109")])},_({width:100,options:e=>[{label:n("Public.Btn.Del"),onClick:()=>{h(e)}}]})]),C=e=>{x({title:n("Config.Alarm.index_101"),width:480,data:{row:e},component:_e})},h=e=>{g({title:n("Config.Alarm.index_102"),content:n("Config.Alarm.index_103"),onConfirm:async()=>{await A({task_id:a.value.id,record_ids:[e.id]}),b()}})},w=D({task_id:a.value.id,page:1,size:10}),b=async()=>{try{c(!0);const{message:e}=await k(O(w));o(e)&&(d.data=t(e.list)?e.list:[],d.total=e.count)}finally{c(!1)}};return b(),(e,t)=>{const a=ae,n=f,i=Z,l=u;return $(),U("div",ge,[M(l,null,{toolsLeft:S(()=>[M(a,{onClick:r},{default:S(()=>[q(I(e.$t("Config.Alarm.index_94")),1)]),_:1})]),table:S(()=>[M(n,{"max-height":382,loading:V(d).loading,data:V(d).data,columns:V(m)},null,8,["loading","data","columns"])]),pageRight:S(()=>[M(i,{page:V(w).page,"onUpdate:page":t[0]||(t[0]=e=>V(w).page=e),"page-size":V(w).size,"onUpdate:pageSize":t[1]||(t[1]=e=>V(w).size=e),"item-count":V(d).total,onRefresh:b},null,8,["page","page-size","item-count"])]),_:1})])}}}),xe=R({__name:"index",setup(e,{expose:a}){const n=G(()=>r(()=>import("./form2.js?v=1769066082311"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]))),{t:l}=W(),s=C("",{isEdit:!1,onRefresh:()=>{P()}}),o=()=>{s.data.isEdit=!1,s.title=l("Config.Alarm.index_1"),s.show=!0},{table:d,columns:m,setLoading:A}=p([{key:"title",title:l("Config.Alarm.index_7"),minWidth:140,ellipsis:{tooltip:!0}},h({minWidth:100,status:e=>({checkedValue:!0,checkedLabel:l("Config.Alarm.index_8"),uncheckedValue:!1,uncheckedLabel:l("Config.Alarm.index_9"),onClick:t=>{y(t,e)}})}),{key:"sender",title:l("Config.Alarm.index_92"),width:"14%",minWidth:140,ellipsis:{tooltip:!0},render:e=>{const{sender:t}=e,a=[];return t.forEach(e=>{const t=se(e);t&&a.push(t)}),a.join(l("Public.Punctuation.Comma"))}},{key:"view_msg",title:l("Config.Alarm.index_10"),width:"34%",minWidth:180,ellipsis:{tooltip:!0},render:e=>M("span",{innerHTML:e.view_msg},null)},{key:"last_check",title:l("Config.Alarm.index_11"),width:"14%",minWidth:140,render:e=>e.last_check?i(e.last_check):"--"},_({width:"12%",minWidth:150,options:e=>[{label:l("Config.Alarm.index_12"),onClick:()=>{k(e)}},{label:l("Public.Btn.Edit"),onClick:()=>{(e=>{s.data.row=e,s.data.isEdit=!0,s.title=l("Config.Alarm.index_2"),s.show=!0})(e)}},{label:l("Public.Btn.Del"),onClick:()=>{L(e)}}]})]),k=e=>{x({title:l("Config.Alarm.index_93",[e.title]),width:800,data:{row:e},component:fe})},y=(e,t)=>{const a=l(e?"Config.Alarm.index_18":"Config.Alarm.index_13");g({title:l("Config.Alarm.index_14",[a,t.title]),content:l("Config.Alarm.index_15",[a.toLocaleLowerCase(),t.title]),onConfirm:async()=>{await j({task_id:t.id,status:e?1:0}),t.status=e}})},L=e=>{g({title:l("Config.Alarm.index_16"),content:l("Config.Alarm.index_17"),onConfirm:async()=>{await b({task_id:e.id}),P()}})},P=async(e=!1)=>{try{A(!0),e&&await async function(){const{message:e}=await w({refresh:0});ie.value=t(e)?e:[]}();const{message:a}=await v();d.data=t(a)?a:[]}finally{A(!1)}};return P(!0),N(()=>{ie.value=[]}),a({init:P}),(e,t)=>{const a=ae,i=f,l=u,r=c;return $(),U("div",null,[M(l,null,{toolsLeft:S(()=>[M(a,{type:"primary",onClick:o},{default:S(()=>[q(I(e.$t("Config.Alarm.index_91")),1)]),_:1})]),table:S(()=>[M(i,{loading:V(d).loading,data:V(d).data,columns:V(m)},null,8,["loading","data","columns"])]),_:1}),M(r,{show:V(s).show,"onUpdate:show":t[0]||(t[0]=e=>V(s).show=e),title:V(s).title,data:V(s).data,width:860,"min-height":340,footer:!0,component:V(n)},null,8,["show","title","data","component"])])}}}),Ce={class:"flex items-center"},he={class:"flex-1 leading-[1.5]"},we={class:"flex"},Ae=["href"],ke=n(R({__name:"table-module",props:{row:{}},emits:["click"],setup(e,{emit:t}){const a=t,n=()=>{a("click")};return(e,t)=>($(),U("div",Ce,[H("div",{class:J(["icon",e.row.name])},null,2),H("div",he,[H("span",{class:"text-14px font-bold cursor-pointer",onClick:n},I(e.row.title),1),H("div",we,[H("span",null,I(e.row.ps),1),H("a",{class:"bt-link",href:e.row.help,target:"_blank"},">>"+I(e.$t("Config.Alarm.index_42")),9,Ae)])])]))}}),[["__scopeId","data-v-10528a00"]]),ye=R({__name:"table-config",props:{row:{}},emits:["click"],setup(e,{emit:t}){const a=t,n=T(e,"row"),{t:i}=W(),l=E(()=>n.value.list.map(e=>e.data.title).join(i("Public.Punctuation.Comma"))),s=()=>{a("click")};return(e,t)=>{const a=d;return $(),U("div",null,[V(n).list.length<=0?($(),B(a,{key:0,type:"error",onClick:s},{default:S(()=>[q(I(e.$t("Config.Alarm.index_40")),1)]),_:1})):($(),U("span",{key:1,class:"cursor-pointer",onClick:s},I(e.$t("Config.Alarm.index_41",[V(l)])),1))])}}}),be=R({__name:"index",setup(e,{expose:a}){const{t:n}=W(),{table:i,columns:l,setLoading:s}=p([{key:"module",title:n("Config.Alarm.index_34"),width:"42%",minWidth:400,render:e=>M(ke,{row:e,onClick:()=>{o(e)}},null)},{key:"config",title:n("Config.Alarm.index_35"),minWidth:320,render:e=>M(ye,{row:e,onClick:()=>{o(e)}},null)},_({width:100,options:e=>[{label:n("Public.Btn.Conf"),onClick:()=>{o(e)}}]})]),o=e=>{L({row:e,onRefresh:d})},r=[{name:"mail",title:n("Config.Alarm.index_3"),ps:n("Config.Alarm.index_36"),help:"https://www.bt.cn/bbs/thread-66183-1-1.html"},{name:"dingding",title:n("Config.Alarm.index_5"),ps:n("Config.Alarm.index_37"),help:"https://www.bt.cn/bbs/thread-108081-1-1.html"},{name:"weixin",title:n("Config.Alarm.index_6"),ps:n("Config.Alarm.index_38"),help:"https://www.bt.cn/bbs/thread-108116-1-1.html"},{name:"feishu",title:n("Config.Alarm.index_4"),ps:n("Config.Alarm.index_39"),help:"https://www.aapanel.com/forum/d/16942-aapanel-how-does-set-lark-or-feishu-notification"},{name:"tg",title:"Telegram",ps:"Use Telegram to send and receive panel notifications",help:"https://www.aapanel.com/forum/d/5115-how-to-add-telegram-to-panel-notifications"}],d=async()=>{try{s(!0);const{message:e}=await w({refresh:1});t(e)&&i.data.forEach(t=>{t.list=e.filter(e=>e.sender_type===t.name)})}finally{s(!1)}};return i.data=r.map(e=>({...e,list:[]})),K(()=>{d()}),a({init:d}),(e,t)=>{const a=f;return $(),U("div",null,[M(a,{loading:V(i).loading,data:V(i).data,columns:V(l)},null,8,["loading","data","columns"])])}}}),ve=R({__name:"index",setup(e,{expose:a}){const{t:n}=W(),{table:i,columns:l,setLoading:s}=p([{key:"log",title:n("Config.Alarm.index_7"),ellipsis:{tooltip:!0},render:e=>M("span",{innerHTML:e.log},null)},{key:"addtime",title:n("Config.Alarm.index_87"),width:150}]),r=D({p:1,limit:20}),d=async()=>{try{s(!0);const{message:e}=await P(O(r));o(e)&&(i.data=t(e.data)?e.data:[],i.total=m(e.page))}finally{s(!1)}};return Q(()=>{d()}),a({init:d}),(e,t)=>{const a=f,n=Z,s=u;return $(),U("div",null,[M(s,null,{table:S(()=>[M(a,{loading:V(i).loading,data:V(i).data,columns:V(l)},null,8,["loading","data","columns"])]),pageRight:S(()=>[M(n,{page:V(r).p,"onUpdate:page":t[0]||(t[0]=e=>V(r).p=e),"page-size":V(r).limit,"onUpdate:pageSize":t[1]||(t[1]=e=>V(r).limit=e),"item-count":V(i).total,"store-key":"alarm-logs",onRefresh:d},null,8,["page","page-size","item-count"])]),_:1})])}}}),je=R({__name:"index",setup(t){const{t:a}=W(),n=X(),i=z("list"),l=[{key:"list",label:a("Config.Alarm.index_88"),component:xe},{key:"settings",label:a("Config.Alarm.index_89"),component:be},{key:"logs",label:a("Config.Alarm.index_90"),component:ve}],s=n.currentRoute.value.query;return s.menu&&(i.value=s.menu),(t,a)=>{const n=e,s=ne;return $(),B(s,{class:"p-16px"},{default:S(()=>[M(n,{value:V(i),"onUpdate:value":a[0]||(a[0]=e=>Y(i)?i.value=e:null),options:l},null,8,["value"])]),_:1})}}});export{je as default};
