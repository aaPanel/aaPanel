import{_ as a}from"./index223.js?v=1769066082311";import{i as e,p as n,k as s,P as t,r as i,R as o,V as r,S as l,W as p,a4 as d,U as c,a2 as m,F as u,a3 as v,j as _,e as g,ak as b}from"./vue.js?v=1769066082311";import{_ as x,a as h,b as f,d as y}from"./public.js?v=1769066082311";import{_ as w}from"./index176.js?v=1769066082311";import{aE as D,i as M,M as P,u as k,q as j,d as C,m as A,fL as $,x as S,p as q,c as U}from"./page_layout.js?v=1769066082311";import{aC as z,dW as B,db as O,d6 as F,dS as I,dg as L}from"./naive.js?v=1769066082311";import{a as E}from"./soft.js?v=1769066082311";import{g as H}from"./site.js?v=1769066082311";import{_ as N}from"./index.vue_vue_type_script_setup_true_lang.js?v=1769066082311";import"./__commonjsHelpers__.js?v=1769066082311";import"./common.js?v=1769066082311";const R=Symbol("php-admin");const{t:T}=M.global,W=()=>D.post("/adminer_manager?action=get_status"),V=a=>D.post("/adminer_manager?action=install",a,{requestOptions:{loading:T("Database.adminerManager.installing"),successMessage:!0}});async function G(a,e,n,s=""){const t=document.createElement("form");t.action="".concat(P(),"/adminer/index.php?driver=").concat(a,"&username=").concat(e),t.method="post",t.target="_blank",t.style.display="none";let i="";"mongo"===a&&(i="localhost:27017".concat("root"===e?"/admin?authSource=admin":"/".concat(e,"?authSource=").concat(e)),s="root"===e?"admin":s);const o='\n\t\t<input type="text" name="auth[driver]" id="driver" value="'.concat(a,'" size="24" />\n\t\t<input type="text" name="auth[username]" id="username" value="').concat(e,'" size="24" />\n\t\t<input type="password" name="auth[password]" id="password" value="').concat(n,'" size="24" />\n\t\t<input type="text" name="auth[db]" id="db" value="').concat(s,'" size="24" />\n\t\t<input type="text" name="auth[server]" id="server" value="').concat(i,'" size="24" />\n\t');t.innerHTML=o,document.body.appendChild(t),t.submit(),document.body.removeChild(t)}const J={class:"p-4px"},K={class:"flex items-center h-40px mb-10px text-14px whitespace-pre-wrap"},Q={class:"flex gap-10px"},X={class:"mt-20px"},Y={class:"flex gap-24px mt-20px"},Z=q(s({__name:"index",setup(a,{expose:n}){const{t:s}=t(),{type:g,db:b,username:y,password:M}=e(R),q=k(),U=i(!1),B=i(""),O=async()=>{h({title:s("Database.adminerManager.service.fixed"),content:s("Database.adminerManager.service.confirmFixed"),onConfirm:async()=>{await V({version:B.value}),N()}})},F=()=>{h({title:s("Database.adminerManager.service.uninstall"),content:s("Database.adminerManager.service.confirmUninstall"),onConfirm:async()=>{await D.post("/adminer_manager?action=uninstall",{},{requestOptions:{loading:T("Database.adminerManager.uninstalling"),successMessage:!0}}),N()}})},I=()=>{h({title:s("Database.adminerManager.service.install"),content:s("Database.adminerManager.service.confirmInstall"),onConfirm:async()=>{const{message:a}=await D.post("/adminer_manager?action=support_versions");S(a)&&await V({version:a[0]}),N()}})},L=new Map([["pgsql","postgres"],["mongo","root"]]),E=async()=>{if(q.isFree)return void f({source:160});if(y&&M&&b)return void G(g,y,M,b);const a=A.loading(s("Database.adminerManager.service.jumpingToAdminer"));try{if("mongo"===g)return void(await H());const{message:a}=await $(g);C(a)&&G(g,L.get(g)||"",a.result)}finally{a.close()}},H=async()=>{const{message:a}=await $("mongodb");C(a)&&G(g,L.get(g)||"",a.root)},N=async()=>{const{message:a}=await W();C(a)&&(U.value=1===a.install,B.value=a.version)};return N(),n({init:N}),(a,e)=>{const n=w,s=z,t=j,i=x;return r(),o("div",J,[l("div",K,[l("span",null,d(a.$t("Database.adminerManager.service.currentStatus")),1),p(n,{value:c(U)},null,8,["value"])]),l("div",Q,[c(U)?(r(),o(u,{key:0},[p(s,{onClick:O},{default:v(()=>[_(d(a.$t("Database.adminerManager.service.fixed")),1)]),_:1}),p(s,{onClick:F},{default:v(()=>[_(d(a.$t("Public.Btn.Uninstall")),1)]),_:1})],64)):(r(),m(s,{key:1,onClick:I},{default:v(()=>[_(d(a.$t("Public.Btn.Install")),1)]),_:1}))]),l("div",X,[p(t,{dashed:""})]),l("div",Y,[p(s,{class:"access-btn",onClick:E},{default:v(()=>[l("span",null,d(a.$t("Database.PhpAdmin.index_11")),1),e[1]||(e[1]=l("span",{class:"bg-recommend"},null,-1))]),_:1,__:[1]}),p(s,{class:"access-btn",onClick:e[0]||(e[0]=a=>(async()=>{window.open("".concat(P(),"/adminer/index.php?driver=").concat(g))})())},{default:v(()=>[_(d(a.$t("Database.PhpAdmin.index_6")),1)]),_:1})]),p(i,{class:"mt-16px"},{default:v(()=>[l("li",null,d(a.$t("Database.PhpAdmin.index_7")),1),l("li",null,d(a.$t("Database.PhpAdmin.index_33")),1)]),_:1})])}}}),[["__scopeId","data-v-989f4d59"]]),aa={class:"p-8px"},ea={class:"w-160px"},na=s({__name:"index",setup(a,{expose:e}){const{t:n}=t(),s=g({php_version:null}),m=i([]),{loading:u,setLoading:b}=y(),x=async()=>{try{b(!0);const[a,e]=await Promise.all([H(),W()]),{message:n}=a;S(n)&&(m.value=n.filter(a=>"00"!==a.version).map(a=>({label:a.name,value:a.version})));const{message:t}=e;s.php_version=F(t,"php_version",null)}finally{b(!1)}},h=async()=>{const a=s.php_version;var e;null!==a?(await(e={php_version:a},D.post("/adminer_manager?action=switch_php",e,{requestOptions:{loading:T("Database.adminerManager.switchingPhp"),successMessage:!0}})),x()):A.error(n("Database.PhpAdmin.index_32"))},f=async()=>{const{message:a}=await U({sName:"php-".concat(Number(s.php_version)/10)});C(a)&&E(a)};return x(),e({init:x}),(a,e)=>{const n=B,t=z,i=O;return r(),o("div",aa,[p(i,{class:"items-center"},{default:v(()=>[l("span",null,d(a.$t("Database.PhpAdmin.index_31")),1),l("div",ea,[p(n,{value:c(s).php_version,"onUpdate:value":e[0]||(e[0]=a=>c(s).php_version=a),loading:c(u),options:c(m)},null,8,["value","loading","options"])]),p(t,{disabled:null===c(s).php_version,type:"primary",onClick:h},{default:v(()=>[_(d(a.$t("Public.Btn.Save")),1)]),_:1},8,["disabled"]),p(t,{disabled:null===c(s).php_version,onClick:f},{default:v(()=>e[1]||(e[1]=[_(" Settings ",-1)])),_:1,__:[1]},8,["disabled"])]),_:1})])}}}),sa={class:"p-4px"},ta={class:"w-142px mr-8px"},ia=s({__name:"index",setup(a,{expose:e}){const{t:n}=t(),s=i(null),m=async()=>{const a=s.value;var e;null!==a?(await(e={port:a},D.post("/adminer_manager?action=switch_port",e,{requestOptions:{loading:T("Database.adminerManager.switchingPort"),successMessage:!0}})),g()):A.error(n("Database.PhpAdmin.index_25"))},u=i(!1),g=async()=>{const{message:a}=await W();s.value=F(a,"port",null)},x=()=>{g()};return x(),e({init:x}),(a,e)=>{const n=L,t=z,i=I,g=N;return r(),o("div",sa,[p(g,{"label-width":"160"},{default:v(()=>[p(i,{label:a.$t("Database.PhpAdmin.index_16"),"label-width":"auto"},{default:v(()=>[l("div",ta,[p(n,{value:c(s),"onUpdate:value":e[0]||(e[0]=a=>b(s)?s.value=a:null),min:0,max:66325,"show-button":!1,loading:c(u),placeholder:""},null,8,["value","loading"])]),p(t,{type:"primary",onClick:m},{default:v(()=>[_(d(a.$t("Public.Btn.Save")),1)]),_:1})]),_:1},8,["label"])]),_:1})])}}}),oa={class:"h-580px"},ra=s({__name:"index",props:{type:{},username:{},password:{},db:{}},setup(e){const s=e,{t:l}=t(),d=i("service"),m=[{key:"service",label:l("Database.PhpAdmin.index_1"),component:Z},{key:"php",label:l("Database.PhpAdmin.index_2"),component:na},{key:"safe",label:l("Database.PhpAdmin.index_3"),component:ia}];var u;return u={type:s.type,username:s.username,password:s.password,db:s.db},n(R,u),(e,n)=>{const s=a;return r(),o("div",oa,[p(s,{value:c(d),"onUpdate:value":n[0]||(n[0]=a=>b(d)?d.value=a:null),ref:"tabsRef",data:m},null,8,["value"])])}}});export{ra as default};
